!function a(b,c,d){function e(f,h){var i,j,k;if(!c[f]){if(!b[f]){if(i="function"==typeof require&&require,!h&&i)return i(f,!0);if(g)return g(f,!0);throw j=new Error("Cannot find module '"+f+"'"),j.code="MODULE_NOT_FOUND",j}k=c[f]={exports:{}},b[f][0].call(k.exports,function(a){var c=b[f][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[f].exports}var f,g="function"==typeof require&&require;for(f=0;f<d.length;f++)e(d[f]);return e}({1:[function(require,module,exports){(function(process,global){!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;"undefined"!=typeof window?b=window:"undefined"!=typeof global?b=global:"undefined"!=typeof self&&(b=self),b.Promise=a()}}(function(){var define,module,exports;return function a(b,c,d){function e(f,h){var i,j,k;if(!c[f]){if(!b[f]){if(i="function"==typeof _dereq_&&_dereq_,!h&&i)return i(f,!0);if(g)return g(f,!0);throw j=new Error("Cannot find module '"+f+"'"),j.code="MODULE_NOT_FOUND",j}k=c[f]={exports:{}},b[f][0].call(k.exports,function(a){var c=b[f][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[f].exports}var f,g="function"==typeof _dereq_&&_dereq_;for(f=0;f<d.length;f++)e(d[f]);return e}({1:[function(a,b,c){"use strict";b.exports=function(a){function b(a){var b=new c(a),d=b.promise();return b.setHowMany(1),b.setUnwrap(),b.init(),d}var c=a._SomePromiseArray;a.any=function(a){return b(a)},a.prototype.any=function(){return b(this)}}},{}],2:[function(a,b,c){"use strict";function d(){this._customScheduler=!1,this._isTickUsed=!1,this._lateQueue=new j(16),this._normalQueue=new j(16),this._haveDrainedQueues=!1,this._trampolineEnabled=!0;var a=this;this.drainQueues=function(){a._drainQueues()},this._schedule=i}function e(a,b,c){this._lateQueue.push(a,b,c),this._queueTick()}function f(a,b,c){this._normalQueue.push(a,b,c),this._queueTick()}function g(a){this._normalQueue._pushOne(a),this._queueTick()}var h,i,j,k;try{throw new Error}catch(l){h=l}i=a("./schedule"),j=a("./queue"),k=a("./util"),d.prototype.setScheduler=function(a){var b=this._schedule;return this._schedule=a,this._customScheduler=!0,b},d.prototype.hasCustomScheduler=function(){return this._customScheduler},d.prototype.enableTrampoline=function(){this._trampolineEnabled=!0},d.prototype.disableTrampolineIfNecessary=function(){k.hasDevTools&&(this._trampolineEnabled=!1)},d.prototype.haveItemsQueued=function(){return this._isTickUsed||this._haveDrainedQueues},d.prototype.fatalError=function(a,b){b?(process.stderr.write("Fatal "+(a instanceof Error?a.stack:a)+"\n"),process.exit(2)):this.throwLater(a)},d.prototype.throwLater=function(a,b){if(1===arguments.length&&(b=a,a=function(){throw b}),"undefined"!=typeof setTimeout)setTimeout(function(){a(b)},0);else try{this._schedule(function(){a(b)})}catch(c){throw new Error("No async scheduler available\n\n    See http://goo.gl/MqrFmX\n")}},k.hasDevTools?(d.prototype.invokeLater=function(a,b,c){this._trampolineEnabled?e.call(this,a,b,c):this._schedule(function(){setTimeout(function(){a.call(b,c)},100)})},d.prototype.invoke=function(a,b,c){this._trampolineEnabled?f.call(this,a,b,c):this._schedule(function(){a.call(b,c)})},d.prototype.settlePromises=function(a){this._trampolineEnabled?g.call(this,a):this._schedule(function(){a._settlePromises()})}):(d.prototype.invokeLater=e,d.prototype.invoke=f,d.prototype.settlePromises=g),d.prototype._drainQueue=function(a){for(var b,c,d;a.length()>0;)b=a.shift(),"function"==typeof b?(c=a.shift(),d=a.shift(),b.call(c,d)):b._settlePromises()},d.prototype._drainQueues=function(){this._drainQueue(this._normalQueue),this._reset(),this._haveDrainedQueues=!0,this._drainQueue(this._lateQueue)},d.prototype._queueTick=function(){this._isTickUsed||(this._isTickUsed=!0,this._schedule(this.drainQueues))},d.prototype._reset=function(){this._isTickUsed=!1},b.exports=d,b.exports.firstLineError=h},{"./queue":26,"./schedule":29,"./util":36}],3:[function(a,b,c){"use strict";b.exports=function(a,b,c,d){var e=!1,f=function(a,b){this._reject(b)},g=function(a,b){b.promiseRejectionQueued=!0,b.bindingPromise._then(f,f,null,this,a)},h=function(a,b){0===(50397184&this._bitField)&&this._resolveCallback(b.target)},i=function(a,b){b.promiseRejectionQueued||this._reject(a)};a.prototype.bind=function(f){var j,k,l,m;return e||(e=!0,a.prototype._propagateFrom=d.propagateFromFunction(),a.prototype._boundValue=d.boundValueFunction()),j=c(f),k=new a(b),k._propagateFrom(this,1),l=this._target(),k._setBoundTo(j),j instanceof a?(m={promiseRejectionQueued:!1,promise:k,target:l,bindingPromise:j},l._then(b,g,void 0,k,m),j._then(h,i,void 0,k,m),k._setOnCancel(j)):k._resolveCallback(l),k},a.prototype._setBoundTo=function(a){void 0!==a?(this._bitField=2097152|this._bitField,this._boundTo=a):this._bitField=this._bitField&-2097153},a.prototype._isBound=function(){return 2097152===(2097152&this._bitField)},a.bind=function(b,c){return a.resolve(c).bind(b)}}},{}],4:[function(a,b,c){"use strict";function d(){try{Promise===f&&(Promise=e)}catch(a){}return f}var e,f;"undefined"!=typeof Promise&&(e=Promise),f=a("./promise")(),f.noConflict=d,b.exports=f},{"./promise":22}],5:[function(a,b,c){"use strict";var d,e,f=Object.create;f&&(d=f(null),e=f(null),d[" size"]=e[" size"]=0),b.exports=function(b){function c(a,c){var d,e;if(null!=a&&(d=a[c]),"function"!=typeof d)throw e="Object "+l.classString(a)+" has no method '"+l.toString(c)+"'",new b.TypeError(e);return d}function d(a){var b=this.pop(),d=c(a,b);return d.apply(a,this)}function e(a){return a[this]}function f(a){var b=+this;return b<0&&(b=Math.max(0,b+a.length)),a[b]}var g,h,i,j,k,l=a("./util"),m=l.canEvaluate,n=l.isIdentifier;b.prototype.call=function(a){var b,c=[].slice.call(arguments,1);return c.push(a),this._then(d,void 0,void 0,c,void 0)},b.prototype.get=function(a){var b,c,d="number"==typeof a;return d?b=f:m?(c=h(a),b=null!==c?c:e):b=e,this._then(b,void 0,void 0,a,void 0)}}},{"./util":36}],6:[function(a,b,c){"use strict";b.exports=function(b,c,d,e){var f=a("./util"),g=f.tryCatch,h=f.errorObj,i=b._async;b.prototype["break"]=b.prototype.cancel=function(){var a,b,c;if(!e.cancellation())return this._warn("cancellation is disabled");for(a=this,b=a;a._isCancellable();){if(!a._cancelBy(b)){b._isFollowing()?b._followee().cancel():b._cancelBranched();break}if(c=a._cancellationParent,null==c||!c._isCancellable()){a._isFollowing()?a._followee().cancel():a._cancelBranched();break}a._isFollowing()&&a._followee().cancel(),a._setWillBeCancelled(),b=a,a=c}},b.prototype._branchHasCancelled=function(){this._branchesRemainingToCancel--},b.prototype._enoughBranchesHaveCancelled=function(){return void 0===this._branchesRemainingToCancel||this._branchesRemainingToCancel<=0},b.prototype._cancelBy=function(a){return a===this?(this._branchesRemainingToCancel=0,this._invokeOnCancel(),!0):(this._branchHasCancelled(),!!this._enoughBranchesHaveCancelled()&&(this._invokeOnCancel(),!0))},b.prototype._cancelBranched=function(){this._enoughBranchesHaveCancelled()&&this._cancel()},b.prototype._cancel=function(){this._isCancellable()&&(this._setCancelled(),i.invoke(this._cancelPromises,this,void 0))},b.prototype._cancelPromises=function(){this._length()>0&&this._settlePromises()},b.prototype._unsetOnCancel=function(){this._onCancelField=void 0},b.prototype._isCancellable=function(){return this.isPending()&&!this._isCancelled()},b.prototype.isCancellable=function(){return this.isPending()&&!this.isCancelled()},b.prototype._doInvokeOnCancel=function(a,b){var c,d;if(f.isArray(a))for(c=0;c<a.length;++c)this._doInvokeOnCancel(a[c],b);else void 0!==a&&("function"==typeof a?b||(d=g(a).call(this._boundValue()),d===h&&(this._attachExtraTrace(d.e),i.throwLater(d.e))):a._resultCancelled(this))},b.prototype._invokeOnCancel=function(){var a=this._onCancel();this._unsetOnCancel(),i.invoke(this._doInvokeOnCancel,this,a)},b.prototype._invokeInternalOnCancel=function(){this._isCancellable()&&(this._doInvokeOnCancel(this._onCancel(),!0),this._unsetOnCancel())},b.prototype._resultCancelled=function(){this.cancel()}}},{"./util":36}],7:[function(a,b,c){"use strict";b.exports=function(b){function c(a,c,h){return function(i){var j,k,l,m,n,o,p=h._boundValue();a:for(j=0;j<a.length;++j)if(k=a[j],k===Error||null!=k&&k.prototype instanceof Error){if(i instanceof k)return f(c).call(p,i)}else if("function"==typeof k){if(l=f(k).call(p,i),l===g)return l;if(l)return f(c).call(p,i)}else if(d.isObject(i)){for(m=e(k),n=0;n<m.length;++n)if(o=m[n],k[o]!=i[o])continue a;return f(c).call(p,i)}return b}}var d=a("./util"),e=a("./es5").keys,f=d.tryCatch,g=d.errorObj;return c}},{"./es5":13,"./util":36}],8:[function(a,b,c){"use strict";b.exports=function(a){function b(){this._trace=new b.CapturedTrace(d())}function c(){if(e)return new b}function d(){var a=f.length-1;if(a>=0)return f[a]}var e=!1,f=[];return a.prototype._promiseCreated=function(){},a.prototype._pushContext=function(){},a.prototype._popContext=function(){return null},a._peekContext=a.prototype._peekContext=function(){},b.prototype._pushContext=function(){void 0!==this._trace&&(this._trace._promiseCreated=null,f.push(this._trace))},b.prototype._popContext=function(){var a,b;return void 0!==this._trace?(a=f.pop(),b=a._promiseCreated,a._promiseCreated=null,b):null},b.CapturedTrace=null,b.create=c,b.deactivateLongStackTraces=function(){},b.activateLongStackTraces=function(){var c=a.prototype._pushContext,f=a.prototype._popContext,g=a._peekContext,h=a.prototype._peekContext,i=a.prototype._promiseCreated;b.deactivateLongStackTraces=function(){a.prototype._pushContext=c,a.prototype._popContext=f,a._peekContext=g,a.prototype._peekContext=h,a.prototype._promiseCreated=i,e=!1},e=!0,a.prototype._pushContext=b.prototype._pushContext,a.prototype._popContext=b.prototype._popContext,a._peekContext=a.prototype._peekContext=d,a.prototype._promiseCreated=function(){var a=this._peekContext();a&&null==a._promiseCreated&&(a._promiseCreated=this)}},b}},{}],9:[function(a,b,c){"use strict";b.exports=function(b,c){function d(a,b){return{promise:b}}function e(){return!1}function f(a,b,c){var d=this;try{a(b,c,function(a){if("function"!=typeof a)throw new TypeError("onCancel must be a function, got: "+W.toString(a));d._attachCancellationCallback(a)})}catch(e){return e}}function g(a){if(!this._isCancellable())return this;var b=this._onCancel();void 0!==b?W.isArray(b)?b.push(a):this._setOnCancel([b,a]):this._setOnCancel(a)}function h(){return this._onCancelField}function i(a){this._onCancelField=a}function j(){this._cancellationParent=void 0,this._onCancelField=void 0}function k(a,b){if(0!==(1&b)){this._cancellationParent=a;var c=a._branchesRemainingToCancel;void 0===c&&(c=0),a._branchesRemainingToCancel=c+1}0!==(2&b)&&a._isBound()&&this._setBoundTo(a._boundTo)}function l(a,b){0!==(2&b)&&a._isBound()&&this._setBoundTo(a._boundTo)}function m(){var a=this._boundTo;return void 0!==a&&a instanceof b?a.isFulfilled()?a.value():void 0:a}function n(){this._trace=new F(this._peekContext())}function o(a,b){var c,d;X(a)&&(c=this._trace,void 0!==c&&b&&(c=c._parent),void 0!==c?c.attachExtraTrace(a):a.__stackCleaned__||(d=x(a),W.notEnumerableProp(a,"stack",d.message+"\n"+d.stack.join("\n")),W.notEnumerableProp(a,"__stackCleaned__",!0)))}function p(a,b,c,d,e){var f,g,h,i,j,k,l,m,n;if(void 0===a&&null!==b&&fa){if(void 0!==e&&e._returnedNonUndefined())return;if(0===(65535&d._bitField))return;if(c&&(c+=" "),f="",g="",b._trace){for(h=b._trace.stack.split("\n"),i=v(h),j=i.length-1;j>=0;--j)if(k=i[j],!Z.test(k)){l=k.match($),l&&(f="at "+l[1]+":"+l[2]+":"+l[3]+" ");break}if(i.length>0)for(m=i[0],j=0;j<h.length;++j)if(h[j]===m){j>0&&(g="\n"+h[j-1]);break}}n="a promise was created in a "+c+"handler "+f+"but was not returned from it, see http://goo.gl/rRqMUw"+g,d._warn(n,!0,b)}}function q(a,b){var c=a+" is deprecated and will be removed in a future version.";return b&&(c+=" Use "+b+" instead."),r(c)}function r(a,c,d){var e,f,g;S.warnings&&(e=new V(a),c?d._attachExtraTrace(e):S.longStackTraces&&(f=b._peekContext())?f.attachExtraTrace(e):(g=x(e),e.stack=g.message+"\n"+g.stack.join("\n")),N("warning",e)||y(e,"",!0))}function s(a,b){for(var c=0;c<b.length-1;++c)b[c].push("From previous event:"),b[c]=b[c].join("\n");return c<b.length&&(b[c]=b[c].join("\n")),a+"\n"+b.join("\n")}function t(a){for(var b=0;b<a.length;++b)(0===a[b].length||b+1<a.length&&a[b][0]===a[b+1][0])&&(a.splice(b,1),b--)}function u(a){var b,c,d,e,f,g,h,i=a[0];for(b=1;b<a.length;++b){for(c=a[b],d=i.length-1,e=i[d],f=-1,g=c.length-1;g>=0;--g)if(c[g]===e){f=g;break}for(g=f;g>=0&&(h=c[g],i[d]===h);--g)i.pop(),d--;i=c}}function v(a){var b,c,d,e,f=[];for(b=0;b<a.length;++b)c=a[b],d="    (No stack trace)"===c||_.test(c),e=d&&P(c),d&&!e&&(ba&&" "!==c.charAt(0)&&(c="    "+c),f.push(c));return f}function w(a){var b,c,d=a.stack.replace(/\s+$/g,"").split("\n");for(b=0;b<d.length&&(c=d[b],"    (No stack trace)"!==c&&!_.test(c));++b);return b>0&&"SyntaxError"!=a.name&&(d=d.slice(b)),d}function x(a){var b=a.stack,c=a.toString();return b="string"==typeof b&&b.length>0?w(a):["    (No stack trace)"],{message:c,stack:"SyntaxError"==a.name?b:v(b)}}function y(a,b,c){var d,e;"undefined"!=typeof console&&(W.isObject(a)?(e=a.stack,d=b+aa(e,a)):d=b+String(a),"function"==typeof I?I(d,c):"function"!=typeof console.log&&"object"!=typeof console.log||console.log(d))}function z(a,b,c,d){var e=!1;try{"function"==typeof b&&(e=!0,"rejectionHandled"===a?b(d):b(c,d))}catch(f){U.throwLater(f)}"unhandledRejection"===a?N(a,c,d)||e||y(c,"Unhandled rejection "):N(a,d)}function A(a){var b,c,d;if("function"==typeof a)b="[function "+(a.name||"anonymous")+"]";else{if(b=a&&"function"==typeof a.toString?a.toString():W.toString(a),c=/\[object [a-zA-Z0-9$_]+\]/,c.test(b))try{d=JSON.stringify(a),b=d}catch(e){}0===b.length&&(b="(empty array)")}return"(<"+B(b)+">, no stack trace)"}function B(a){var b=41;return a.length<b?a:a.substr(0,b-3)+"..."}function C(){return"function"==typeof R}function D(a){var b=a.match(Q);if(b)return{fileName:b[1],line:parseInt(b[2],10)}}function E(a,b){var c,d,e,f,g,h,i,j;if(C()){for(c=a.stack.split("\n"),d=b.stack.split("\n"),e=-1,f=-1,i=0;i<c.length;++i)if(j=D(c[i])){g=j.fileName,e=j.line;break}for(i=0;i<d.length;++i)if(j=D(d[i])){h=j.fileName,f=j.line;break}e<0||f<0||!g||!h||g!==h||e>=f||(P=function(a){if(Y.test(a))return!0;var b=D(a);return!!(b&&b.fileName===g&&e<=b.line&&b.line<=f)})}}function F(a){this._parent=a,this._promisesCreated=0;var b=this._length=1+(void 0===a?0:a._length);R(this,F),b>32&&this.uncycle()}var G,H,I,J,K,L,M,N,O,P,Q,R,S,T=b._getDomain,U=b._async,V=a("./errors").Warning,W=a("./util"),X=W.canAttachTrace,Y=/[\\\/]bluebird[\\\/]js[\\\/](release|debug|instrumented)/,Z=/\((?:timers\.js):\d+:\d+\)/,$=/[\/<\(](.+?):(\d+):(\d+)\)?\s*$/,_=null,aa=null,ba=!1,ca=!(0==W.env("BLUEBIRD_DEBUG")),da=!(0==W.env("BLUEBIRD_WARNINGS")||!ca&&!W.env("BLUEBIRD_WARNINGS")),ea=!(0==W.env("BLUEBIRD_LONG_STACK_TRACES")||!ca&&!W.env("BLUEBIRD_LONG_STACK_TRACES")),fa=0!=W.env("BLUEBIRD_W_FORGOTTEN_RETURN")&&(da||!!W.env("BLUEBIRD_W_FORGOTTEN_RETURN"));return b.prototype.suppressUnhandledRejections=function(){var a=this._target();a._bitField=a._bitField&-1048577|524288},b.prototype._ensurePossibleRejectionHandled=function(){0===(524288&this._bitField)&&(this._setRejectionIsUnhandled(),U.invokeLater(this._notifyUnhandledRejection,this,void 0))},b.prototype._notifyUnhandledRejectionIsHandled=function(){z("rejectionHandled",G,void 0,this)},b.prototype._setReturnedNonUndefined=function(){this._bitField=268435456|this._bitField},b.prototype._returnedNonUndefined=function(){return 0!==(268435456&this._bitField)},b.prototype._notifyUnhandledRejection=function(){if(this._isRejectionUnhandled()){var a=this._settledValue();this._setUnhandledRejectionIsNotified(),z("unhandledRejection",H,a,this)}},b.prototype._setUnhandledRejectionIsNotified=function(){this._bitField=262144|this._bitField},b.prototype._unsetUnhandledRejectionIsNotified=function(){this._bitField=this._bitField&-262145},b.prototype._isUnhandledRejectionNotified=function(){return(262144&this._bitField)>0},b.prototype._setRejectionIsUnhandled=function(){this._bitField=1048576|this._bitField},b.prototype._unsetRejectionIsUnhandled=function(){this._bitField=this._bitField&-1048577,this._isUnhandledRejectionNotified()&&(this._unsetUnhandledRejectionIsNotified(),this._notifyUnhandledRejectionIsHandled())},b.prototype._isRejectionUnhandled=function(){return(1048576&this._bitField)>0},b.prototype._warn=function(a,b,c){return r(a,b,c||this)},b.onPossiblyUnhandledRejection=function(a){var b=T();H="function"==typeof a?null===b?a:W.domainBind(b,a):void 0},b.onUnhandledRejectionHandled=function(a){var b=T();G="function"==typeof a?null===b?a:W.domainBind(b,a):void 0},J=function(){},b.longStackTraces=function(){var a,d;if(U.haveItemsQueued()&&!S.longStackTraces)throw new Error("cannot enable long stack traces after promises have been created\n\n    See http://goo.gl/MqrFmX\n");!S.longStackTraces&&C()&&(a=b.prototype._captureStackTrace,d=b.prototype._attachExtraTrace,S.longStackTraces=!0,J=function(){if(U.haveItemsQueued()&&!S.longStackTraces)throw new Error("cannot enable long stack traces after promises have been created\n\n    See http://goo.gl/MqrFmX\n");b.prototype._captureStackTrace=a,b.prototype._attachExtraTrace=d,c.deactivateLongStackTraces(),U.enableTrampoline(),S.longStackTraces=!1},b.prototype._captureStackTrace=n,b.prototype._attachExtraTrace=o,c.activateLongStackTraces(),U.disableTrampolineIfNecessary())},b.hasLongStackTraces=function(){return S.longStackTraces&&C()},K=function(){var a;try{return"function"==typeof CustomEvent?(a=new CustomEvent("CustomEvent"),W.global.dispatchEvent(a),function(a,b){var c=new CustomEvent(a.toLowerCase(),{detail:b,cancelable:!0});return!W.global.dispatchEvent(c)}):"function"==typeof Event?(a=new Event("CustomEvent"),W.global.dispatchEvent(a),function(a,b){var c=new Event(a.toLowerCase(),{cancelable:!0});return c.detail=b,!W.global.dispatchEvent(c)}):(a=document.createEvent("CustomEvent"),a.initCustomEvent("testingtheevent",!1,!0,{}),W.global.dispatchEvent(a),function(a,b){var c=document.createEvent("CustomEvent");return c.initCustomEvent(a.toLowerCase(),!1,!0,b),!W.global.dispatchEvent(c)})}catch(b){}return function(){return!1}}(),L=function(){return W.isNode?function(){return process.emit.apply(process,arguments)}:W.global?function(a){var b="on"+a.toLowerCase(),c=W.global[b];return!!c&&(c.apply(W.global,[].slice.call(arguments,1)),!0)}:function(){return!1}}(),M={promiseCreated:d,promiseFulfilled:d,promiseRejected:d,promiseResolved:d,promiseCancelled:d,promiseChained:function(a,b,c){return{promise:b,child:c}},warning:function(a,b){return{warning:b}},unhandledRejection:function(a,b,c){return{reason:b,promise:c}},rejectionHandled:d},N=function(a){var b,c=!1;try{c=L.apply(null,arguments)}catch(d){U.throwLater(d),c=!0}b=!1;try{b=K(a,M[a].apply(null,arguments))}catch(d){U.throwLater(d),b=!0}return b||c},b.config=function(a){if(a=Object(a),"longStackTraces"in a&&(a.longStackTraces?b.longStackTraces():!a.longStackTraces&&b.hasLongStackTraces()&&J()),"warnings"in a){var c=a.warnings;S.warnings=!!c,fa=S.warnings,W.isObject(c)&&"wForgottenReturn"in c&&(fa=!!c.wForgottenReturn)}if("cancellation"in a&&a.cancellation&&!S.cancellation){if(U.haveItemsQueued())throw new Error("cannot enable cancellation after promises are in use");b.prototype._clearCancellationData=j,b.prototype._propagateFrom=k,b.prototype._onCancel=h,b.prototype._setOnCancel=i,b.prototype._attachCancellationCallback=g,b.prototype._execute=f,O=k,S.cancellation=!0}return"monitoring"in a&&(a.monitoring&&!S.monitoring?(S.monitoring=!0,b.prototype._fireEvent=N):!a.monitoring&&S.monitoring&&(S.monitoring=!1,b.prototype._fireEvent=e)),b},b.prototype._fireEvent=e,b.prototype._execute=function(a,b,c){try{a(b,c)}catch(d){return d}},b.prototype._onCancel=function(){},b.prototype._setOnCancel=function(a){},b.prototype._attachCancellationCallback=function(a){},b.prototype._captureStackTrace=function(){},b.prototype._attachExtraTrace=function(){},b.prototype._clearCancellationData=function(){},b.prototype._propagateFrom=function(a,b){},O=l,P=function(){return!1},Q=/[\/<\(]([^:\/]+):(\d+):(?:\d+)\)?\s*$/,W.inherits(F,Error),c.CapturedTrace=F,F.prototype.uncycle=function(){var a,b,c,d,e,f,g,h,i,j,k=this._length;if(!(k<2)){for(a=[],b={},c=0,d=this;void 0!==d;++c)a.push(d),d=d._parent;for(k=this._length=c,c=k-1;c>=0;--c)e=a[c].stack,void 0===b[e]&&(b[e]=c);for(c=0;c<k;++c)if(f=a[c].stack,g=b[f],void 0!==g&&g!==c){for(g>0&&(a[g-1]._parent=void 0,a[g-1]._length=1),a[c]._parent=void 0,a[c]._length=1,h=c>0?a[c-1]:this,g<k-1?(h._parent=a[g+1],h._parent.uncycle(),h._length=h._parent._length+1):(h._parent=void 0,h._length=1),i=h._length+1,j=c-2;j>=0;--j)a[j]._length=i,i++;return}}},F.prototype.attachExtraTrace=function(a){var b,c,d,e;if(!a.__stackCleaned__){for(this.uncycle(),b=x(a),c=b.message,d=[b.stack],e=this;void 0!==e;)d.push(v(e.stack.split("\n"))),e=e._parent;u(d),t(d),W.notEnumerableProp(a,"stack",s(c,d)),W.notEnumerableProp(a,"__stackCleaned__",!0)}},R=function ga(){var a,b,c,d=/^\s*at\s*/,e=function(a,b){return"string"==typeof a?a:void 0!==b.name&&void 0!==b.message?b.toString():A(b)};if("number"==typeof Error.stackTraceLimit&&"function"==typeof Error.captureStackTrace)return Error.stackTraceLimit+=6,_=d,aa=e,a=Error.captureStackTrace,P=function(a){return Y.test(a)},function(b,c){Error.stackTraceLimit+=6,a(b,c),Error.stackTraceLimit-=6};if(b=new Error,"string"==typeof b.stack&&b.stack.split("\n")[0].indexOf("stackDetection@")>=0)return _=/@/,aa=e,ba=!0,function g(a){a.stack=(new Error).stack};try{throw new Error}catch(f){c="stack"in f}return"stack"in b||!c||"number"!=typeof Error.stackTraceLimit?(aa=function(a,b){return"string"==typeof a?a:"object"!=typeof b&&"function"!=typeof b||void 0===b.name||void 0===b.message?A(b):b.toString()},null):(_=d,aa=e,function h(a){Error.stackTraceLimit+=6;try{throw new Error}catch(b){a.stack=b.stack}Error.stackTraceLimit-=6})}([]),"undefined"!=typeof console&&"undefined"!=typeof console.warn&&(I=function(a){console.warn(a)},W.isNode&&process.stderr.isTTY?I=function(a,b){var c=b?"[33m":"[31m";console.warn(c+a+"[0m\n")}:W.isNode||"string"!=typeof(new Error).stack||(I=function(a,b){console.warn("%c"+a,b?"color: darkorange":"color: red")})),S={warnings:da,longStackTraces:!1,cancellation:!1,monitoring:!1},ea&&b.longStackTraces(),{longStackTraces:function(){return S.longStackTraces},warnings:function(){return S.warnings},cancellation:function(){return S.cancellation},monitoring:function(){return S.monitoring},propagateFromFunction:function(){return O},boundValueFunction:function(){return m},checkForgottenReturns:p,setBounds:E,warn:r,deprecated:q,CapturedTrace:F,fireDomEvent:K,fireGlobalEvent:L}}},{"./errors":12,"./util":36}],10:[function(a,b,c){"use strict";b.exports=function(a){function b(){return this.value}function c(){throw this.reason}a.prototype["return"]=a.prototype.thenReturn=function(c){return c instanceof a&&c.suppressUnhandledRejections(),this._then(b,void 0,void 0,{value:c},void 0)},a.prototype["throw"]=a.prototype.thenThrow=function(a){return this._then(c,void 0,void 0,{reason:a},void 0)},a.prototype.catchThrow=function(a){var b,d;return arguments.length<=1?this._then(void 0,c,void 0,{reason:a},void 0):(b=arguments[1],d=function(){throw b},this.caught(a,d))},a.prototype.catchReturn=function(c){var d,e;return arguments.length<=1?(c instanceof a&&c.suppressUnhandledRejections(),this._then(void 0,b,void 0,{value:c},void 0)):(d=arguments[1],d instanceof a&&d.suppressUnhandledRejections(),e=function(){return d},this.caught(c,e))}}},{}],11:[function(a,b,c){"use strict";b.exports=function(a,b){function c(){return f(this)}function d(a,c){return e(a,c,b,b)}var e=a.reduce,f=a.all;a.prototype.each=function(a){return e(this,a,b,0)._then(c,void 0,void 0,this,void 0)},a.prototype.mapSeries=function(a){return e(this,a,b,b)},a.each=function(a,d){return e(a,d,b,0)._then(c,void 0,void 0,a,void 0)},a.mapSeries=d}},{}],12:[function(a,b,c){"use strict";function d(a,b){function c(d){return this instanceof c?(p(this,"message","string"==typeof d?d:b),p(this,"name",a),void(Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):Error.call(this))):new c(d)}return o(c,Error),c}function e(a){return this instanceof e?(p(this,"name","OperationalError"),p(this,"message",a),this.cause=a,this.isOperational=!0,void(a instanceof Error?(p(this,"message",a.message),p(this,"stack",a.stack)):Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor))):new e(a)}var f,g,h,i,j,k,l=a("./es5"),m=l.freeze,n=a("./util"),o=n.inherits,p=n.notEnumerableProp,q=d("Warning","warning"),r=d("CancellationError","cancellation error"),s=d("TimeoutError","timeout error"),t=d("AggregateError","aggregate error");try{f=TypeError,g=RangeError}catch(u){f=d("TypeError","type error"),g=d("RangeError","range error")}for(h="join pop push shift unshift slice filter forEach some every map indexOf lastIndexOf reduce reduceRight sort reverse".split(" "),i=0;i<h.length;++i)"function"==typeof Array.prototype[h[i]]&&(t.prototype[h[i]]=Array.prototype[h[i]]);l.defineProperty(t.prototype,"length",{value:0,configurable:!1,writable:!0,enumerable:!0}),t.prototype.isOperational=!0,j=0,t.prototype.toString=function(){var a,b,c,d,e=Array(4*j+1).join(" "),f="\n"+e+"AggregateError of:\n";for(j++,e=Array(4*j+1).join(" "),a=0;a<this.length;++a){for(b=this[a]===this?"[Circular AggregateError]":this[a]+"",c=b.split("\n"),d=0;d<c.length;++d)c[d]=e+c[d];b=c.join("\n"),f+=b+"\n"}return j--,f},o(e,Error),k=Error.__BluebirdErrorTypes__,k||(k=m({CancellationError:r,TimeoutError:s,OperationalError:e,RejectionError:e,AggregateError:t}),l.defineProperty(Error,"__BluebirdErrorTypes__",{value:k,writable:!1,enumerable:!1,configurable:!1})),b.exports={Error:Error,TypeError:f,RangeError:g,CancellationError:k.CancellationError,OperationalError:k.OperationalError,TimeoutError:k.TimeoutError,AggregateError:k.AggregateError,Warning:q}},{"./es5":13,"./util":36}],13:[function(a,b,c){var d,e,f,g,h,i,j,k,l,m=function(){"use strict";return void 0===this}();m?b.exports={freeze:Object.freeze,defineProperty:Object.defineProperty,getDescriptor:Object.getOwnPropertyDescriptor,keys:Object.keys,names:Object.getOwnPropertyNames,getPrototypeOf:Object.getPrototypeOf,isArray:Array.isArray,isES5:m,propertyIsWritable:function(a,b){var c=Object.getOwnPropertyDescriptor(a,b);return!(c&&!c.writable&&!c.set)}}:(d={}.hasOwnProperty,e={}.toString,f={}.constructor.prototype,g=function(a){var b,c=[];for(b in a)d.call(a,b)&&c.push(b);return c},h=function(a,b){return{value:a[b]}},i=function(a,b,c){return a[b]=c.value,a},j=function(a){return a},k=function(a){try{return Object(a).constructor.prototype}catch(b){return f}},l=function(a){try{return"[object Array]"===e.call(a)}catch(b){return!1}},b.exports={isArray:l,keys:g,names:g,defineProperty:i,getDescriptor:h,freeze:j,getPrototypeOf:k,isES5:m,propertyIsWritable:function(){return!0}})},{}],14:[function(a,b,c){"use strict";b.exports=function(a,b){var c=a.map;a.prototype.filter=function(a,d){return c(this,a,d,b)},a.filter=function(a,d,e){return c(a,d,e,b)}}},{}],15:[function(a,b,c){"use strict";b.exports=function(b,c){function d(a,b,c){this.promise=a,this.type=b,this.handler=c,this.called=!1,this.cancelPromise=null}function e(a){this.finallyHandler=a}function f(a,b){return null!=a.cancelPromise&&(arguments.length>1?a.cancelPromise._reject(b):a.cancelPromise._cancel(),a.cancelPromise=null,!0)}function g(){return i.call(this,this.promise._target()._settledValue())}function h(a){if(!f(this,a))return l.e=a,l}function i(a){var d,i,j,m=this.promise,n=this.handler;if(!this.called&&(this.called=!0,d=this.isFinallyHandler()?n.call(m._boundValue()):n.call(m._boundValue(),a),void 0!==d&&(m._setReturnedNonUndefined(),i=c(d,m),i instanceof b))){if(null!=this.cancelPromise){if(i._isCancelled())return j=new k("late cancellation observer"),m._attachExtraTrace(j),l.e=j,l;i.isPending()&&i._attachCancellationCallback(new e(this))}return i._then(g,h,void 0,this,void 0)}return m.isRejected()?(f(this),l.e=a,l):(f(this),a)}var j=a("./util"),k=b.CancellationError,l=j.errorObj;return d.prototype.isFinallyHandler=function(){return 0===this.type},e.prototype._resultCancelled=function(){f(this.finallyHandler)},b.prototype._passThrough=function(a,b,c,e){return"function"!=typeof a?this.then():this._then(c,e,void 0,new d(this,b,a),void 0)},b.prototype.lastly=b.prototype["finally"]=function(a){return this._passThrough(a,0,i,i)},b.prototype.tap=function(a){return this._passThrough(a,1,i)},d}},{"./util":36}],16:[function(a,b,c){"use strict";b.exports=function(b,c,d,e,f,g){function h(a,c,d){var f,g,h,i;for(f=0;f<c.length;++f){if(d._pushContext(),g=n(c[f])(a),d._popContext(),g===m)return d._pushContext(),h=b.reject(m.e),d._popContext(),h;if(i=e(g,d),i instanceof b)return i}return null}function i(a,c,e,f){var h,i,j;g.cancellation()?(h=new b(d),i=this._finallyPromise=new b(d),this._promise=h.lastly(function(){return i}),h._captureStackTrace(),h._setOnCancel(this)):(j=this._promise=new b(d),j._captureStackTrace()),this._stack=f,this._generatorFunction=a,this._receiver=c,this._generator=void 0,this._yieldHandlers="function"==typeof e?[e].concat(o):o,this._yieldedPromise=null,this._cancellationPhase=!1}var j=a("./errors"),k=j.TypeError,l=a("./util"),m=l.errorObj,n=l.tryCatch,o=[];l.inherits(i,f),i.prototype._isResolved=function(){return null===this._promise},i.prototype._cleanup=function(){this._promise=this._generator=null,g.cancellation()&&null!==this._finallyPromise&&(this._finallyPromise._fulfill(),this._finallyPromise=null)},i.prototype._promiseCancelled=function(){var a,c,d;this._isResolved()||(a="undefined"!=typeof this._generator["return"],a?(this._promise._pushContext(),c=n(this._generator["return"]).call(this._generator,void 0),this._promise._popContext()):(d=new b.CancellationError("generator .return() sentinel"),b.coroutine.returnSentinel=d,this._promise._attachExtraTrace(d),this._promise._pushContext(),c=n(this._generator["throw"]).call(this._generator,d),this._promise._popContext()),this._cancellationPhase=!0,this._yieldedPromise=null,this._continue(c))},i.prototype._promiseFulfilled=function(a){this._yieldedPromise=null,this._promise._pushContext();var b=n(this._generator.next).call(this._generator,a);this._promise._popContext(),this._continue(b)},i.prototype._promiseRejected=function(a){this._yieldedPromise=null,this._promise._attachExtraTrace(a),this._promise._pushContext();var b=n(this._generator["throw"]).call(this._generator,a);this._promise._popContext(),this._continue(b)},i.prototype._resultCancelled=function(){if(this._yieldedPromise instanceof b){var a=this._yieldedPromise;this._yieldedPromise=null,a.cancel()}},i.prototype.promise=function(){return this._promise},i.prototype._run=function(){this._generator=this._generatorFunction.call(this._receiver),this._receiver=this._generatorFunction=void 0,this._promiseFulfilled(void 0)},i.prototype._continue=function(a){var c,d,f,g=this._promise;return a===m?(this._cleanup(),this._cancellationPhase?g.cancel():g._rejectCallback(a.e,!1)):(c=a.value,a.done===!0?(this._cleanup(),this._cancellationPhase?g.cancel():g._resolveCallback(c)):(d=e(c,this._promise),d instanceof b||(d=h(d,this._yieldHandlers,this._promise),null!==d)?(d=d._target(),f=d._bitField,void(0===(50397184&f)?(this._yieldedPromise=d,d._proxy(this,null)):0!==(33554432&f)?b._async.invoke(this._promiseFulfilled,this,d._value()):0!==(16777216&f)?b._async.invoke(this._promiseRejected,this,d._reason()):this._promiseCancelled())):void this._promiseRejected(new k("A value %s was yielded that could not be treated as a promise\n\n    See http://goo.gl/MqrFmX\n\n".replace("%s",c)+"From coroutine:\n"+this._stack.split("\n").slice(1,-7).join("\n")))))},b.coroutine=function(a,b){var c,d,e;if("function"!=typeof a)throw new k("generatorFunction must be a function\n\n    See http://goo.gl/MqrFmX\n");
return c=Object(b).yieldHandler,d=i,e=(new Error).stack,function(){var b=a.apply(this,arguments),f=new d((void 0),(void 0),c,e),g=f.promise();return f._generator=b,f._promiseFulfilled(void 0),g}},b.coroutine.addYieldHandler=function(a){if("function"!=typeof a)throw new k("expecting a function but got "+l.classString(a));o.push(a)},b.spawn=function(a){var d,e;return g.deprecated("Promise.spawn()","Promise.coroutine()"),"function"!=typeof a?c("generatorFunction must be a function\n\n    See http://goo.gl/MqrFmX\n"):(d=new i(a,this),e=d.promise(),d._run(b.spawn),e)}}},{"./errors":12,"./util":36}],17:[function(a,b,c){"use strict";b.exports=function(b,c,d,e,f,g){var h,i,j,k,l,m,n,o,p=a("./util"),q=p.canEvaluate,r=p.tryCatch,s=p.errorObj;if(0){for(i=function(a){return new Function("value","holder","                             \n            'use strict';                                                    \n            holder.pIndex = value;                                           \n            holder.checkFulfillment(this);                                   \n            ".replace(/Index/g,a))},j=function(a){return new Function("promise","holder","                           \n            'use strict';                                                    \n            holder.pIndex = promise;                                         \n            ".replace(/Index/g,a))},k=function(a){var c,d,e,g,h,i,j=new Array(a);for(c=0;c<j.length;++c)j[c]="this.p"+(c+1);return d=j.join(" = ")+" = null;",e="var promise;\n"+j.map(function(a){return"                                                         \n                promise = "+a+";                                      \n                if (promise instanceof Promise) {                            \n                    promise.cancel();                                        \n                }                                                            \n            "}).join("\n"),g=j.join(", "),h="Holder$"+a,i="return function(tryCatch, errorObj, Promise, async) {    \n            'use strict';                                                    \n            function [TheName](fn) {                                         \n                [TheProperties]                                              \n                this.fn = fn;                                                \n                this.asyncNeeded = true;                                     \n                this.now = 0;                                                \n            }                                                                \n                                                                             \n            [TheName].prototype._callFunction = function(promise) {          \n                promise._pushContext();                                      \n                var ret = tryCatch(this.fn)([ThePassedArguments]);           \n                promise._popContext();                                       \n                if (ret === errorObj) {                                      \n                    promise._rejectCallback(ret.e, false);                   \n                } else {                                                     \n                    promise._resolveCallback(ret);                           \n                }                                                            \n            };                                                               \n                                                                             \n            [TheName].prototype.checkFulfillment = function(promise) {       \n                var now = ++this.now;                                        \n                if (now === [TheTotal]) {                                    \n                    if (this.asyncNeeded) {                                  \n                        async.invoke(this._callFunction, this, promise);     \n                    } else {                                                 \n                        this._callFunction(promise);                         \n                    }                                                        \n                                                                             \n                }                                                            \n            };                                                               \n                                                                             \n            [TheName].prototype._resultCancelled = function() {              \n                [CancellationCode]                                           \n            };                                                               \n                                                                             \n            return [TheName];                                                \n        }(tryCatch, errorObj, Promise, async);                               \n        ",i=i.replace(/\[TheName\]/g,h).replace(/\[TheTotal\]/g,a).replace(/\[ThePassedArguments\]/g,g).replace(/\[TheProperties\]/g,d).replace(/\[CancellationCode\]/g,e),new Function("tryCatch","errorObj","Promise","async",i)(r,s,b,f)},l=[],m=[],n=[],o=0;o<8;++o)l.push(k(o+1)),m.push(i(o+1)),n.push(j(o+1));h=function(a){this._reject(a)}}b.join=function(){var a,f,i,j,k,o,q,r,s,t,u=arguments.length-1;if(u>0&&"function"==typeof arguments[u]&&(a=arguments[u],0)){for(f=new b(e),f._captureStackTrace(),i=l[u-1],j=new i(a),k=m,o=0;o<u;++o)q=d(arguments[o],f),q instanceof b?(q=q._target(),r=q._bitField,0===(50397184&r)?(q._then(k[o],h,void 0,f,j),n[o](q,j),j.asyncNeeded=!1):0!==(33554432&r)?k[o].call(f,q._value(),j):0!==(16777216&r)?f._reject(q._reason()):f._cancel()):k[o].call(f,q,j);return f._isFateSealed()||(j.asyncNeeded&&(s=g(),null!==s&&(j.fn=p.domainBind(s,j.fn))),f._setAsyncGuaranteed(),f._setOnCancel(j)),f}return t=[].slice.call(arguments),a&&t.pop(),f=new c(t).promise(),void 0!==a?f.spread(a):f}}},{"./util":36}],18:[function(a,b,c){"use strict";b.exports=function(b,c,d,e,f,g){function h(a,b,c,d){this.constructor$(a),this._promise._captureStackTrace();var e=j();this._callback=null===e?b:k.domainBind(e,b),this._preservedValues=d===f?new Array(this.length()):null,this._limit=c,this._inFlight=0,this._queue=[],n.invoke(this._asyncInit,this,void 0)}function i(a,c,e,f){if("function"!=typeof c)return d("expecting a function but got "+k.classString(c));var g=0;if(void 0!==e){if("object"!=typeof e||null===e)return b.reject(new TypeError("options argument must be an object but it is "+k.classString(e)));if("number"!=typeof e.concurrency)return b.reject(new TypeError("'concurrency' must be a number but it is "+k.classString(e.concurrency)));g=e.concurrency}return g="number"==typeof g&&isFinite(g)&&g>=1?g:0,new h(a,c,g,f).promise()}var j=b._getDomain,k=a("./util"),l=k.tryCatch,m=k.errorObj,n=b._async;k.inherits(h,c),h.prototype._asyncInit=function(){this._init$(void 0,-2)},h.prototype._init=function(){},h.prototype._promiseFulfilled=function(a,c){var d,f,h,i,j,k,n,o,p=this._values,q=this.length(),r=this._preservedValues,s=this._limit;if(c<0){if(c=c*-1-1,p[c]=a,s>=1&&(this._inFlight--,this._drainQueue(),this._isResolved()))return!0}else{if(s>=1&&this._inFlight>=s)return p[c]=a,this._queue.push(c),!1;if(null!==r&&(r[c]=a),d=this._promise,f=this._callback,h=d._boundValue(),d._pushContext(),i=l(f).call(h,a,c,q),j=d._popContext(),g.checkForgottenReturns(i,j,null!==r?"Promise.filter":"Promise.map",d),i===m)return this._reject(i.e),!0;if(k=e(i,this._promise),k instanceof b){if(k=k._target(),n=k._bitField,0===(50397184&n))return s>=1&&this._inFlight++,p[c]=k,k._proxy(this,(c+1)*-1),!1;if(0===(33554432&n))return 0!==(16777216&n)?(this._reject(k._reason()),!0):(this._cancel(),!0);i=k._value()}p[c]=i}return o=++this._totalResolved,o>=q&&(null!==r?this._filter(p,r):this._resolve(p),!0)},h.prototype._drainQueue=function(){for(var a,b=this._queue,c=this._limit,d=this._values;b.length>0&&this._inFlight<c;){if(this._isResolved())return;a=b.pop(),this._promiseFulfilled(d[a],a)}},h.prototype._filter=function(a,b){var c,d=b.length,e=new Array(d),f=0;for(c=0;c<d;++c)a[c]&&(e[f++]=b[c]);e.length=f,this._resolve(e)},h.prototype.preservedValues=function(){return this._preservedValues},b.prototype.map=function(a,b){return i(this,a,b,null)},b.map=function(a,b,c,d){return i(a,b,c,d)}}},{"./util":36}],19:[function(a,b,c){"use strict";b.exports=function(b,c,d,e,f){var g=a("./util"),h=g.tryCatch;b.method=function(a){if("function"!=typeof a)throw new b.TypeError("expecting a function but got "+g.classString(a));return function(){var d,e,g=new b(c);return g._captureStackTrace(),g._pushContext(),d=h(a).apply(this,arguments),e=g._popContext(),f.checkForgottenReturns(d,e,"Promise.method",g),g._resolveFromSyncValue(d),g}},b.attempt=b["try"]=function(a){var d,i,j,k,l;return"function"!=typeof a?e("expecting a function but got "+g.classString(a)):(d=new b(c),d._captureStackTrace(),d._pushContext(),arguments.length>1?(f.deprecated("calling Promise.try with more than 1 argument"),j=arguments[1],k=arguments[2],i=g.isArray(j)?h(a).apply(k,j):h(a).call(k,j)):i=h(a)(),l=d._popContext(),f.checkForgottenReturns(i,l,"Promise.try",d),d._resolveFromSyncValue(i),d)},b.prototype._resolveFromSyncValue=function(a){a===g.errorObj?this._rejectCallback(a.e,!1):this._resolveCallback(a,!0)}}},{"./util":36}],20:[function(a,b,c){"use strict";function d(a){return a instanceof Error&&k.getPrototypeOf(a)===Error.prototype}function e(a){var b,c,e,f;if(d(a)){for(b=new j(a),b.name=a.name,b.message=a.message,b.stack=a.stack,c=k.keys(a),e=0;e<c.length;++e)f=c[e],l.test(f)||(b[f]=a[f]);return b}return g.markAsOriginatingFromRejection(a),a}function f(a,b){return function(c,d){var f,g;null!==a&&(c?(f=e(h(c)),a._attachExtraTrace(f),a._reject(f)):b?(g=[].slice.call(arguments,1),a._fulfill(g)):a._fulfill(d),a=null)}}var g=a("./util"),h=g.maybeWrapAsError,i=a("./errors"),j=i.OperationalError,k=a("./es5"),l=/^(?:name|message|stack|cause)$/;b.exports=f},{"./errors":12,"./es5":13,"./util":36}],21:[function(a,b,c){"use strict";b.exports=function(b){function c(a,b){var c,e=this;return f.isArray(a)?(c=h(b).apply(e._boundValue(),[null].concat(a)),void(c===i&&g.throwLater(c.e))):d.call(e,a,b)}function d(a,b){var c=this,d=c._boundValue(),e=void 0===a?h(b).call(d,null):h(b).call(d,null,a);e===i&&g.throwLater(e.e)}function e(a,b){var c,d,e=this;a||(c=new Error(a+""),c.cause=a,a=c),d=h(b).call(e._boundValue(),a),d===i&&g.throwLater(d.e)}var f=a("./util"),g=b._async,h=f.tryCatch,i=f.errorObj;b.prototype.asCallback=b.prototype.nodeify=function(a,b){if("function"==typeof a){var f=d;void 0!==b&&Object(b).spread&&(f=c),this._then(f,e,void 0,this,a)}return this}}},{"./util":36}],22:[function(a,b,c){"use strict";b.exports=function(){function c(){}function d(a,b){if("function"!=typeof b)throw new n("expecting a function but got "+H.classString(b));if(a.constructor!==e)throw new n("the promise constructor cannot be invoked directly\n\n    See http://goo.gl/MqrFmX\n")}function e(a){this._bitField=0,this._fulfillmentHandler0=void 0,this._rejectionHandler0=void 0,this._promise0=void 0,this._receiver0=void 0,a!==p&&(d(this,a),this._resolveFromExecutor(a)),this._promiseCreated(),this._fireEvent("promiseCreated",this)}function f(a){this.promise._resolveCallback(a)}function g(a){this.promise._rejectCallback(a,!1)}function h(a){var b=new e(p);b._fulfillmentHandler0=a,b._rejectionHandler0=a,b._promise0=a,b._receiver0=a}var i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D=function(){return new n("circular promise resolution chain\n\n    See http://goo.gl/MqrFmX\n")},E=function(){return new e.PromiseInspection(this._target())},F=function(a){return e.reject(new n(a))},G={},H=a("./util");return i=H.isNode?function(){var a=process.domain;return void 0===a&&(a=null),a}:function(){return null},H.notEnumerableProp(e,"_getDomain",i),j=a("./es5"),k=a("./async"),l=new k,j.defineProperty(e,"_async",{value:l}),m=a("./errors"),n=e.TypeError=m.TypeError,e.RangeError=m.RangeError,o=e.CancellationError=m.CancellationError,e.TimeoutError=m.TimeoutError,e.OperationalError=m.OperationalError,e.RejectionError=m.OperationalError,e.AggregateError=m.AggregateError,p=function(){},q={},r={},s=a("./thenables")(e,p),t=a("./promise_array")(e,p,s,F,c),u=a("./context")(e),v=u.create,w=a("./debuggability")(e,u),x=w.CapturedTrace,y=a("./finally")(e,s),z=a("./catch_filter")(r),A=a("./nodeback"),B=H.errorObj,C=H.tryCatch,e.prototype.toString=function(){return"[object Promise]"},e.prototype.caught=e.prototype["catch"]=function(a){var b,c,d,e,f=arguments.length;if(f>1){for(b=new Array(f-1),c=0,d=0;d<f-1;++d){if(e=arguments[d],!H.isObject(e))return F("expecting an object but got A catch statement predicate "+H.classString(e));b[c++]=e}return b.length=c,a=arguments[d],this.then(void 0,z(b,a,this))}return this.then(void 0,a)},e.prototype.reflect=function(){return this._then(E,E,void 0,this,void 0)},e.prototype.then=function(a,b){if(w.warnings()&&arguments.length>0&&"function"!=typeof a&&"function"!=typeof b){var c=".then() only accepts functions but was passed: "+H.classString(a);arguments.length>1&&(c+=", "+H.classString(b)),this._warn(c)}return this._then(a,b,void 0,void 0,void 0)},e.prototype.done=function(a,b){var c=this._then(a,b,void 0,void 0,void 0);c._setIsFinal()},e.prototype.spread=function(a){return"function"!=typeof a?F("expecting a function but got "+H.classString(a)):this.all()._then(a,void 0,void 0,q,void 0)},e.prototype.toJSON=function(){var a={isFulfilled:!1,isRejected:!1,fulfillmentValue:void 0,rejectionReason:void 0};return this.isFulfilled()?(a.fulfillmentValue=this.value(),a.isFulfilled=!0):this.isRejected()&&(a.rejectionReason=this.reason(),a.isRejected=!0),a},e.prototype.all=function(){return arguments.length>0&&this._warn(".all() was passed arguments but it does not take any"),new t(this).promise()},e.prototype.error=function(a){return this.caught(H.originatesFromRejection,a)},e.getNewLibraryCopy=b.exports,e.is=function(a){return a instanceof e},e.fromNode=e.fromCallback=function(a){var b,c,d=new e(p);return d._captureStackTrace(),b=arguments.length>1&&!!Object(arguments[1]).multiArgs,c=C(a)(A(d,b)),c===B&&d._rejectCallback(c.e,!0),d._isFateSealed()||d._setAsyncGuaranteed(),d},e.all=function(a){return new t(a).promise()},e.cast=function(a){var b=s(a);return b instanceof e||(b=new e(p),b._captureStackTrace(),b._setFulfilled(),b._rejectionHandler0=a),b},e.resolve=e.fulfilled=e.cast,e.reject=e.rejected=function(a){var b=new e(p);return b._captureStackTrace(),b._rejectCallback(a,!0),b},e.setScheduler=function(a){if("function"!=typeof a)throw new n("expecting a function but got "+H.classString(a));return l.setScheduler(a)},e.prototype._then=function(a,b,c,d,f){var g,h,j,k,m=void 0!==f,n=m?f:new e(p),q=this._target(),r=q._bitField;return m||(n._propagateFrom(this,3),n._captureStackTrace(),void 0===d&&0!==(2097152&this._bitField)&&(d=0!==(50397184&r)?this._boundValue():q===this?void 0:this._boundTo),this._fireEvent("promiseChained",this,n)),g=i(),0!==(50397184&r)?(k=q._settlePromiseCtx,0!==(33554432&r)?(j=q._rejectionHandler0,h=a):0!==(16777216&r)?(j=q._fulfillmentHandler0,h=b,q._unsetRejectionIsUnhandled()):(k=q._settlePromiseLateCancellationObserver,j=new o("late cancellation observer"),q._attachExtraTrace(j),h=b),l.invoke(k,q,{handler:null===g?h:"function"==typeof h&&H.domainBind(g,h),promise:n,receiver:d,value:j})):q._addCallbacks(a,b,n,d,g),n},e.prototype._length=function(){return 65535&this._bitField},e.prototype._isFateSealed=function(){return 0!==(117506048&this._bitField)},e.prototype._isFollowing=function(){return 67108864===(67108864&this._bitField)},e.prototype._setLength=function(a){this._bitField=this._bitField&-65536|65535&a},e.prototype._setFulfilled=function(){this._bitField=33554432|this._bitField,this._fireEvent("promiseFulfilled",this)},e.prototype._setRejected=function(){this._bitField=16777216|this._bitField,this._fireEvent("promiseRejected",this)},e.prototype._setFollowing=function(){this._bitField=67108864|this._bitField,this._fireEvent("promiseResolved",this)},e.prototype._setIsFinal=function(){this._bitField=4194304|this._bitField},e.prototype._isFinal=function(){return(4194304&this._bitField)>0},e.prototype._unsetCancelled=function(){this._bitField=this._bitField&-65537},e.prototype._setCancelled=function(){this._bitField=65536|this._bitField,this._fireEvent("promiseCancelled",this)},e.prototype._setWillBeCancelled=function(){this._bitField=8388608|this._bitField},e.prototype._setAsyncGuaranteed=function(){l.hasCustomScheduler()||(this._bitField=134217728|this._bitField)},e.prototype._receiverAt=function(a){var b=0===a?this._receiver0:this[4*a-4+3];if(b!==G)return void 0===b&&this._isBound()?this._boundValue():b},e.prototype._promiseAt=function(a){return this[4*a-4+2]},e.prototype._fulfillmentHandlerAt=function(a){return this[4*a-4+0]},e.prototype._rejectionHandlerAt=function(a){return this[4*a-4+1]},e.prototype._boundValue=function(){},e.prototype._migrateCallback0=function(a){var b=a._bitField,c=a._fulfillmentHandler0,d=a._rejectionHandler0,e=a._promise0,f=a._receiverAt(0);void 0===f&&(f=G),this._addCallbacks(c,d,e,f,null)},e.prototype._migrateCallbackAt=function(a,b){var c=a._fulfillmentHandlerAt(b),d=a._rejectionHandlerAt(b),e=a._promiseAt(b),f=a._receiverAt(b);void 0===f&&(f=G),this._addCallbacks(c,d,e,f,null)},e.prototype._addCallbacks=function(a,b,c,d,e){var f,g=this._length();return g>=65531&&(g=0,this._setLength(0)),0===g?(this._promise0=c,this._receiver0=d,"function"==typeof a&&(this._fulfillmentHandler0=null===e?a:H.domainBind(e,a)),"function"==typeof b&&(this._rejectionHandler0=null===e?b:H.domainBind(e,b))):(f=4*g-4,this[f+2]=c,this[f+3]=d,"function"==typeof a&&(this[f+0]=null===e?a:H.domainBind(e,a)),"function"==typeof b&&(this[f+1]=null===e?b:H.domainBind(e,b))),this._setLength(g+1),g},e.prototype._proxy=function(a,b){this._addCallbacks(void 0,void 0,b,a,null)},e.prototype._resolveCallback=function(a,b){var c,d,f,g,h,i;if(0===(117506048&this._bitField)){if(a===this)return this._rejectCallback(D(),!1);if(c=s(a,this),!(c instanceof e))return this._fulfill(a);if(b&&this._propagateFrom(c,2),d=c._target(),d===this)return void this._reject(D());if(f=d._bitField,0===(50397184&f)){for(g=this._length(),g>0&&d._migrateCallback0(this),h=1;h<g;++h)d._migrateCallbackAt(this,h);this._setFollowing(),this._setLength(0),this._setFollowee(d)}else 0!==(33554432&f)?this._fulfill(d._value()):0!==(16777216&f)?this._reject(d._reason()):(i=new o("late cancellation observer"),d._attachExtraTrace(i),this._reject(i))}},e.prototype._rejectCallback=function(a,b,c){var d,e=H.ensureErrorObject(a),f=e===a;f||c||!w.warnings()||(d="a promise was rejected with a non-error: "+H.classString(a),this._warn(d,!0)),this._attachExtraTrace(e,!!b&&f),this._reject(a)},e.prototype._resolveFromExecutor=function(a){var b,c,d=this;this._captureStackTrace(),this._pushContext(),b=!0,c=this._execute(a,function(a){d._resolveCallback(a)},function(a){d._rejectCallback(a,b)}),b=!1,this._popContext(),void 0!==c&&d._rejectCallback(c,!0)},e.prototype._settlePromiseFromHandler=function(a,b,c,d){var e,f,g=d._bitField;0===(65536&g)&&(d._pushContext(),b===q?c&&"number"==typeof c.length?e=C(a).apply(this._boundValue(),c):(e=B,e.e=new n("cannot .spread() a non-array: "+H.classString(c))):e=C(a).call(b,c),f=d._popContext(),g=d._bitField,0===(65536&g)&&(e===r?d._reject(c):e===B?d._rejectCallback(e.e,!1):(w.checkForgottenReturns(e,f,"",d,this),d._resolveCallback(e))))},e.prototype._target=function(){for(var a=this;a._isFollowing();)a=a._followee();return a},e.prototype._followee=function(){return this._rejectionHandler0},e.prototype._setFollowee=function(a){this._rejectionHandler0=a},e.prototype._settlePromise=function(a,b,d,f){var g=a instanceof e,h=this._bitField,i=0!==(134217728&h);0!==(65536&h)?(g&&a._invokeInternalOnCancel(),d instanceof y&&d.isFinallyHandler()?(d.cancelPromise=a,C(b).call(d,f)===B&&a._reject(B.e)):b===E?a._fulfill(E.call(d)):d instanceof c?d._promiseCancelled(a):g||a instanceof t?a._cancel():d.cancel()):"function"==typeof b?g?(i&&a._setAsyncGuaranteed(),this._settlePromiseFromHandler(b,d,f,a)):b.call(d,f,a):d instanceof c?d._isResolved()||(0!==(33554432&h)?d._promiseFulfilled(f,a):d._promiseRejected(f,a)):g&&(i&&a._setAsyncGuaranteed(),0!==(33554432&h)?a._fulfill(f):a._reject(f))},e.prototype._settlePromiseLateCancellationObserver=function(a){var b=a.handler,c=a.promise,d=a.receiver,f=a.value;"function"==typeof b?c instanceof e?this._settlePromiseFromHandler(b,d,f,c):b.call(d,f,c):c instanceof e&&c._reject(f)},e.prototype._settlePromiseCtx=function(a){this._settlePromise(a.promise,a.handler,a.receiver,a.value)},e.prototype._settlePromise0=function(a,b,c){var d=this._promise0,e=this._receiverAt(0);this._promise0=void 0,this._receiver0=void 0,this._settlePromise(d,a,e,b)},e.prototype._clearCallbackDataAtIndex=function(a){var b=4*a-4;this[b+2]=this[b+3]=this[b+0]=this[b+1]=void 0},e.prototype._fulfill=function(a){var b,c=this._bitField;if(!((117506048&c)>>>16)){if(a===this)return b=D(),this._attachExtraTrace(b),this._reject(b);this._setFulfilled(),this._rejectionHandler0=a,(65535&c)>0&&(0!==(134217728&c)?this._settlePromises():l.settlePromises(this))}},e.prototype._reject=function(a){var b=this._bitField;if(!((117506048&b)>>>16))return this._setRejected(),this._fulfillmentHandler0=a,this._isFinal()?l.fatalError(a,H.isNode):void((65535&b)>0?l.settlePromises(this):this._ensurePossibleRejectionHandled())},e.prototype._fulfillPromises=function(a,b){var c,d,e,f;for(c=1;c<a;c++)d=this._fulfillmentHandlerAt(c),e=this._promiseAt(c),f=this._receiverAt(c),this._clearCallbackDataAtIndex(c),this._settlePromise(e,d,f,b)},e.prototype._rejectPromises=function(a,b){var c,d,e,f;for(c=1;c<a;c++)d=this._rejectionHandlerAt(c),e=this._promiseAt(c),f=this._receiverAt(c),this._clearCallbackDataAtIndex(c),this._settlePromise(e,d,f,b)},e.prototype._settlePromises=function(){var a,b,c=this._bitField,d=65535&c;d>0&&(0!==(16842752&c)?(a=this._fulfillmentHandler0,this._settlePromise0(this._rejectionHandler0,a,c),this._rejectPromises(d,a)):(b=this._rejectionHandler0,this._settlePromise0(this._fulfillmentHandler0,b,c),this._fulfillPromises(d,b)),this._setLength(0)),this._clearCancellationData()},e.prototype._settledValue=function(){var a=this._bitField;return 0!==(33554432&a)?this._rejectionHandler0:0!==(16777216&a)?this._fulfillmentHandler0:void 0},e.defer=e.pending=function(){w.deprecated("Promise.defer","new Promise");var a=new e(p);return{promise:a,resolve:f,reject:g}},H.notEnumerableProp(e,"_makeSelfResolutionError",D),a("./method")(e,p,s,F,w),a("./bind")(e,p,s,w),a("./cancel")(e,t,F,w),a("./direct_resolve")(e),a("./synchronous_inspection")(e),a("./join")(e,t,s,p,l,i),e.Promise=e,e.version="3.4.7",a("./map.js")(e,t,F,s,p,w),a("./call_get.js")(e),a("./using.js")(e,F,s,v,p,w),a("./timers.js")(e,p,w),a("./generators.js")(e,F,p,s,c,w),a("./nodeify.js")(e),a("./promisify.js")(e,p),a("./props.js")(e,t,s,F),a("./race.js")(e,p,s,F),a("./reduce.js")(e,t,F,s,p,w),a("./settle.js")(e,t,w),a("./some.js")(e,t,F),a("./filter.js")(e,p),a("./each.js")(e,p),a("./any.js")(e),H.toFastProperties(e),H.toFastProperties(e.prototype),h({a:1}),h({b:2}),h({c:3}),h(1),h(function(){}),h(void 0),h(!1),h(new e(p)),w.setBounds(k.firstLineError,H.lastLineError),e}},{"./any.js":1,"./async":2,"./bind":3,"./call_get.js":5,"./cancel":6,"./catch_filter":7,"./context":8,"./debuggability":9,"./direct_resolve":10,"./each.js":11,"./errors":12,"./es5":13,"./filter.js":14,"./finally":15,"./generators.js":16,"./join":17,"./map.js":18,"./method":19,"./nodeback":20,"./nodeify.js":21,"./promise_array":23,"./promisify.js":24,"./props.js":25,"./race.js":27,"./reduce.js":28,"./settle.js":30,"./some.js":31,"./synchronous_inspection":32,"./thenables":33,"./timers.js":34,"./using.js":35,"./util":36}],23:[function(a,b,c){"use strict";b.exports=function(b,c,d,e,f){function g(a){switch(a){case-2:return[];case-3:return{}}}function h(a){var d=this._promise=new b(c);a instanceof b&&d._propagateFrom(a,3),d._setOnCancel(this),this._values=a,this._length=0,this._totalResolved=0,this._init(void 0,-2)}var i=a("./util"),j=i.isArray;return i.inherits(h,f),h.prototype.length=function(){return this._length},h.prototype.promise=function(){return this._promise},h.prototype._init=function k(a,c){var f,h,j=d(this._values,this._promise);if(j instanceof b){if(j=j._target(),f=j._bitField,this._values=j,0===(50397184&f))return this._promise._setAsyncGuaranteed(),j._then(k,this._reject,void 0,this,c);if(0===(33554432&f))return 0!==(16777216&f)?this._reject(j._reason()):this._cancel();j=j._value()}return j=i.asArray(j),null===j?(h=e("expecting an array or an iterable object but got "+i.classString(j)).reason(),void this._promise._rejectCallback(h,!1)):0===j.length?void(c===-5?this._resolveEmptyArray():this._resolve(g(c))):void this._iterate(j)},h.prototype._iterate=function(a){var c,e,f,g,h,i=this.getActualLength(a.length);for(this._length=i,this._values=this.shouldCopyValues()?new Array(i):this._values,c=this._promise,e=!1,f=null,g=0;g<i;++g)h=d(a[g],c),h instanceof b?(h=h._target(),f=h._bitField):f=null,e?null!==f&&h.suppressUnhandledRejections():null!==f?0===(50397184&f)?(h._proxy(this,g),this._values[g]=h):e=0!==(33554432&f)?this._promiseFulfilled(h._value(),g):0!==(16777216&f)?this._promiseRejected(h._reason(),g):this._promiseCancelled(g):e=this._promiseFulfilled(h,g);e||c._setAsyncGuaranteed()},h.prototype._isResolved=function(){return null===this._values},h.prototype._resolve=function(a){this._values=null,this._promise._fulfill(a)},h.prototype._cancel=function(){!this._isResolved()&&this._promise._isCancellable()&&(this._values=null,this._promise._cancel())},h.prototype._reject=function(a){this._values=null,this._promise._rejectCallback(a,!1)},h.prototype._promiseFulfilled=function(a,b){this._values[b]=a;var c=++this._totalResolved;return c>=this._length&&(this._resolve(this._values),!0)},h.prototype._promiseCancelled=function(){return this._cancel(),!0},h.prototype._promiseRejected=function(a){return this._totalResolved++,this._reject(a),!0},h.prototype._resultCancelled=function(){var a,c;if(!this._isResolved())if(a=this._values,this._cancel(),a instanceof b)a.cancel();else for(c=0;c<a.length;++c)a[c]instanceof b&&a[c].cancel()},h.prototype.shouldCopyValues=function(){return!0},h.prototype.getActualLength=function(a){return a},h}},{"./util":36}],24:[function(a,b,c){"use strict";b.exports=function(b,c){function d(a){return!B.test(a)}function e(a){try{return a.__isPromisified__===!0}catch(b){return!1}}function f(a,b,c){var d=s.getDataPropertyOrDefault(a,b+c,z);return!!d&&e(d)}function g(a,b,c){var d,e,f,g;for(d=0;d<a.length;d+=2)if(e=a[d],c.test(e))for(f=e.replace(c,""),g=0;g<a.length;g+=2)if(a[g]===f)throw new x("Cannot promisify an API that has normal methods with '%s'-suffix\n\n    See http://goo.gl/MqrFmX\n".replace("%s",b))}function h(a,b,c,d){var h,i,j,k,l=s.inheritedDataKeys(a),m=[];for(h=0;h<l.length;++h)i=l[h],j=a[i],k=d===C||C(i,j,a),"function"!=typeof j||e(j)||f(a,i,b)||!d(i,j,a,k)||m.push(i,j);return g(m,b,c),m}function i(a,d,e,f,g,h){function i(){var e,f,g,i=d;d===r&&(i=this),e=new b(c),e._captureStackTrace(),f="string"==typeof k&&this!==j?this[k]:a,g=t(e,h);try{f.apply(i,u(arguments,g))}catch(l){e._rejectCallback(v(l),!0,!0)}return e._isFateSealed()||e._setAsyncGuaranteed(),e}var j=function(){return this}(),k=a;return"string"==typeof k&&(a=f),s.notEnumerableProp(i,"__isPromisified__",!0),i}function j(a,b,c,d,e){var f,g,i,j,k,l,m=new RegExp(D(b)+"$"),n=h(a,b,m,c);for(f=0,g=n.length;f<g;f+=2)i=n[f],j=n[f+1],k=i+b,d===q?a[k]=q(i,r,i,j,b,e):(l=d(j,function(){return q(i,r,i,j,b,e)}),s.notEnumerableProp(l,"__isPromisified__",!0),a[k]=l);return s.toFastProperties(a),a}function k(a,b,c){return q(a,b,void 0,a,null,c)}var l,m,n,o,p,q,r={},s=a("./util"),t=a("./nodeback"),u=s.withAppended,v=s.maybeWrapAsError,w=s.canEvaluate,x=a("./errors").TypeError,y="Async",z={__isPromisified__:!0},A=["arity","length","name","arguments","caller","callee","prototype","__isPromisified__"],B=new RegExp("^(?:"+A.join("|")+")$"),C=function(a){return s.isIdentifier(a)&&"_"!==a.charAt(0)&&"constructor"!==a},D=function(a){return a.replace(/([$])/,"\\$")};q=w?l:i,b.promisify=function(a,b){var c,f,g;if("function"!=typeof a)throw new x("expecting a function but got "+s.classString(a));return e(a)?a:(b=Object(b),c=void 0===b.context?r:b.context,f=!!b.multiArgs,g=k(a,c,f),s.copyDescriptors(a,g,d),g)},b.promisifyAll=function(a,b){var c,d,e,f,g,h,i;if("function"!=typeof a&&"object"!=typeof a)throw new x("the target of promisifyAll must be an object or a function\n\n    See http://goo.gl/MqrFmX\n");if(b=Object(b),c=!!b.multiArgs,d=b.suffix,"string"!=typeof d&&(d=y),e=b.filter,"function"!=typeof e&&(e=C),f=b.promisifier,"function"!=typeof f&&(f=q),!s.isIdentifier(d))throw new RangeError("suffix must be a valid identifier\n\n    See http://goo.gl/MqrFmX\n");for(g=s.inheritedDataKeys(a),h=0;h<g.length;++h)i=a[g[h]],"constructor"!==g[h]&&s.isClass(i)&&(j(i.prototype,d,e,f,c),j(i,d,e,f,c));return j(a,d,e,f,c)}}},{"./errors":12,"./nodeback":20,"./util":36}],25:[function(a,b,c){"use strict";b.exports=function(b,c,d,e){function f(a){var b,c,d,e,f,g=!1;if(void 0!==h&&a instanceof h)b=i(a),g=!0;else for(c=m.keys(a),d=c.length,b=new Array(2*d),e=0;e<d;++e)f=c[e],b[e]=a[f],b[e+d]=f;this.constructor$(b),this._isMap=g,this._init$(void 0,-3)}function g(a){var c,g=d(a);return l(g)?(c=g instanceof b?g._then(b.props,void 0,void 0,void 0,void 0):new f(g).promise(),g instanceof b&&c._propagateFrom(g,2),c):e("cannot await properties of a non-object\n\n    See http://goo.gl/MqrFmX\n")}var h,i,j,k=a("./util"),l=k.isObject,m=a("./es5");"function"==typeof Map&&(h=Map),i=function(){function a(a,d){this[b]=a,this[b+c]=d,b++}var b=0,c=0;return function d(e){c=e.size,b=0;var f=new Array(2*e.size);return e.forEach(a,f),f}}(),j=function(a){var b,c,d,e=new h,f=a.length/2|0;for(b=0;b<f;++b)c=a[f+b],d=a[b],e.set(c,d);return e},k.inherits(f,c),f.prototype._init=function(){},f.prototype._promiseFulfilled=function(a,b){var c,d,e,f,g;if(this._values[b]=a,c=++this._totalResolved,c>=this._length){if(this._isMap)d=j(this._values);else for(d={},e=this.length(),f=0,g=this.length();f<g;++f)d[this._values[f+e]]=this._values[f];return this._resolve(d),!0}return!1},f.prototype.shouldCopyValues=function(){return!1},f.prototype.getActualLength=function(a){return a>>1},b.prototype.props=function(){return g(this)},b.props=function(a){return g(a)}}},{"./es5":13,"./util":36}],26:[function(a,b,c){"use strict";function d(a,b,c,d,e){for(var f=0;f<e;++f)c[f+d]=a[f+b],a[f+b]=void 0}function e(a){this._capacity=a,this._length=0,this._front=0}e.prototype._willBeOverCapacity=function(a){return this._capacity<a},e.prototype._pushOne=function(a){var b,c=this.length();this._checkCapacity(c+1),b=this._front+c&this._capacity-1,this[b]=a,this._length=c+1},e.prototype.push=function(a,b,c){var d,e,f=this.length()+3;return this._willBeOverCapacity(f)?(this._pushOne(a),this._pushOne(b),void this._pushOne(c)):(d=this._front+f-3,this._checkCapacity(f),e=this._capacity-1,this[d+0&e]=a,this[d+1&e]=b,this[d+2&e]=c,void(this._length=f))},e.prototype.shift=function(){var a=this._front,b=this[a];return this[a]=void 0,this._front=a+1&this._capacity-1,this._length--,b},e.prototype.length=function(){return this._length},e.prototype._checkCapacity=function(a){this._capacity<a&&this._resizeTo(this._capacity<<1)},e.prototype._resizeTo=function(a){var b,c,e,f=this._capacity;this._capacity=a,b=this._front,c=this._length,e=b+c&f-1,d(this,0,this,f,e)},b.exports=e},{}],27:[function(a,b,c){"use strict";b.exports=function(b,c,d,e){function f(a,f){var i,j,k,l,m,n,o=d(a);if(o instanceof b)return h(o);if(a=g.asArray(a),null===a)return e("expecting an array or an iterable object but got "+g.classString(a));for(i=new b(c),void 0!==f&&i._propagateFrom(f,3),j=i._fulfill,k=i._reject,l=0,
m=a.length;l<m;++l)n=a[l],(void 0!==n||l in a)&&b.cast(n)._then(j,k,void 0,i,null);return i}var g=a("./util"),h=function(a){return a.then(function(b){return f(b,a)})};b.race=function(a){return f(a,void 0)},b.prototype.race=function(){return f(this,void 0)}}},{"./util":36}],28:[function(a,b,c){"use strict";b.exports=function(b,c,d,e,f,g){function h(a,c,d,e){this.constructor$(a);var g=m();this._fn=null===g?c:n.domainBind(g,c),void 0!==d&&(d=b.resolve(d),d._attachCancellationCallback(this)),this._initialValue=d,this._currentCancellable=null,e===f?this._eachValues=Array(this._length):0===e?this._eachValues=null:this._eachValues=void 0,this._promise._captureStackTrace(),this._init$(void 0,-5)}function i(a,b){this.isFulfilled()?b._resolve(a):b._reject(a)}function j(a,b,c,e){if("function"!=typeof b)return d("expecting a function but got "+n.classString(b));var f=new h(a,b,c,e);return f.promise()}function k(a){this.accum=a,this.array._gotAccum(a);var c=e(this.value,this.array._promise);return c instanceof b?(this.array._currentCancellable=c,c._then(l,void 0,void 0,this,void 0)):l.call(this,c)}function l(a){var c,d,e=this.array,f=e._promise,h=o(e._fn);return f._pushContext(),c=void 0!==e._eachValues?h.call(f._boundValue(),a,this.index,this.length):h.call(f._boundValue(),this.accum,a,this.index,this.length),c instanceof b&&(e._currentCancellable=c),d=f._popContext(),g.checkForgottenReturns(c,d,void 0!==e._eachValues?"Promise.each":"Promise.reduce",f),c}var m=b._getDomain,n=a("./util"),o=n.tryCatch;n.inherits(h,c),h.prototype._gotAccum=function(a){void 0!==this._eachValues&&null!==this._eachValues&&a!==f&&this._eachValues.push(a)},h.prototype._eachComplete=function(a){return null!==this._eachValues&&this._eachValues.push(a),this._eachValues},h.prototype._init=function(){},h.prototype._resolveEmptyArray=function(){this._resolve(void 0!==this._eachValues?this._eachValues:this._initialValue)},h.prototype.shouldCopyValues=function(){return!1},h.prototype._resolve=function(a){this._promise._resolveCallback(a),this._values=null},h.prototype._resultCancelled=function(a){return a===this._initialValue?this._cancel():void(this._isResolved()||(this._resultCancelled$(),this._currentCancellable instanceof b&&this._currentCancellable.cancel(),this._initialValue instanceof b&&this._initialValue.cancel()))},h.prototype._iterate=function(a){var c,d,e,f;if(this._values=a,e=a.length,void 0!==this._initialValue?(c=this._initialValue,d=0):(c=b.resolve(a[0]),d=1),this._currentCancellable=c,!c.isRejected())for(;d<e;++d)f={accum:null,value:a[d],index:d,length:e,array:this},c=c._then(k,void 0,void 0,f,void 0);void 0!==this._eachValues&&(c=c._then(this._eachComplete,void 0,void 0,this,void 0)),c._then(i,i,void 0,c,this)},b.prototype.reduce=function(a,b){return j(this,a,b,null)},b.reduce=function(a,b,c,d){return j(a,b,c,d)}}},{"./util":36}],29:[function(a,b,c){"use strict";var d,e,f,g,h=a("./util"),i=function(){throw new Error("No async scheduler available\n\n    See http://goo.gl/MqrFmX\n")},j=h.getNativePromise();h.isNode&&"undefined"==typeof MutationObserver?(e=global.setImmediate,f=process.nextTick,d=h.isRecentNode?function(a){e.call(global,a)}:function(a){f.call(process,a)}):"function"==typeof j&&"function"==typeof j.resolve?(g=j.resolve(),d=function(a){g.then(a)}):d="undefined"==typeof MutationObserver||"undefined"!=typeof window&&window.navigator&&(window.navigator.standalone||window.cordova)?"undefined"!=typeof setImmediate?function(a){setImmediate(a)}:"undefined"!=typeof setTimeout?function(a){setTimeout(a,0)}:i:function(){var a,b=document.createElement("div"),c={attributes:!0},d=!1,e=document.createElement("div"),f=new MutationObserver(function(){b.classList.toggle("foo"),d=!1});return f.observe(e,c),a=function(){d||(d=!0,e.classList.toggle("foo"))},function g(d){var e=new MutationObserver(function(){e.disconnect(),d()});e.observe(b,c),a()}}(),b.exports=d},{"./util":36}],30:[function(a,b,c){"use strict";b.exports=function(b,c,d){function e(a){this.constructor$(a)}var f=b.PromiseInspection,g=a("./util");g.inherits(e,c),e.prototype._promiseResolved=function(a,b){this._values[a]=b;var c=++this._totalResolved;return c>=this._length&&(this._resolve(this._values),!0)},e.prototype._promiseFulfilled=function(a,b){var c=new f;return c._bitField=33554432,c._settledValueField=a,this._promiseResolved(b,c)},e.prototype._promiseRejected=function(a,b){var c=new f;return c._bitField=16777216,c._settledValueField=a,this._promiseResolved(b,c)},b.settle=function(a){return d.deprecated(".settle()",".reflect()"),new e(a).promise()},b.prototype.settle=function(){return b.settle(this)}}},{"./util":36}],31:[function(a,b,c){"use strict";b.exports=function(b,c,d){function e(a){this.constructor$(a),this._howMany=0,this._unwrap=!1,this._initialized=!1}function f(a,b){var c,f;return(0|b)!==b||b<0?d("expecting a positive integer\n\n    See http://goo.gl/MqrFmX\n"):(c=new e(a),f=c.promise(),c.setHowMany(b),c.init(),f)}var g=a("./util"),h=a("./errors").RangeError,i=a("./errors").AggregateError,j=g.isArray,k={};g.inherits(e,c),e.prototype._init=function(){if(this._initialized){if(0===this._howMany)return void this._resolve([]);this._init$(void 0,-5);var a=j(this._values);!this._isResolved()&&a&&this._howMany>this._canPossiblyFulfill()&&this._reject(this._getRangeError(this.length()))}},e.prototype.init=function(){this._initialized=!0,this._init()},e.prototype.setUnwrap=function(){this._unwrap=!0},e.prototype.howMany=function(){return this._howMany},e.prototype.setHowMany=function(a){this._howMany=a},e.prototype._promiseFulfilled=function(a){return this._addFulfilled(a),this._fulfilled()===this.howMany()&&(this._values.length=this.howMany(),1===this.howMany()&&this._unwrap?this._resolve(this._values[0]):this._resolve(this._values),!0)},e.prototype._promiseRejected=function(a){return this._addRejected(a),this._checkOutcome()},e.prototype._promiseCancelled=function(){return this._values instanceof b||null==this._values?this._cancel():(this._addRejected(k),this._checkOutcome())},e.prototype._checkOutcome=function(){var a,b;if(this.howMany()>this._canPossiblyFulfill()){for(a=new i,b=this.length();b<this._values.length;++b)this._values[b]!==k&&a.push(this._values[b]);return a.length>0?this._reject(a):this._cancel(),!0}return!1},e.prototype._fulfilled=function(){return this._totalResolved},e.prototype._rejected=function(){return this._values.length-this.length()},e.prototype._addRejected=function(a){this._values.push(a)},e.prototype._addFulfilled=function(a){this._values[this._totalResolved++]=a},e.prototype._canPossiblyFulfill=function(){return this.length()-this._rejected()},e.prototype._getRangeError=function(a){var b="Input array must contain at least "+this._howMany+" items but contains only "+a+" items";return new h(b)},e.prototype._resolveEmptyArray=function(){this._reject(this._getRangeError(0))},b.some=function(a,b){return f(a,b)},b.prototype.some=function(a){return f(this,a)},b._SomePromiseArray=e}},{"./errors":12,"./util":36}],32:[function(a,b,c){"use strict";b.exports=function(a){function b(a){void 0!==a?(a=a._target(),this._bitField=a._bitField,this._settledValueField=a._isFateSealed()?a._settledValue():void 0):(this._bitField=0,this._settledValueField=void 0)}var c,d,e,f,g,h;b.prototype._settledValue=function(){return this._settledValueField},c=b.prototype.value=function(){if(!this.isFulfilled())throw new TypeError("cannot get fulfillment value of a non-fulfilled promise\n\n    See http://goo.gl/MqrFmX\n");return this._settledValue()},d=b.prototype.error=b.prototype.reason=function(){if(!this.isRejected())throw new TypeError("cannot get rejection reason of a non-rejected promise\n\n    See http://goo.gl/MqrFmX\n");return this._settledValue()},e=b.prototype.isFulfilled=function(){return 0!==(33554432&this._bitField)},f=b.prototype.isRejected=function(){return 0!==(16777216&this._bitField)},g=b.prototype.isPending=function(){return 0===(50397184&this._bitField)},h=b.prototype.isResolved=function(){return 0!==(50331648&this._bitField)},b.prototype.isCancelled=function(){return 0!==(8454144&this._bitField)},a.prototype.__isCancelled=function(){return 65536===(65536&this._bitField)},a.prototype._isCancelled=function(){return this._target().__isCancelled()},a.prototype.isCancelled=function(){return 0!==(8454144&this._target()._bitField)},a.prototype.isPending=function(){return g.call(this._target())},a.prototype.isRejected=function(){return f.call(this._target())},a.prototype.isFulfilled=function(){return e.call(this._target())},a.prototype.isResolved=function(){return h.call(this._target())},a.prototype.value=function(){return c.call(this._target())},a.prototype.reason=function(){var a=this._target();return a._unsetRejectionIsUnhandled(),d.call(a)},a.prototype._value=function(){return this._settledValue()},a.prototype._reason=function(){return this._unsetRejectionIsUnhandled(),this._settledValue()},a.PromiseInspection=b}},{}],33:[function(a,b,c){"use strict";b.exports=function(b,c){function d(a,d){var e,i;if(k(a)){if(a instanceof b)return a;if(e=f(a),e===j)return d&&d._pushContext(),i=b.reject(e.e),d&&d._popContext(),i;if("function"==typeof e)return g(a)?(i=new b(c),a._then(i._fulfill,i._reject,void 0,i,null),i):h(a,e,d)}return a}function e(a){return a.then}function f(a){try{return e(a)}catch(b){return j.e=b,j}}function g(a){try{return l.call(a,"_promise0")}catch(b){return!1}}function h(a,d,e){function f(a){l&&(l._resolveCallback(a),l=null)}function g(a){l&&(l._rejectCallback(a,h,!0),l=null)}var h,k,l=new b(c),m=l;return e&&e._pushContext(),l._captureStackTrace(),e&&e._popContext(),h=!0,k=i.tryCatch(d).call(a,f,g),h=!1,l&&k===j&&(l._rejectCallback(k.e,!0,!0),l=null),m}var i=a("./util"),j=i.errorObj,k=i.isObject,l={}.hasOwnProperty;return d}},{"./util":36}],34:[function(a,b,c){"use strict";b.exports=function(b,c,d){function e(a){this.handle=a}function f(a){return clearTimeout(this.handle),a}function g(a){throw clearTimeout(this.handle),a}var h,i,j,k=a("./util"),l=b.TimeoutError;e.prototype._resultCancelled=function(){clearTimeout(this.handle)},h=function(a){return i(+this).thenReturn(a)},i=b.delay=function(a,f){var g,i;return void 0!==f?(g=b.resolve(f)._then(h,null,null,a,void 0),d.cancellation()&&f instanceof b&&g._setOnCancel(f)):(g=new b(c),i=setTimeout(function(){g._fulfill()},+a),d.cancellation()&&g._setOnCancel(new e(i)),g._captureStackTrace()),g._setAsyncGuaranteed(),g},b.prototype.delay=function(a){return i(a,this)},j=function(a,b,c){var d;d="string"!=typeof b?b instanceof Error?b:new l("operation timed out"):new l(b),k.markAsOriginatingFromRejection(d),a._attachExtraTrace(d),a._reject(d),null!=c&&c.cancel()},b.prototype.timeout=function(a,b){var c,h,i;return a=+a,i=new e(setTimeout(function k(){c.isPending()&&j(c,b,h)},a)),d.cancellation()?(h=this.then(),c=h._then(f,g,void 0,i,void 0),c._setOnCancel(i)):c=this._then(f,g,void 0,i,void 0),c}}},{"./util":36}],35:[function(a,b,c){"use strict";b.exports=function(b,c,d,e,f,g){function h(a){setTimeout(function(){throw a},0)}function i(a){var b=d(a);return b!==a&&"function"==typeof a._isDisposable&&"function"==typeof a._getDisposer&&a._isDisposable()&&b._setDisposable(a._getDisposer()),b}function j(a,c){function e(){if(g>=j)return k._fulfill();var f=i(a[g++]);if(f instanceof b&&f._isDisposable()){try{f=d(f._getDisposer().tryDispose(c),a.promise)}catch(l){return h(l)}if(f instanceof b)return f._then(e,h,null,null,null)}e()}var g=0,j=a.length,k=new b(f);return e(),k}function k(a,b,c){this._data=a,this._promise=b,this._context=c}function l(a,b,c){this.constructor$(a,b,c)}function m(a){return k.isDisposer(a)?(this.resources[this.index]._setDisposable(a),a.promise()):a}function n(a){this.length=a,this.promise=null,this[a-1]=null}var o=a("./util"),p=a("./errors").TypeError,q=a("./util").inherits,r=o.errorObj,s=o.tryCatch,t={};k.prototype.data=function(){return this._data},k.prototype.promise=function(){return this._promise},k.prototype.resource=function(){return this.promise().isFulfilled()?this.promise().value():t},k.prototype.tryDispose=function(a){var b,c=this.resource(),d=this._context;return void 0!==d&&d._pushContext(),b=c!==t?this.doDispose(c,a):null,void 0!==d&&d._popContext(),this._promise._unsetDisposable(),this._data=null,b},k.isDisposer=function(a){return null!=a&&"function"==typeof a.resource&&"function"==typeof a.tryDispose},q(l,k),l.prototype.doDispose=function(a,b){var c=this.data();return c.call(a,a,b)},n.prototype._resultCancelled=function(){var a,c,d=this.length;for(a=0;a<d;++a)c=this[a],c instanceof b&&c.cancel()},b.using=function(){var a,e,f,h,i,l,p,q,t,u,v,w=arguments.length;if(w<2)return c("you must pass at least 2 arguments to Promise.using");if(a=arguments[w-1],"function"!=typeof a)return c("expecting a function but got "+o.classString(a));for(f=!0,2===w&&Array.isArray(arguments[0])?(e=arguments[0],w=e.length,f=!1):(e=arguments,w--),h=new n(w),i=0;i<w;++i)l=e[i],k.isDisposer(l)?(p=l,l=l.promise(),l._setDisposable(p)):(q=d(l),q instanceof b&&(l=q._then(m,null,null,{resources:h,index:i},void 0))),h[i]=l;for(t=new Array(h.length),i=0;i<t.length;++i)t[i]=b.resolve(h[i]).reflect();return u=b.all(t).then(function(b){var c,d,e,h;for(c=0;c<b.length;++c){if(d=b[c],d.isRejected())return r.e=d.error(),r;if(!d.isFulfilled())return void u.cancel();b[c]=d.value()}return v._pushContext(),a=s(a),e=f?a.apply(void 0,b):a(b),h=v._popContext(),g.checkForgottenReturns(e,h,"Promise.using",v),e}),v=u.lastly(function(){var a=new b.PromiseInspection(u);return j(h,a)}),h.promise=v,v._setOnCancel(h),v},b.prototype._setDisposable=function(a){this._bitField=131072|this._bitField,this._disposer=a},b.prototype._isDisposable=function(){return(131072&this._bitField)>0},b.prototype._getDisposer=function(){return this._disposer},b.prototype._unsetDisposable=function(){this._bitField=this._bitField&-131073,this._disposer=void 0},b.prototype.disposer=function(a){if("function"==typeof a)return new l(a,this,e());throw new p}}},{"./errors":12,"./util":36}],36:[function(_dereq_,module,exports){"use strict";function tryCatcher(){try{var a=tryCatchTarget;return tryCatchTarget=null,a.apply(this,arguments)}catch(b){return errorObj.e=b,errorObj}}function tryCatch(a){return tryCatchTarget=a,tryCatcher}function isPrimitive(a){return null==a||a===!0||a===!1||"string"==typeof a||"number"==typeof a}function isObject(a){return"function"==typeof a||"object"==typeof a&&null!==a}function maybeWrapAsError(a){return isPrimitive(a)?new Error(safeToString(a)):a}function withAppended(a,b){var c,d=a.length,e=new Array(d+1);for(c=0;c<d;++c)e[c]=a[c];return e[c]=b,e}function getDataPropertyOrDefault(a,b,c){if(!es5.isES5)return{}.hasOwnProperty.call(a,b)?a[b]:void 0;var d=Object.getOwnPropertyDescriptor(a,b);return null!=d?null==d.get&&null==d.set?d.value:c:void 0}function notEnumerableProp(a,b,c){if(isPrimitive(a))return a;var d={value:c,configurable:!0,enumerable:!1,writable:!0};return es5.defineProperty(a,b,d),a}function thrower(a){throw a}function isClass(a){var b,c,d,e;try{return!!("function"==typeof a&&(b=es5.names(a.prototype),c=es5.isES5&&b.length>1,d=b.length>0&&!(1===b.length&&"constructor"===b[0]),e=thisAssignmentPattern.test(a+"")&&es5.names(a).length>0,c||d||e))}catch(f){return!1}}function toFastProperties(obj){function FakeConstructor(){}FakeConstructor.prototype=obj;for(var l=8;l--;)new FakeConstructor;return obj;eval(obj)}function isIdentifier(a){return rident.test(a)}function filledRange(a,b,c){var d,e=new Array(a);for(d=0;d<a;++d)e[d]=b+d+c;return e}function safeToString(a){try{return a+""}catch(b){return"[no string representation]"}}function isError(a){return null!==a&&"object"==typeof a&&"string"==typeof a.message&&"string"==typeof a.name}function markAsOriginatingFromRejection(a){try{notEnumerableProp(a,"isOperational",!0)}catch(b){}}function originatesFromRejection(a){return null!=a&&(a instanceof Error.__BluebirdErrorTypes__.OperationalError||a.isOperational===!0)}function canAttachTrace(a){return isError(a)&&es5.propertyIsWritable(a,"stack")}function classString(a){return{}.toString.call(a)}function copyDescriptors(a,b,c){var d,e,f=es5.names(a);for(d=0;d<f.length;++d)if(e=f[d],c(e))try{es5.defineProperty(b,e,es5.getDescriptor(a,e))}catch(g){}}function env(a){return hasEnvVariables?process.env[a]:void 0}function getNativePromise(){if("function"==typeof Promise)try{var a=new Promise(function(){});if("[object Promise]"==={}.toString.call(a))return Promise}catch(b){}}function domainBind(a,b){return a.bind(b)}var tryCatchTarget,ArrayFrom,isNode,hasEnvVariables,ret,es5=_dereq_("./es5"),canEvaluate="undefined"==typeof navigator,errorObj={e:{}},globalObject="undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:void 0!==this?this:null,inherits=function(a,b){function c(){this.constructor=a,this.constructor$=b;for(var c in b.prototype)d.call(b.prototype,c)&&"$"!==c.charAt(c.length-1)&&(this[c+"$"]=b.prototype[c])}var d={}.hasOwnProperty;return c.prototype=b.prototype,a.prototype=new c,a.prototype},inheritedDataKeys=function(){var a,b,c=[Array.prototype,Object.prototype,Function.prototype],d=function(a){for(var b=0;b<c.length;++b)if(c[b]===a)return!0;return!1};return es5.isES5?(a=Object.getOwnPropertyNames,function(b){for(var c,e,f,g,h=[],i=Object.create(null);null!=b&&!d(b);){try{c=a(b)}catch(j){return h}for(e=0;e<c.length;++e)f=c[e],i[f]||(i[f]=!0,g=Object.getOwnPropertyDescriptor(b,f),null!=g&&null==g.get&&null==g.set&&h.push(f));b=es5.getPrototypeOf(b)}return h}):(b={}.hasOwnProperty,function(a){var e,f,g;if(d(a))return[];e=[];a:for(f in a)if(b.call(a,f))e.push(f);else{for(g=0;g<c.length;++g)if(b.call(c[g],f))continue a;e.push(f)}return e})}(),thisAssignmentPattern=/this\s*\.\s*\S+\s*=/,rident=/^[a-z$_][a-z$_0-9]*$/i,ensureErrorObject=function(){return"stack"in new Error?function(a){return canAttachTrace(a)?a:new Error(safeToString(a))}:function(a){if(canAttachTrace(a))return a;try{throw new Error(safeToString(a))}catch(b){return b}}}(),asArray=function(a){return es5.isArray(a)?a:null};"undefined"!=typeof Symbol&&Symbol.iterator&&(ArrayFrom="function"==typeof Array.from?function(a){return Array.from(a)}:function(a){for(var b,c=[],d=a[Symbol.iterator]();!(b=d.next()).done;)c.push(b.value);return c},asArray=function(a){return es5.isArray(a)?a:null!=a&&"function"==typeof a[Symbol.iterator]?ArrayFrom(a):null}),isNode="undefined"!=typeof process&&"[object process]"===classString(process).toLowerCase(),hasEnvVariables="undefined"!=typeof process&&"undefined"!=typeof process.env,ret={isClass:isClass,isIdentifier:isIdentifier,inheritedDataKeys:inheritedDataKeys,getDataPropertyOrDefault:getDataPropertyOrDefault,thrower:thrower,isArray:es5.isArray,asArray:asArray,notEnumerableProp:notEnumerableProp,isPrimitive:isPrimitive,isObject:isObject,isError:isError,canEvaluate:canEvaluate,errorObj:errorObj,tryCatch:tryCatch,inherits:inherits,withAppended:withAppended,maybeWrapAsError:maybeWrapAsError,toFastProperties:toFastProperties,filledRange:filledRange,toString:safeToString,canAttachTrace:canAttachTrace,ensureErrorObject:ensureErrorObject,originatesFromRejection:originatesFromRejection,markAsOriginatingFromRejection:markAsOriginatingFromRejection,classString:classString,copyDescriptors:copyDescriptors,hasDevTools:"undefined"!=typeof chrome&&chrome&&"function"==typeof chrome.loadTimes,isNode:isNode,hasEnvVariables:hasEnvVariables,env:env,global:globalObject,getNativePromise:getNativePromise,domainBind:domainBind},ret.isRecentNode=ret.isNode&&function(){var a=process.versions.node.split(".").map(Number);return 0===a[0]&&a[1]>10||a[0]>0}(),ret.isNode&&ret.toFastProperties(process);try{throw new Error}catch(e){ret.lastLineError=e}module.exports=ret},{"./es5":13}]},{},[4])(4)}),"undefined"!=typeof window&&null!==window?window.P=window.Promise:"undefined"!=typeof self&&null!==self&&(self.P=self.Promise)}).call(this,require("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{_process:3}],2:[function(a,b,c){function d(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function e(a){return"function"==typeof a}function f(a){return"number"==typeof a}function g(a){return"object"==typeof a&&null!==a}function h(a){return void 0===a}b.exports=d,d.EventEmitter=d,d.prototype._events=void 0,d.prototype._maxListeners=void 0,d.defaultMaxListeners=10,d.prototype.setMaxListeners=function(a){if(!f(a)||a<0||isNaN(a))throw TypeError("n must be a positive number");return this._maxListeners=a,this},d.prototype.emit=function(a){var b,c,d,f,i,j;if(this._events||(this._events={}),"error"===a&&(!this._events.error||g(this._events.error)&&!this._events.error.length)){if(b=arguments[1],b instanceof Error)throw b;throw TypeError('Uncaught, unspecified "error" event.')}if(c=this._events[a],h(c))return!1;if(e(c))switch(arguments.length){case 1:c.call(this);break;case 2:c.call(this,arguments[1]);break;case 3:c.call(this,arguments[1],arguments[2]);break;default:for(d=arguments.length,f=new Array(d-1),i=1;i<d;i++)f[i-1]=arguments[i];c.apply(this,f)}else if(g(c)){for(d=arguments.length,f=new Array(d-1),i=1;i<d;i++)f[i-1]=arguments[i];for(j=c.slice(),d=j.length,i=0;i<d;i++)j[i].apply(this,f)}return!0},d.prototype.addListener=function(a,b){var c;if(!e(b))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",a,e(b.listener)?b.listener:b),this._events[a]?g(this._events[a])?this._events[a].push(b):this._events[a]=[this._events[a],b]:this._events[a]=b,g(this._events[a])&&!this._events[a].warned&&(c=h(this._maxListeners)?d.defaultMaxListeners:this._maxListeners,c&&c>0&&this._events[a].length>c&&(this._events[a].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[a].length),"function"==typeof console.trace&&console.trace())),this},d.prototype.on=d.prototype.addListener,d.prototype.once=function(a,b){function c(){this.removeListener(a,c),d||(d=!0,b.apply(this,arguments))}if(!e(b))throw TypeError("listener must be a function");var d=!1;return c.listener=b,this.on(a,c),this},d.prototype.removeListener=function(a,b){var c,d,f,h;if(!e(b))throw TypeError("listener must be a function");if(!this._events||!this._events[a])return this;if(c=this._events[a],f=c.length,d=-1,c===b||e(c.listener)&&c.listener===b)delete this._events[a],this._events.removeListener&&this.emit("removeListener",a,b);else if(g(c)){for(h=f;h-- >0;)if(c[h]===b||c[h].listener&&c[h].listener===b){d=h;break}if(d<0)return this;1===c.length?(c.length=0,delete this._events[a]):c.splice(d,1),this._events.removeListener&&this.emit("removeListener",a,b)}return this},d.prototype.removeAllListeners=function(a){var b,c;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[a]&&delete this._events[a],this;if(0===arguments.length){for(b in this._events)"removeListener"!==b&&this.removeAllListeners(b);return this.removeAllListeners("removeListener"),this._events={},this}if(c=this._events[a],e(c))this.removeListener(a,c);else for(;c.length;)this.removeListener(a,c[c.length-1]);return delete this._events[a],this},d.prototype.listeners=function(a){var b;return b=this._events&&this._events[a]?e(this._events[a])?[this._events[a]]:this._events[a].slice():[]},d.listenerCount=function(a,b){var c;return c=a._events&&a._events[b]?e(a._events[b])?1:a._events[b].length:0}},{}],3:[function(a,b,c){function d(){throw new Error("setTimeout has not been defined")}function e(){throw new Error("clearTimeout has not been defined")}function f(a){if(l===setTimeout)return setTimeout(a,0);if((l===d||!l)&&setTimeout)return l=setTimeout,setTimeout(a,0);try{return l(a,0)}catch(b){try{return l.call(null,a,0)}catch(b){return l.call(this,a,0)}}}function g(a){if(m===clearTimeout)return clearTimeout(a);if((m===e||!m)&&clearTimeout)return m=clearTimeout,clearTimeout(a);try{return m(a)}catch(b){try{return m.call(null,a)}catch(b){return m.call(this,a)}}}function h(){o&&p&&(o=!1,p.length?n=p.concat(n):q=-1,n.length&&i())}function i(){var a,b;if(!o){for(a=f(h),o=!0,b=n.length;b;){for(p=n,n=[];++q<b;)p&&p[q].run();q=-1,b=n.length}p=null,o=!1,g(a)}}function j(a,b){this.fun=a,this.array=b}function k(){}var l,m,n,o,p,q,r=b.exports={};!function(){try{l="function"==typeof setTimeout?setTimeout:d}catch(a){l=d}try{m="function"==typeof clearTimeout?clearTimeout:e}catch(a){m=e}}(),n=[],o=!1,q=-1,r.nextTick=function(a){var b,c=new Array(arguments.length-1);if(arguments.length>1)for(b=1;b<arguments.length;b++)c[b-1]=arguments[b];n.push(new j(a,c)),1!==n.length||o||f(i)},j.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=k,r.addListener=k,r.once=k,r.off=k,r.removeListener=k,r.removeAllListeners=k,r.emit=k,r.prependListener=k,r.prependOnceListener=k,r.listeners=function(a){return[]},r.binding=function(a){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(a){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}},{}],4:[function(a,b,c){!function(a,d){"use strict";var e,f,g="0.7.12",h="",i="?",j="function",k="undefined",l="object",m="string",n="major",o="model",p="name",q="type",r="vendor",s="version",t="architecture",u="console",v="mobile",w="tablet",x="smarttv",y="wearable",z="embedded",A={extend:function(a,b){var c,d={};for(c in a)b[c]&&b[c].length%2===0?d[c]=b[c].concat(a[c]):d[c]=a[c];return d},has:function(a,b){return"string"==typeof a&&b.toLowerCase().indexOf(a.toLowerCase())!==-1},lowerize:function(a){return a.toLowerCase()},major:function(a){return typeof a===m?a.replace(/[^\d\.]/g,"").split(".")[0]:d},trim:function(a){return a.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}},B={rgx:function(){for(var a,b,c,e,f,g,h,i,m,n=0,o=arguments;n<o.length&&!g;){if(i=o[n],m=o[n+1],typeof a===k){a={};for(e in m)m.hasOwnProperty(e)&&(f=m[e],typeof f===l?a[f[0]]=d:a[f]=d)}for(b=c=0;b<i.length&&!g;)if(g=i[b++].exec(this.getUA()))for(e=0;e<m.length;e++)h=g[++c],f=m[e],typeof f===l&&f.length>0?2==f.length?typeof f[1]==j?a[f[0]]=f[1].call(this,h):a[f[0]]=f[1]:3==f.length?typeof f[1]!==j||f[1].exec&&f[1].test?a[f[0]]=h?h.replace(f[1],f[2]):d:a[f[0]]=h?f[1].call(this,h,f[2]):d:4==f.length&&(a[f[0]]=h?f[3].call(this,h.replace(f[1],f[2])):d):a[f]=h?h:d;n+=2}return a},str:function(a,b){var c,e;for(c in b)if(typeof b[c]===l&&b[c].length>0){for(e=0;e<b[c].length;e++)if(A.has(b[c][e],a))return c===i?d:c}else if(A.has(b[c],a))return c===i?d:c;return a}},C={browser:{oldsafari:{version:{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}}},device:{amazon:{model:{"Fire Phone":["SD","KF"]}},sprint:{model:{"Evo Shift 4G":"7373KT"},vendor:{HTC:"APA",Sprint:"Sprint"}}},os:{windows:{version:{ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2000:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"}}}},D={browser:[[/(opera\smini)\/([\w\.-]+)/i,/(opera\s[mobiletab]+).+version\/([\w\.-]+)/i,/(opera).+version\/([\w\.]+)/i,/(opera)[\/\s]+([\w\.]+)/i],[p,s],[/(opios)[\/\s]+([\w\.]+)/i],[[p,"Opera Mini"],s],[/\s(opr)\/([\w\.]+)/i],[[p,"Opera"],s],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/\s]?([\w\.]+)*/i,/(avant\s|iemobile|slim|baidu)(?:browser)?[\/\s]?([\w\.]*)/i,/(?:ms|\()(ie)\s([\w\.]+)/i,/(rekonq)\/([\w\.]+)*/i,/(chromium|flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs)\/([\w\.-]+)/i],[p,s],[/(trident).+rv[:\s]([\w\.]+).+like\sgecko/i],[[p,"IE"],s],[/(edge)\/((\d+)?[\w\.]+)/i],[p,s],[/(yabrowser)\/([\w\.]+)/i],[[p,"Yandex"],s],[/(comodo_dragon)\/([\w\.]+)/i],[[p,/_/g," "],s],[/(micromessenger)\/([\w\.]+)/i],[[p,"WeChat"],s],[/xiaomi\/miuibrowser\/([\w\.]+)/i],[s,[p,"MIUI Browser"]],[/\swv\).+(chrome)\/([\w\.]+)/i],[[p,/(.+)/,"$1 WebView"],s],[/android.+samsungbrowser\/([\w\.]+)/i,/android.+version\/([\w\.]+)\s+(?:mobile\s?safari|safari)*/i],[s,[p,"Android Browser"]],[/(chrome|omniweb|arora|[tizenoka]{5}\s?browser)\/v?([\w\.]+)/i,/(qqbrowser)[\/\s]?([\w\.]+)/i],[p,s],[/(uc\s?browser)[\/\s]?([\w\.]+)/i,/ucweb.+(ucbrowser)[\/\s]?([\w\.]+)/i,/juc.+(ucweb)[\/\s]?([\w\.]+)/i],[[p,"UCBrowser"],s],[/(dolfin)\/([\w\.]+)/i],[[p,"Dolphin"],s],[/((?:android.+)crmo|crios)\/([\w\.]+)/i],[[p,"Chrome"],s],[/;fbav\/([\w\.]+);/i],[s,[p,"Facebook"]],[/fxios\/([\w\.-]+)/i],[s,[p,"Firefox"]],[/version\/([\w\.]+).+?mobile\/\w+\s(safari)/i],[s,[p,"Mobile Safari"]],[/version\/([\w\.]+).+?(mobile\s?safari|safari)/i],[s,p],[/webkit.+?(mobile\s?safari|safari)(\/[\w\.]+)/i],[p,[s,B.str,C.browser.oldsafari.version]],[/(konqueror)\/([\w\.]+)/i,/(webkit|khtml)\/([\w\.]+)/i],[p,s],[/(navigator|netscape)\/([\w\.-]+)/i],[[p,"Netscape"],s],[/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo\sbrowser|minimo|conkeror)[\/\s]?([\w\.\+]+)/i,/(firefox|seamonkey|k-meleon|icecat|iceape|firebird|phoenix)\/([\w\.-]+)/i,/(mozilla)\/([\w\.]+).+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir)[\/\s]?([\w\.]+)/i,/(links)\s\(([\w\.]+)/i,/(gobrowser)\/?([\w\.]+)*/i,/(ice\s?browser)\/v?([\w\._]+)/i,/(mosaic)[\/\s]([\w\.]+)/i],[p,s]],cpu:[[/(?:(amd|x(?:(?:86|64)[_-])?|wow|win)64)[;\)]/i],[[t,"amd64"]],[/(ia32(?=;))/i],[[t,A.lowerize]],[/((?:i[346]|x)86)[;\)]/i],[[t,"ia32"]],[/windows\s(ce|mobile);\sppc;/i],[[t,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?:\smac|;|\))/i],[[t,/ower/,"",A.lowerize]],[/(sun4\w)[;\)]/i],[[t,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|arm(?:64|(?=v\d+;))|(?=atmel\s)avr|(?:irix|mips|sparc)(?:64)?(?=;)|pa-risc)/i],[[t,A.lowerize]]],device:[[/\((ipad|playbook);[\w\s\);-]+(rim|apple)/i],[o,r,[q,w]],[/applecoremedia\/[\w\.]+ \((ipad)/],[o,[r,"Apple"],[q,w]],[/(apple\s{0,1}tv)/i],[[o,"Apple TV"],[r,"Apple"]],[/(archos)\s(gamepad2?)/i,/(hp).+(touchpad)/i,/(hp).+(tablet)/i,/(kindle)\/([\w\.]+)/i,/\s(nook)[\w\s]+build\/(\w+)/i,/(dell)\s(strea[kpr\s\d]*[\dko])/i],[r,o,[q,w]],[/(kf[A-z]+)\sbuild\/[\w\.]+.*silk\//i],[o,[r,"Amazon"],[q,w]],[/(sd|kf)[0349hijorstuw]+\sbuild\/[\w\.]+.*silk\//i],[[o,B.str,C.device.amazon.model],[r,"Amazon"],[q,v]],[/\((ip[honed|\s\w*]+);.+(apple)/i],[o,r,[q,v]],[/\((ip[honed|\s\w*]+);/i],[o,[r,"Apple"],[q,v]],[/(blackberry)[\s-]?(\w+)/i,/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|huawei|meizu|motorola|polytron)[\s_-]?([\w-]+)*/i,/(hp)\s([\w\s]+\w)/i,/(asus)-?(\w+)/i],[r,o,[q,v]],[/\(bb10;\s(\w+)/i],[o,[r,"BlackBerry"],[q,v]],[/android.+(transfo[prime\s]{4,10}\s\w+|eeepc|slider\s\w+|nexus 7|padfone)/i],[o,[r,"Asus"],[q,w]],[/(sony)\s(tablet\s[ps])\sbuild\//i,/(sony)?(?:sgp.+)\sbuild\//i],[[r,"Sony"],[o,"Xperia Tablet"],[q,w]],[/(?:sony)?(?:(?:(?:c|d)\d{4})|(?:so[-l].+))\sbuild\//i],[[r,"Sony"],[o,"Xperia Phone"],[q,v]],[/\s(ouya)\s/i,/(nintendo)\s([wids3u]+)/i],[r,o,[q,u]],[/android.+;\s(shield)\sbuild/i],[o,[r,"Nvidia"],[q,u]],[/(playstation\s[34portablevi]+)/i],[o,[r,"Sony"],[q,u]],[/(sprint\s(\w+))/i],[[r,B.str,C.device.sprint.vendor],[o,B.str,C.device.sprint.model],[q,v]],[/(lenovo)\s?(S(?:5000|6000)+(?:[-][\w+]))/i],[r,o,[q,w]],[/(htc)[;_\s-]+([\w\s]+(?=\))|\w+)*/i,/(zte)-(\w+)*/i,/(alcatel|geeksphone|huawei|lenovo|nexian|panasonic|(?=;\s)sony)[_\s-]?([\w-]+)*/i],[r,[o,/_/g," "],[q,v]],[/(nexus\s9)/i],[o,[r,"HTC"],[q,w]],[/(nexus\s6p)/i],[o,[r,"Huawei"],[q,v]],[/(microsoft);\s(lumia[\s\w]+)/i],[r,o,[q,v]],[/[\s\(;](xbox(?:\sone)?)[\s\);]/i],[o,[r,"Microsoft"],[q,u]],[/(kin\.[onetw]{3})/i],[[o,/\./g," "],[r,"Microsoft"],[q,v]],[/\s(milestone|droid(?:[2-4x]|\s(?:bionic|x2|pro|razr))?(:?\s4g)?)[\w\s]+build\//i,/mot[\s-]?(\w+)*/i,/(XT\d{3,4}) build\//i,/(nexus\s6)/i],[o,[r,"Motorola"],[q,v]],[/android.+\s(mz60\d|xoom[\s2]{0,2})\sbuild\//i],[o,[r,"Motorola"],[q,w]],[/hbbtv\/\d+\.\d+\.\d+\s+\([\w\s]*;\s*(\w[^;]*);([^;]*)/i],[[r,A.trim],[o,A.trim],[q,x]],[/hbbtv.+maple;(\d+)/i],[[o,/^/,"SmartTV"],[r,"Samsung"],[q,x]],[/\(dtv[\);].+(aquos)/i],[o,[r,"Sharp"],[q,x]],[/android.+((sch-i[89]0\d|shw-m380s|gt-p\d{4}|gt-n\d+|sgh-t8[56]9|nexus 10))/i,/((SM-T\w+))/i],[[r,"Samsung"],o,[q,w]],[/smart-tv.+(samsung)/i],[r,[q,x],o],[/((s[cgp]h-\w+|gt-\w+|galaxy\snexus|sm-\w[\w\d]+))/i,/(sam[sung]*)[\s-]*(\w+-?[\w-]*)*/i,/sec-((sgh\w+))/i],[[r,"Samsung"],o,[q,v]],[/sie-(\w+)*/i],[o,[r,"Siemens"],[q,v]],[/(maemo|nokia).*(n900|lumia\s\d+)/i,/(nokia)[\s_-]?([\w-]+)*/i],[[r,"Nokia"],o,[q,v]],[/android\s3\.[\s\w;-]{10}(a\d{3})/i],[o,[r,"Acer"],[q,w]],[/android\s3\.[\s\w;-]{10}(lg?)-([06cv9]{3,4})/i],[[r,"LG"],o,[q,w]],[/(lg) netcast\.tv/i],[r,o,[q,x]],[/(nexus\s[45])/i,/lg[e;\s\/-]+(\w+)*/i],[o,[r,"LG"],[q,v]],[/android.+(ideatab[a-z0-9\-\s]+)/i],[o,[r,"Lenovo"],[q,w]],[/linux;.+((jolla));/i],[r,o,[q,v]],[/((pebble))app\/[\d\.]+\s/i],[r,o,[q,y]],[/android.+;\s(glass)\s\d/i],[o,[r,"Google"],[q,y]],[/android.+(\w+)\s+build\/hm\1/i,/android.+(hm[\s\-_]*note?[\s_]*(?:\d\w)?)\s+build/i,/android.+(mi[\s\-_]*(?:one|one[\s_]plus|note lte)?[\s_]*(?:\d\w)?)\s+build/i],[[o,/_/g," "],[r,"Xiaomi"],[q,v]],[/android.+a000(1)\s+build/i],[o,[r,"OnePlus"],[q,v]],[/\s(tablet)[;\/]/i,/\s(mobile)(?:[;\/]|\ssafari)/i],[[q,A.lowerize],r,o]],
engine:[[/windows.+\sedge\/([\w\.]+)/i],[s,[p,"EdgeHTML"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m)\/([\w\.]+)/i,/(khtml|tasman|links)[\/\s]\(?([\w\.]+)/i,/(icab)[\/\s]([23]\.[\d\.]+)/i],[p,s],[/rv\:([\w\.]+).*(gecko)/i],[s,p]],os:[[/microsoft\s(windows)\s(vista|xp)/i],[p,s],[/(windows)\snt\s6\.2;\s(arm)/i,/(windows\sphone(?:\sos)*)[\s\/]?([\d\.\s]+\w)*/i,/(windows\smobile|windows)[\s\/]?([ntce\d\.\s]+\w)/i],[p,[s,B.str,C.os.windows.version]],[/(win(?=3|9|n)|win\s9x\s)([nt\d\.]+)/i],[[p,"Windows"],[s,B.str,C.os.windows.version]],[/\((bb)(10);/i],[[p,"BlackBerry"],s],[/(blackberry)\w*\/?([\w\.]+)*/i,/(tizen)[\/\s]([\w\.]+)/i,/(android|webos|palm\sos|qnx|bada|rim\stablet\sos|meego|contiki)[\/\s-]?([\w\.]+)*/i,/linux;.+(sailfish);/i],[p,s],[/(symbian\s?os|symbos|s60(?=;))[\/\s-]?([\w\.]+)*/i],[[p,"Symbian"],s],[/\((series40);/i],[p],[/mozilla.+\(mobile;.+gecko.+firefox/i],[[p,"Firefox OS"],s],[/(nintendo|playstation)\s([wids34portablevu]+)/i,/(mint)[\/\s\(]?(\w+)*/i,/(mageia|vectorlinux)[;\s]/i,/(joli|[kxln]?ubuntu|debian|[open]*suse|gentoo|(?=\s)arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk|linpus)[\/\s-]?(?!chrom)([\w\.-]+)*/i,/(hurd|linux)\s?([\w\.]+)*/i,/(gnu)\s?([\w\.]+)*/i],[p,s],[/(cros)\s[\w]+\s([\w\.]+\w)/i],[[p,"Chromium OS"],s],[/(sunos)\s?([\w\.]+\d)*/i],[[p,"Solaris"],s],[/\s([frentopc-]{0,4}bsd|dragonfly)\s?([\w\.]+)*/i],[p,s],[/(haiku)\s(\w+)/i],[p,s],[/(ip[honead]+)(?:.*os\s([\w]+)*\slike\smac|;\sopera)/i],[[p,"iOS"],[s,/_/g,"."]],[/(mac\sos\sx)\s?([\w\s\.]+\w)*/i,/(macintosh|mac(?=_powerpc)\s)/i],[[p,"Mac OS"],[s,/_/g,"."]],[/((?:open)?solaris)[\/\s-]?([\w\.]+)*/i,/(aix)\s((\d)(?=\.|\)|\s)[\w\.]*)*/i,/(plan\s9|minix|beos|os\/2|amigaos|morphos|risc\sos|openvms)/i,/(unix)\s?([\w\.]+)*/i],[p,s]]},E=function(b,c){var d,e;return this instanceof E?(d=b||(a&&a.navigator&&a.navigator.userAgent?a.navigator.userAgent:h),e=c?A.extend(D,c):D,this.getBrowser=function(){var a=B.rgx.apply(this,e.browser);return a.major=A.major(a.version),a},this.getCPU=function(){return B.rgx.apply(this,e.cpu)},this.getDevice=function(){return B.rgx.apply(this,e.device)},this.getEngine=function(){return B.rgx.apply(this,e.engine)},this.getOS=function(){return B.rgx.apply(this,e.os)},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return d},this.setUA=function(a){return d=a,this},this):new E(b,c).getResult()};E.VERSION=g,E.BROWSER={NAME:p,MAJOR:n,VERSION:s},E.CPU={ARCHITECTURE:t},E.DEVICE={MODEL:o,VENDOR:r,TYPE:q,CONSOLE:u,MOBILE:v,SMARTTV:x,TABLET:w,WEARABLE:y,EMBEDDED:z},E.ENGINE={NAME:p,VERSION:s},E.OS={NAME:p,VERSION:s},typeof c!==k?(typeof b!==k&&b.exports&&(c=b.exports=E),c.UAParser=E):typeof define===j&&define.amd?define(function(){return E}):a.UAParser=E,e=a.jQuery||a.Zepto,typeof e!==k&&(f=new E,e.ua=f.getResult(),e.ua.get=function(){return f.getUA()},e.ua.set=function(a){var b,c;f.setUA(a),b=f.getResult();for(c in b)e.ua[c]=b[c]})}("object"==typeof window?window:this)},{}],5:[function(a,b,c){var d=function(){function a(a){return null==a?String(a):S[T.call(a)]||"object"}function b(b){return"function"==a(b)}function c(a){return null!=a&&a==a.window}function d(a){return null!=a&&a.nodeType==a.DOCUMENT_NODE}function e(b){return"object"==a(b)}function f(a){return e(a)&&!c(a)&&Object.getPrototypeOf(a)==Object.prototype}function g(a){return"number"==typeof a.length}function h(a){return B.call(a,function(a){return null!=a})}function i(a){return a.length>0?x.fn.concat.apply([],a):a}function j(a){return a.replace(/::/g,"/").replace(/([A-Z]+)([A-Z][a-z])/g,"$1_$2").replace(/([a-z\d])([A-Z])/g,"$1_$2").replace(/_/g,"-").toLowerCase()}function k(a){return a in E?E[a]:E[a]=new RegExp("(^|\\s)"+a+"(\\s|$)")}function l(a,b){return"number"!=typeof b||F[j(a)]?b:b+"px"}function m(a){var b,c;return D[a]||(b=C.createElement(a),C.body.appendChild(b),c=getComputedStyle(b,"").getPropertyValue("display"),b.parentNode.removeChild(b),"none"==c&&(c="block"),D[a]=c),D[a]}function n(a){return"children"in a?A.call(a.children):x.map(a.childNodes,function(a){if(1==a.nodeType)return a})}function o(a,b,c){for(w in b)c&&(f(b[w])||Z(b[w]))?(f(b[w])&&!f(a[w])&&(a[w]={}),Z(b[w])&&!Z(a[w])&&(a[w]=[]),o(a[w],b[w],c)):b[w]!==v&&(a[w]=b[w])}function p(a,b){return null==b?x(a):x(a).filter(b)}function q(a,c,d,e){return b(c)?c.call(a,d,e):c}function r(a,b,c){null==c?a.removeAttribute(b):a.setAttribute(b,c)}function s(a,b){var c=a.className||"",d=c&&c.baseVal!==v;return b===v?d?c.baseVal:c:void(d?c.baseVal=b:a.className=b)}function t(a){try{return a?"true"==a||"false"!=a&&("null"==a?null:+a+""==a?+a:/^[\[\{]/.test(a)?x.parseJSON(a):a):a}catch(b){return a}}function u(a,b){b(a);for(var c=0,d=a.childNodes.length;c<d;c++)u(a.childNodes[c],b)}var v,w,x,y,z=[],A=z.slice,B=z.filter,C=window.document,D={},E={},F={"column-count":1,columns:1,"font-weight":1,"line-height":1,opacity:1,"z-index":1,zoom:1},G=/^\s*<(\w+|!)[^>]*>/,H=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,I=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,J=/^(?:body|html)$/i,K=/([A-Z])/g,L=["val","css","html","text","data","width","height","offset"],M=["after","prepend","before","append"],N=C.createElement("table"),O=C.createElement("tr"),P={tr:C.createElement("tbody"),tbody:N,thead:N,tfoot:N,td:O,th:O,"*":C.createElement("div")},Q=/complete|loaded|interactive/,R=/^[\w-]*$/,S={},T=S.toString,U={},V,W,X=C.createElement("div"),Y={tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},Z=Array.isArray||function(a){return a instanceof Array};return U.matches=function(a,b){var c,d,e,f;return!(!b||!a||1!==a.nodeType)&&((c=a.webkitMatchesSelector||a.mozMatchesSelector||a.oMatchesSelector||a.matchesSelector)?c.call(a,b):(e=a.parentNode,f=!e,f&&(e=X).appendChild(a),d=~U.qsa(e,b).indexOf(a),f&&X.removeChild(a),d))},V=function(a){return a.replace(/-+(.)?/g,function(a,b){return b?b.toUpperCase():""})},W=function(a){return B.call(a,function(b,c){return a.indexOf(b)==c})},U.fragment=function(a,b,c){var d,e,g;return H.test(a)&&(d=x(C.createElement(RegExp.$1))),d||(a.replace&&(a=a.replace(I,"<$1></$2>")),b===v&&(b=G.test(a)&&RegExp.$1),b in P||(b="*"),g=P[b],g.innerHTML=""+a,d=x.each(A.call(g.childNodes),function(){g.removeChild(this)})),f(c)&&(e=x(d),x.each(c,function(a,b){L.indexOf(a)>-1?e[a](b):e.attr(a,b)})),d},U.Z=function(a,b){return a=a||[],a.__proto__=x.fn,a.selector=b||"",a},U.isZ=function(a){return a instanceof U.Z},U.init=function(a,c){var d;if(!a)return U.Z();if("string"==typeof a)if(a=a.trim(),"<"==a[0]&&G.test(a))d=U.fragment(a,RegExp.$1,c),a=null;else{if(c!==v)return x(c).find(a);d=U.qsa(C,a)}else{if(b(a))return x(C).ready(a);if(U.isZ(a))return a;if(Z(a))d=h(a);else if(e(a))d=[a],a=null;else if(G.test(a))d=U.fragment(a.trim(),RegExp.$1,c),a=null;else{if(c!==v)return x(c).find(a);d=U.qsa(C,a)}}return U.Z(d,a)},x=function(a,b){return U.init(a,b)},x.extend=function(a){var b,c=A.call(arguments,1);return"boolean"==typeof a&&(b=a,a=c.shift()),c.forEach(function(c){o(a,c,b)}),a},U.qsa=function(a,b){var c,e="#"==b[0],f=!e&&"."==b[0],g=e||f?b.slice(1):b,h=R.test(g);return d(a)&&h&&e?(c=a.getElementById(g))?[c]:[]:1!==a.nodeType&&9!==a.nodeType?[]:A.call(h&&!e?f?a.getElementsByClassName(g):a.getElementsByTagName(b):a.querySelectorAll(b))},x.contains=C.documentElement.contains?function(a,b){return a!==b&&a.contains(b)}:function(a,b){for(;b&&(b=b.parentNode);)if(b===a)return!0;return!1},x.type=a,x.isFunction=b,x.isWindow=c,x.isArray=Z,x.isPlainObject=f,x.isEmptyObject=function(a){var b;for(b in a)return!1;return!0},x.inArray=function(a,b,c){return z.indexOf.call(b,a,c)},x.camelCase=V,x.trim=function(a){return null==a?"":String.prototype.trim.call(a)},x.uuid=0,x.support={},x.expr={},x.map=function(a,b){var c,d=[],e,f;if(g(a))for(e=0;e<a.length;e++)c=b(a[e],e),null!=c&&d.push(c);else for(f in a)c=b(a[f],f),null!=c&&d.push(c);return i(d)},x.each=function(a,b){var c,d;if(g(a)){for(c=0;c<a.length;c++)if(b.call(a[c],c,a[c])===!1)return a}else for(d in a)if(b.call(a[d],d,a[d])===!1)return a;return a},x.grep=function(a,b){return B.call(a,b)},window.JSON&&(x.parseJSON=JSON.parse),x.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(a,b){S["[object "+b+"]"]=b.toLowerCase()}),x.fn={forEach:z.forEach,reduce:z.reduce,push:z.push,sort:z.sort,indexOf:z.indexOf,concat:z.concat,map:function(a){return x(x.map(this,function(b,c){return a.call(b,c,b)}))},slice:function(){return x(A.apply(this,arguments))},ready:function(a){return Q.test(C.readyState)&&C.body?a(x):C.addEventListener("DOMContentLoaded",function(){a(x)},!1),this},get:function(a){return a===v?A.call(this):this[a>=0?a:a+this.length]},toArray:function(){return this.get()},size:function(){return this.length},remove:function(){return this.each(function(){null!=this.parentNode&&this.parentNode.removeChild(this)})},each:function(a){return z.every.call(this,function(b,c){return a.call(b,c,b)!==!1}),this},filter:function(a){return b(a)?this.not(this.not(a)):x(B.call(this,function(b){return U.matches(b,a)}))},add:function(a,b){return x(W(this.concat(x(a,b))))},is:function(a){return this.length>0&&U.matches(this[0],a)},not:function(a){var c,d=[];return b(a)&&a.call!==v?this.each(function(b){a.call(this,b)||d.push(this)}):(c="string"==typeof a?this.filter(a):g(a)&&b(a.item)?A.call(a):x(a),this.forEach(function(a){c.indexOf(a)<0&&d.push(a)})),x(d)},has:function(a){return this.filter(function(){return e(a)?x.contains(this,a):x(this).find(a).size()})},eq:function(a){return a===-1?this.slice(a):this.slice(a,+a+1)},first:function(){var a=this[0];return a&&!e(a)?a:x(a)},last:function(){var a=this[this.length-1];return a&&!e(a)?a:x(a)},find:function(a){var b,c=this;return b=a?"object"==typeof a?x(a).filter(function(){var a=this;return z.some.call(c,function(b){return x.contains(b,a)})}):1==this.length?x(U.qsa(this[0],a)):this.map(function(){return U.qsa(this,a)}):x()},closest:function(a,b){var c=this[0],e=!1;for("object"==typeof a&&(e=x(a));c&&!(e?e.indexOf(c)>=0:U.matches(c,a));)c=c!==b&&!d(c)&&c.parentNode;return x(c)},parents:function(a){for(var b=[],c=this;c.length>0;)c=x.map(c,function(a){if((a=a.parentNode)&&!d(a)&&b.indexOf(a)<0)return b.push(a),a});return p(b,a)},parent:function(a){return p(W(this.pluck("parentNode")),a)},children:function(a){return p(this.map(function(){return n(this)}),a)},contents:function(){return this.map(function(){return A.call(this.childNodes)})},siblings:function(a){return p(this.map(function(a,b){return B.call(n(b.parentNode),function(a){return a!==b})}),a)},empty:function(){return this.each(function(){this.innerHTML=""})},pluck:function(a){return x.map(this,function(b){return b[a]})},show:function(){return this.each(function(){"none"==this.style.display&&(this.style.display=""),"none"==getComputedStyle(this,"").getPropertyValue("display")&&(this.style.display=m(this.nodeName))})},replaceWith:function(a){return this.before(a).remove()},wrap:function(a){var c,d,e=b(a);return this[0]&&!e&&(c=x(a).get(0),d=c.parentNode||this.length>1),this.each(function(b){x(this).wrapAll(e?a.call(this,b):d?c.cloneNode(!0):c)})},wrapAll:function(a){if(this[0]){x(this[0]).before(a=x(a));for(var b;(b=a.children()).length;)a=b.first();x(a).append(this)}return this},wrapInner:function(a){var c=b(a);return this.each(function(b){var d=x(this),e=d.contents(),f=c?a.call(this,b):a;e.length?e.wrapAll(f):d.append(f)})},unwrap:function(){return this.parent().each(function(){x(this).replaceWith(x(this).children())}),this},clone:function(){return this.map(function(){return this.cloneNode(!0)})},hide:function(){return this.css("display","none")},toggle:function(a){return this.each(function(){var b=x(this);(a===v?"none"==b.css("display"):a)?b.show():b.hide()})},prev:function(a){return x(this.pluck("previousElementSibling")).filter(a||"*")},next:function(a){return x(this.pluck("nextElementSibling")).filter(a||"*")},html:function(a){return 0 in arguments?this.each(function(b){var c=this.innerHTML;x(this).empty().append(q(this,a,b,c))}):0 in this?this[0].innerHTML:null},text:function(a){return 0 in arguments?this.each(function(b){var c=q(this,a,b,this.textContent);this.textContent=null==c?"":""+c}):0 in this?this[0].textContent:null},attr:function(a,b){var c;return"string"!=typeof a||1 in arguments?this.each(function(c){if(1===this.nodeType)if(e(a))for(w in a)r(this,w,a[w]);else r(this,a,q(this,b,c,this.getAttribute(a)))}):this.length&&1===this[0].nodeType?!(c=this[0].getAttribute(a))&&a in this[0]?this[0][a]:c:v},removeAttr:function(a){return this.each(function(){1===this.nodeType&&a.split(" ").forEach(function(a){r(this,a)},this)})},prop:function(a,b){return a=Y[a]||a,1 in arguments?this.each(function(c){this[a]=q(this,b,c,this[a])}):this[0]&&this[0][a]},data:function(a,b){var c="data-"+a.replace(K,"-$1").toLowerCase(),d=1 in arguments?this.attr(c,b):this.attr(c);return null!==d?t(d):v},val:function(a){return 0 in arguments?this.each(function(b){this.value=q(this,a,b,this.value)}):this[0]&&(this[0].multiple?x(this[0]).find("option").filter(function(){return this.selected}).pluck("value"):this[0].value)},offset:function(a){if(a)return this.each(function(b){var c=x(this),d=q(this,a,b,c.offset()),e=c.offsetParent().offset(),f={top:d.top-e.top,left:d.left-e.left};"static"==c.css("position")&&(f.position="relative"),c.css(f)});if(!this.length)return null;var b=this[0].getBoundingClientRect();return{left:b.left+window.pageXOffset,top:b.top+window.pageYOffset,width:Math.round(b.width),height:Math.round(b.height)}},css:function(b,c){var d,e,f,g;if(arguments.length<2){if(e=this[0],!e)return;if(d=getComputedStyle(e,""),"string"==typeof b)return e.style[V(b)]||d.getPropertyValue(b);if(Z(b))return f={},x.each(b,function(a,b){f[b]=e.style[V(b)]||d.getPropertyValue(b)}),f}if(g="","string"==a(b))c||0===c?g=j(b)+":"+l(b,c):this.each(function(){this.style.removeProperty(j(b))});else for(w in b)b[w]||0===b[w]?g+=j(w)+":"+l(w,b[w])+";":this.each(function(){this.style.removeProperty(j(w))});return this.each(function(){this.style.cssText+=";"+g})},index:function(a){return a?this.indexOf(x(a)[0]):this.parent().children().indexOf(this[0])},hasClass:function(a){return!!a&&z.some.call(this,function(a){return this.test(s(a))},k(a))},addClass:function(a){return a?this.each(function(b){if("className"in this){y=[];var c=s(this),d=q(this,a,b,c);d.split(/\s+/g).forEach(function(a){x(this).hasClass(a)||y.push(a)},this),y.length&&s(this,c+(c?" ":"")+y.join(" "))}}):this},removeClass:function(a){return this.each(function(b){if("className"in this){if(a===v)return s(this,"");y=s(this),q(this,a,b,y).split(/\s+/g).forEach(function(a){y=y.replace(k(a)," ")}),s(this,y.trim())}})},toggleClass:function(a,b){return a?this.each(function(c){var d=x(this),e=q(this,a,c,s(this));e.split(/\s+/g).forEach(function(a){(b===v?!d.hasClass(a):b)?d.addClass(a):d.removeClass(a)})}):this},scrollTop:function(a){if(this.length){var b="scrollTop"in this[0];return a===v?b?this[0].scrollTop:this[0].pageYOffset:this.each(b?function(){this.scrollTop=a}:function(){this.scrollTo(this.scrollX,a)})}},scrollLeft:function(a){if(this.length){var b="scrollLeft"in this[0];return a===v?b?this[0].scrollLeft:this[0].pageXOffset:this.each(b?function(){this.scrollLeft=a}:function(){this.scrollTo(a,this.scrollY)})}},position:function(){if(this.length){var a=this[0],b=this.offsetParent(),c=this.offset(),d=J.test(b[0].nodeName)?{top:0,left:0}:b.offset();return c.top-=parseFloat(x(a).css("margin-top"))||0,c.left-=parseFloat(x(a).css("margin-left"))||0,d.top+=parseFloat(x(b[0]).css("border-top-width"))||0,d.left+=parseFloat(x(b[0]).css("border-left-width"))||0,{top:c.top-d.top,left:c.left-d.left}}},offsetParent:function(){return this.map(function(){for(var a=this.offsetParent||C.body;a&&!J.test(a.nodeName)&&"static"==x(a).css("position");)a=a.offsetParent;return a})}},x.fn.detach=x.fn.remove,["width","height"].forEach(function(a){var b=a.replace(/./,function(a){return a[0].toUpperCase()});x.fn[a]=function(e){var f,g=this[0];return e===v?c(g)?g["inner"+b]:d(g)?g.documentElement["scroll"+b]:(f=this.offset())&&f[a]:this.each(function(b){g=x(this),g.css(a,q(this,e,b,g[a]()))})}}),M.forEach(function(b,c){var d=c%2;x.fn[b]=function(){var b,e=x.map(arguments,function(c){return b=a(c),"object"==b||"array"==b||null==c?c:U.fragment(c)}),f,g=this.length>1;return e.length<1?this:this.each(function(a,b){f=d?b:b.parentNode,b=0==c?b.nextSibling:1==c?b.firstChild:2==c?b:null;var h=x.contains(C.documentElement,f);e.forEach(function(a){if(g)a=a.cloneNode(!0);else if(!f)return x(a).remove();f.insertBefore(a,b),h&&u(a,function(a){null==a.nodeName||"SCRIPT"!==a.nodeName.toUpperCase()||a.type&&"text/javascript"!==a.type||a.src||window.eval.call(window,a.innerHTML)})})})},x.fn[d?b+"To":"insert"+(c?"Before":"After")]=function(a){return x(a)[b](this),this}}),U.Z.prototype=x.fn,U.uniq=W,U.deserializeValue=t,x.zepto=U,x}();window.Zepto=d,void 0===window.$&&(window.$=d),c.Zepto=window.Zepto,c.$=window.$,function(a){function b(a){return a._zid||(a._zid=q++)}function c(a,c,f,g){if(c=d(c),c.ns)var h=e(c.ns);return(u[b(a)]||[]).filter(function(a){return a&&(!c.e||a.e==c.e)&&(!c.ns||h.test(a.ns))&&(!f||b(a.fn)===b(f))&&(!g||a.sel==g)})}function d(a){var b=(""+a).split(".");return{e:b[0],ns:b.slice(1).sort().join(" ")}}function e(a){return new RegExp("(?:^| )"+a.replace(" "," .* ?")+"(?: |$)")}function f(a,b){return a.del&&!w&&a.e in x||!!b}function g(a){return y[a]||w&&x[a]||a}function h(c,e,h,i,k,m,n){var o=b(c),p=u[o]||(u[o]=[]);e.split(/\s/).forEach(function(b){var e,o;return"ready"==b?a(document).ready(h):(e=d(b),e.fn=h,e.sel=k,e.e in y&&(h=function(b){var c=b.relatedTarget;if(!c||c!==this&&!a.contains(this,c))return e.fn.apply(this,arguments)}),e.del=m,o=m||h,e.proxy=function(a){if(a=j(a),!a.isImmediatePropagationStopped()){a.data=i;var b=o.apply(c,a._args==l?[a]:[a].concat(a._args));return b===!1&&(a.preventDefault(),a.stopPropagation()),b}},e.i=p.length,p.push(e),void("addEventListener"in c&&c.addEventListener(g(e.e),e.proxy,f(e,n))))})}function i(a,d,e,h,i){var j=b(a);(d||"").split(/\s/).forEach(function(b){c(a,b,e,h).forEach(function(b){delete u[j][b.i],"removeEventListener"in a&&a.removeEventListener(g(b.e),b.proxy,f(b,i))})})}function j(b,c){return!c&&b.isDefaultPrevented||(c||(c=b),a.each(p,function(a,d){var e=c[a];b[a]=function(){return this[d]=m,e&&e.apply(c,arguments)},b[d]=n}),(c.defaultPrevented!==l?c.defaultPrevented:"returnValue"in c?c.returnValue===!1:c.getPreventDefault&&c.getPreventDefault())&&(b.isDefaultPrevented=m)),b}function k(a){var b,c={originalEvent:a};for(b in a)o.test(b)||a[b]===l||(c[b]=a[b]);return j(c,a)}var l,m,n,o,p,q=1,r=Array.prototype.slice,s=a.isFunction,t=function(a){return"string"==typeof a},u={},v={},w="onfocusin"in window,x={focus:"focusin",blur:"focusout"},y={mouseenter:"mouseover",mouseleave:"mouseout"};v.click=v.mousedown=v.mouseup=v.mousemove="MouseEvents",a.event={add:h,remove:i},a.proxy=function(c,d){var e,f=2 in arguments&&r.call(arguments,2);if(s(c))return e=function(){return c.apply(d,f?f.concat(r.call(arguments)):arguments)},e._zid=b(c),e;if(t(d))return f?(f.unshift(c[d],c),a.proxy.apply(null,f)):a.proxy(c[d],c);throw new TypeError("expected function")},a.fn.bind=function(a,b,c){return this.on(a,b,c)},a.fn.unbind=function(a,b){return this.off(a,b)},a.fn.one=function(a,b,c,d){return this.on(a,b,c,d,1)},m=function(){return!0},n=function(){return!1},o=/^([A-Z]|returnValue$|layer[XY]$)/,p={preventDefault:"isDefaultPrevented",stopImmediatePropagation:"isImmediatePropagationStopped",stopPropagation:"isPropagationStopped"},a.fn.delegate=function(a,b,c){return this.on(b,a,c)},a.fn.undelegate=function(a,b,c){return this.off(b,a,c)},a.fn.live=function(b,c){return a(document.body).delegate(this.selector,b,c),this},a.fn.die=function(b,c){return a(document.body).undelegate(this.selector,b,c),this},a.fn.on=function(b,c,d,e,f){var g,j,m=this;return b&&!t(b)?(a.each(b,function(a,b){m.on(a,c,d,b,f)}),m):(t(c)||s(e)||e===!1||(e=d,d=c,c=l),(s(d)||d===!1)&&(e=d,d=l),e===!1&&(e=n),m.each(function(l,m){f&&(g=function(a){return i(m,a.type,e),e.apply(this,arguments)}),c&&(j=function(b){var d,f=a(b.target).closest(c,m).get(0);if(f&&f!==m)return d=a.extend(k(b),{currentTarget:f,liveFired:m}),(g||e).apply(f,[d].concat(r.call(arguments,1)))}),h(m,b,e,d,c,j||g)}))},a.fn.off=function(b,c,d){var e=this;return b&&!t(b)?(a.each(b,function(a,b){e.off(a,c,b)}),e):(t(c)||s(d)||d===!1||(d=c,c=l),d===!1&&(d=n),e.each(function(){i(this,b,d,c)}))},a.fn.trigger=function(b,c){return b=t(b)||a.isPlainObject(b)?a.Event(b):j(b),b._args=c,this.each(function(){b.type in x&&"function"==typeof this[b.type]?this[b.type]():"dispatchEvent"in this?this.dispatchEvent(b):a(this).triggerHandler(b,c)})},a.fn.triggerHandler=function(b,d){var e,f;return this.each(function(g,h){e=k(t(b)?a.Event(b):b),e._args=d,e.target=h,a.each(c(h,b.type||b),function(a,b){if(f=b.proxy(e),e.isImmediatePropagationStopped())return!1})}),f},"focusin focusout focus blur load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select keydown keypress keyup error".split(" ").forEach(function(b){a.fn[b]=function(a){return 0 in arguments?this.bind(b,a):this.trigger(b)}}),a.Event=function(a,b){var c,d,e;if(t(a)||(b=a,a=b.type),c=document.createEvent(v[a]||"Events"),d=!0,b)for(e in b)"bubbles"==e?d=!!b[e]:c[e]=b[e];return c.initEvent(a,d,!0),j(c)}}(d),function(a){function b(b,c,d){var e=a.Event(c);return a(b).trigger(e,d),!e.isDefaultPrevented()}function c(a,c,d,e){if(a.global)return b(c||t,d,e)}function d(b){b.global&&0===a.active++&&c(b,null,"ajaxStart")}function e(b){b.global&&!--a.active&&c(b,null,"ajaxStop")}function f(a,b){var d=b.context;return b.beforeSend.call(d,a,b)!==!1&&c(b,d,"ajaxBeforeSend",[a,b])!==!1&&void c(b,d,"ajaxSend",[a,b])}function g(a,b,d,e){var f=d.context,g="success";d.success.call(f,a,g,b),e&&e.resolveWith(f,[a,g,b]),c(d,f,"ajaxSuccess",[b,d,a]),i(g,b,d)}function h(a,b,d,e,f){var g=e.context;e.error.call(g,d,b,a),f&&f.rejectWith(g,[d,b,a]),c(e,g,"ajaxError",[d,e,a||b]),i(b,d,e)}function i(a,b,d){var f=d.context;d.complete.call(f,b,a),c(d,f,"ajaxComplete",[b,d]),e(d)}function j(){}function k(a){return a&&(a=a.split(";",2)[0]),a&&(a==y?"html":a==x?"json":v.test(a)?"script":w.test(a)&&"xml")||"text"}function l(a,b){return""==b?a:(a+"&"+b).replace(/[&?]{1,2}/,"?")}function m(b){b.processData&&b.data&&"string"!=a.type(b.data)&&(b.data=a.param(b.data,b.traditional)),!b.data||b.type&&"GET"!=b.type.toUpperCase()||(b.url=l(b.url,b.data),b.data=void 0)}function n(b,c,d,e){return a.isFunction(c)&&(e=d,d=c,c=void 0),a.isFunction(d)||(e=d,d=void 0),{url:b,data:c,success:d,dataType:e}}function o(b,c,d,e){var f,g=a.isArray(c),h=a.isPlainObject(c);a.each(c,function(c,i){f=a.type(i),e&&(c=d?e:e+"["+(h||"object"==f||"array"==f?c:"")+"]"),!e&&g?b.add(i.name,i.value):"array"==f||!d&&"object"==f?o(b,i,d,c):b.add(c,i)})}var p,q,r,s=0,t=window.document,u=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,v=/^(?:text|application)\/javascript/i,w=/^(?:text|application)\/xml/i,x="application/json",y="text/html",z=/^\s*$/,A=t.createElement("a");A.href=window.location.href,a.active=0,a.ajaxJSONP=function(b,c){if(!("type"in b))return a.ajax(b);var d=b.jsonpCallback,e=(a.isFunction(d)?d():d)||"jsonp"+ ++s,i=t.createElement("script"),j=window[e],k,l=function(b){a(i).triggerHandler("error",b||"abort")},m={abort:l},n;return c&&c.promise(m),a(i).on("load error",function(d,f){clearTimeout(n),a(i).off().remove(),"error"!=d.type&&k?g(k[0],m,b,c):h(null,f||"error",m,b,c),window[e]=j,k&&a.isFunction(j)&&j(k[0]),j=k=void 0}),f(m,b)===!1?(l("abort"),m):(window[e]=function(){k=arguments},i.src=b.url.replace(/\?(.+)=\?/,"?$1="+e),t.head.appendChild(i),b.timeout>0&&(n=setTimeout(function(){l("timeout")},b.timeout)),m)},a.ajaxSettings={type:"GET",beforeSend:j,success:j,error:j,complete:j,context:null,global:!0,xhr:function(){return new window.XMLHttpRequest},accepts:{script:"text/javascript, application/javascript, application/x-javascript",json:x,xml:"application/xml, text/xml",html:y,text:"text/plain"},crossDomain:!1,timeout:0,processData:!0,cache:!0},a.ajax=function(b){var c,e,i,n,o,r,s,u,v,w,x,y=a.extend({},b||{}),B=a.Deferred&&a.Deferred();for(p in a.ajaxSettings)void 0===y[p]&&(y[p]=a.ajaxSettings[p]);if(d(y),y.crossDomain||(c=t.createElement("a"),c.href=y.url,c.href=c.href,y.crossDomain=A.protocol+"//"+A.host!=c.protocol+"//"+c.host),y.url||(y.url=window.location.toString()),m(y),e=y.dataType,i=/\?.+=\?/.test(y.url),i&&(e="jsonp"),y.cache!==!1&&(b&&b.cache===!0||"script"!=e&&"jsonp"!=e)||(y.url=l(y.url,"_="+Date.now())),"jsonp"==e)return i||(y.url=l(y.url,y.jsonp?y.jsonp+"=?":y.jsonp===!1?"":"callback=?")),a.ajaxJSONP(y,B);if(n=y.accepts[e],o={},r=function(a,b){o[a.toLowerCase()]=[a,b]},s=/^([\w-]+:)\/\//.test(y.url)?RegExp.$1:window.location.protocol,u=y.xhr(),v=u.setRequestHeader,B&&B.promise(u),y.crossDomain||r("X-Requested-With","XMLHttpRequest"),r("Accept",n||"*/*"),(n=y.mimeType||n)&&(n.indexOf(",")>-1&&(n=n.split(",",2)[0]),u.overrideMimeType&&u.overrideMimeType(n)),(y.contentType||y.contentType!==!1&&y.data&&"GET"!=y.type.toUpperCase())&&r("Content-Type",y.contentType||"application/x-www-form-urlencoded"),y.headers)for(q in y.headers)r(q,y.headers[q]);if(u.setRequestHeader=r,u.onreadystatechange=function(){if(4==u.readyState){u.onreadystatechange=j,clearTimeout(w);var b,c=!1;if(u.status>=200&&u.status<300||304==u.status||0==u.status&&"file:"==s){e=e||k(y.mimeType||u.getResponseHeader("content-type")),b=u.responseText;try{"script"==e?(0,eval)(b):"xml"==e?b=u.responseXML:"json"==e&&(b=z.test(b)?null:a.parseJSON(b))}catch(d){c=d}c?h(c,"parsererror",u,y,B):g(b,u,y,B)}else h(u.statusText||null,u.status?"error":"abort",u,y,B)}},f(u,y)===!1)return u.abort(),h(null,"abort",u,y,B),u;if(y.xhrFields)for(q in y.xhrFields)u[q]=y.xhrFields[q];x=!("async"in y)||y.async,u.open(y.type,y.url,x,y.username,y.password);for(q in o)v.apply(u,o[q]);return y.timeout>0&&(w=setTimeout(function(){u.onreadystatechange=j,u.abort(),h(null,"timeout",u,y,B)},y.timeout)),u.send(y.data?y.data:null),u},a.get=function(){return a.ajax(n.apply(null,arguments))},a.post=function(){var b=n.apply(null,arguments);return b.type="POST",a.ajax(b)},a.getJSON=function(){var b=n.apply(null,arguments);return b.dataType="json",a.ajax(b)},a.fn.load=function(b,c,d){if(!this.length)return this;var e=this,f=b.split(/\s/),g,h=n(b,c,d),i=h.success;return f.length>1&&(h.url=f[0],g=f[1]),h.success=function(b){e.html(g?a("<div>").html(b.replace(u,"")).find(g):b),i&&i.apply(e,arguments)},a.ajax(h),this},r=encodeURIComponent,a.param=function(b,c){var d=[];return d.add=function(b,c){a.isFunction(c)&&(c=c()),null==c&&(c=""),this.push(r(b)+"="+r(c))},o(d,b,c),d.join("&").replace(/%20/g,"+")}}(d),function(a){a.fn.serializeArray=function(){var b,c,d=[],e=function(a){return a.forEach?a.forEach(e):void d.push({name:b,value:a})};return this[0]&&a.each(this[0].elements,function(d,f){c=f.type,b=f.name,b&&"fieldset"!=f.nodeName.toLowerCase()&&!f.disabled&&"submit"!=c&&"reset"!=c&&"button"!=c&&"file"!=c&&("radio"!=c&&"checkbox"!=c||f.checked)&&e(a(f).val())}),d},a.fn.serialize=function(){var a=[];return this.serializeArray().forEach(function(b){a.push(encodeURIComponent(b.name)+"="+encodeURIComponent(b.value))}),a.join("&")},a.fn.submit=function(b){if(0 in arguments)this.bind("submit",b);else if(this.length){var c=a.Event("submit");this.eq(0).trigger(c),c.isDefaultPrevented()||this.get(0).submit()}return this}}(d),function(a){"__proto__"in{}||a.extend(a.zepto,{Z:function(b,c){return b=b||[],a.extend(b,a.fn),b.selector=c||"",b.__Z=!0,b},isZ:function(b){return"array"===a.type(b)&&"__Z"in b}});try{getComputedStyle(void 0)}catch(b){var c=getComputedStyle;window.getComputedStyle=function(a){try{return c(a)}catch(b){return null}}}}(d)},{}],6:[function(a,b,c){"use strict";function d(a,b,c){}function e(a,b,c){Object.defineProperty(a,b,{writable:!1,configurable:!1,value:c})}var f,g=["handshakeVersion","initAd","startAd","stopAd","skipAd","resizeAd","pauseAd","resumeAd","expandAd","collapseAd","subscribe","unsubscribe"],h=["AdLoaded","AdStarted","AdStopped","AdSkipped","AdSkippableStateChange","AdSizeChange","AdLinearChange","AdDurationChange","AdExpandedChange","AdRemainingTimeChange","AdVolumeChange","AdImpression","AdVideoStart","AdVideoFirstQuartile","AdVideoMidpoint","AdVideoThirdQuartile","AdVideoComplete","AdClickThru","AdInteraction","AdUserAcceptInvitation","AdUserMinimize","AdUserClose","AdPaused","AdPlaying","AdLog","AdError"],i=["getAdLinear","getAdWidth","getAdHeight","getAdExpanded","getAdSkippableState","getAdRemainingTime","getAdDuration","getAdVolume","getAdCompanions","getAdIcons"],j=["setAdVolume"];d.prototype.handshakeVersion=function(a,b){},d.prototype.initAd=function(a,b,c,d,e,f,g){},d.prototype.startAd=function(a){},d.prototype.stopAd=function(a){},d.prototype.skipAd=function(a){},d.prototype.resizeAd=function(a,b,c,d){},d.prototype.pauseAd=function(a){},d.prototype.resumeAd=function(a){},d.prototype.expandAd=function(a){},d.prototype.collapseAd=function(a){},d.prototype.subscribe=function(a,b,c){},d.prototype.unsubscribe=function(a,b){},d.prototype.getAdLinear=function(a){},d.prototype.getAdWidth=function(a){},d.prototype.getAdHeight=function(a){},d.prototype.getAdExpanded=function(a){},d.prototype.getAdSkippableState=function(a){},d.prototype.getAdRemainingTime=function(a){},d.prototype.getAdDuration=function(a){},d.prototype.getAdVolume=function(a){},d.prototype.getAdCompanions=function(a){},d.prototype.getAdIcons=function(a){},d.prototype.setAdVolume=function(a,b){},e(d,"METHODS",g),e(d,"GETTERS",i),e(d,"SETTERS",j),e(d,"EVENTS",h),f=g.filter(function(a){return["skipAd"].indexOf(a)===-1}),e(d,"checkVPAIDInterface",function k(a){var b=f.every(function(b){return"function"==typeof a[b]});return b}),b.exports=d},{}],7:[function(a,b,c){"use strict";function d(a,b,c,d){this._isValid=k(a),this._isValid&&(this._creative=a,this._el=b,this._videoEl=c,this._iframe=d,this._subscribers=new j,l.setFullSizeStyle(b),e.call(this))}function e(){var a,b;p.forEach(function(a){this._creative.subscribe(g.bind(this,a),a)}.bind(this)),this._creative.subscribe(f.bind(this),o),this._videoEl&&(a=this._iframe.contentDocument.documentElement,b=this._videoEl,a.addEventListener("click",function(c){c.target===a&&b.click()}))}function f(a,b,c){this._subscribers.triggerSync(o,{url:a,id:b,playerHandles:c})}function g(a){this._subscribers.trigger(a,Array.prototype.slice(arguments,1))}function h(a,b,c,d){a?a(c,d):c&&b.trigger(n,c)}var i=a("./IVPAIDAdUnit"),j=a("./subscriber"),k=i.checkVPAIDInterface,l=a("./utils"),m=i.METHODS,n="AdError",o="AdClickThru",p=i.EVENTS.filter(function(a){return a!=o});d.prototype=Object.create(i.prototype),d.prototype.isValidVPAIDAd=function q(){return this._isValid},i.METHODS.forEach(function(a){var b=["subscribe","unsubscribe","initAd"];b.indexOf(a)===-1&&(d.prototype[a]=function(){var b=i.prototype[a].length,c=Array.prototype.slice.call(arguments),d=b===c.length?c.pop():void 0;setTimeout(function(){var b,e=null;try{b=this._creative[a].apply(this._creative,c)}catch(f){e=f}h(d,this._subscribers,e,b)}.bind(this),0)})}),d.prototype.initAd=function r(a,b,c,d,e,f,g){e=e||{},f=l.extend({slot:this._el,videoSlot:this._videoEl},f||{}),setTimeout(function(){var i;try{this._creative.initAd(a,b,c,d,e,f)}catch(j){i=j}h(g,this._subscribers,i)}.bind(this),0)},d.prototype.subscribe=function s(a,b,c){this._subscribers.subscribe(b,a,c)},d.prototype.unsubscribe=function t(a,b){this._subscribers.unsubscribe(b,a)},d.prototype.on=d.prototype.subscribe,d.prototype.off=d.prototype.unsubscribe,i.GETTERS.forEach(function(a){
d.prototype[a]=function(b){setTimeout(function(){var c,d=null;try{c=this._creative[a]()}catch(e){d=e}h(b,this._subscribers,d,c)}.bind(this),0)}}),d.prototype.setAdVolume=function u(a,b){setTimeout(function(){var c,d=null;try{this._creative.setAdVolume(a),c=this._creative.getAdVolume()}catch(e){}h(b,this._subscribers,d,c)}.bind(this),0)},d.prototype._destroy=function v(){this.stopAd(),this._subscribers.unsubscribeAll()},b.exports=d},{"./IVPAIDAdUnit":6,"./subscriber":9,"./utils":10}],8:[function(a,b,c){"use strict";function d(a,b,c,d){c=c||{},this._id=n(),this._destroyed=!1,this._frameContainer=m.createElementInEl(a,"div"),this._videoEl=b,this._vpaidOptions=d||{timeout:1e4},this._templateConfig={template:c.template||p,extraOptions:c.extraOptions||{}}}function e(a){var b=this[a];b&&(b.remove(),delete this[a])}function f(){h.call(this),delete this._adUnit}function g(){h.call(this),j.call(this)}function h(){e.call(this,"_frame"),i.call(this)}function i(){this._onLoad&&(window.removeEventListener("message",this._onLoad),m.clearCallbackTimeout(this._onLoad),delete this._onLoad)}function j(){this._adUnit&&(this._adUnit.stopAd(),delete this._adUnit)}function k(){if(this._destroyed)throw new Error("VPAIDHTML5Client already destroyed!")}function l(){return window.location.origin?window.location.origin:window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"")}var m=a("./utils"),n=m.unique("vpaidIframe"),o=a("./VPAIDAdUnit"),p='<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"></head><body style="margin:0;padding:0"><div class="ad-element"></div><script type="text/javascript" src="{{iframeURL_JS}}"></script><script type="text/javascript">window.parent.postMessage(\'{"event": "ready", "id": "{{iframeID}}"}\', \'{{origin}}\');</script></body></html>',q="AdStopped";d.prototype.destroy=function r(){this._destroyed||(this._destroyed=!0,g.call(this))},d.prototype.isDestroyed=function s(){return this._destroyed},d.prototype.loadAdUnit=function t(a,b){function c(a){var c,d,g,h,j;if(a.origin===l()){try{c=JSON.parse(a.data)}catch(a){c={}}if(c.id===e.getID())return e._frame.contentWindow?(h=e._frame.contentWindow.getVPAIDAd,g=m.validate("function"==typeof h,"the ad didn't return a function to create an ad")):g="the iframe is not anymore in the DOM tree",g||(j=e._frame.contentWindow.document.querySelector(".ad-element"),d=new o(h(),j,e._videoEl,e._frame),d.subscribe(q,f.bind(e)),g=m.validate(d.isValidVPAIDAd(),"the add is not fully complaint with VPAID specification")),e._adUnit=d,i.call(e),b(g,g?null:d),!0}}function d(){b("timeout",null)}var e,h;k.call(this),g.call(this),e=this,h=m.createIframeWithContent(this._frameContainer,this._templateConfig.template,m.extend({iframeURL_JS:a,iframeID:this.getID(),origin:l()},this._templateConfig.extraOptions)),this._frame=h,this._onLoad=m.callbackTimeout(this._vpaidOptions.timeout,c.bind(this),d.bind(this)),window.addEventListener("message",this._onLoad)},d.prototype.unloadAdUnit=function u(){g.call(this)},d.prototype.getID=function(){return this._id},b.exports=d},{"./VPAIDAdUnit":7,"./utils":10}],9:[function(a,b,c){"use strict";function d(){this._subscribers={}}function e(a,b){setTimeout(function(){a.handler.call(a.context,b)},0)}d.prototype.subscribe=function f(a,b,c){this.isHandlerAttached(a,b)||this.get(b).push({handler:a,context:c,eventName:b})},d.prototype.unsubscribe=function g(a,b){this._subscribers[b]=this.get(b).filter(function(b){return a!==b.handler})},d.prototype.unsubscribeAll=function h(){this._subscribers={}},d.prototype.trigger=function(a,b){var c,d=this,f=this.get(a);for(c=0;c<f.length;c++)e(f[c],b)},d.prototype.triggerSync=function(a,b){var c=this.get(a);c.forEach(function(a){a.handler.call(a.context,b)})},d.prototype.get=function i(a){return this._subscribers[a]||(this._subscribers[a]=[]),this._subscribers[a]||[]},d.prototype.isHandlerAttached=function j(a,b){return this.get(b).some(function(b){return a===b.handler})},b.exports=d},{}],10:[function(a,b,c){"use strict";function d(){}function e(a,b){return a?null:new Error(b)}function f(a){var b=q[a];b&&(clearTimeout(b),delete q[a])}function g(a,b,c){var e,g;return g=setTimeout(function(){b=d,delete g[e],c()},a),e=function h(){b.apply(this,arguments)&&f(e)},q[e]=g,e}function h(a,b,c){var d=document.createElement(b);return c&&(d.id=c),a.appendChild(d),d}function i(a,b,c){var d=j(a,null,c.zIndex);if(m(d,l(b,c)))return d}function j(a,b,c){var d=document.createElement("iframe");return d.src=b||"about:blank",d.marginWidth="0",d.marginHeight="0",d.frameBorder="0",d.width="100%",d.height="100%",k(d),c&&(d.style.zIndex=c),d.setAttribute("SCROLLING","NO"),a.innerHTML="",a.appendChild(d),d}function k(a){a.style.position="absolute",a.style.left="0",a.style.top="0",a.style.margin="0px",a.style.padding="0px",a.style.border="none",a.style.width="100%",a.style.height="100%"}function l(a,b){return Object.keys(b).forEach(function(c){var d="object"===("undefined"==typeof d?"undefined":p(d))?JSON.stringify(b[c]):b[c];a=a.replace(new RegExp("{{"+c+"}}","g"),d)}),a}function m(a,b){var c=a.contentWindow&&a.contentWindow.document;return!!c&&(c.write(b),!0)}function n(a,b){return Object.keys(b).forEach(function(c){a[c]=b[c]}),a}function o(a){var b=-1;return function(){return a+"_"+ ++b}}var p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},q={};b.exports={noop:d,validate:e,clearCallbackTimeout:f,callbackTimeout:g,createElementInEl:h,createIframeWithContent:i,createIframe:j,setFullSizeStyle:k,simpleTemplate:l,setIframeContent:m,extend:n,unique:o}},{}],11:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var e,f;Object.defineProperty(c,"__esModule",{value:!0}),e=function(){function a(a,b){var c,d;for(c=0;c<b.length;c++)d=b[c],d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=function(){function a(b){d(this,a),this.os=b.os.name,this.osVersion=parseInt(b.os.version),this.browserName=b.browser.name,this.browserMajorVersion=parseInt(b.browser.major)}return e(a,[{key:"isAutoplaySupported",value:function b(){switch(this.os){case"Android":return this.isAutoplaySupportedAndroid();case"iOS":return this.isAutoplaySupportedIOS();default:return!1}}},{key:"isAutoplaySupportedIOS",value:function c(){if(this.osVersion<10)return!1;switch(this.browserName){case"Firefox":return this.browserMajorVersion>=7;default:return!0}}},{key:"isAutoplaySupportedAndroid",value:function f(){switch(this.browserName){case"Chrome":case"Chrome WebView":return parseInt(this.browserMajorVersion)>=53;case"Firefox":return parseInt(this.browserMajorVersion)>=49;default:return!1}}}]),a}(),c["default"]=f,b.exports=c["default"]},{}],12:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var f,g,h,i,j,k,l,m;Object.defineProperty(c,"__esModule",{value:!0}),f=function(){function a(a,b){var c,d;for(c=0;c<b.length;c++)d=b[c],d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g=a("./PerformanceSampler"),h=d(g),i=a("../vpaidjs/OpportunityManager"),j=d(i),k=a("../vpaidjs/OpportunityType"),l=d(k),m=function(){function a(b){e(this,a),this._store=b,this._intervalDuration=this._store.get("kpitrvldrt"),this._numOfSamplesPerMeasurment=this._store.get("prfsmpmsnt"),this._durationOfSamplePerMeasurment=this._store.get("prfsmitrvpmsnt"),this._opportunityManager=void 0,this._fixedItem=void 0,this._mainVpaidConfig=void 0,this._addListeners(),this._measure()}return f(a,[{key:"_addListeners",value:function b(){this._store.once("stop",this._onStop.bind(this)),this._store.once("beforeunload",this._onBeforeunload.bind(this)),this._store.once("waterfallData",this._onWaterfallData.bind(this)),this._store.once("mainVpaidCreated",this._onMainVpaidCreated.bind(this))}},{key:"_measure",value:function c(){var a=this;this._running=!0,this._runSampling("first_kpi"),this.intervalMeasureId=setInterval(function(){a._runSampling("last_kpi")},this._intervalDuration)}},{key:"_runSampling",value:function d(a){var b=this,c=new h["default"];c.runEventLoopSampling(this._numOfSamplesPerMeasurment,this._durationOfSamplePerMeasurment).then(function(d){b._store.set(a,d),b._saveData(d),c.cleanResources()})}},{key:"_sendOpp",value:function g(a){this._opportunityManager.send(this._fixedItem,a)}},{key:"_onWaterfallData",value:function i(a){this._fixedItem||(this._fixedItem=a.tags[0],this._createOpportunityManager())}},{key:"_onMainVpaidCreated",value:function k(a){this._mainVpaidConfig=a,this._createOpportunityManager()}},{key:"_createOpportunityManager",value:function m(){this._mainVpaidConfig&&this._fixedItem&&!this._opportunityManager&&(this._opportunityManager=new j["default"]({CM_DOMAIN:this._mainVpaidConfig.creatives.CM_DOMAIN,AUC_DAST:this._mainVpaidConfig.creatives.AUC_DAST,sequenceId:this._fixedItem.sequenceId,ST:this._mainVpaidConfig.creatives.ST,STS:this._mainVpaidConfig.creatives.STS,SDID:this._mainVpaidConfig.creatives.SDID,PT:this._mainVpaidConfig.creatives.PT,PV:this._mainVpaidConfig.creatives.PV,WP:this._mainVpaidConfig.creatives.WP,VPD:this._mainVpaidConfig.creatives.PUBID,VPTD:this._mainVpaidConfig.creatives.TAGID,VMT:this._mainVpaidConfig.creatives.VMT},this._store),this._runFirstMeasurmentCycle())}},{key:"_runFirstMeasurmentCycle",value:function n(){var a=this,b=new h["default"];b.runOneEventLoopSampling().then(function(b){a._saveData(b),a._sendOpp(l["default"].firstWfMeasurment)})}},{key:"_saveData",value:function o(a){this._store.set("performance.wfRoundTripAverageDuration",this._store.get("waterfall_data.average_duration")),this._store.set("performance.performanceMeasurment",Math.round(a))}},{key:"_onBeforeunload",value:function p(){this._destroy()}},{key:"_onStop",value:function q(){this._destroy()}},{key:"_destroy",value:function r(){this._running&&(clearInterval(this.intervalMeasureId),this._running=!1,this._saveData(this._store.get("last_kpi")),this._sendOpp(l["default"].playerClosedMeasurment))}}]),a}(),c["default"]=m,b.exports=c["default"]},{"../vpaidjs/OpportunityManager":41,"../vpaidjs/OpportunityType":42,"./PerformanceSampler":15}],13:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var e,f;Object.defineProperty(c,"__esModule",{value:!0}),e=function(){function a(a,b){var c,d;for(c=0;c<b.length;c++)d=b[c],d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=function(){function a(b,c){d(this,a),this.parent=b,this.getAdSkippableRemainingTime=this.build_vpaid_get_controller(b,"getAdSkippableRemainingTime",-1),this.getAdLinear=this.build_vpaid_get_controller(b,"getAdLinear",!0),this.getAdWidth=this.build_vpaid_get_controller(b,"getAdWidth",0,"width"),this.getAdHeight=this.build_vpaid_get_controller(b,"getAdHeight",0,"height"),this.getAdExpanded=this.build_vpaid_get_controller(b,"getAdExpanded",!0),this.getAdSkippableState=this.build_vpaid_get_controller(b,"getAdSkippableState",!0),this.getAdRemainingTime=this.build_vpaid_get_controller(b,"getAdRemainingTime",-1),this.getAdDuration=this.build_vpaid_get_controller(b,"getAdDuration",-1),this.getAdCompanions=this.build_vpaid_get_controller(b,"getAdCompanions",[]),this.getAdIcons=this.build_vpaid_get_controller(b,"getAdIcons",[]),this.pauseAd=this.build_vpaid_set_controller(b,"pauseAd"),this.resumeAd=this.build_vpaid_set_controller(b,"resumeAd"),this.expandAd=this.build_vpaid_set_controller(b,"expandAd"),this.collapseAd=this.build_vpaid_set_controller(b,"collapseAd"),this.skipAd=this.build_vpaid_set_controller(b,"skipAd"),this.stopAd=this.build_vpaid_set_controller(b,"stopAd"),this.store=c}return e(a,[{key:"startAd",value:function b(){this.parent.vpaidHandler.startAd()}},{key:"getAdVolume",value:function c(){var a=this.parent.volume();return a}},{key:"setAdVolume",value:function f(a,b){this.parent.volume(a),this.parent.runningVpaid&&this.parent.runningVpaid.vpaid&&this.parent.runningVpaid.vpaid.setAdVolume(a)}},{key:"resizeAd",value:function g(a,b,c){return this.parent.runningVpaid?this.parent.runningVpaid.resize(a,b,c):(this.parent.debugTracker.warn("OVA","[resizeAd] No vpaid object."),!1)}},{key:"muteAd",value:function h(){}},{key:"unmuteAd",value:function i(){}},{key:"setParam",value:function j(a,b){return this.parent.debugTracker.warn("OVA","[setParam] "+a+" : "+b),this.store(a,b)}},{key:"getParam",value:function k(a){return this.parent.debugTracker.warn("OVA","[getParam] "+a),this.store(a)}},{key:"build_vpaid_set_controller",value:function l(a,b){var c=function d(){return a.scheduleMaster.gotVpaid?a.scheduleMaster.runningVpaid.vpaid[d.type]?a.scheduleMaster.vpaid[d.type]():(a.debugTracker.warn("OVA","["+d.type+"] VPAID does not support this action!"),!1):(a.debugTracker.warn("OVA","["+d.type+"] No vpaid object."),!1)};return c.proxy=a,c.type=b,c}},{key:"build_vpaid_get_controller",value:function m(a,b,c,d){var e=function f(){return a.scheduleMaster.gotVpaid?a.scheduleMaster.vpaid[f.type]():(a.debugTracker.warn("OVA","["+f.type+"] No vpaid object."),f.default_value_key&&void 0!=a.options[f.default_value_key]?a.options[f.default_value_key]:f.default_value)};return e.proxy=a,e.default_value=c,d?e.default_value_key=d:e.default_value_key=void 0,e.type=b,e}},{key:"gotVpaid",get:function n(){return!!(this.parent&&this.parent.scheduleMaster&&this.parent.scheduleMaster.gotVpaid)}},{key:"gotAd",get:function o(){return!(!this.gotVpaid||!this.parent.scheduleMaster.runningVpaid.adPlaying)}}]),a}(),c["default"]=f,f.prototype.getAdSkippableRemainingTime=f.prototype.build_vpaid_get_controller(parent,"getAdSkippableRemainingTime",-1),b.exports=c["default"]},{}],14:[function(a,b,c){"use strict";function d(a){var b,c;if(a&&a.__esModule)return a;if(b={},null!=a)for(c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b["default"]=a,b}function e(a){return a&&a.__esModule?a:{"default":a}}function f(a){function b(){var a,b,c,d;if(this.isMobile){if(a=this.store.get("forcecnvsmpg"),b=this.store.get("useapforcntnt"),a&&!b)return this.store.set("hasAutoPlay",!1),void(this.hasAutoPlay=!1);c=this.store.get("ua"),d=new H["default"](c),d.isAutoplaySupported()?(this.store.set("hasAutoPlay",!0),this.hasAutoPlay=!0):(this.store.set("hasAutoPlay",!1),this.hasAutoPlay=!1)}}var c,d,e,f,h,j,l,o,q,s=this;for(this.status="loading",this.videoLength=0,this.ga_set=!1,this.video=void 0,this.repeatCount=0,this.schedule={},this.playerIsClosed=!1,this.forceMute=!1,this.options=(0,n.getDefaults)(a),c=g((0,n.getUnitParams)(),a.dplayerSettings),this.options=g({},this.options,c),d=new p["default"](this.options),this.store=d,this.store.set("fullPageUrl",window.location.href),this.store.set("forcePause",!1),this.store.set("dataSaverDetected",!1),this.store.set("conversionsCount",0),this.store.set("getAdData.count",0),this.store.get("base_url")&&0!==this.store.get("base_url").length||(this.store.set("original_base_url","empty"),this.store.set("href",window.location.href),this.store.set("base_url","//www.cmbestsrv.com")),this.store.set("queueLength",0),this.store.set("vpaidReadyCount",0),this.store.set("document.visible",!document.hidden),D.reportDebug("player_waterfall","ctor1",{type:"debug",message:"ctor1",options:this.store.data},this.store),d.set("ads_playing",0),d.set("ads_started",0),d.set("total_impressions",0),r.init(this.store),this.store.get("measureKPI")&&(this.KPIsRecorder=new F["default"](this.store)),this.options.schedule&&this.options.schedule.length&&this.options.schedule[0].ad_parameters&&this.options.schedule[0].ad_parameters.length>2&&d.set("static_schedule",this.options.schedule),this.isMobile=this.store.get("isMobile"),b.call(this),e=this,f=36e5*(this.store.get("kill_after_hour")||0),f&&setTimeout(function(){e.closeCleanPlayer("kill_after_hour")},f),window.addEventListener("beforeunload",function(a){s.store.emit("beforeunload")}),this.store.on("AdImpression",function(){e.killAfterXWithNoConversion()}),this.playerStatus="content",this.store.on("AdPlayerVisible",function(){this.playerIsClosed||(this.playerStatus="ad",this.VideoDesktopControls&&(this.wasContentPausedBeforeAd=this.VideoDesktopControls.getPaused(),this.VideoDesktopControls.setState(this.playerStatus),this.VideoDesktopControls.onAdPlayerStateChanged(!1),this.runningVpaid&&(this.runningVpaid.vpaid.vpaidHandler.setPaused(!1),this.runningVpaid.vpaid.vpaidHandler.volume(this.VideoDesktopControls.getVolume()))),this.VideoMobileControls&&this.VideoMobileControls.setState(this.playerStatus))}.bind(this)),this.store.on("AdPlayerHidden",function(){this.playerIsClosed||(this.playerStatus="content",this.VideoDesktopControls&&(this.VideoDesktopControls.setState(this.playerStatus),this.volume(this.VideoDesktopControls.getVolume()),this.VideoDesktopControls.onAdPlayerStateChanged(this.wasContentPausedBeforeAd)),this.VideoMobileControls&&this.VideoMobileControls.setState(this.playerStatus))}.bind(this)),m["default"].prototype.debugLevels={},h=["error","warn","info","log","debug","event"],j=0;j<h.length;j++)l=h[j],(this.options.debug.indexOf(l)>-1||this.options.debug.indexOf("*")>-1)&&this.options.debug.indexOf("!"+l)==-1&&(m["default"].prototype.debugLevels[l]=!0);return this.debugTracker=new m["default"]("OvaMediaPlayer"),this.debugTracker.info("OvaMediaPlayer Settings",a),this.seek=function(a){if(!this._isAdState())try{if(void 0==a)return this.video.currentTime;if(isNaN(parseFloat(a)))return;this.video.currentTime=parseFloat(a)}catch(b){return 0}},this.killAfterXWithNoConversion=function(){var a=this.store.get("kaxwnc");a&&(this.kaxwnc&&clearTimeout(this.kaxwnc),this.kaxwnc=setTimeout(function(){e.closeCleanPlayer("killAfterXWithNoConversion")},a))},this.killAfterXWithNoConversion(),this.play=function(){this.store.get("forcePause")||(this.vpaidManager&&this.vpaidManager.resume(),this._isAdState()||this.video.play())},this.pause=function(){this.vpaidManager&&(this.vpaidManager.pause(),this.VideoDesktopControls&&this.VideoDesktopControls.setPaused(!0)),this._isAdState()||(this.store.emit("contentPaused"),this.video.pause())},this.resume=function(){this._isAdState()||(this.store.emit("contentResumed"),"paused"==this.status&&this.video.play())},this.stop=function(){try{if("stopped"==this.status||this._isAdState())return;this.status="stopping",this.video.pause(),this.seek(0),this.status="stopped",this.options.onPlayerStop(this)}catch(a){}},this.resize=function(a,b,c){this.vpaidManager&&this.vpaidManager.resize(a,b);var d=0,e=0,f=0;try{(void 0==a||isNaN(parseInt(a)))&&(a=!1),(void 0==b||isNaN(parseInt(b)))&&(b=!1),a||b?b&&a?(this.options.height=b+"",this.options.width=a+"",this.setVideoSize(this.options.width.search(/px$/g)>-1?this.options.width:this.options.width+"px",this.options.height.search(/px$/g)>-1?this.options.height:this.options.height+"px")):(c&&c.split(":").length>1&&(this.options.aspect_ratio=c),a?(this.options.height=!1,this.options.width=a+"",f=this.options.aspect_ratio.split(":")[1]/this.options.aspect_ratio.split(":")[0],d=this.options.width.search(/px$/g)>-1?this.options.width:parseFloat(this.options.width)+"px",e=Math.floor(parseFloat(d)*f)+"px",this.setVideoSize(d,e)):(this.options.width=!1,this.options.height=b+"",f=this.options.aspect_ratio.split(":")[0]/this.options.aspect_ratio.split(":")[1],e=this.options.height.search(/px$/g)>-1?this.options.height:parseFloat(this.options.height)+"px",d=Math.floor(parseFloat(e)*f)+"px",this.setVideoSize(d,e))):this.debugTracker.error("resize","No `height` or `width` specified!")}catch(g){this.debugTracker.error("resize","Resizing component failed!")}},this.setVideoSize=function(a,b){this.target.style.width=a,this.target.style.height=b,this.target.setAttribute("width",parseInt(a)),this.target.setAttribute("height",parseInt(b)),this.video.style.width=a,this.video.style.height=b,this.video.setAttribute("width",parseInt(a)),this.video.setAttribute("height",parseInt(b)),this.scheduleMaster.runningVpaid&&!this.scheduleMaster.runningVpaid.finished&&this.scheduleMaster.runningVpaid.resize(parseInt(a),parseInt(b))},this.handleTarget=function(a){var b;return b="string"==typeof a?document.getElementById(a):a},this.stringToSeconds=function(a){var b,c,d=a.split(":"),e=[];for(b=0;b<d.length;b++)e.push(isNaN(parseInt(d[b]))?0:parseInt(d[b]));switch(c=0,e.length){case 1:c=parseInt(a);break;case 2:c=60*parseInt(e[0])+parseInt(e[1]);break;case 3:c=3600*parseInt(e[1])+60*parseInt(e[1])+parseInt(e[2])}return c},this.secondsToString=function(a){var b,c;return a=Math.floor(a),b=(a-a%3600)/3600,b=b<10?"0"+b:b,a-=3600*b,c=(a-a%60)/60,c=c<10?"0"+c:c,a-=60*c,a=a<10?"0"+a:a,(b>0?b+":":"")+c+":"+a},this.generateId=function(){for(var a="vpaid-"+Math.floor(65536*(1+Math.random()));document.getElementById(a);)a="vpaid-"+Math.floor(1e5*Math.random());return a},this.ova=new i["default"](this,this.store),this.initVpaidManager=function(){this.vpaidManager=new B["default"](this.store,this)},this.store.on("closePlayer",function(){s.closePlayer()}),this.initScheduleMaster=function(){this.scheduleMaster=new k["default"](this,this.store),this.store.get("vForce")&&this.scheduleMaster.disable()},this.initScheduleMaster(),this.handlePlayerPause=function(){if(!this.playerIsClosed)switch(this.status){case"loading-play":case"playing":this.status="paused",this.options.onPlayerPause(this);break;default:return}},this.handlePlayerPlay=function(){if(!this.playerIsClosed)switch(this.status){case"loading":this.status="loading-play";break;case"ended":this.status="playing",window.setTimeout(function(a){a.playerIsClosed||a.options._onPlayerRepeat(a)},0,this),window.setTimeout(function(a){a.playerIsClosed||a.options._onPlayerRepeat(a)},0,this),window.setTimeout(function(a){a.playerIsClosed||a.options.onPlayerPlay(a)},0,this);break;case"loading-play":case"stopped":case"paused":this.status="playing",window.setTimeout(function(a){a.playerIsClosed||a.options.onPlayerResume(a)},0,this);break;default:return}},this._onPlayerRepeat=function(){this.repeatCount++},this.handleOnCanPlay=function(){if(!this.playerIsClosed)switch(this.status){case"loading-play":this.status="playing",this.createSchedule(),window.setTimeout(function(a){a.onPlayerReadyRun(),a.options.onPlayerReady(a)},0,this),window.setTimeout(function(a){a.options.onPlayerPlay(a)},0,this);break;case"loading":this.createSchedule(),window.setTimeout(function(a){a.onPlayerReadyRun(),a.options.onPlayerReady(a)},0,this);break;default:return}},this.handlePlayerEnd=function(){if(!this.playerIsClosed)switch(this.store.emit("contentChanged"),this.status){case"playing":window.setTimeout(function(a){a.options.onPlayerPause(a)},0,this);case"paused":this.status="ended",this.options.repeat?window.setTimeout(function(a){a.play()},0,this.video):(this.options.onPlayerComplete(this),this.options.onPlayerStop(this));break;default:return}},this.handlePlayerSeeked=function(a){this.playerIsClosed||window.setTimeout(function(a){a.options.onPlayerSeek(a)},0,this)},this.handlePlayerError=function(a){this.status="stopping",this.video.pause(),this.status="loading",this.options.onPlayerError(this,a)},this.handlePlayerVolume=function(){this.debugTracker.info("Event","Player Volume Was Changed!")},this.muteToggle=function(){this.options.mute?this.unMute():this.mute()},this.mute=function(){this.video.muted=this.options.mute=!0,this.vpaidManager&&this.vpaidManager.mute(),this.volume(0)},this.unMute=function(){this.video.muted=this.options.mute=!1,this.vpaidManager&&this.vpaidManager.unmute(this.options.volume/100),this.volume(this.options.volumeBeforeMute)},this.volume=function(a){if("stopped"!=this.status&&!(this.forceMute&&a>0))return this.vpaidManager&&this.vpaidManager.volume(a),void 0==a?this.options.mute?0:Math.round(100*this.video.volume):void(this.options.videoControlsForceMute&&a>0||(0===a&&0!=this.options.volume&&(this.options.volumeBeforeMute=this.options.volume),this.options.volume=a,a/=100,0==a?(this.video.muted=this.options.mute=!0,this.video.volume=0):(this.video.muted=this.options.mute=!1,this.video.volume=a),e.store.set("volume",a),this.VideoDesktopControls&&this.VideoDesktopControls.setVolumeState(a)))},this.onPlayerReadyRun=function(){var a,b=this.onPlayerReadyActions.length;if(0!=b){for(a=0;a<b;a++)this.onPlayerReadyActions[a].apply(this,[]);this.onPlayerReadyActions=new Array}},this.onPlayerReadyActions=new Array,this.attachEventsToVideo=function(a){var b,c,d,e,f,g=this,h=this,i=function j(a){j.player.handlePlayerSeeked(a)};i.player=this,a.addEventListener("seeked",i,!0),b=function k(){k.player.handleOnCanPlay()},b.player=this,a.addEventListener("canplay",b,!0),c=function l(){l.player.handlePlayerPlay()},c.player=this,a.addEventListener("play",c,!0),d=function m(){m.player.handlePlayerPause()},d.player=this,a.addEventListener("pause",d,!0),e=function n(){n.player.handlePlayerEnd()},e.player=this,a.addEventListener("ended",e,!0),f=function o(a){h.isMobile||h.handlePlayerError(a)},f.player=this,h=this,a.addEventListener("error",f,!0),a.addEventListener("click",function(){0===a.currentTime&&this.store.get("dataSaverDetected")&&(a.play(),h.VideoMobileControls.setPaused(!1))}),this.contentInterval=setInterval(function(){var a=h.video.currentTime,b=h.video.duration;g.store.set("contentTime",a),g.store.set("contentDuration",b)},5e3)},this.createMediaPlayer=function(){var b,c,e,f,g,h,i,j,k,l,m=this;this.target.className+=" vpaid-player-container",this.isMobile||(b=this.store.get("ua"),"Windows"!==b.os.name||"Edge"!==b.browser.name&&"IE"!==b.browser.name||this._fixEdgeIEIframeHoverBug()),c=document.createElement("video"),this.playerTag=c,c.id=this.generateId(),c.className=this.options.video_class_name,c.style.cssText="position: relative; z-index:99; cursor:pointer; display:block",c.setAttribute("playsinline",""),c.setAttribute("autoplay",""),this.isMobile&&this.hasAutoPlay&&(b=this.store.get("ua"),"Android"===b.os.name&&(J["default"].detect(d),c.setAttribute("poster","//cloudvid.cachefly.net/assets/poster-play.png"))),this.attachEventsToVideo(c),this.options.height||this.options.width?this.options.height&&this.options.width?(c.style.height=this.options.height.search(/px$/g)>-1?this.options.height:this.options.height+"px",c.style.width=this.options.width.search(/px$/g)>-1?this.options.width:this.options.width+"px"):this.options.width?(e=this.options.aspect_ratio.split(":")[1]/this.options.aspect_ratio.split(":")[0],c.style.width=this.options.width.search(/px$/g)>-1?this.options.width:parseFloat(this.options.width)+"px",c.style.height=Math.floor(parseFloat(c.style.width)*e)+"px"):(f=this.options.aspect_ratio.split(":")[0]/this.options.aspect_ratio.split(":")[1],c.style.height=this.options.height.search(/px$/g)>-1?this.options.height:parseFloat(this.options.height)+"px",c.style.width=Math.floor(parseFloat(c.style.height)*f)+"px"):this.debugTracker.error("createMediaPlayer","No `height` or `width` specified!"),c.setAttribute("muted",""),c.setAttribute("width",parseFloat(c.style.width)+""),c.setAttribute("height",parseFloat(c.style.height)+""),c.setAttribute("playsinline",""),this.store.get("repeat")&&c.setAttribute("loop",""),g=this,setTimeout(function(){try{g.handleOnCanPlay()}catch(a){}},200),this.options.repeat&&(c.playerRepeat=!0),this.options.image&&c.setAttribute("poster",this.options.image);try{if(this.store.get("cntonvfrc"))for(h=0;h<this.options.files.length;h++)i=this.options.files[h],/\.mpg$/.test(i.url)||/\.mpeg$/.test(i.url)||(this.isMobile&&!this.hasAutoPlay?this.playerTag.src=i.url:(j=document.createElement("source"),j.setAttribute("type",i.type),j.src=i.url,c.name||(c.name=i.name?i.name:i.url),c.appendChild(j)))}catch(n){this.debugTracker.error("createMediaPlayer","Files array supplied is corrupted or malformed!")}this.store.get("cntonvfrc")&&this.target.appendChild(c),this.video=c,this.target.id="_cm-css-reset",this.isMobile&&!this.hasAutoPlay?(k=function o(){g.canvas.destroy(),g.store.set("sncad",!0),g.canvas=!1},l=c.src,this.canvas=new z["default"](c,{_onPlayerError:k},(!0),{position:"absolute",zIndex:102},this.store,(!0),this.target),this.canvas.on("newVidCreated",this._onNewVidCreated.bind(this)),this.isCanvaMode=!0,setTimeout(function(){c._vidSetAttr("src",""),setTimeout(function(){m.canvas&&(m.canvas.setSrc(l),c.style.display="none",m.handleOnCanPlay())},2e3)},2)):c.volume=this.options.volume/100,this.isMobile||!this.options.controls&&!this.store.get("ad_controls")||this.addVideoDesktopControls(),this.isMobile&&this.options.controls&&this.addVideoMobileControls(),this.volume(this.options.mute?0:this.options.volume),this.setVideoSize(a.width+"px",a.height+"px"),this.VideoDesktopControls&&this.VideoDesktopControls.setState(this.playerStatus),this.VideoMobileControls&&this.VideoMobileControls.setState(this.playerStatus)},this._fixEdgeIEIframeHoverBug=function(){var a=this;this.target.addEventListener("mouseover",function(){a.target.classList.add("hover")}),this.target.addEventListener("mouseleave",function(){a.target.classList.remove("hover")})},this._onNewVidCreated=function(a){this.video.parentElement.removeChild(this.video),this.video=a,this.canvas=!1},this.addVideoDesktopControls=function(){this.VideoDesktopControls=new v["default"](this.video,this.store,this.target),this.store.on("videoControlsMute",this._onVideoControlMuteChanged.bind(this)),this.store.on("videoControlsVolume",this._onVideoControlVolumeChanged.bind(this)),this.store.on("videoControlsPause",this._onVideoControlPauseChanged.bind(this)),this.store.on("videoProgressBar",this._onVideoProgressBarChanged.bind(this))},this.addVideoMobileControls=function(){this.VideoMobileControls=new x["default"](this.video,this.store,this.canvas,this.target),this.store.on("videoControlsVolume",this._onVideoControlVolumeChanged.bind(this))},this._isAdState=function(){return"ad"===this.playerStatus},this._onVideoControlMuteChanged=function(a){this.options.videoControlsForceMute=a,this._isAdState()&&this.runningVpaid&&(a?this.runningVpaid.vpaid.vpaidHandler.mute():this.runningVpaid.vpaid.vpaidHandler.unMute()),this.forceMute=a,a?this.mute():this.unMute()},this._onVideoControlVolumeChanged=function(a){this.options.videoControlsForceMute=!1,this._isAdState()&&this.runningVpaid&&this.runningVpaid.vpaid.vpaidHandler.volume(a),this.volume(a),this.forceMute=0==a},this._onVideoControlPauseChanged=function(a){this.store.set("forcePause",a),this._isAdState()&&this.runningVpaid?a?this.runningVpaid.vpaid.vpaidHandler.pause():this.runningVpaid.vpaid.vpaidHandler.resume():a?this.pause():this.video.currentTime===this.video.duration?this.play():this.resume(),this.store.emit("UserInteractionPauseState",a)},this._onVideoProgressBarChanged=function(a){if(!this._isAdState()){var b=Math.floor(a*this.video.duration);this.store.emit("videoProgressBarTransition",this.video.duration,b),this.video.currentTime=b}},this.onVpaidCreated=function(a){this.runningVpaid=a,this.vpaidHandler=a,this.VideoDesktopControls&&this.VideoDesktopControls.setVpaidHandler(this.runningVpaid)}.bind(this),this.store.on("vpaidHandlerCreated",this.onVpaidCreated),this.ga={sendGaMessage:function u(){}},e=this,this.createGA=function w(){},this.removeGA=function y(){this.ga_set},this.convertPreMidPostToTime=function(a,b){var c,d,e,f,g,h,i;if(b=1*Math.round(b)-this.options.min_vpaid_run_time,c={},d=this.options.schedule_auto,e=void 0,e=a["pre-roll"].length>0?a["pre-roll"][0]:a["mid-roll"].length>0?a["mid-roll"][0]:a["post-roll"].length>0?a["post-roll"][0]:void 0,void 0==e)return this.debugTracker.error("PreMidPostToTime","Error creating automatic schedule!Pleace check the schedule preset!"),
{};for(c["00:00"]=e,f=[],a["mid-roll"].length>0?f=a["mid-roll"]:a["post-roll"].length>0?f=a["post-roll"]:f.push(e),g=void 0,g=a["post-roll"].length>0?a["post-roll"][0]:f[0];d<b;)h=this.secondsToString(d),i=f.shift(),f.push(i),d+=this.options.schedule_auto,d>b&&(i=g),c[h]=i;return c},this.createSchedule=function(){var a,b,c,d,e,f;if(!this.store.get("vForce")){for(this.videoLength=this.video.duration,this.videoLength=this.videoLength||120,a=this.options.schedule,b={},c=this.options.schedule_auto,0===this.options.schedule_auto&&(this.options.schedule_auto=1),d=0;d<a.length;d++)if(e=a[d],this.options.schedule_auto)b[e.roll_type]||(b[e.roll_type]=[]),b[e.roll_type].push(e);else for(f=0;f<e.positions.length;f++)!b[e.positions[f]]&&this.videoLength-this.options.min_vpaid_run_time>this.stringToSeconds(e.positions[f])&&(b[e.positions[f]]=e);this.options.schedule_auto&&(b["pre-roll"]||(b["pre-roll"]=[]),b["mid-roll"]||(b["mid-roll"]=[]),b["post-roll"]||(b["post-roll"]=[]),b=this.convertPreMidPostToTime(b,this.videoLength)),this.options.schedule_auto=c,this.scheduleMaster.schedule=b,this.store.set("contentSchedule",b),this.scheduleMaster.start()}},this.setVideoFile=function(a,b,c){for(var d,e,f;this.video.childNodes.length;)this.video.removeChild(this.video.childNodes[0]);b?this.video.setAttribute("poster",b):this.video.removeAttribute("poster"),c?(this.status="loading",this.video.setAttribute("autoplay","true")):this.video.removeAttribute("autoplay");try{for(this.video.removeAttribute("src"),d=0;d<a.length;d++)e=a[d],f=document.createElement("source"),f.setAttribute("type",e.type),f.src=e.url,this.video.name||(this.video.name=e.name?e.name:e.url),this.video.appendChild(f);this.video.load()}catch(g){this.debugTracker.error("setVideoFile","Error creating video sources!")}},this._onVpaidClosed=function(){},this._pausePlayer=function(){this.scheduleMaster.stop(!0),this.seek(0),this.stop(),this.store.emit("pausePlayer")},this.closePlayer=function A(){this._onVpaidClosed=this.closeCleanPlayer.bind(this,"_onVpaidClosed"),this.options.onPlayerClose(this),this.scheduleMaster.stop()},this.closeCleanPlayer=function(a){var b=this;setTimeout(function(){if(a=a||"none",b.store.emit("stop","close:"+a),!b.playerIsClosed){for(clearInterval(b.contentInterval),b.vpaidManager&&b.vpaidManager.stop(),b.playerIsClosed=!0,b._onVpaidClosed=function(){},b.stop(),b.removeGA();b.target.childNodes.length;)b.target.removeChild(b.target.childNodes[0]);b.onPlayerReadyActions=b.debugTracker=b.video=b.schedule=b.ova=b.ga=b.scheduleMaster=b.KPIsRecorder=void 0,b.options=b.target=void 0}},0)},this.target=this.handleTarget(a.target_id),this.target&&this.target.appendChild?(this.options.htmlVideoSupport?this.createMediaPlayer():(this.debugTracker.error("Constructor","Browser does not support <video> Tag!Nothing to do, aborting..."),this.options.onPlayerLoadError(this)),o=this.store.get("base_url"),this.store.set("flashSupported",t["default"]&&t["default"].hasFlashPlayerVersion(K)),this.store.set("use_flash_player",this.store.get("use_flash_player")&&this.store.get("flashSupported")),this.store.get("use_flash_player")&&((new Image).src=o+"/release-r1/assets/flash_cors5.swf?callbackID=301115",(new Image).src=o+"/release-r1/assets/swfobject.js",(new Image).src=o+"/release-r1/assets/VpaidClientFlash.js",(new Image).src=o+"/release-r1/assets/Player.novast.swf"),this.set=function(a,b){this.store.set(a,b)},this.get=function(a){return this.store.get(a)},this.on=function(a,b){this.store.on(a,b)},this.off=function(a,b){this.store.removeListener(a,b)},this.getVpaidLogs=function(){return this.vpaidManager?this.vpaidManager.getVpaidLogs():this.scheduleMaster?this.scheduleMaster.getVpaidLogs():void 0},this.startWaterfall=function(){try{this.scheduleMaster.vpaid.waterfallManager.start()}catch(a){return!1}return!0},this.stopWaterfall=function(){try{this.scheduleMaster.vpaid.waterfallManager.stop()}catch(a){return!1}return!0},q=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream,q&&setTimeout(function(){s.handleOnCanPlay()},500),this.store.get("vForce")&&this.initVpaidManager(),void(this.getAd=function(a){if(this.vpaidManager)return this.vpaidManager.getAd(a)})):void this.debugTracker.error("Constructor","No player target!Can't build player in ["+this.target+"]... aborting!")}var g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K;Object.defineProperty(c,"__esModule",{value:!0}),g=Object.assign||function(a){var b,c,d;for(b=1;b<arguments.length;b++){c=arguments[b];for(d in c)Object.prototype.hasOwnProperty.call(c,d)&&(a[d]=c[d])}return a},c["default"]=f,h=a("./Ova"),i=e(h),j=a("./ScheduleMaster"),k=e(j),l=a("./Tracker"),m=e(l),n=a("./extendPlayerOptions"),o=a("./Store"),p=e(o),q=a("./dynamicSettings"),r=d(q),s=a("../vpaidjs/swfobject"),t=e(s),u=a("./VideoDesktopControls"),v=e(u),w=a("./VideoMobileControls"),x=e(w),y=a("../vpaidjs/Mpg1Canvas"),z=e(y),A=a("./VpaidManager"),B=e(A),C=a("./utils"),D=d(C),E=a("./KPIsRecorder"),F=e(E),G=a("./AutoplayDetector"),H=e(G),I=a("./dataSaverDetector"),J=e(I),K="11.0.0",window.OvaMediaPlayer=f,b.exports=c["default"]},{"../vpaidjs/Mpg1Canvas":39,"../vpaidjs/swfobject":58,"./AutoplayDetector":11,"./KPIsRecorder":12,"./Ova":13,"./ScheduleMaster":17,"./Store":19,"./Tracker":20,"./VideoDesktopControls":21,"./VideoMobileControls":22,"./VpaidManager":24,"./dataSaverDetector":25,"./dynamicSettings":26,"./extendPlayerOptions":27,"./utils":28}],15:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var f,g,h,i,j,k;Object.defineProperty(c,"__esModule",{value:!0}),f=function(){function a(a,b){var c,d;for(c=0;c<b.length;c++)d=b[c],d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g=a("./Stopwatch"),h=d(g),i=a("bluebird"),j=d(i),k=function(){function a(){e(this,a),this._stopwatchs=[]}return f(a,[{key:"startSampling",value:function b(){var a=new h["default"];return this._stopwatchs.push(a),a.start(),this._stopwatchs.length-1}},{key:"stopSampling",value:function c(a){this._stopwatchs[a].stop()}},{key:"getDuration",value:function d(a){return this._stopwatchs[a].duration()}},{key:"runOneEventLoopSampling",value:function g(){var a=this;return new j["default"](function(b){var c=a.startSampling();setTimeout(function(){a.stopSampling(c),b(a.getDuration(c))},0)})}},{key:"runEventLoopSampling",value:function i(a,b){var c=this;return new j["default"](function(d){var e=[],f=0,g=setInterval(function(){f<a?(e.push(c.runOneEventLoopSampling()),f++):(clearInterval(g),j["default"].all(e).then(function(b){var c=b.reduce(function(a,b){return a+b},0);d(c/a)}))},b)})}},{key:"cleanResources",value:function k(){this._stopwatchs.length=0}}]),a}(),c["default"]=k,b.exports=c["default"]},{"./Stopwatch":18,bluebird:1}],16:[function(a,b,c){"use strict";function d(a,b,c,d,e,f){function g(a,b,c,d,e,f,g){var i,k;return!!a&&(b=b||"",i=new XMLHttpRequest,k=b?"POST":"GET",i.open(k,a,!0),i.withCredentials=!0,f===!1&&(i.withCredentials=!1),i.setRequestHeader("Content-type",j),i.async=void 0==e||e,i.callback="function"==typeof c?c:function(){},i.fallback="function"==typeof d?d:function(){},i.timeout=g,i.gotResponse=!1,i.addEventListener("error",function(a){this.gotResponse||(this.gotResponse=!0,i.fallback())}),i.addEventListener("load",function(a){this.gotResponse||(this.gotResponse=!0,i.fallback())}),i.addEventListener("abort",function(a){this.gotResponse||(this.gotResponse=!0,i.fallback())}),i.addEventListener("timeout",function(a){this.gotResponse||(this.gotResponse=!0,i.fallback())}),i.addEventListener("readystatechange",function(f){if(4==this.readyState){if(this.gotResponse)return;switch(this.gotResponse=!0,this.status+""){case"200":case"460":this.callback(this.responseText,m);break;default:if(!l)return m.push(this.status),void h(a,b,c,d,e,!1,g);m.push(this.status),this.fallback(m,a)}}}),i.send(b),!0)}function h(a,b,c,d,e,f,h){l=!0,g(a,b,c,d,e,!1,h)}var i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:5e3,j=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"application/x-www-form-urlencoded",k=!(arguments.length>8&&void 0!==arguments[8])||arguments[8],l=!k,m=[];g(a,b,c,d,e,f,i)}Object.defineProperty(c,"__esModule",{value:!0}),c["default"]=d,b.exports=c["default"]},{}],17:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var f,g,h,i,j,k,l;Object.defineProperty(c,"__esModule",{value:!0}),f=function(){function a(a,b){var c,d;for(c=0;c<b.length;c++)d=b[c],d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g=a("./VpaidHandler"),h=d(g),i=a("./Tracker"),j=d(i),k=500,l=function(){function a(b,c){e(this,a),this.schedule={},this.parent=b,this.savedTime=-1,this.runningVpaid=!1,this.runningVpaidTagData={},this.runTimeId=0,this.bug_feature=b.options.bug_feature,this.vpaidCount=0,this._firstImpression=!1,this.minTimeBetweenRuns=5e3,this.debugTracker=new j["default"]("ScheduleMaster"),this.store=c,this.lastEndedPlayedVpaid=-1e6,this.timeBetweenAds=this.store.get("schedule_auto"),this.store.on("stop",this.stop.bind(this)),this.useNewScheduler=this.store.get("evtbsschdl"),this.useNewScheduler&&(this._bindedLoop2=this._loop2.bind(this),this._bindedOnVpaidReady=this._onVpaidReady.bind(this),this._bindedOnVpaidEnded=this._onVpaidEnded.bind(this),this.loop2Ticker=setInterval(this._bindedLoop2,k))}return f(a,[{key:"stop",value:function b(){window.clearTimeout(this.runTimeId),this.runningVpaid&&!this.runningVpaid.finished?(this.runningVpaid.stop(),this.savedTime=-1,this.parent=void 0,this.runningVpaid=void 0,this.schedule=void 0):(this.parent,this.savedTime=-1,this.parent=void 0,this.runningVpaid=void 0,this.schedule=void 0),this.useNewScheduler&&(this.store.removeListener("vpaidReady",this._bindedOnVpaidReady),this.store.removeListener("vpaidEnded",this._bindedOnVpaidEnded),clearInterval(this.loop2Ticker))}},{key:"stopVpaid",value:function c(){this.runningVpaid&&!this.runningVpaid.finished&&this.runningVpaid.stop()}},{key:"start",value:function d(){window.clearTimeout(this.runTimeId),this.useNewScheduler?(this.vpaidToRun={vpaid:this.schedule["00:00"],time:"00:00"},this.store.on("vpaidReady",this._bindedOnVpaidReady),this.store.on("vpaidEnded",this._bindedOnVpaidEnded),this._bindedLoop2()):this._loop()}},{key:"disable",value:function g(){this.isDisabled=!0}},{key:"_onVpaidReady",value:function i(a){this._loop2()}},{key:"_onVpaidEnded",value:function l(a){a.hadImpression&&(this.lastEndedPlayedVpaid=Date.now()),this._loop2()}},{key:"_loop2",value:function m(){if(!this.isDisabled&&0===this.store.get("ads_started")){var a=Date.now()-this.lastEndedPlayedVpaid;a>=1e3*this.timeBetweenAds&&this.runVpaid(this.vpaidToRun.vpaid,this.vpaidToRun.time)}}},{key:"_loop",value:function n(){var a,b,c,d,e,f,g;if(!this.isDisabled){if(window.clearTimeout(this.runTimeId),a=this,b=Math.floor(this.parent.video.currentTime),this._isContentPaused()&&(b=NaN),1===this.timeBetweenAds||b!=this.savedTime&&!isNaN(b)&&"repeating"!=this.parent.status){if(this.savedTime>b&&(this.savedTime=-1),c=(new Date).getTime(),c-this.lastRun<this.minTimeBetweenRuns)return void(a.runTimeId=window.setTimeout(function(){a._loop()},1e3));for(isNaN(this.savedTime)&&(this.savedTime=0),d=this.savedTime+1,d>b&&(d=b),e={vpaid:!1,time:0};d<=b;)f=this.parent.secondsToString(d),this.schedule[f]&&(e.vpaid=this.schedule[f],e.time=f),d++;e.vpaid&&(window.lastRun=Date.now(),g=this.runVpaid(e.vpaid,e.time),g&&(this.lastRun=c)),this.savedTime=b}a.runTimeId=window.setTimeout(function(b){a._loop()},700)}}},{key:"_isContentPaused",value:function o(){return this.parent.canvas?"PAUSED"===this.parent.canvas.status:this.parent.video&&this.parent.video.paused}},{key:"runVpaid",value:function p(a,b){return this.runningVpaidTagData=a,this.vpaidCount++,a.vpaidCount=this.vpaidCount,this.runningVpaid?this.runningVpaid.run():(this.runningVpaid=new h["default"]({isFirstImpression:this.isFirstImpression,vpaidTag:a,uid:b,parent:this.parent,isPreRoll:"00:00"===b&&0===this.vpaidCount},this.parent.options,this.store),this.debugTracker.info("runVpaid","Started VpaidTag at ["+b+"]"),!0)}},{key:"_checkFirstImpression",value:function q(){var a=!this._firstImpression;return this._firstImpression=!0,a}},{key:"getTagData",value:function r(){return!!this.gotVpaid&&this.runningVpaidTagData}},{key:"getVpaidLogs",value:function s(){if(this.runningVpaid)return this.runningVpaid.getVpaidLogs()}},{key:"isFirstImpression",get:function t(){return this._checkFirstImpression.bind(this)}},{key:"tagVolume",set:function u(a){this.runningVpaidTagData.volume=a}},{key:"vpaid",get:function v(){return this.gotVpaid?this.runningVpaid.vpaid:{}}},{key:"gotVpaid",get:function w(){return!(!this.runningVpaid||this.runningVpaid.finished||!this.runningVpaid.vpaidCreated)}}]),a}(),c["default"]=l,b.exports=c["default"]},{"./Tracker":20,"./VpaidHandler":23}],18:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var e,f;Object.defineProperty(c,"__esModule",{value:!0}),e=function(){function a(a,b){var c,d;for(c=0;c<b.length;c++)d=b[c],d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=function(){function a(){d(this,a),this._startTime=0,this._stopTime=0,this._now=window.performance?window.performance.now.bind(window.performance):Date.now.bind(Date)}return e(a,[{key:"now",value:function b(){return parseInt(this._now())}},{key:"start",value:function c(){this._startTime=this.now()}},{key:"stop",value:function f(){this._stopTime=this.now()}},{key:"reset",value:function g(){this._stopTime=this._startTime=0}},{key:"duration",value:function h(){if(this._startTime&&this._stopTime)return this._stopTime-this._startTime;throw"You did not use the stopwatch as expected!"}},{key:"setMeasureInPerformanceObject",value:function i(a){window.performance&&window.performance.measure(a,this._startTime,this._stopTime)}}]),a}(),c["default"]=f,b.exports=c["default"]},{}],19:[function(a,b,c){"use strict";function d(a){var b,c;if(a&&a.__esModule)return a;if(b={},null!=a)for(c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b["default"]=a,b}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var h,i,j,k,l,m,n,o,p;Object.defineProperty(c,"__esModule",{value:!0}),h=Object.assign||function(a){var b,c,d;for(b=1;b<arguments.length;b++){c=arguments[b];for(d in c)Object.prototype.hasOwnProperty.call(c,d)&&(a[d]=c[d])}return a},i=function(){function a(a,b){var c,d;for(c=0;c<b.length;c++)d=b[c],d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),j=a("../player/dynamicSettings"),k=d(j),l=a("events"),m=a("ua-parser-js"),n=d(m),o=function(a){function b(a){var c,d,g,i,j;e(this,b),c=f(this,(b.__proto__||Object.getPrototypeOf(b)).call(this)),c.data={},h(c.data,a),d="6.4.42",d=d.replace(/\./g,""),d=parseInt(d),c.data.debug=a.debug.indexOf("*")!=-1,c.data.player_version=d,g="",i="",j="";try{i=a.unit_name,g=a.abTest,j=a.unit_main_version}catch(k){}return c.data.ab_test=g,c.data.unit_type=i,c.data.unit_version=j,c.data.session_started=Date.now(),c._parseUserAgent(),c}return g(b,a),i(b,[{key:"incr",value:function c(a){p.exists(a,this.data)||p.set(a,0,this.data);var b=p.get(a,!0,this.data)||0;if("number"==typeof b)return p.set(a,b+1,this.data),p.get(a,!1,this.data)}},{key:"decr",value:function d(a){var b=p.get(a,!1,this.data);if("number"==typeof b)return p.set(a,b-1,this.data),p.get(a,!1,this.data)}},{key:"get",value:function j(a){return a=a.toString(),a.indexOf(".")===-1?this.data[a]:p.get(a,!1,this.data)}},{key:"getByAdvId",value:function l(a,b){var c=k.get()||{};return c&&c.hasOwnProperty(b)&&c[b].hasOwnProperty(a)?c[b][a]:this.get(a,!1,this.data)}},{key:"getByTech",value:function m(a,b){var c=k.get()||{};return c&&c.hasOwnProperty(b)&&c[b].hasOwnProperty(a)?c[b][a]:null}},{key:"set",value:function o(a,b){a=a.toString(),p.set(a,b,this.data)}},{key:"_parseUserAgent",value:function q(){var a=n.UAParser(window.navigator.userAgent);this.set("ua",a)}}]),b}(l.EventEmitter),c["default"]=o,p=function(){var a=function b(a,c,d){var e,f,g=d||data;for(e=0;g&&(f=a[e]);e++)g=f in g?g[f]:c?g[f]={}:void 0;return g};return{set:function c(b,d,e){var f=b.split("."),g=f.pop(),h=a(f,!0,e);return h&&g?h[g]=d:void 0},get:function d(b,c,e){return a(b.split("."),c,e)},exists:function e(a,b){return void 0!==this.get(a,!1,b)}}}(),b.exports=c["default"]},{"../player/dynamicSettings":26,events:2,"ua-parser-js":4}],20:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var e,f,g;Object.defineProperty(c,"__esModule",{value:!0}),e=function(){function a(a,b){var c,d;for(c=0;c<b.length;c++)d=b[c],d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=function h(){},g=function(){function a(b){d(this,a),this.label="["+b+"]";var c=this;this.debugLevels||(this.debugLevels={}),localStorage&&localStorage.getItem("dev")&&(this.debugLevels={error:1,warn:1,info:1,debug:1,event:1}),this.debugLevels.error&&(this.error=function e(a,b){console.error(c.label,"["+a+"]",b)}),this.debugLevels.warn&&(this.warn=function f(a,b){console.warn(c.label,"["+a+"]",b)}),this.debugLevels.info&&(this.info=function g(a,b){console.info(c.label,"["+a+"]",b)}),this.debugLevels.log&&(this.log=function h(a,b){console.log(c.label,"["+a+"]",b)}),this.debugLevels.debug&&(this.debug=function i(a,b,d){console.debug(d?"":"[-DEBUG-]"+c.label,"["+a+"]",b)}),this.debugLevels.event&&(this.event=function j(a,b){console.debug("[-EVENT-]"+c.label,"["+a+"]",b)})}return e(a,[{key:"error",value:function b(){}},{key:"warn",value:function c(){}},{key:"info",value:function f(){}},{key:"log",value:function g(){}},{key:"debug",value:function h(){}},{key:"event",value:function i(){}}]),a}(),c["default"]=g,b.exports=c["default"]},{}],21:[function(a,b,c){"use strict";function d(a){var b,c;if(a&&a.__esModule)return a;if(b={},null!=a)for(c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b["default"]=a,b}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var f,g,h,i;Object.defineProperty(c,"__esModule",{value:!0}),f=function(){function a(a,b){var c,d;for(c=0;c<b.length;c++)d=b[c],d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g=a("./utils"),h=d(g),i=function(){function a(b,c,d){e(this,a),this.store=c,this.target=b.parentElement||d,this.video=b,this.showContentControls=this.store.get("controls"),this.showAdControls=this.store.get("ad_controls"),this.statet="content",this.volume=0,this.volumeBeforeMute=0,this.adDuration=1e3*this.store.get("baseAdDuration"),this.adCurrentTime=0,this.adStartTime=0,this.adTickerId=0,this.adLastTickTime=0,this._createElements(),this._setTitle(this.store.get("disctxt")),this._setMuted(!0),this._setPause(!1),this._onBindedVolumeOut=this._onVolumeOut.bind(this),this._onBindedVolumeMove=this._onVolumeMove.bind(this),this._onBindedProgressBarOut=this._onProgressBarOut.bind(this),this._onBindedProgressBarMove=this._onProgressBarMove.bind(this),this._addVideoListeners(),this.updateVisibility()}return f(a,[{key:"updateVisibility",value:function b(){var a=this;requestAnimationFrame(function(){h.removeClass(a.element,"hide"),h.removeClass(a.element,"show"),a._isAdState()?h.addClass(a.element,a.showAdControls?"show":"hide"):h.addClass(a.element,a.showContentControls?"show":"hide")})}},{key:"setState",value:function c(a){this.state=a,this.adLastTickTime=0,this._isAdState()?(this.adDuration=1e3*this.store.get("baseAdDuration"),this.adCurrentTime=0,this._updateProgress(0,30),this.adStartTime=Date.now(),this.adTickerId&&(this.adTickerId=clearInterval(this.adTickerId)),this.adTickerId=setInterval(this._onAdTicks.bind(this),250)):this.adTickerId=clearInterval(this.adTickerId),this.updateVisibility()}},{key:"_isAdState",value:function d(){return"ad"===this.state}},{key:"_createElements",value:function g(){this.element=document.createElement("div"),this.element.className="video_controls hide",this.element.innerHTML="<div class='cm_video_controls_progressbar_area'>\n            <div class='cm_video_controls_progressbar_bg white_bg'>\n            </div>\n            <div class='cm_video_controls_progressbar blue_bg'>\n            </div>\n        </div>\n        <div class='cm_video_controls_main_area'>\n            <div class='play_pause interactive'>\n                <div class='pause hide'>\n                </div>\n                <div class='play'>\n                </div>\n            </div>\n            <div class='title text' class='control'>\n            </div>\n            <div class='cm_video_controls_valume_area'>\n                <div class='cm_video_controls_mute interactive' class='control interactive'>\n                </div>\n                <div class='video-controls-scroller-area control interactive'>\n                    <div class='video-controls-scroller-bg white_bg'>\n                    </div>\n                    <div class='video-controls-scroller blue_bg'>\n                    </div>\n                </div>\n            </div>\n        </div>",this.target.addEventListener("dragstart",{}),this.progressBarArea=this.element.children[0],this.progressBarBg=this.progressBarArea.children[0],this.progressBarPercentager=this.progressBarArea.children[1],this.mainArea=this.element.children[1],this.playPause=this.mainArea.children[0],this.textElement=this.mainArea.children[1],this.volumeArea=this.mainArea.children[2],this.pauseBtn=this.playPause.children[0],this.playBtn=this.playPause.children[1],this.soundElement=this.volumeArea.children[0],this.volumeScrollerArea=this.volumeArea.children[1],this.volumeScrollerBg=this.volumeScrollerArea.children[0],this.volumeScroller=this.volumeScrollerArea.children[1],this.element.addEventListener("click",function(a){a.stopPropagation()}),this.playPause.addEventListener("click",this._onPlayPauseClicked.bind(this)),this.soundElement.addEventListener("click",this._onMuteClicked.bind(this)),this.volumeScrollerArea.addEventListener("mousedown",this._onVolumeDown.bind(this)),this.progressBarArea.addEventListener("mousedown",this._onProgressBarDown.bind(this)),this.target.appendChild(this.element)}},{key:"_setMuted",value:function i(a){this.isMuted=a,h.removeClass(this.soundElement,"display_unmute"),h.removeClass(this.soundElement,"display_mute"),h.addClass(this.soundElement,a?"display_mute":"display_unmute")}},{key:"_setVolume",value:function j(a){this.volume=a,this.volumeScroller.style.width=a+"%"}},{key:"_setPause",value:function k(a){var b,c;this.isPaused=a,b=this.isPaused?this.playBtn:this.pauseBtn,c=this.isPaused?this.pauseBtn:this.playBtn,h.removeClass(c,"show"),h.addClass(c,"hide"),h.removeClass(b,"hide"),h.addClass(b,"show")}},{key:"_updateProgress",value:function l(a,b){var c=this;requestAnimationFrame(function(){var d=(a-b)/a*100;c._setProgress(d),c._updateTimeLeft(a-b)})}},{key:"_setProgress",value:function m(a){var b=this;requestAnimationFrame(function(){var c=100-a+"%";b.progressBarPercentager.style.width!==c&&(b.progressBarPercentager.style.width=c)})}},{key:"_updateTimeLeft",value:function n(a){var b=parseInt(a%60),c=parseInt(a/60%60)}},{key:"_setTitle",value:function o(a){this.textElement.innerHTML=a}},{key:"_addVideoListeners",value:function p(){this.video.addEventListener("durationchange",this._onVideoEvent.bind(this)),this.video.addEventListener("progress",this._onVideoEvent.bind(this)),this.video.addEventListener("timeupdate",this._onVideoEvent.bind(this)),this.video.addEventListener("volumechange",this._onVideoEvent.bind(this)),this.video.addEventListener("playing",this._onVideoEvent.bind(this)),this.video.addEventListener("pause",this._onVideoEvent.bind(this)),this.video.addEventListener("click",this._onVideoClick.bind(this))}},{key:"_onVideoClick",value:function q(a){this.video.currentTime===this.video.duration&&(this.video.play(),a.stopPropagation())}},{key:"_onVideoEvent",value:function r(a){if(!this._isAdState())switch(this._updateProgress(this.video.duration,this.video.currentTime),this._setVolume(100*this.video.volume),this._setMuted(0===this.video.volume),a.type){case"pause":this._setPause(!0);break;case"playing":this._setPause(!1)}}},{key:"setVpaidHandler",value:function s(a){this.runningVpaid=a,this._addVpaidListeners()}},{key:"_addVpaidListeners",value:function t(){this.runningVpaid.on("AdVolumeChange",this._onVpaidEvent.bind(this)),this.runningVpaid.on("AdPaused",this._onVpaidEvent.bind(this)),this.runningVpaid.on("AdPlaying",this._onVpaidEvent.bind(this)),this.runningVpaid.on("AdVideoStart",this._onAdVideoStart.bind(this))}},{key:"_onVpaidEvent",value:function u(a){if(this._isAdState()&&this.runningVpaid.vpaid.manager.workingVpaidItem.vpaidWrapper===a.dispatcher)switch(this._setVolume(100*a.dispatcher.adVolume),this._setMuted(0===a.dispatcher.adVolume),a.type){case"AdPaused":this._setPause(!0);break;case"AdPlaying":this._setPause(!1)}}},{key:"_onAdVideoStart",value:function v(){this._isAdState()&&(this.adDuration=this.store.get("currentAdDuration"))}},{key:"_onAdTicks",value:function w(){var a=Date.now();this.isPaused?0!=this.adLastTickTime&&(this.adStartTime+=a-this.adLastTickTime):(this.adCurrentTime=(a-this.adStartTime)/1e3,this.adCurrentTime>this.adDuration&&(this.adCurrentTime=this.adDuration),this._updateProgress(this.adDuration,this.adCurrentTime)),this.adLastTickTime=a}},{key:"_onPlayPauseClicked",value:function x(a){this.store.emit("videoControlsPause",!this.isPaused),a.stopPropagation()}},{key:"_onMuteClicked",value:function y(a){this.store.emit("videoControlsMute",!this.isMuted),this.isMuted?0===this.volumeBeforeMute&&(this.volumeBeforeMute=50):this.volumeBeforeMute=this.volume,a.stopPropagation()}},{key:"_onVolumeDown",value:function z(a){this._sendVolumePercentagesChanged(a.offsetX/this.volumeScrollerArea.offsetWidth*100,a),this.volumeScrollerArea.addEventListener("mouseleave",this._onBindedVolumeOut),this.volumeScrollerArea.addEventListener("mouseup",this._onBindedVolumeOut),this.volumeScrollerArea.addEventListener("mouseout",this._onBindedVolumeOut),this.volumeScrollerArea.addEventListener("mousemove",this._onBindedVolumeMove),a.stopPropagation()}},{key:"_onVolumeOut",value:function A(a){this.volumeScrollerArea.removeEventListener("mouseleave",this._onBindedVolumeOut),this.volumeScrollerArea.removeEventListener("mouseup",this._onBindedVolumeOut),this.volumeScrollerArea.removeEventListener("mouseout",this._onBindedVolumeOut),this.volumeScrollerArea.removeEventListener("mousemove",this._onBindedVolumeMove),a.stopPropagation()}},{key:"_onVolumeMove",value:function B(a){this._sendVolumePercentagesChanged(event.offsetX/this.volumeScrollerArea.offsetWidth*100,a)}},{key:"_sendVolumePercentagesChanged",value:function C(a,b){a=Math.min(100,Math.max(a,0)),this.store.emit("videoControlsVolume",a),this.volumeBeforeMute=a,0===a&&this.store.emit("videoControlsMute",!0),b.stopPropagation()}},{key:"getVolume",value:function D(){return this.volume}},{key:"onAdPlayerStateChanged",value:function E(a){this._setPause(a);var b=0,c=0;this._isAdState()?(b=this.adDuration/1e3,c=Math.min((Date.now()-this.adStartTime)/1e3,b)):(b=this.video.duration,c=this.video.currentTime)}},{key:"_onProgressBarDown",value:function F(a){this._sendProgressBarPercentagesChanged(a.offsetX/this.progressBarArea.offsetWidth,a),this.progressBarArea.addEventListener("mouseleave",this._onBindedProgressBarOut),this.progressBarArea.addEventListener("mouseup",this._onBindedProgressBarOut),this.progressBarArea.addEventListener("mouseout",this._onBindedProgressBarOut),this.progressBarArea.addEventListener("mousemove",this._onBindedProgressBarMove),a.stopPropagation(),this._updateProgress(duration,currentTime)}},{key:"_sendProgressBarPercentagesChanged",value:function G(a,b){this.store.emit("videoProgressBar",a),b.stopPropagation()}},{key:"getPaused",value:function H(){return this.isPaused}},{key:"setPaused",value:function I(a){this.isPaused=a}},{key:"_onProgressBarOut",value:function J(a){this.progressBarArea.removeEventListener("mouseleave",this._onBindedProgressBarOut),this.progressBarArea.removeEventListener("mouseup",this._onBindedProgressBarOut),this.progressBarArea.removeEventListener("mouseout",this._onBindedProgressBarOut),this.progressBarArea.removeEventListener("mousemove",this._onBindedProgressBarMove),a.stopPropagation()}},{key:"_onProgressBarMove",value:function K(a){this._sendProgressBarPercentagesChanged(a.offsetX/this.progressBarArea.offsetWidth,a)}},{key:"setVolumeState",value:function L(a){this._setVolume(a),this._setMuted(0==a)}}]),a}(),c["default"]=i,b.exports=c["default"]},{"./utils":28}],22:[function(a,b,c){"use strict";function d(a){var b,c;if(a&&a.__esModule)return a;if(b={},null!=a)for(c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b["default"]=a,b}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var f,g,h,i;Object.defineProperty(c,"__esModule",{value:!0}),f=function(){function a(a,b){var c,d;for(c=0;c<b.length;c++)d=b[c],d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g=a("./utils"),h=d(g),i=function(){function a(b,c,d,f){var g,h,i,j;e(this,a),this.store=c,this.video=b,this.canvas=d,this.target=f,this.statet="content",g=document.createElement("div"),g.style.width="100%",g.style.height="100%",g.style.top="0",g.style.left="0",g.style.pointerEvents="none",g.style.zIndex=1001,h=document.createElement("div"),h.className="mc-play",h.style.pointerEvents="all",h.addEventListener("click",this._mobilePlayPauseClick.bind(this)),i=document.createElement("div"),i.className="speaker",i.style.pointerEvents="all",i.addEventListener("click",this._mobileMuteClick.bind(this)),j=document.createElement("div"),j.className="tbl-text",j.innerText=this.store.get("disctxt"),this.container=(this.video.parentElement||this.target).appendChild(g),this.playbtn=this.container.appendChild(h),this.mutebtn=this.container.appendChild(i),this.container.appendChild(j),this.isMuted=0===this.store.get("volume")||!!this.canvas,this.isPaused=!1}return f(a,[{key:"setState",value:function b(a){a!=this.state&&(this.isPaused=this.store.get("dataSaverDetected")&&0===this.video.currentTime,this.state=a,this._isAdState()?(this.container.style.display="none",this.store.emit("videoControlsVolume",100*this.store.get("volume"))):(this.isMuted=0===this.store.get("volume")||!!this.canvas,this.container.style.display="block",this.container.style.zIndex=1001,this.video.muted=this.isMuted,this.video.muted||this.video.removeAttribute("muted"),this.volume=this.video.volume=this.store.get("volume"),
this._renderControls()))}},{key:"_isAdState",value:function c(){return"ad"===this.state}},{key:"_mobileMuteClick",value:function d(){this.mutebtn.className="speaker",this.isMuted=!this.isMuted,this._isAdState()||(this.canvas?this.canvas.muteButtonClick():this.video.muted=!this.video.muted,this.volume=this.video.volume=.7,this._renderControls())}},{key:"_mobilePlayPauseClick",value:function g(){this._isAdState()||(this.video.paused?(this.video.play(),this.isPaused=!1):(this.video.pause(),this.isPaused=!0),this._renderControls()),this.store.emit("UserInteractionPauseState",this.isPaused)}},{key:"_renderControls",value:function h(){this.playbtn.className=this.isPaused?"mc-play":"mc-pause",this.mutebtn.className=this.isMuted?"speaker mute":"speaker"}},{key:"setPaused",value:function i(a){this.isPaused=a,this._renderControls()}}]),a}(),c["default"]=i,b.exports=c["default"]},{"./utils":28}],23:[function(a,b,c){"use strict";function d(a){var b,c;if(a&&a.__esModule)return a;if(b={},null!=a)for(c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b["default"]=a,b}function f(a){return a&&a.__esModule?a:{"default":a}}function g(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function h(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function i(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y;Object.defineProperty(c,"__esModule",{value:!0}),j=Object.assign||function(a){var b,c,d;for(b=1;b<arguments.length;b++){c=arguments[b];for(d in c)Object.prototype.hasOwnProperty.call(c,d)&&(a[d]=c[d])}return a},k=function(){function a(a,b){var c,d;for(c=0;c<b.length;c++)d=b[c],d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),l=a("./Post"),m=f(l),n=a("./Tracker"),o=f(n),p=a("../vpaidjs/ConvertVpaidMain"),q=f(p),r=a("./utils"),s=d(r),t=a("events"),u=a("../vpaidjs/OpportunityAggregator"),v=f(u),w=100,x=0,y=function(a){function b(a,c,d){var e,f;return g(this,b),e=h(this,(b.__proto__||Object.getPrototypeOf(b)).call(this)),e.store=d,e.finished=!1,e.isFirstImpression=a.isFirstImpression,e.soundViolationFired=!1,e.iframe={},e.vpaid=null,e.uid="",e.debugTracker=new o["default"]("VpaidHandler"),e.vpaidCreated=!1,e.adPlayer={},e.videoWrapper={},e.options=a,e.parent=a.parent,e.parentOptions=c,e.creativeData={},e.height=0,e.width=0,e.eventFunctions={},e.viewMode="normal",e.bitRate=512,e.timerId=0,e.adPlaying=!1,e.environmentVars={},f=j({},e.parentOptions.tagDefault,e.options.vpaidTag),e.normalizeVpaidParam(f),e.options.vpaidTag=f,e.prepareVideoTag(),e.run(a.isPreRoll),e.store.on("stop",e.stop.bind(e)),e.volumeBeforeMute=0,e.paused=!1,e.hideAdPlayerDelayId=0,e.store.emit("vpaidHandlerCreated",e),e}return i(b,a),k(b,[{key:"volumeControlClick",value:function c(a,b,d){var e=a.parentNode.getBoundingClientRect(),f=parseInt((d.pageX-(e.left+5))/(e.width-10)*100);this.setVolumeControls(a,b,f),f>100&&(f=100),this.volume(f/100),this.options.parent.volume(f)}},{key:"setVolumeControls",value:function d(a,b,c){c>100&&(c=100),c<=0?(c=0,b.className="vjs-mute-control vjs-control vjs-vol-0",b.muted=!0):(b.className="vjs-mute-control vjs-control vjs-vol-"+Math.floor(c/25),b.muted=!1),a.style.width=c+"%"}},{key:"muteControlClick",value:function f(a,b,c){if(b.muted){b.className="vjs-mute-control vjs-control vjs-vol-4",b.muted=!1;var d=100*(this._beforeMuteVolume||1);a.style.width=d+"%",this.volume(d),this.options.parent.volume(100)}else b.className="vjs-mute-control vjs-control vjs-vol-0",b.muted=!0,this._beforeMuteVolume=this._volume,a.style.width="0",this.volume(0),this.options.parent.volume(0)}},{key:"playPauseClick",value:function l(a,b){this.paused?(this.vpaid.resumeAd(),this.paused=!1,a.className="vjs-play-control vjs-control"):(this.vpaid.pauseAd(),this.paused=!0,a.className="vjs-play-control vjs-control vjs-playing c-paused"),b.stopPropagation()}},{key:"onVpaidCreated",value:function m(a){this.vpaid=a,this.vpaid||(this.debugTracker.error("onVpaidCreated","Vpaid Object is Invalid!"),this.debugTracker.warn("onVpaidCreated","Missing vpaid error handler for this case!")),this.subscribeToVpaid(a),this.environmentVars={slot:this.videoWrapper,videoSlot:this.adPlayer,videoSlotCanAutoPlay:!0,videoSlotControls:!0},this.debugTracker.info("onVpaidCreated","Vpaid-Player->Creating..."),this.debugTracker.info("onVpaidCreated","Vpaid-Handshake->"+this.vpaid.handshakeVersion("1.1")),this.options.vpaidTag.skip_vast||!this.creativeData.adParameters?this.creativeData.adparameters=this.creativeData.AdParameters=this.creativeData.adParameters=this.options.vpaidTag.ad_parameters:this.creativeData.adparameters=this.creativeData.AdParameters=this.creativeData.adParameters;try{this.vpaid.initAd(this.options.width,this.options.height,this.viewMode,parseInt(this.bitRate),this.creativeData,this.environmentVars),this.vpaidCreated=!0}catch(b){this.debugTracker.warn("onVpaidCreated","Vpaid-initAd->failed!Trying to run with parsed <adParameters>...");try{var c=this.creativeData.adParameters;this.creativeData.adParameters={},this.creativeData.adParameters=new Function("return "+c+";")(),this.creativeData.adparameters=this.creativeData.AdParameters=this.creativeData.adParameters,this.vpaid.initAd(this.options.width,this.options.height,this.viewMode,parseInt(this.bitRate),this.creativeData,this.environmentVars),this.vpaidCreated=!0}catch(d){this.vpaidCreated=!1,this.onVpaidLoadError(b,d)}}this.vpaidCreated&&this.parent.ga.sendGaMessage({type:"vpaidInitiated"})}},{key:"resize",value:function n(a,b,c){if(c=c||"normal",b=parseInt(b),a=parseInt(a),this.options.height=b,this.options.width=a,this.viewmode=c,!isNaN(a)||!isNaN(b)){this.videoWrapper.style.width=a+"px",this.videoWrapper.style.height=b+"px";var d=!1;try{this.adPlayer&&(this.adPlayer.style.width=a+"px",this.adPlayer.style.height=b+"px",this.adPlayer.setAttribute("width",window.parseInt(this.adPlayer.style.width)),this.adPlayer.setAttribute("height",window.parseInt(this.adPlayer.style.height))),this.vpaid&&(d=this.vpaid.resizeAd(a,b,c))}catch(e){this.debugTracker.error("resize",e),d=!1}return d}}},{key:"viewAdPlayer",value:function p(){clearTimeout(this.hideAdPlayerDelayId),this.adPlaying||(this.store.get("isMobile")||this.antiFlashBlackScreen(),this.startAdTimer(),this.adPlaying=!0,this.parent.video.pause(),this.parent.video.style.display="none",this.parent.canvas?this.parent.canvas.hide():(this.parent.video.style.display="none",this.parent.video.style.zIndex=0),this.videoWrapper.style.zIndex=100,this.videoWrapper.classList.add("_ad-cm-playing"),this.videoWrapper.style.top=0,this.videoWrapper.style.display="block"),this.store.emit("AdPlayerVisible")}},{key:"antiFlashBlackScreen",value:function r(){document.body.scrollTop=document.body.scrollTop+1,setTimeout(function(){document.body.scrollTop=document.body.scrollTop-1},2)}},{key:"hideAdPlayer",value:function s(){clearTimeout(this.hideAdPlayerDelayId);var a=this;this.hideAdPlayerDelayId=setTimeout(function(){window.clearTimeout(a.timerId),a.store.get("vForce")||a.parent.playerIsClosed||a.adPlaying&&(a.adPlaying=!1,a.parent.canvas?(a.parent.video.play(),a.parent.canvas.show(),a.parent.canvas._play()):(a.parent.video&&a.parent.video.paused&&(a.store.get("dataSaverDetected")||a.parent.video.play()),a.parent.video&&(a.parent.video.style.display="block",a.parent.video.style.zIndex=1e3)),a.videoWrapper.classList.remove("_ad-cm-playing"),a.store.emit("AdPlayerHidden"))})}},{key:"startAdTimer",value:function t(){var a=this.store.get("global_ad_timeout");window.clearTimeout(this.timerId),this.timerId=window.setTimeout(this.stop.bind(this),a)}},{key:"onVpaidError",value:function u(a,b,c){c?this.debugTracker.error("VPAID-"+this.options.uid,c?c[0]:""):this.debugTracker.error("VPAID-"+this.options.uid,"Vpaid Threw Error"),this.parent.options.onAdError(this.parent,this),window.setTimeout(function(a){a.hideAdPlayer()},0,this)}},{key:"onVpaidLoadError",value:function w(a,b){var c,d;if(a=a||"",b=b||"",this.parent.ga.sendGaMessage({type:"VpaidLoadError"}),500==parseInt(1e3*Math.random()))try{c="VpaidLoadError="+encodeURIComponent(a.toString()+"[][][][]"+b.toString()),d=new XMLHttpRequest,d.open("POST","//www.mikysrv.com/push.html",!0),d.setRequestHeader("Content-type","application/x-www-form-urlencoded"),d.send(c),this.debugTracker.error("VPAID-"+this.options.uid,[a,b])}catch(e){}this.parent.options.onAdLoadError(this.parent,this),window.setTimeout(function(a){a.hideAdPlayer()},0,this)}},{key:"onVpaidPageError",value:function x(a){this.debugTracker.warn("VpaidPageError",a)}},{key:"stop",value:function y(){window.setTimeout(function(a){a.hideAdPlayer()},0,this)}},{key:"onVpaidStop",value:function z(){window.setTimeout(function(a){a.hideAdPlayer()},0,this)}},{key:"cleanVpaidStuff",value:function A(){}},{key:"generateId",value:function B(){for(var a="vpaid-"+Math.floor(65536*(1+Math.random()));document.getElementById(a);)a="vpaid-"+Math.floor(1e5*Math.random());return a}},{key:"run",value:function C(a){var b,c,d=this.store.get("ads_playing")||0,e=this.store.get("sncad")||!1;return e&&d?(this.debugTracker.info("Run Ad  adsPlaying > 0",d),!1):(b=this.options.vpaidTag,this.vpaid||(this.creativeData.adparameters=this.creativeData.AdParameters=this.creativeData.adParameters=this.options.vpaidTag.ad_parameters,this.vpaid=new q["default"](b,this,this.store),this.store.get("cmbopps")&&(c=new v["default"](this.store,this.vpaid.config.creatives),this.store.set("oppsAggregator",c)),this.onVpaidCreated(this.vpaid),this.vpaid.initAd(this.options.width,this.options.height,this.viewMode,parseInt(this.bitRate),this.creativeData,this.environmentVars)),this.store.set("currentPubid",b.pubid),this.store.set("currentTagid",b.tagid),this.store.set("rollType",b.roll_type),this.vpaid.startAd(a),this.vpaidCreated=!0,!0)}},{key:"startAd",value:function D(){this.startAdFired=!0,this.vpaid.startAd()}},{key:"prepareVideoTag",value:function E(){var a,b,c,d,e,f,g=this.parent.target,h=this.getWorkingVolume();this.videoWrapper=document.createElement("div"),this.videoWrapper.className=g.className,this.videoWrapper.className+=" vpaid-handler",this.videoWrapper.id=this.options.uid+"_"+g.id,this.videoWrapper.style.cssText=g.style.cssText+";position:absolute;top:0;left:0;border:0; z-index:0",this.adPlayer=document.createElement("video"),this.adPlayer.className=this.options.video_class_name,this.adPlayer.id=this.generateId(),this.adPlayer.style.cursor="pointer",this.adPlayer.style.position="absolute",this.adPlayer.style.left="0",this.adPlayer.style.top="0",this.adPlayer.style.zIndex="0",this.parentOptions.height||this.parentOptions.width?(a=this.parentOptions.height,b=this.parentOptions.width,c=this.parentOptions.aspect_ratio,a&&b?(this.adPlayer.style.height=a.search(/px$/g)>-1?a:a+"px",this.adPlayer.style.width=b.search(/px$/g)>-1?b:b+"px"):b?(d=c.split(":")[1]/c.split(":")[0],this.adPlayer.style.width=b.search(/px$/g)>-1?b:parseFloat(b)+"px",this.adPlayer.style.height=Math.floor(parseFloat(this.adPlayer.style.width)*d)+"px"):(e=c.split(":")[0]/c.split(":")[1],this.adPlayer.style.height=a.search(/px$/g)>-1?a:parseFloat(a)+"px",this.adPlayer.style.width=Math.floor(parseFloat(this.adPlayer.style.height)*e)+"px")):this.debugTracker.error("prepareVideoTag","No `height` or `width` specified!"),f=this.options.vpaidTag.mute?this.options.vpaidTag.mute:this.parentOptions.mute,this.options.vpaidTag.mute=f,this.options.height=window.parseInt(this.adPlayer.style.height),this.options.width=window.parseInt(this.adPlayer.style.width),this.adPlayer.setAttribute("width",window.parseInt(this.adPlayer.style.width)),this.adPlayer.setAttribute("height",window.parseInt(this.adPlayer.style.height)),this.options.controls&&this.adPlayer.setAttribute("controls","true"),this.options.autostart&&this.adPlayer.setAttribute("autoplay","true"),this.options.fullscreen&&this.adPlayer.setAttribute("allowFulScreen","true"),f?(this.adPlayer.volume=0,Object.defineProperty(this.adPlayer,"volume",{configurable:!0,enumerable:!0,get:function i(){return 0},set:function j(a){}})):this.adPlayer.volume=h/100,this.videoWrapper.appendChild(this.adPlayer),g.appendChild(this.videoWrapper)}},{key:"getWorkingVolume",value:function F(){var a=0;return this.options.vpaidTag.volume?"auto"==this.options.vpaidTag.volume&&(a=this.parent.volume()/100,a=this.store.get("volume")):a=this.parentOptions.volume/100,a<1?parseInt(100*a):parseInt(a)}},{key:"normalizeVpaidParam",value:function G(a){a.ufp=a.use_flash_player,a.adto=a.ad_timeout,a["player-width"]=this.parent.video.offsetWidth,a["player-height"]=this.parent.video.offsetHeight,a["video-url"]=this.parent.video.name,a.vidlength=parseInt(this.parent.video.duration),a.sts=this.parent.repeatCount,a["vpaid-version"]=a.vpaid_version,a["auc-dast"]=a.auc_dast;var b=2;a.use_as_is||(b=0==a.plmd?a.muted?2:1:a.plmd),a.plmd=b}},{key:"volume",value:function H(a){if(a=a>1?a/100:a,void 0!=a)try{this.vpaid&&(this.vpaid.setAdVolume(a),this._volume=a)}catch(b){return 0}else try{return this.vpaid.getAdVolume()}catch(b){return 0}}},{key:"subscribeToVpaid",value:function I(a){var b,c,d=this;this.eventFunctions={AdLoaded:function f(a){d.parent.ga.sendGaMessage({type:"AdLoaded"})},AdVideoStart:function g(a){if(a.dispatcher.adPlayedCounter||a.dispatcher.isBf||(this.store.incr("ads_playing"),a.dispatcher.adPlayedCounter=!0),!d.finished){d.debugTracker.debug("VPAID-"+a.dispatcher.index,"AdVideoStart");var b=d.getWorkingVolume();d.adPlayer.volume=b/100,d.volume(b),d.viewAdPlayer(),d.parent.options.onAdVideoStart(d.parent,d)}},AdImpression:function h(a){var b,c,e=this.store.get("ads_playing"),f=this.store.incr("total_impressions");if(a.dispatcher.adPlayedCounter||a.dispatcher.isBf||(this.store.incr("ads_playing"),a.dispatcher.adPlayedCounter=!0),!d.finished){if(d.parent.ga.sendGaMessage({type:"AdImpression"},{vage:parseInt((Date.now()-a.dispatcher.created)/1e3),vpaidReadyInQue:a.vpaidReady,qsize:a.qsize,dp:a.dp,adImpInMS:a.adImpInMS,readyInMS:a.readyInMS,loadToImpMS:a.loadToImpMS,vast:a.dispatcher.vast,adsPlaying:e,totalImpressions:f,xhrErrors:a.dispatcher.xhrErrors||""}),d.debugTracker.debug("VPAID-dp "+a.dp+" : "+d.uid,"AdImpression"),b=a.tag,d.isFirstImpression()&&d.vpaid)if(d.vpaid.fire99&&d.parent.options.fire99)try{a.dispatcher.fire99()}catch(g){d.debugTracker.warn("VPAID-"+d.uid,"Error running method 'fire99' ")}else d.debugTracker.warn("VPAID-"+d.uid,"Method 'fire99' is not supported");if(d.parent.options.onAdImpression(d,a.dispatcher,b),c=d.getWorkingVolume(),d.adPlayer.volume=c/100,d.volume(c),d.vpaid)try{d.vpaid.resizeAd(d.options.width,d.options.height,d.viewmode)}catch(g){console.log(g)}}},AdStopped:function i(a){a.dispatcher.adPlayedCounter&&!a.dispatcher.isBf&&this.store.set("ads_playing",0),d.debugTracker.debug("VPAID-"+d.uid,"AdStopped"),d.parent.options.onAdStopped(e.dispatcher.index,d),d.onVpaidStop()},AdVideoComplete:function j(a){d.debugTracker.debug("VPAID-"+a.dispatcher.index,"AdVideoComplete"),d.hideAdPlayer(),a.dispatcher.adPlayedCounter&&!a.dispatcher.isBf&&this.store.set("ads_playing",0),d.parent.options&&d.parent.options.onAdVideoEnd(d.parent,d)},AdError:function k(a){d.debugTracker.debug("VPAID-"+d.uid,"AdError"),d.onVpaidError("[VPAID-"+d.options.uid+"]::AdError","AdError",arguments),a.dispatcher.adPlayedCounter&&!a.dispatcher.isBf&&this.store.set("ads_playing",0)},AdClickThru:function l(a){d.debugTracker.debug("VPAID-"+d.uid,"AdClickThru"),a&&(a.clickThruUrl&&window.open(a.clickThruUrl),d.parent.options.onAdClick(d.parent,d,a.clickThruUrl))},AdStarted:function m(){setTimeout(function(){d.viewAdPlayer()},2),d.debugTracker.debug("VPAID-"+d.uid,"AdStarted");var a=d.getWorkingVolume();d.adPlayer.volume=a/100,d.volume(a)},VpaidSpecial:function n(){d.debugTracker.debug("VPAID-"+d.uid,"VpaidSpecial"),d.parent.ga.sendGaMessage({type:"VpaidSpecial"})},AdBlockEnabled:function o(){d.debugTracker.debug("VPAID-"+d.uid,"AdBlockEnabled"),d.parent.ga.sendGaMessage({type:"AdBlockEnabled"})},SoundViolation:function p(){d.soundViolationFired||(d.soundViolationFired=!0,d.parent.ga.sendGaMessage({type:"SoundViolation"})),d.debugTracker.debug("VPAID-"+d.uid,"SoundViolation")},HijackAttempt:function q(a){var b="";"string"==typeof a&&(b=a),d.parent.ga.sendGaMessage({type:"HijackAttempt"}),(new Image).src="//convusmp.basebanner.com/st?cijs=0&ttype=5&pix=31542217&dast="+d.options.vpaidTag.auc_dast+"&"+(new Date).getTime(),d.debugTracker.debug("VPAID-"+d.uid,"HijackAttempt")},AdPaused:function r(a){this.store.emit("contentPaused"),d.debugTracker.debug("VPAID-"+d.uid,"AdPaused"),d.paused=!0,d.playButton&&(d.playButton.className="vjs-play-control vjs-control vjs-playing c-paused")},AdPlaying:function s(a){d.debugTracker.debug("VPAID-"+d.uid,"AdPlaying"),d.paused&&(this.store.emit("contentResumed"),d.paused=!1),d.paused=!1,d.playButton&&(d.playButton.className="vjs-play-control vjs-control"),d.finished},AdDurationChange:function t(){d.debugTracker.debug("VPAID-"+d.uid,"AdDurationChange")},AdSkipped:function u(){d.eventFunctions.AdStopped(),d.debugTracker.debug("VPAID-"+d.uid,"AdSkipped")},AdSkippableStateChange:function v(){d.debugTracker.debug("VPAID-"+d.uid,"AdSkippableStateChange")},AdSizeChange:function w(){d.debugTracker.debug("VPAID-"+d.uid,"AdSizeChange")},AdLinearChange:function x(){d.debugTracker.debug("VPAID-"+d.uid,"AdLinearChange")},AdExpandedChange:function y(){d.debugTracker.debug("VPAID-"+d.uid,"AdExpandedChange")},AdVolumeChange:function z(){d.debugTracker.debug("VPAID-"+d.uid,"AdVolumeChange")},AdVideoFirstQuartile:function A(){d.debugTracker.debug("VPAID-"+d.uid,"AdVideoFirstQuartile")},AdVideoMidpoint:function B(){d.debugTracker.debug("VPAID-"+d.uid,"AdVideoMidpoint")},AdVideoThirdQuartile:function C(){d.debugTracker.debug("VPAID-"+d.uid,"AdVideoThirdQuartile")},AdInteraction:function D(a){d.debugTracker.debug("VPAID-"+d.uid,"AdInteraction",arguments)},AdUserAcceptInvitation:function E(){d.debugTracker.debug("VPAID-"+d.uid,"AdUserAcceptInvitation",arguments)},AdUserMinimize:function F(){d.debugTracker.debug("VPAID-"+d.uid,"AdUserMinimize",arguments)},AdUserClose:function G(){d.debugTracker.debug("VPAID-"+d.uid,"AdUserClose",arguments)},AdLog:function H(){d.debugTracker.debug("VPAID-"+d.uid,"AdLog",arguments)}},b=this.vpaidEvents;for(c in b)b[c]&&this.eventFunctions[c]?(this.eventFunctions[c].controller=this,a.subscribe(this.eventFunctions[c],b[c])):this.debugTracker.warn("VPAID-"+this.options.uid,"Missing function at '"+c+"'"),this.on(b[c],this.eventFunctions[c]);this.on("viewAdPlayer",d.viewAdPlayer)}},{key:"trigger",value:function J(a,b){this.eventFunctions.hasOwnProperty(a)&&"function"==typeof this.eventFunctions&&(this.emit(a,b),console.log("trigger event",a))}},{key:"getVpaidLogs",value:function K(){if(this.vpaid)return this.vpaid.getVpaidLogs()}},{key:"getAd",value:function L(a){return this.vpaid.getAd(a)}},{key:"runWaterfall",value:function M(a){this.vpaid.runWaterfall(a)}},{key:"pause",value:function N(){this.paused||(this.vpaid.pauseAd(),this.paused=!0)}},{key:"resume",value:function O(){this.adPlaying&&this.paused&&(this.vpaid.resumeAd(),this.paused=!1)}},{key:"mute",value:function P(){this.volumeBeforeMute=0===this._volume?50:this._volume,this.volume(0)}},{key:"unMute",value:function Q(){this.volumeBeforeMute&&(this.volumeBeforeMute=50),this.volume(this.volumeBeforeMute)}},{key:"setPaused",value:function R(a){this.paused=a}},{key:"vpaidEvents",get:function S(){return{VpaidSpecial:"VpaidSpecial",AdBlockEnabled:"AdBlockEnabled",AdLoaded:"AdLoaded",AdStarted:"AdStarted",AdStopped:"AdStopped",AdSkipped:"AdSkipped",AdSkippableStateChange:"AdSkippableStateChange",AdSizeChange:"AdSizeChange",AdLinearChange:"AdLinearChange",AdDurationChange:"AdDurationChange",AdExpandedChange:"AdExpandedChange",AdVolumeChange:"AdVolumeChange",AdImpression:"AdImpression",AdVideoStart:"AdVideoStart",AdVideoFirstQuartile:"AdVideoFirstQuartile",AdVideoMidpoint:"AdVideoMidpoint",AdVideoThirdQuartile:"AdVideoThirdQuartile",AdVideoComplete:"AdVideoComplete",AdClickThru:"AdClickThru",AdInteraction:"AdInteraction",AdUserAcceptInvitation:"AdUserAcceptInvitation",AdUserMinimize:"AdUserMinimize",AdUserClose:"AdUserClose",AdPaused:"AdPaused",AdPlaying:"AdPlaying",AdLog:"AdLog",AdError:"AdError",SoundViolation:"SoundViolation",HijackAttempt:"HijackAttempt"}}}]),b}(t.EventEmitter),c["default"]=y,b.exports=c["default"]},{"../vpaidjs/ConvertVpaidMain":30,"../vpaidjs/OpportunityAggregator":40,"./Post":16,"./Tracker":20,"./utils":28,events:2}],24:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var f,g,h,i,j;Object.defineProperty(c,"__esModule",{value:!0}),f=function(){function a(a,b){var c,d;for(c=0;c<b.length;c++)d=b[c],d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g=a("./VpaidHandler"),h=d(g),i=0,j=function(){function a(b,c){e(this,a),this.store=b,this.parent=c,this.initVpaid(),this.hadFirstImpression=!1}return f(a,[{key:"initVpaid",value:function b(){var a=this.getVpaidTag(),b={"00:00":a,"00:01":a};this.store.set("contentSchedule",b),this.store.set("autoplay_on_pre_roll",!1),this.vpaidHandler=new h["default"]({isFirstImpression:this.isFirstImpression,vpaidTag:a,uid:i++,parent:this.parent},this.parent.options,this.store),this.vpaidHandler.runWaterfall("vforceInit")}},{key:"getVpaidTag",value:function c(){var a="pre-roll",b=this.store.get("schedule"),c={};return b.forEach(function(a){a&&"pre-roll"===a.roll_type&&(c=a)}),c}},{key:"isFirstImpression",value:function d(){return!this.hadFirstImpression&&(this.hadFirstImpression=!0,!0)}},{key:"getVpaidLogs",value:function g(){if(this.vpaidHandler)return this.vpaidHandler.getVpaidLogs()}},{key:"getAd",value:function j(a){return this.vpaidHandler.getAd(a)}},{key:"stop",value:function k(){this.vpaidHandler&&!this.vpaidHandler.finished?this.vpaidHandler.stop():this.parent&&this.parent._onVpaidClosed(),this.vpaidHandler=void 0,this.schedule=void 0,this.parent=void 0,this.savedTime=-1}},{key:"pause",value:function l(){this.vpaidHandler.pause()}},{key:"resume",value:function m(){this.vpaidHandler.resume()}},{key:"volume",value:function n(a){this.vpaidHandler.volume(a)}},{key:"mute",value:function o(){this.volume(0)}},{key:"unmute",value:function p(a){this.volume(a)}},{key:"resize",value:function q(a,b,c){this.vpaidHandler.resize(a,b,c)}}]),a}(),c["default"]=j,b.exports=c["default"]},{"./VpaidHandler":23}],25:[function(a,b,c){"use strict";function d(a){var b=a.get("dtsvrurl"),c=new XMLHttpRequest;c.open("GET",b,!0),c.onreadystatechange=function(){var b,d;if(c.readyState==XMLHttpRequest.DONE){b=c.responseText,d={};try{d=JSON.parse(b)}catch(f){}e(d,a)}},c.send(null)}function e(a,b){var c=!!a.dataSaver;b&&b.set(f,c)}var f="dataSaverDetected";b.exports={detect:d}},{}],26:[function(a,b,c){"use strict";function d(a,b){var c=document.createElement("script"),d=document.getElementsByTagName("script")[0];c.src=a,d.parentNode.insertBefore(c,d),c.onload=function(){b()}}function e(a){var b=a.get("base_url"),c=b+a.get("dsu");d(c,function(){var b=cmTag.dSettings,c=a.get("advCnf")||{};i(cmTag.dSettings,c)})}function f(a,b){var c,d,e=h();for(d in e)d===id&&(c=e[d]);return c&&c.hasOwnProperty(b)?c[b]:null}function g(){var a,b=h(),c=[];for(a in b)/^\d+$/.test(a)&&b[a]&&b[a].hasOwnProperty("ftchVst")&&c.push({id:a,fv:b[a].ftchVst});return c}function h(){var a;try{a=cmTag.dSettings}catch(b){}return a||{}}Object.defineProperty(c,"__esModule",{value:!0});var i=Object.assign||function(a){var b,c,d;for(b=1;b<arguments.length;b++){c=arguments[b];for(d in c)Object.prototype.hasOwnProperty.call(c,d)&&(a[d]=c[d])}return a};c.init=e,c.getPropByAdvId=f,c.getWfData=g,c.get=h},{}],27:[function(a,b,c){"use strict";function d(a){var b,c,d={domain:window.location.hostname,cirf:"",referrer:document.referrer?document.referrer.split("//")[1]:window.location.hostname,page_url:window.location.href,vertical:"default",version:"0",auc_dast:"0",tags:"",title:"",description:"",keywords:"",default_ad_parameters:"",files:[],image:!1,target_id:"",height:!1,width:!1,controls:!0,aspect_ratio:"16:9",repeat:!0,mute:!1,default_b2b:1,oid:0,default_ad_timeout:30,volume:100,video_class_name:"video-js vjs-default-skin",target_class_name:"",schedule:[],schedule_auto:1,min_vpaid_run_time:4,debug:[],debug_label:"[JS-OVA-COMPONENT]",vpaid_protect_path:!1,htmlVideoSupport:function(){return!!document.createElement("video").canPlayType}(),ga_factor:1,use_flash_player:!0,use_flash_bypass:!0,fire99:!0,ad_controls:!1,seconds_to_close:0,time_between_waterfall:10,tmbtwfs:function e(a,b,c){return c.get("time_between_waterfall")},mntmbtwfsf:function f(a,b,c){return c.get("mintimwf")},mintimwf:5e3,mntmbtwfs:5,mxtmbtwfs:900,queue_size:6,report_version:611,max_ready_vpaid:3,waterfall_watermark:0,fire_piggies:!1,base_url:"//cloudvid.cachefly.net",wf_path:"VideoBidRequestHandlerServlet",run_wf_when_empty:!0,kill_after_hour:0,autoplay_on_pre_roll:!0,kaxwnc:18e5,pstflrs:!0,time_between_ads:1,vstxhr:!1,pvpd:"flash",noflshHiden:!1,sncad:!1,dlgverr:!0,blkflshjs:!0,vjshndlrlgcy:!1,vflashhndlrlgcy:!0,altmot:6e4,stadtmot:5e4,adimptmot:0,prtct:"/vpaid/hjk.5.js",jsnoflshdtct:!1,qsrtscr:function g(a,b){return 100*b.alfrox},psthdrs:"text/plain",rstmrai:!0,vstprxy:!1,xhrfrst:!0,pxyurl:"http://vid.mikysrv.com/fetch?url=",global_ad_timeout:18e4,mprdct:0,baseAdDuration:30,xhrz:!0,uscnvsmpg:!0,forcecnvsmpg:!1,gtvid:"//cnv.tcsrv.com/getvid?url",cnvsldrt:5,mpgclrslv:["gcdn.2mdn.net"],dsu:"/vpaid/ds/112/dsm.js",run_wf_on_init:!0,useapforcntnt:!1,wf_dynmc_ps:!0,sprssviderr:!1,vForce:!1,get_ad_timeout_seconds:10,wf_manual:!1,disctxt:"By Taboola",httpsOverride:!1,evtbsschdl:!0,timbtopps:100,cmbopps:!1,anltcsUrl:"/vpaid/vPlayer/vpaidjs/v6.4.42/assets/vpaidAnalytics.js",anltcsOptions:{withXHR:!0,withXML:!0,withEval:!0,withWindowProperties:!1},moat:!1,measureKPI:!1,prfsmpmsnt:5,prfsmitrvpmsnt:1500,kpitrvldrt:15e3,moatPartnerCode:"taboolajsvideo2446883476",untflshblktim:50,sndvltopp:!0,novdtrm:!1,dcdvdurl:!1,firstWaterfallNoaop:0,mpgwbgl:!0,mxlifls:0,kbnul:"//bi.mikysrv.com",frcmtfrms:!0,frcvlm:!1,pxlnotsmtp:!1,cntonvfrc:!0,mxemptwf:0,dtsvrurl:"//vidutils.taboola.com",onPlayerReady:function h(a){},onPlayerLoadError:function i(a){},onPlayerError:function j(a){},onPlayerPlay:function k(a){},onPlayerStop:function l(a){},onPlayerClose:function m(a){},onPlayerPause:function n(a){},onPlayerResume:function o(a){},onPlayerSeek:function p(a){},onPlayerRepeat:function q(a){},onPlayerComplete:function r(a){},onAdLoadError:function s(a,b){},onAdError:function t(a,b){},onAdStopped:function u(a,b){},onAdImpression:function v(a,b){},onAdVideoStart:function w(a,b){},onAdVideoEnd:function x(a,b){},onAdClick:function y(a,b,c){}};for(b in d)void 0==a[b]&&(a[b]=d[b]);return a.description||(a.description=a.title),a.keywords||(a.keywords=a.title),c=parseInt(100*Math.random())+1<=a.ron_percent,a.tagDefault={ad_controls:a.ad_controls,url:"",pubid:"",tagid:"",vidlength:"",video_url:a.files[0],title:a.title,cirf:a.cirf,description:a.description,keywords:a.keywords,ad_parameters:a.default_ad_parameters,muted:a.mute?1:0,auc_dast:a.auc_dast,referrer:a.referrer,page_url:a.page_url,domain:a.domain,vertical:a.vertical,tag:a.tags,vpaid_version:a.version,roll_type:"mid-roll",oid:a.oid,ad_timeout:a.default_ad_timeout,rs:"1",st:"1",sts:"1",type:"wf",noaop:"10",sortOrderType:0,mfp:4,afbp:a.use_flash_bypass,b2b:a.default_b2b,isRon:c,use_flash_player:a.use_flash_player,isvideo:0,mindur:1,maxdur:a.default_ad_timeout,minbr:1,maxbr:512,plmd:0,defaultTagTimeout:30,totaltimeout:60,use_as_is:!1,skip_vast:!1},a}function e(){var a,b,c,d={};try{d=window.cmTag.config}catch(e){return{}}a={};for(b in d)0===b.indexOf("player.settings.")&&(c=b.substr(16,b.length-16),a[c]=f(d[b]));return a}function f(a){var b,c=/^\d+$/.test(a);return c?parseInt(a):(b=/^true$|^false$/g.test(a),b?"true"===a||a===!0:a)}Object.defineProperty(c,"__esModule",{value:!0}),c.getDefaults=d,c.getUnitParams=e},{}],28:[function(a,b,c){"use strict";function d(a){var b,c,d;return!!a&&(null!==E?E:(b=parseInt(a.get("ga_factor"))||1e3,1===b?E=!0:(b>100&&(b=100),c=a.get("ab_test")||"",c&&100===b&&(b=50),d=o(0,b),E=d===b)))}function e(a,b){var c,e;d(b)&&(c=b.get("report_version"),e=new XMLHttpRequest,e.open("POST",b.get("kbnul")+"/push?"+a+"&ver="+c,!0),e.setRequestHeader("Content-type","application/x-www-form-urlencoded"),e.send(a))}function f(a,b,c){d(c)&&k(a,b,c)}function g(a,b,c,e){d(e)&&l(a,b,c,e)}function h(a,b,c){d(c)&&m(a,b,c)}function i(a){return a?1:0}function j(a,b){var c,d=store.get("report_version"),e=new XMLHttpRequest;e.open("POST",store.get("kbnul")+"/put",!0),e.setRequestHeader("Content-type","application/x-www-form-urlencoded"),c=n(b),e.send("report,event="+a+",version="+d+c+" value=1")}function k(a,b,c){var d,e=c.get("player_version"),f=c.get("ab_test")||"",g=new XMLHttpRequest;g.open("POST",c.get("kbnul")+"/putes",!0),d={event:a,timestamp:(new Date).toISOString(),version:e,abTest:f},d=D(d,b),g.send(JSON.stringify(d))}function l(a,b,c,d){var e,f=d.get("player_version"),g=d.get("ab_test")||"",h=new XMLHttpRequest;h.open("POST",d.get("kbnul")+"/putes/"+a,!0),e={event:b,timestamp:(new Date).toISOString(),version:f,abTest:g},e=D(e,c),h.send(JSON.stringify(e))}function m(a,b,c){var d=c.get("player_version"),e=new XMLHttpRequest;e.open("POST",c.get("kbnul")+"/putes/vast",!0),e.setRequestHeader("Content-type","application/x-www-form-urlencoded"),a=D(a,{version:d,timestamp:(new Date).toISOString()},b),e.send(JSON.stringify(a))}function n(a){var b,c;if("object"!==("undefined"==typeof a?"undefined":C(a)))return"";b="";for(c in a)b+=","+c+"="+a[c];return b}function o(a,b){var c=Math.floor(Math.random()*(b-a+1))+a;return c}function p(a,b){var c=F,d=[],e=0;for(b=b||c.length,a=a||22,e=0;e<a;e++)d[e]=c[0|Math.random()*b];return d.join("")}function q(a){return"string"!=typeof a?a:(a=a.replace(/^(http[s]?:|ftp:)/g,""),0!==a.indexOf("//")&&(a="//"+a),a)}function r(a){var b,c,d,e,f,g;if(!a||"string"!=typeof a)return 0;for(a=u(a),c="00000000 77073096 EE0E612C 990951BA 076DC419 706AF48F E963A535 9E6495A3 0EDB8832 79DCB8A4 E0D5E91E 97D2D988 09B64C2B 7EB17CBD E7B82D07 90BF1D91 1DB71064 6AB020F2 F3B97148 84BE41DE 1ADAD47D 6DDDE4EB F4D4B551 83D385C7 136C9856 646BA8C0 FD62F97A 8A65C9EC 14015C4F 63066CD9 FA0F3D63 8D080DF5 3B6E20C8 4C69105E D56041E4 A2677172 3C03E4D1 4B04D447 D20D85FD A50AB56B 35B5A8FA 42B2986C DBBBC9D6 ACBCF940 32D86CE3 45DF5C75 DCD60DCF ABD13D59 26D930AC 51DE003A C8D75180 BFD06116 21B4F4B5 56B3C423 CFBA9599 B8BDA50F 2802B89E 5F058808 C60CD9B2 B10BE924 2F6F7C87 58684C11 C1611DAB B6662D3D 76DC4190 01DB7106 98D220BC EFD5102A 71B18589 06B6B51F 9FBFE4A5 E8B8D433 7807C9A2 0F00F934 9609A88E E10E9818 7F6A0DBB 086D3D2D 91646C97 E6635C01 6B6B51F4 1C6C6162 856530D8 F262004E 6C0695ED 1B01A57B 8208F4C1 F50FC457 65B0D9C6 12B7E950 8BBEB8EA FCB9887C 62DD1DDF 15DA2D49 8CD37CF3 FBD44C65 4DB26158 3AB551CE A3BC0074 D4BB30E2 4ADFA541 3DD895D7 A4D1C46D D3D6F4FB 4369E96A 346ED9FC AD678846 DA60B8D0 44042D73 33031DE5 AA0A4C5F DD0D7CC9 5005713C 270241AA BE0B1010 C90C2086 5768B525 206F85B3 B966D409 CE61E49F 5EDEF90E 29D9C998 B0D09822 C7D7A8B4 59B33D17 2EB40D81 B7BD5C3B C0BA6CAD EDB88320 9ABFB3B6 03B6E20C 74B1D29A EAD54739 9DD277AF 04DB2615 73DC1683 E3630B12 94643B84 0D6D6A3E 7A6A5AA8 E40ECF0B 9309FF9D 0A00AE27 7D079EB1 F00F9344 8708A3D2 1E01F268 6906C2FE F762575D 806567CB 196C3671 6E6B06E7 FED41B76 89D32BE0 10DA7A5A 67DD4ACC F9B9DF6F 8EBEEFF9 17B7BE43 60B08ED5 D6D6A3E8 A1D1937E 38D8C2C4 4FDFF252 D1BB67F1 A6BC5767 3FB506DD 48B2364B D80D2BDA AF0A1B4C 36034AF6 41047A60 DF60EFC3 A867DF55 316E8EEF 4669BE79 CB61B38C BC66831A 256FD2A0 5268E236 CC0C7795 BB0B4703 220216B9 5505262F C5BA3BBE B2BD0B28 2BB45A92 5CB36A04 C2D7FFA7 B5D0CF31 2CD99E8B 5BDEAE1D 9B64C2B0 EC63F226 756AA39C 026D930A 9C0906A9 EB0E363F 72076785 05005713 95BF4A82 E2B87A14 7BB12BAE 0CB61B38 92D28E9B E5D5BE0D 7CDCEFB7 0BDBDF21 86D3D2D4 F1D4E242 68DDB3F8 1FDA836E 81BE16CD F6B9265B 6FB077E1 18B74777 88085AE6 FF0F6A70 66063BCA 11010B5C 8F659EFF F862AE69 616BFFD3 166CCF45 A00AE278 D70DD2EE 4E048354 3903B3C2 A7672661 D06016F7 4969474D 3E6E77DB AED16A4A D9D65ADC 40DF0B66 37D83BF0 A9BCAE53 DEBB9EC5 47B2CF7F 30B5FFE9 BDBDF21C CABAC28A 53B39330 24B4A3A6 BAD03605 CDD70693 54DE5729 23D967BF B3667A2E C4614AB8 5D681B02 2A6F2B94 B40BBE37 C30C8EA1 5A05DF1B 2D02EF8D",
"undefined"==typeof b&&(b=0),d=0,e=0,b^=-1,f=0,g=a.length;f<g;f++)e=255&(b^a.charCodeAt(f)),d="0x"+c.substr(9*e,8),b=b>>>8^d;return b^-1}function s(a){var b,c,d,e;for(a=a||{},c=function f(){},d=["debug","error","info","log","warn"],e=d.length;e--;)b=d[e],a[b]&&(a[b]=c)}function t(a){var b=/^(?:https?:\/\/)?(?:[^@\n]+@)?(?:www\.)?([^:\/\n]+)/im.exec(a);return b&&b.length?b[1]:null}function u(a){var b,c,d;for(a=a.replace(/\r\n/g,"\n"),b="",c=0;c<a.length;c++)d=a.charCodeAt(c),d<128?b+=String.fromCharCode(d):d>127&&d<2048?(b+=String.fromCharCode(d>>6|192),b+=String.fromCharCode(63&d|128)):(b+=String.fromCharCode(d>>12|224),b+=String.fromCharCode(d>>6&63|128),b+=String.fromCharCode(63&d|128));return b}function v(a){var b=-1,c={"pre-roll":0,preroll:0,"mid-roll":-1,midroll:-1,"post-roll":-2,postroll:-2};return c.hasOwnProperty(a)&&(b=c[a]),b}function w(a){return a.replace(/\s/g,"")}function x(a,b){a.className.indexOf(b)===-1&&(a.className+=" "+b),a.className=a.className.split("  ").join(" ")}function y(a,b){a.className=a.className.split(b).join("").split("  ").join(" ")}function z(a){var b,c,d,e={};for(b in a)if(a.hasOwnProperty(b))if("object"==C(a[b])){c=z(a[b]);for(d in c)c.hasOwnProperty(d)&&"function"!=typeof c[d]&&(e[b+"_"+d]=c[d])}else e[b]=a[b];return e}function A(a){try{return JSON.parse(JSON.stringify(a))}catch(b){return{}}}function B(a,b,c,d){var e,f,g=this;try{if(e="iframe"==a.tagName.toLowerCase()?a.contentDocument:a,!e)return;f=e.querySelectorAll(b),f.forEach(function(a){g.DOMIterator(a,b,c,d)}),c(e.querySelectorAll(d))}catch(h){return}}var C,D,E,F;Object.defineProperty(c,"__esModule",{value:!0}),C="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},D=Object.assign||function(a){var b,c,d;for(b=1;b<arguments.length;b++){c=arguments[b];for(d in c)Object.prototype.hasOwnProperty.call(c,d)&&(a[d]=c[d])}return a},c.shouldReport=d,c.reportMiky=e,c.reportDb=f,c.reportDebug=g,c.reportVastToDb=h,c.boolToInt=i,c.getRandomInt=o,c.generateGuid=p,c.setUrlPrefix=q,c.crc32=r,c._suppressConsoleMethods=s,c.stripDomain=t,c.getStreamType=v,c.trim=w,c.addClass=x,c.removeClass=y,c.flattenObject=z,c.deepClone=A,c.DOMIterator=B,E=null,F="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split("")},{}],29:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var e=function f(a){d(this,f),this.parent=a,this.events={},this.dispatchEvent=function b(a,c,d){var e,f=b.beacon;if(void 0==c&&(c={}),a&&f.events[a]){for(e=0;e<f.events[a].useCapture.length;e++)f.events[a].useCapture[e].assignedFunction.apply(f.parent,[{dispatcher:d?d:f.parent,type:a,eventData:c,staticData:f.events[a].useCapture[e].static_data}]);for(e=0;e<f.events[a].noCapture.length;e++)f.events[a].noCapture[e].assignedFunction.apply(f.parent,[{dispatcher:d?d:f.parent,type:a,eventData:c,staticData:f.events[a].noCapture[e].static_data}])}},this.dispatchEvent.beacon=this,this.removeEventListener=function c(a,b){var d,e,f=c.beacon;if(a){if(void 0==b&&f.events[a])return void(f.events[a]={useCapture:[],noCapture:[]});if(b&&f.events[a]&&"function"==typeof b){for(d=[],e=0;e<f.events[a].useCapture.length;e++)f.events[a].useCapture[e].assignedFunction!=b&&d.push(f.events[a].useCapture[e]);for(f.events[a].useCapture=d,d=[],e=0;e<f.events[a].noCapture.length;e++)f.events[a].noCapture[e].assignedFunction==b&&d.push(f.events[a].noCapture[e]);f.events[a].noCapture=d}}},this.removeEventListener.beacon=this,this.addEventListener=function e(a,b,c){var d,f,g=e.beacon;if(a&&"function"==typeof b){for(d=[],f=3;f<arguments.length;f++)d.push(arguments[f]);g.events[a]||(g.events[a]={useCapture:[],noCapture:[]}),c?g.events[a].useCapture.push({assignedFunction:b,static_data:d}):g.events[a].noCapture.push({assignedFunction:b,static_data:d})}},this.addEventListener.beacon=this,this.listEvents=function g(){return Object.keys(g.beacon.events)},this.listEvents.beacon=this,this.listEventHandlers=function h(a){var b,c,d,e=dispatchEvent.beacon;if(!a||!e.events[a])return[];for(c=[],b=e.events[a].useCapture,d=0;d<b;d++)c.push(e.events[a].useCapture[d]);for(b=e.events[a].noCapture,d=0;d<b;d++)c.push(e.events[a].noCapture[d]);return c},this.listEventHandlers.beacon=this,this.destroy=function(){for(var a in self.events)self.events[a]=null;self.events={}}};c["default"]=e,b.exports=c["default"]},{}],30:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w;Object.defineProperty(c,"__esModule",{value:!0}),f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},g=Object.assign||function(a){var b,c,d;for(b=1;b<arguments.length;b++){c=arguments[b];for(d in c)Object.prototype.hasOwnProperty.call(c,d)&&(a[d]=c[d])}return a},h=function(){function a(a,b){var c,d;for(c=0;c<b.length;c++)d=b[c],d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),i=a("./Beacon"),j=d(i),k=a("../player/Post"),l=d(k),m=a("../player/utils"),n=a("./Manager"),o=d(n),p=a("./Tracker"),q=d(p),r=a("./WaterfallManager"),s=d(r),t=a("./vpaidEvents"),u=d(t),v=0,w=function(){function a(b,c,d){var f,h,i;e(this,a),this.vpaidHandler=c,this.store=d,this.vpaidCount=1,this.version="VPAID-1.0.0",this.VPAIDversion="1.1",this.debugTracker=new q["default"](this.version),this.beacon=new j["default"](this),this.vpaidParameters=this._defaultVpaidParameters,this.config=this._defaultVpaidConfig,f={};for(h in b)f[h.toUpperCase()]=b[h];this.config.creatives=g({},this._defaultVpaidParameters,f),this.manager=!1,this._initWaterfall();for(i in this.vpaidEvents)this.beacon.addEventListener(this.vpaidEvents[i],this._runEventFunction.bind(this));this.debugTracker.event("getVPAIDAd","Vpaid was created successfully!"),this.beacon.dispatchEvent(this.vpaidEvents.AdLoaded,""),this.store.emit("mainVpaidCreated",this.config)}return h(a,[{key:"trigger",value:function b(a,c){this.vpaidHandler.emit(a,c)}},{key:"runWaterfall",value:function c(a){this.waterfallManager.runWaterfall(a)}},{key:"getVpaidReadyCount",value:function d(){return this.manager.getVpaidReadyCount()}},{key:"_initWaterfall",value:function i(){this.waterfallManager=new s["default"](this.store),this.config.creativeData=this._getCreativeData(this.config),this.waterfallManager.init(this.config.creatives,this.config.creativeData.AdParameters),this.waterfallManager.SetWaterfallError(this._waterfallError.bind(this)),this.waterfallManager.SetWaterfallSuccess(this._waterfallSuccess.bind(this));var a=this;this.waterfallManager.SetShouldRun(function(){var b=this.store.get("max_ready_vpaid")||2,c=this.store.get("waterfall_watermark")||0;return!a.manager||a.manager.getVpaidReadyCount()+c<b})}},{key:"_getSlot",value:function k(a){var b=!1;switch("undefined"==typeof a?"undefined":f(a)){case"string":document.getElementById(a)&&(b=document.getElementById(a));break;case"object":a.style&&a.tagName&&(b=a);break;default:this.debugTracker.error("initAd","Bad slot in 'environmentVars'")}return b}},{key:"_getVideoSlot",value:function l(a){var b=!1;switch("undefined"==typeof a?"undefined":f(a)){case"string":document.getElementById(a)&&"video"==document.getElementById(a).tagName.toLowerCase()&&(b=document.getElementById(a));break;case"object":a.style&&a.tagName&&"video"==a.tagName.toLowerCase()&&(b=a);break;default:this.debugTracker.error("initAd","Bad video slot in 'environmentVars' expecting '<video>' tag or its id")}return b}},{key:"_getCreativeData",value:function m(a){var b,c=!1;switch("undefined"==typeof a?"undefined":f(a)){case"object":Object.keys(a).length>0&&(c=!0);break;case"string":if(a.length>0)try{a=new Function("return "+a+";")(),c=!0}catch(d){}}if(c){for(b in this.config.creatives)(void 0==a[b]||this.config.protectedCreatives.indexOf(b)>-1)&&(a[b]=this.config.creatives[b]);a.AdParameters&&(a.AdParameters=this._handleAdParams(a.AdParameters))}return a}},{key:"_handleAdParams",value:function n(a){var b={};switch("undefined"==typeof a?"undefined":f(a)){case"object":Object.keys(a).length>0&&(b=a);break;case"string":if(a.length>0)try{b=new Function("return "+a+";")()}catch(c){}}return b}},{key:"_dataFromUrl",value:function p(a){var b,c,d,e,f=a.replace(/\?\?+/g,"?").replace(/&&+/g,"&").split(/\?(.+)?/gi,2);if(2!=f.length)return this.debugTracker.warn("dataFromUrl","Bad source parameter!"),this.vpaidParameters;b=f[1].split(/\?|&/gi);for(c in b)if(b[c]&&(d=b[c].split(/=(.+)?/gi,2),2==d.length))if(e=d[0].replace(/\-/gi,"_").toUpperCase(),void 0!=this.vpaidParameters[e])switch(e){case"ISVIDEO":case"PLMD":case"MINDUR":case"MAXDUR":case"MINBR":case"MAXBR":case"VPD":case"VPTD":case"RS":case"ST":case"PLAYER_WIDTH":case"PLAYER_HEIGHT":case"PUBID":case"STS":case"MFP":case"ADTO":case"B2B":case"VMT":case"SORTORDERTYPE":case"TAGID":case"VIDLENGTH":case"DEFAULTTAGTIMEOUT":case"TOTALTIMEOUT":this.vpaidParameters[e]=isNaN(parseInt(d[1]))?0:parseInt(d[1]);break;case"MUTED":case"AFBP":case"UFP":case"DEBUG":case"PAUSE_ON_START":switch(d[1]){case"1":case"true":case"TRUE":this.vpaidParameters[e]=!0;break;case"0":case"false":case"FALSE":this.vpaidParameters[e]=!1}break;case"WP":case"SERVICE":case"PV":case"PT":case"SDID":break;default:this.vpaidParameters[e]=d[1]}else this.debugTracker.warn("dataFromUrl","Parameter '"+d[0]+"' is not supported!");return this.vpaidParameters}},{key:"_runEventFunction",value:function r(a){this["on"+a.type]&&this["on"+a.type](a)}},{key:"_waterfallError",value:function t(a){v||(v=!0)}},{key:"_waterfallSuccess",value:function w(a){this.manager&&(this.config.waterfall=a,this.manager.fillSchedule(a))}},{key:"_onManagerStopped",value:function x(){this.beacon.dispatchEvent(this.vpaidEvents.AdStopped)}},{key:"getTime",value:function y(){var a=new Date;return a.getTime()}},{key:"initAd",value:function z(a,b,c,d,e,f){return this.config.inited?void this.debugTracker.warn("initAd","Vpaid is already initiated!"):(this.config.target=this._getSlot(f.slot),this.config.video=this._getVideoSlot(f.videoSlot),void(this.config.video&&this.config.target&&(this.config.videoSlotControls=this.store.get("ad_controls"),this.config.videoSlotCanAutoPlay=!0,this.config.width=parseInt(a),this.config.height=parseInt(b),this.config.bitrate=d,this.config.viewMode=c,this.config.creatives.PLAYER_WIDTH=this.config.width,this.config.creatives.PLAYER_HEIGHT=this.config.height,this.config.creativeData=this._getCreativeData(e),this.config.inited=!0,this.debugTracker.event("initAd","[AdLoaded]-Success"),this.manager||(this.manager=new o["default"](this,this.store)),this.manager.onStop=this._onManagerStopped.bind(this),this.beacon.dispatchEvent(this.vpaidEvents.AdLoaded,""))))}},{key:"subscribe",value:function A(a,b){return this.beacon?void(this.vpaidEvents[b]?this.beacon.addEventListener(b,a):this.debugTracker.warn("subscribe","Unsupported event '"+b+"'")):void this.debugTracker.error("subscribe"," Null ConvertVpaidMain::Beacon ")}},{key:"unsubscribe",value:function B(a,b){if(this.vpaidEvents[b]){if(void 0==a)return;this.beacon.removeEventListener(b,a)}else this.debugTracker.warn("subscribe","Unsupported event '"+b+"'")}},{key:"handshakeVersion",value:function C(a){return this.debugTracker.info("handshakeVersion","handshakeVersion('"+a+"')"),this.VPAIDversion}},{key:"startAd",value:function D(a){this.manager.playFromQueue(a),this.config.started=!0}},{key:"fire99",value:function E(a,b){this.manager&&this.manager.fire99({waterfallTagId:a,dast:b})}},{key:"resizeAd",value:function F(a,b,c){this.config.width=a,this.config.height=b,this.config.viewMode=c,this.manager&&this.manager.resizeAd(a,b,c)}},{key:"stopAd",value:function G(){this.manager?this.manager.stop():this.beacon.dispatchEvent(this.vpaidEvents.AdStopped)}},{key:"setAdVolume",value:function H(a){return a=a>1?a/100:a,!isNaN(parseFloat(a))&&void(this.manager&&this.manager.setAdVolume(a))}},{key:"getAdVolume",value:function I(){return this.manager?this.manager.callWorkingVpaid("getAdVolume",[],0):0}},{key:"getAdLinear",value:function J(){return!this.manager||this.manager.callWorkingVpaid("getAdLinear",[],!0)}},{key:"getAdWidth",value:function K(){return this.manager?this.manager.callWorkingVpaid("getAdWidth",[],this.config.width):this.config.width}},{key:"getAdHeight",value:function L(){return this.manager?this.manager.callWorkingVpaid("getAdHeight",[],this.config.height):this.config.height}},{key:"getAdExpanded",value:function M(){return!this.manager||this.manager.callWorkingVpaid("getAdExpanded",[],!0)}},{key:"getAdSkippableState",value:function N(){return!!this.manager&&this.manager.callWorkingVpaid("getAdSkippableState",[],!1)}},{key:"getAdSkippableRemainingTime",value:function O(){return this.manager?this.manager.callWorkingVpaid("getAdSkippableRemainingTime",[],-1):-1}},{key:"getAdRemainingTime",value:function P(){return this.manager?this.manager.callWorkingVpaid("getAdRemainingTime",[],-1):-1}},{key:"getAdDuration",value:function Q(){return this.manager?this.manager.callWorkingVpaid("getAdDuration",[],-1):-1}},{key:"getAdCompanions",value:function R(){return this.manager?this.manager.callWorkingVpaid("getAdCompanions",[],[]):[]}},{key:"getAdIcons",value:function S(){return this.manager?this.manager.callWorkingVpaid("getAdIcons",[],[]):[]}},{key:"pauseAd",value:function T(){this.manager&&this.manager.callWorkingVpaid("pauseAd",[],!0)}},{key:"resumeAd",value:function U(){this.manager&&this.manager.callWorkingVpaid("resumeAd",[],!0)}},{key:"expandAd",value:function V(){this.manager&&this.manager.callWorkingVpaid("expandAd",[],!0)}},{key:"collapseAd",value:function W(){this.manager&&this.manager.callWorkingVpaid("collapseAd",[],!0)}},{key:"skipAd",value:function X(){this.manager&&this.manager.callWorkingVpaid("skipAd",[],!0)}},{key:"getVpaidLogs",value:function Y(){if(this.manager)return this.manager.getVpaidLogs()}},{key:"getAd",value:function Z(a){if(this.manager)return this.manager.getAd(a)}},{key:"onAdLoaded",value:function $(){}},{key:"onAdStarted",value:function _(){}},{key:"onAdStopped",value:function aa(){}},{key:"onAdSkipped",value:function ba(){}},{key:"onAdSkippableStateChange",value:function ca(){}},{key:"onAdSizeChange",value:function da(){}},{key:"onAdLinearChange",value:function ea(){}},{key:"onAdDurationChange",value:function fa(){}},{key:"onAdExpandedChange",value:function ga(){}},{key:"onAdVolumeChange",value:function ha(){}},{key:"onAdImpression",value:function ia(){}},{key:"onAdVideoStart",value:function ja(){}},{key:"onAdVideoFirstQuartile",value:function ka(){}},{key:"onAdVideoMidpoint",value:function la(){}},{key:"onAdVideoThirdQuartile",value:function ma(){}},{key:"onAdVideoComplete",value:function na(){}},{key:"onAdClickThru",value:function oa(){}},{key:"onAdInteraction",value:function pa(){}},{key:"onAdUserAcceptInvitation",value:function qa(){}},{key:"onAdUserMinimize",value:function ra(){}},{key:"onAdUserClose",value:function sa(){}},{key:"onAdPaused",value:function ta(){}},{key:"onAdPlaying",value:function ua(){}},{key:"onAdLog",value:function va(){}},{key:"onAdError",value:function wa(){}},{key:"onVpaidSpecial",value:function xa(){}},{key:"onSonudViolation",value:function ya(){}},{key:"vpaidEvents",set:function za(a){},get:function Aa(){return u["default"]}},{key:"_defaultVpaidParameters",set:function Ba(a){},get:function Ca(){return{VIEW_MODE:"normal",REFERRER:"",VIDEO_URL:"",DOMAIN:"",PUBID:0,TAGID:0,VPD:0,VPTD:0,AUC_DAST:"",VIDLENGTH:0,KEY_WORDS:"",DESCRIPTION:"",SERVICE:"WhiteLabelBidRequestHandlerServlet",VERTICAL:"",SCHEMA:"vast2-vpaid",TYPE:"application/javascript",PV:this.version,RS:1,ST:1,WP:1,PT:5,CIRF:"",SDID:1,STS:0,CB:"",VOLUME:0,TAG:"",PAGE_URL:"",TIME_STAMP:"",TITLE:"",MFP:4,ISVIDEO:1,PLMD:2,MINDUR:1,MAXDUR:60,MINBR:1,MAXBR:512,AFBP:!1,UFP:!0,ADTO:60,B2B:1,VMT:0,SORTORDERTYPE:0,DEFAULTTAGTIMEOUT:30,OID:"",NOAOP:"",TOTALTIMEOUT:60,CM_DOMAIN:"http://exchange.basebanner.com",OFFSET:0,MODE:"paralel",MUTED:!1,DEBUG:!1,PAUSE_ON_START:!1,PLAYER_WIDTH:0,PLAYER_HEIGHT:0}}},{key:"_defaultVpaidConfig",set:function Da(a){},get:function Ea(){return{waterfall:{},source:this.src,videoSlotCanAutoPlay:!0,videoSlotControls:!1,vpaid_protect_path:!1,running:!1,inited:!1,stopped:!1,started:!1,target:!1,video:!1,bitrate:512,creatives:{},protectedCreatives:["WP","PV","PT","SDID","CM_DOMAIN","SERVICE"]}}}]),a}(),c["default"]=w,b.exports=c["default"]},{"../player/Post":16,"../player/utils":28,"./Beacon":29,"./Manager":37,"./Tracker":44,"./WaterfallManager":50,"./vpaidEvents":60}],31:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var f,g,h,i,j;Object.defineProperty(c,"__esModule",{value:!0}),f=function(){function a(a,b){var c,d;for(c=0;c<b.length;c++)d=b[c],d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g=a("../player/Post"),h=d(g),i="11.0.0",j=function(){function a(b,c,d,f,g){var h,i,j,k,l=this;e(this,a),this.creatives=f,this.store=g,this._useFallback=!1,this.ready=!1,this._destroyed=!1,this.target=c,this._callbackid="301115",this.flashElement=!1,this.flashTimedout=!1,h=this.store.get("flash_cors_url"),i=this.store.get("base_url"),this.flashURL=h||i+"/release-r1/assets/flash_cors5.swf",this._idElf=this._callbackid,this._operations={},this._pendingOperations=[],this.reuqestTimeout=0,j=this.store.get("noflshHiden")||!1,k=document.hidden&&j,d&&!k?this._createContainerIframe(c,b):this._onAgentError(),this.iframeTimeout=setTimeout(function(){l.vpaidLog&&l.vpaidLog.push("flashPostTimeout",{}),l._onAgentError()},2e3),setTimeout(function(){l.destroy()},12e4)}return f(a,[{key:"setVpiadLog",value:function b(a){this.vpaidLog=a}},{key:"_generateID",value:function c(){return this._idElf++,this._idElf}},{key:"_createFlashObject",value:function d(a,b){this.iframe=b,this.iframe.contentWindow["flashCallbackFunction"+this._callbackid]=this._onFlashCallback.bind(this),this.iframe.contentWindow["urlRequestResultSuccess"+this._callbackid]=this._onRequestResultSuccess.bind(this),this.iframe.contentWindow["urlRequestResultError"+this._callbackid]=this._onRequestResultError.bind(this),a.hasFlashPlayerVersion(i)||this._onAgentError();try{var c={wmode:"transparent",salign:"tl",align:"left",allowScriptAccess:"always",scale:"noScale",allowFullScreen:"false",quality:"high",movie:this.flashURL+"?callbackID="+this._callbackid,FlashVars:"flashid=CORS"};this.flashElement=a.createSWF({data:this.flashURL+"?callbackID="+this._callbackid,width:800,height:600},c,this.iframe.contentWindow.document.getElementsByTagName("body")[0]),this.flashElement.style.width="800px",this.flashElement.style.height="600px"}catch(d){this._onAgentError()}}},{key:"_createFlashObjectFaild",value:function g(){this._logToBI("FlashPostCreateFlashFailed",{})}},{key:"_createContainerIframe",value:function j(a,b){var c=document.createElement("iframe");return c.style.cssText="width:800px;height:600px;position:absolute;left:-1800px;top:-1600px;",c.setAttribute("width","800"),c.setAttribute("height","600"),c.setAttribute("frameborder","0"),c.setAttribute("border","0"),c.setAttribute("padding","0"),c.setAttribute("scrolling","no"),c.setAttribute("marginwidth","0"),c.setAttribute("marginheight","0"),a.appendChild(c),c.onload=this._createFlashObject.bind(this,b,c),c.onerror=this._createFlashObjectFaild.bind(this),c.contentWindow.document.open(),c.contentWindow.document.write("<html><head></head><body></body></html>"),c.contentWindow.document.close(),c}},{key:"_onFlashCallback",value:function k(){this._logToBI("FlashPostFlashCallback",{}),this.ready||(this.ready=!0,this._onReady())}},{key:"_onRequestResultSuccess",value:function l(a,b){if(this._logToBI("FlashPostFlashSuccess",{}),clearTimeout(this.reuqestTimeout),this._operations[a]&&!this.flashTimedout){if(this._operations[a].finished)return;this.vpaidLog.push("vastFecthSuccess",{}),this._operations[a].callback(b),this._operations[a].finished=!0}}},{key:"_onRequestResultError",value:function m(a){if(this._logToBI("FlashPostFlashError",{}),clearTimeout(this.reuqestTimeout),this._operations[a]){if(this._operations[a].finished)return;this.vpaidLog.push("vastFecthError",{}),this._xhrFallback(this._operations[a]),this._operations[a].finished=!0}}},{key:"send",value:function n(a,b,c){var d,e,f;if(!this.ready)return void this._pendingOperations.push({url:a,callback:b,fallback:c});if(d=this,this._useFallback)return this.vpaidLog.push("fetchVastXhr",{url:a}),void(0,h["default"])(a,"",b,c,!0,!0,1e4);e="request"+this._generateID(),this._operations[e]={callback:b,fallback:c,url:a};try{this.vpaidLog.push("fetchVastFlash",{url:a}),this.flashElement["requestData"+this._callbackid](a,e),f=this.store.get("fptmout")||5e3,this.reuqestTimeout=setTimeout(this._onFlashTimeout.bind(this),f,e,a)}catch(g){d._xhrFallback(this._operations[e])}}},{key:"_onFlashTimeout",value:function o(a,b){this.flashTimedout=!0,this._operations&&this._operations[a]&&!this._operations[a].finished&&(this.vpaidLog.push("fetchVastFallToXhr",{url:b}),this._xhrFallback(this._operations[a]))}},{key:"_xhrFallback",value:function p(a){this._logToBI("FlashPostXhrFallback",{}),clearTimeout(this.reuqestTimeout),(0,h["default"])(a.url,"",function(b){a.callback(b)},function(b){a.fallback(b)},!0,!0,1e4)}},{key:"destroy",value:function q(){this._destroyed=!0,clearTimeout(this.iframeTimeout),this.flashElement&&(this.flashElement["stopLoaders"+this._callbackid]&&this.flashElement["stopLoaders"+this._callbackid](),this.flashElement.parentNode.removeChild(this.flashElement)),this.iframe&&this.iframe.contentWindow&&(this.iframe.contentWindow["flashCallbackFunction"+this._callbackid]=function(){},this.iframe.contentWindow["urlRequestResultSuccess"+this._callbackid]=function(){},this.iframe.contentWindow["urlRequestResultError"+this._callbackid]=function(){}),this._operations={},this._pendingOperations=[],this.flashElement=void 0,this.iframe&&this.iframe.parentNode.removeChild(this.iframe),this.iframe=void 0,this.vpaidLog=void 0,this.store=null}},{key:"_onAgentError",value:function r(){this.ready||(this.vpaidLog&&this.vpaidLog.push("flashPostAError",{}),this.ready=!0,this._useFallback=!0,this.iframe&&this.iframe.contentWindow&&(this.iframe.contentWindow["flashCallbackFunction"+this._callbackid]=function(){},this.iframe.contentWindow["urlRequestResultSuccess"+this._callbackid]=function(){},this.iframe.contentWindow["urlRequestResultError"+this._callbackid]=function(){}),this.flashElement&&this.flashElement.parentNode.removeChild(this.flashElement),this.flashElement=void 0,this.iframe&&this.iframe.parentNode.removeChild(this.iframe),this.iframe=void 0,this._onReady())}},{key:"_onReady",value:function s(){var a,b,c;for(clearTimeout(this.iframeTimeout),this.iframe&&(this.iframe.style.height="1px",this.iframe.style.width="1px",this.iframe.setAttribute("height","1"),this.iframe.setAttribute("width","1")),this.flashElement&&(this.flashElement.style.height="1px",this.flashElement.style.width="1px",this.flashElement.setAttribute("height","1"),this.flashElement.setAttribute("width","1")),a=this._pendingOperations.length,b=0;b<a;b++)c=this._pendingOperations[b],this.send(c.url,c.callback,c.fallback);this._pendingOperations=[]}},{key:"_logToBI",value:function t(a,b){this.vpaidLog&&this.vpaidLog.push(a,b)}}]),a}(),c["default"]=j,b.exports=c["default"]},{"../player/Post":16}],32:[function(a,b,c){"use strict";function d(a){var b,c;if(a&&a.__esModule)return a;if(b={},null!=a)for(c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b["default"]=a,b}function e(a){return a&&a.__esModule?a:{"default":a}}function f(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var g,h,i,j,k,l,m,n,o;Object.defineProperty(c,"__esModule",{value:!0}),g=Object.assign||function(a){var b,c,d;for(b=1;b<arguments.length;b++){c=arguments[b];for(d in c)Object.prototype.hasOwnProperty.call(c,d)&&(a[d]=c[d])}return a},h=function(){function a(a,b){var c,d;for(c=0;c<b.length;c++)d=b[c],d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),i=a("./Tracker"),j=e(i),k=a("../player/utils"),l=d(k),m=a("./vpaidEvents"),n=e(m),o=function(){function a(b,c,d){var e,h;f(this,a),this.vpaidLog=c,this.store=d,this.type="vpaid",this.stopped=!1,this.version="1.1",this.applyBypass=b.applyBypass,this.creatives=b.creatives,this.target=b.slot,this.video=b.videoSlot,this.mediaFiles=b.vpaidFiles,this.mediaUrl,this.videoSlotControls=b.videoSlotControls,this.videoSlotCanAutoPlay=b.videoSlotCanAutoPlay,this.debugTracker=new j["default"]("FlashVpaid"),e=this.store.get("prtct"),this.baseUrl=this.store.get("base_url"),this._VpaidProtection=this.baseUrl+e,h=this.store.get("flash_wrapper"),this._FlashWrapper=h||this.baseUrl+"/release-r1/assets/Player.novast.swf",this._onReady=b.onReady,this._onError=b.onError,this._registeredEvents=[],this.vpaidEvents=g({},n["default"]),this.iframe=this._createIframe(),this.VPAID={},this._internalStopType="none",this.isStarted=!1,this.inited=!1,this.paused=!1}return h(a,[{key:"_createIframe",value:function b(){var a,b,c;if(!this.stopped)return a=document.createElement("iframe"),a.style.cssText="width:800px;height:600px;",a.setAttribute("width",800),a.setAttribute("height",600),a.setAttribute("frameborder","0"),a.setAttribute("border","0"),a.setAttribute("padding","0"),a.setAttribute("scrolling","no"),a.setAttribute("marginwidth","0"),a.setAttribute("marginheight","0"),this.applyBypass&&(a.style.left="-800px",a.style.top="-600px"),a.style.position="absolute",this.target.parentNode?this.target.appendChild(a):(this.debugTracker.warn("wrapper","Target is not connected to DOM,using own body instead"),b=document.getElementsByTagName("body")[0]||document.getElementsByTagName("div")[0],b.appendChild(a)),a.onload=this._onIframeLoaded.bind(this,a),a.contentWindow.document.open(),a.contentWindow.document.write("<html><head></head><body><div id='_cm_FlashContainer' style='position:absolute;top:0;right:0;bottom:0;left:0;display:block;visibility:visible;float:left;' ></div>"+(this._VpaidProtection?"<script type='text/javascript' src='"+this._VpaidProtection+"'></script>":"")+"<script type='text/javascript' src='"+this.baseUrl+"/release-r1/assets/swfobject.js'></script><script type='text/javascript' src='"+this.baseUrl+"/release-r1/assets/VpaidClientFlash.js'></script></body></html>"),a.contentWindow.document.close(),c=this.store.get("debug"),c||(a.contentWindow.onerror=function(){return!0},l._suppressConsoleMethods(a.contentWindow.console)),a}},{key:"_onIframeLoaded",value:function c(a){if(!this.stopped){var b=a.contentWindow;b.ReportHijackAttempt=this._onHijackAttempt,b.VPAIDFLASHClient||l.reportDb("noVPAIDFLASHClient",{noVPAIDFLASHClient:!0}),b.flashLoader=new b.VPAIDFLASHClient(b.document.getElementById("_cm_FlashContainer"),this._onFlashLoaderReady.bind(this),b.swfobject,{data:this._FlashWrapper,width:800,height:600})}}},{key:"_onFlashLoaderReady",value:function d(a,b){this.stopped||(a?this._onError(a,"FlashLoaderTimedOut"):(this.mediaUrl=this.mediaFiles[0].url,this.iframe.contentWindow.flashLoader.loadAdUnit(this.mediaUrl,this._onVpaidUnitLoaded.bind(this))))}},{key:"_onVpaidUnitLoaded",value:function e(a,b){this.stopped||(a?this._onError(a,"adUnitLoadFailed"):(this.VPAID=b,this.VPAID.on(this.vpaidEvents.AdError,this._internalHandleError.bind(this)),this.VPAID.on(this.vpaidEvents.AdStopped,this._internalHandleStop.bind(this)),this._registeredEvents.push({event:this.vpaidEvents.AdError,func:this._internalHandleError.bind(this)}),this._registeredEvents.push({event:this.vpaidEvents.AdStopped,func:this._internalHandleStop.bind(this)}),this._onReady()))}},{key:"_internalHandleError",value:function i(a){var b,c="";for(b in a)c+="&"+a[b];c&&this.vpaidLog&&this.vpaidLog.push("AdErrorDetails",{err:c,isStarted:this.isStarted,inited:this.inited,paused:this.paused}),this._internalStopType="error",this.stopAd(!0)}},{key:"_internalHandleStop",value:function k(){this._internalStopType="stop",this.stopAd(!0)}},{key:"_safeCall",value:function m(a,b){if(!this.stopped){this.debugTracker.info("Calling-< "+a+" >",b.toString());try{return this.VPAID[a].apply(this.VPAID,b)}catch(c){return!1}}}},{key:"handshakeVersion",value:function o(a){return this._safeCall("handshakeVersion",[a])}},{key:"resizeAd",value:function p(a,b,c){parseInt(a)&&parseInt(b)&&(this._PlayerWidth=parseInt(a),this._PlayerHeight=parseInt(b),this.target.style.width=this._PlayerWidth+"px",this.target.style.height=this._PlayerHeight+"px",this.target.setAttribute("width",this._PlayerWidth),this.target.setAttribute("height",this._PlayerHeight),this._safeCall("resizeAd",[this._PlayerWidth,this._PlayerHeight,c]),this.iframe&&(a=a>800?a:800,b=b>600?b:600,this.iframe.style.width=a+"px",this.iframe.style.height=b+"px",this.iframe.setAttribute("width",a),this.iframe.setAttribute("height",b)))}},{key:"initAd",value:function q(a,b,c,d,e,f){this.iframe.style.top="0",this.iframe.style.left="0",this.iframe.style.position="",this.iframe.style.height="0",this.iframe.style.overflow="none",this.inited=!0,this._safeCall("initAd",[a,b,c,d,e,f])}},{key:"_cleanIframeInternal",value:function r(a){for(a&&a._cm_watcher&&a._cm_watcher.stop&&a._cm_watcher.stop();a&&a.document&&a.document.childNodes&&a.document.childNodes.length;)this._removeElements(a.document.childNodes[0])}},{key:"_removeElements",value:function s(a){for(;a.childNodes&&a.childNodes.length;)this._removeElements(a.childNodes[0]);a.parentNode.removeChild(a)}},{key:"_removeAllEvents",value:function t(){var a,b;for(a=0;a<this._registeredEvents.length;a++)b=this._registeredEvents[a],this.VPAID.off(b.event,b.func);this.VPAID=void 0,this._registeredEvents=[]}},{key:"stopAd",value:function u(a){return this.stopped?void window.setTimeout(this.onAfterStop,25):(a||this._safeCall("stopAd",[]),this.stopped=!0,this._removeAllEvents(),this.iframe&&this.iframe.contentWindow&&(this.iframe.contentWindow.ReportHijackAttempt=void 0,this.iframe.contentWindow.flashLoader&&(this.iframe.contentWindow.flashLoader.destroy(),this.iframe.contentWindow.flashLoader=null),this._cleanIframeInternal(this.iframe.contentWindow)),void window.setTimeout(this._stopAdStep1.bind(this),0))}},{key:"_stopAdStep1",value:function v(){switch(this.iframe&&this.iframe.parentNode.removeChild(this.iframe),this.iframe=void 0,this._internalStopType){case"error":window.setTimeout(this._onAdError,0);break;case"stop":window.setTimeout(this._onAdVideoComplete,0),window.setTimeout(this._onAdStopped,0)}window.setTimeout(this.onAfterStop,0),this.vpaidLog=null,this.target=this.video=this.mediaFiles=this.debugTracker=this._onReady=this.store=this._onError=this.vpaidEvents=this.VPAID=void 0}},{key:"pauseAd",value:function w(){this.paused=!0,this._safeCall("pauseAd",[])}},{key:"resumeAd",value:function x(){this._safeCall("resumeAd",[])}},{key:"skipAd",value:function y(){this._safeCall("skipAd",[])}},{key:"startAd",value:function z(){var a,b=this;return this.isStarted&&this.vpaidLog?(this.vpaidLog.push("doubleStart",{ds:1}),void setTimeout(function(){b.stopAd()},200)):(this.isStarted=!0,this.iframe.style.height="600px",a=this.store.get("untflshblktim"),a>0&&this.subscribe(function(){var c=parseInt(b.iframe.style.top);b.iframe.style.top=c+1+"px",setTimeout(function(){b.iframe.style.top=c+"px"},a)},this.vpaidEvents.AdVideoStart),void this._safeCall("startAd",[]));
}},{key:"expandAd",value:function A(){this._safeCall("expandAd",[])}},{key:"collapseAd",value:function B(){this._safeCall("collapseAd",[])}},{key:"setAdVolume",value:function C(a){this._safeCall("setAdVolume",[a])}},{key:"getAdWidth",value:function D(){return this._safeCall("getAdWidth",[])}},{key:"getAdHeight",value:function E(){return this._safeCall("getAdWidth",[])}},{key:"getAdSkippableRemainingTime",value:function F(){return this._safeCall("getAdSkippableRemainingTime",[])}},{key:"getAdRemainingTime",value:function G(){return this._safeCall("getAdRemainingTime",[])}},{key:"getAdDuration",value:function H(){return this._safeCall("getAdDuration",[])}},{key:"getAdSkippableState",value:function I(){return this._safeCall("getAdSkippableState",[])}},{key:"getAdVolume",value:function J(){return this._safeCall("getAdVolume",[])}},{key:"getAdIcons",value:function K(){return this._safeCall("getAdIcons",[])}},{key:"getAdCompanions",value:function L(){return this._safeCall("getAdCompanions",[])}},{key:"getAdExpanded",value:function M(){return this._safeCall("getAdExpanded",[])}},{key:"getAdLinear",value:function N(){return this._safeCall("getAdLinear",[])}},{key:"getDOMContainer",value:function O(){return this.target}},{key:"subscribe",value:function P(a,b){if(!this.stopped)if(this.vpaidEvents[b])switch(b){case this.vpaidEvents.AdError:this._onAdError=a;break;case this.vpaidEvents.AdStopped:this._onAdStopped=a;break;case this.vpaidEvents.AdVideoComplete:this._onAdVideoComplete=a;break;default:this._registeredEvents.push({event:b,func:a}),this.VPAID.on(b,a)}else this.debugTracker.warn("subscribe","Unsupported event '"+b+"'")}},{key:"unsubscribe",value:function Q(a,b){if(!this.stopped)if(this.vpaidEvents[b]){if(void 0==a)return;this.VPAID.off(b,a)}else this.debugTracker.warn("unsubscribe","Unsupported event '"+b+"'")}},{key:"onAfterStop",value:function R(){}},{key:"_onAdVideoComplete",value:function S(){}},{key:"_onAdError",value:function T(){}},{key:"_onAdStopped",value:function U(){}},{key:"_onHijackAttempt",value:function V(){var a="";"string"==typeof event&&(a=event),l.reportDb("hijackAttempt",{hijackAttempt:a}),this.stopAd()}},{key:"_getMediaUrl",value:function W(){return this.mediaUrl}}]),a}(),c["default"]=o,b.exports=c["default"]},{"../player/utils":28,"./Tracker":44,"./vpaidEvents":60}],33:[function(a,b,c){"use strict";function d(a){var b,c;if(a&&a.__esModule)return a;if(b={},null!=a)for(c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b["default"]=a,b}function e(a){return a&&a.__esModule?a:{"default":a}}function f(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var g,h,i,j,k,l,m,n,o,p;Object.defineProperty(c,"__esModule",{value:!0}),g=Object.assign||function(a){var b,c,d;for(b=1;b<arguments.length;b++){c=arguments[b];for(d in c)Object.prototype.hasOwnProperty.call(c,d)&&(a[d]=c[d])}return a},h=function(){function a(a,b){var c,d;for(c=0;c<b.length;c++)d=b[c],d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),i=a("./Tracker"),j=e(i),k=a("../player/utils"),l=d(k),m=a("./vpaidEvents"),n=e(m),o=1,p=function(){function a(b,c,d){var e,h;f(this,a),this.store=d,this.type="vpaid",this.stopped=!1,this.version="1.1",this.applyBypass=b.applyBypass,this.creatives=b.creatives,this.target=b.slot,this.video=b.videoSlot,this.mediaFiles=b.vpaidFiles,this.mediaUrl,this.videoSlotControls=b.videoSlotControls,this.videoSlotCanAutoPlay=b.videoSlotCanAutoPlay,this.debugTracker=new j["default"]("FlashVpaid"),e=this.store.get("prtct"),this.baseUrl=this.store.get("base_url"),this._VpaidProtection=this.baseUrl+e,h=this.store.get("flash_wrapper"),this._FlashWrapper=h||this.baseUrl+"/release-r1/assets/Player.novast.swf",this._onReady=b.onReady,this._onError=b.onError,this._registeredEvents=[],this.vpaidEvents=g({},n["default"]),this.VPAID={},this._internalStopType="none",this.isStarted=!1,this.inited=!1,this.paused=!1,this.vpaidLog=c,this.domWrapper=this._createWrapper(this._hostReady.bind(this))}return h(a,[{key:"_createWrapper",value:function b(a){var b=this.store.get("flshinifrm");return this.isInIframe=b,b?this._createIframeHost():this._buildDivHost(a)}},{key:"_createIframeHost",value:function c(){var a,b,c,d;if(!this.stopped)return a=document.createElement("iframe"),a.style.cssText="width:800px;height:600px;",a.setAttribute("width",800),a.setAttribute("height",600),a.setAttribute("frameborder","0"),a.setAttribute("border","0"),a.setAttribute("padding","0"),a.setAttribute("scrolling","no"),a.setAttribute("marginwidth","0"),a.setAttribute("marginheight","0"),this.applyBypass&&(a.style.left="-800px",a.style.top="-600px"),a.style.position="absolute",this.target.parentNode?this.target.appendChild(a):(this.debugTracker.warn("wrapper","Target is not connected to DOM,using own body instead"),b=document.getElementsByTagName("body")[0]||document.getElementsByTagName("div")[0],b.appendChild(a)),a.onload=this._hostReady.bind(this),a.contentWindow.document.open(),a.contentWindow.document.write("<html><head></head><body><div id='_cm_FlashContainer' style='position:absolute;top:0;right:0;bottom:0;left:0;display:block;visibility:visible;float:left;' ></div>"+(this._VpaidProtection?"<script type='text/javascript' src='"+this._VpaidProtection+"'></script>":"")+"<script type='text/javascript' src='"+this.baseUrl+"/release-r1/assets/swfobject.js'></script><script type='text/javascript' src='"+this.baseUrl+"/release-r1/assets/VpaidClientFlash.js'></script></body></html>"),a.contentWindow.document.close(),c=this.store.get("dlgverr")||!1,c&&(d=this.store.get("debug"),d||(a.contentWindow.onerror=function(){return!0},l._suppressConsoleMethods(a.contentWindow.console))),a}},{key:"_getScript",value:function d(a,b,c){if(document.getElementById(b))return void setTimeout(function(){c&&c()},200);var d=document.createElement("script"),e=document.getElementsByTagName("script")[0];d.src=a,d.id=b,e.parentNode.insertBefore(d,e),d.onload=function(){c&&c()}}},{key:"_generateId",value:function e(){this.soltId="_cm_FlashContainer"+o++}},{key:"_buildDivHost",value:function i(a){var b=document.createElement("div");return this._generateId(),b.id=this.soltId,this.applyBypass&&(b.style.position="absolute",b.style.left="-800px",b.style.top="-600px"),this.target.appendChild(b),this._getScript(this.baseUrl+"/release-r1/assets/swfobject.js","cm_swf"),this._getScript(this.baseUrl+"/release-r1/assets/VpaidClientFlash.js","vpaidclientflash",a),b}},{key:"_hostReady",value:function k(){var a,b;this.stopped||(a=this.isInIframe?this.domWrapper.contentWindow:window,b=this.isInIframe?"_cm_FlashContainer":this.soltId,a.ReportHijackAttempt=this._onHijackAttempt,a.VPAIDFLASHClient||l.reportDb("noVPAIDFLASHClient",{noVPAIDFLASHClient:!0}),a.flashLoader=new a.VPAIDFLASHClient(a.document.getElementById(b),this._onFlashLoaderReady.bind(this),a.swfobject,{data:this._FlashWrapper,width:800,height:600}),this.flashLoader=a.flashLoader)}},{key:"_onFlashLoaderReady",value:function m(a,b){this.stopped||(a?this._onError(a):(this.mediaUrl=this.mediaFiles[0].url,this.flashLoader.loadAdUnit(this.mediaUrl,this._onVpaidUnitLoaded.bind(this))))}},{key:"_onVpaidUnitLoaded",value:function p(a,b){this.stopped||(a?this._onError(a):(this.VPAID=b,this.VPAID.on(this.vpaidEvents.AdError,this._internalHandleError.bind(this)),this.VPAID.on(this.vpaidEvents.AdStopped,this._internalHandleStop.bind(this)),this._registeredEvents.push({event:this.vpaidEvents.AdError,func:this._internalHandleError.bind(this)}),this._registeredEvents.push({event:this.vpaidEvents.AdStopped,func:this._internalHandleStop.bind(this)}),this._onReady()))}},{key:"_internalHandleError",value:function q(a){var b,c="";for(b in a)c+="&"+a[b];c&&this.vpaidLog&&this.vpaidLog.push("AdErrorDetails",{err:c,isStarted:this.isStarted,inited:this.inited,paused:this.paused}),this._internalStopType="error",this.stopAd(!0)}},{key:"_internalHandleStop",value:function r(){this._internalStopType="stop",this.stopAd(!0)}},{key:"_safeCall",value:function s(a,b){if(!this.stopped){this.debugTracker.info("Calling-< "+a+" >",b.toString());try{return this.VPAID[a].apply(this.VPAID,b)}catch(c){return!1}}}},{key:"handshakeVersion",value:function t(a){return this._safeCall("handshakeVersion",[a])}},{key:"resizeAd",value:function u(a,b,c){parseInt(a)&&parseInt(b)&&(this._PlayerWidth=parseInt(a),this._PlayerHeight=parseInt(b),this.target.style.width=this._PlayerWidth+"px",this.target.style.height=this._PlayerHeight+"px",this.target.setAttribute("width",this._PlayerWidth),this.target.setAttribute("height",this._PlayerHeight),this._safeCall("resizeAd",[this._PlayerWidth,this._PlayerHeight,c]))}},{key:"initAd",value:function v(a,b,c,d,e,f){this.domWrapper.style.top="0",this.domWrapper.style.left="0",this.domWrapper.style.position="",this.domWrapper.style.height="0",this.domWrapper.style.overflow="none",this.domWrapper.inited=!0,this._safeCall("initAd",[a,b,c,d,e,f])}},{key:"_cleanIframeInternal",value:function w(a){for(a&&a._cm_watcher&&a._cm_watcher.stop&&a._cm_watcher.stop();a&&a.document&&a.document.childNodes&&a.document.childNodes.length;)this._removeElements(a.document.childNodes[0])}},{key:"_removeElements",value:function x(a){for(;a.childNodes&&a.childNodes.length;)this._removeElements(a.childNodes[0]);a.parentNode.removeChild(a)}},{key:"_removeAllEvents",value:function y(){var a,b;for(a=0;a<this._registeredEvents.length;a++)b=this._registeredEvents[a],this.VPAID.off(b.event,b.func);this.VPAID=void 0,this._registeredEvents=[]}},{key:"stopAd",value:function z(a){return this.stopped?void window.setTimeout(this.onAfterStop,25):(a||this._safeCall("stopAd",[]),this.stopped=!0,this._removeAllEvents(),this.domWrapper&&this.domWrapper.contentWindow?(this.domWrapper.contentWindow.ReportHijackAttempt=void 0,this.domWrapper.contentWindow.flashLoader&&(this.domWrapper.contentWindow.flashLoader.destroy(),this.domWrapper.contentWindow.flashLoader=null),this._cleanIframeInternal(this.domWrapper.contentWindow)):(this.flashLoader.destroy(),this.flashLoader=null),void window.setTimeout(this._stopAdStep1.bind(this),0))}},{key:"_stopAdStep1",value:function A(){switch(this.domWrapper&&this.domWrapper.parentNode.removeChild(this.domWrapper),this.domWrapper=void 0,this._internalStopType){case"error":window.setTimeout(this._onAdError,0);break;case"stop":window.setTimeout(this._onAdVideoComplete,0),window.setTimeout(this._onAdStopped,0)}window.setTimeout(this.onAfterStop,0),this.vpaidLog=null,this.target=this.video=this.mediaFiles=this.debugTracker=this._onReady=this._onError=this.vpaidEvents=this.VPAID=void 0}},{key:"pauseAd",value:function B(){this.paused=!0,this._safeCall("pauseAd",[])}},{key:"resumeAd",value:function C(){this._safeCall("resumeAd",[])}},{key:"skipAd",value:function D(){this._safeCall("skipAd",[])}},{key:"startAd",value:function E(){var a=this;return this.isStarted&&this.vpaidLog?(this.vpaidLog.push("doubleStart",{ds:1}),void setTimeout(function(){a.stopAd()},200)):(this.domWrapper.isStarted=!0,this.domWrapper.style.height="600px",this.domWrapper.style.position="absolute",this.domWrapper.style.zIndex=1e3,void this._safeCall("startAd",[]))}},{key:"expandAd",value:function F(){this._safeCall("expandAd",[])}},{key:"collapseAd",value:function G(){this._safeCall("collapseAd",[])}},{key:"setAdVolume",value:function H(a){this._safeCall("setAdVolume",[a])}},{key:"getAdWidth",value:function I(){return this._safeCall("getAdWidth",[])}},{key:"getAdHeight",value:function J(){return this._safeCall("getAdWidth",[])}},{key:"getAdSkippableRemainingTime",value:function K(){return this._safeCall("getAdSkippableRemainingTime",[])}},{key:"getAdRemainingTime",value:function L(){return this._safeCall("getAdRemainingTime",[])}},{key:"getAdDuration",value:function M(){return this._safeCall("getAdDuration",[])}},{key:"getAdSkippableState",value:function N(){return this._safeCall("getAdSkippableState",[])}},{key:"getAdVolume",value:function O(){return this._safeCall("getAdVolume",[])}},{key:"getAdIcons",value:function P(){return this._safeCall("getAdIcons",[])}},{key:"getAdCompanions",value:function Q(){return this._safeCall("getAdCompanions",[])}},{key:"getAdExpanded",value:function R(){return this._safeCall("getAdExpanded",[])}},{key:"getAdLinear",value:function S(){return this._safeCall("getAdLinear",[])}},{key:"subscribe",value:function T(a,b){if(!this.stopped)if(this.vpaidEvents[b])switch(b){case this.vpaidEvents.AdError:this._onAdError=a;break;case this.vpaidEvents.AdStopped:this._onAdStopped=a;break;case this.vpaidEvents.AdVideoComplete:this._onAdVideoComplete=a;break;default:this._registeredEvents.push({event:b,func:a}),this.VPAID.on(b,a)}else this.debugTracker.warn("subscribe","Unsupported event '"+b+"'")}},{key:"unsubscribe",value:function U(a,b){if(!this.stopped)if(this.vpaidEvents[b]){if(void 0==a)return;this.VPAID.off(b,a)}else this.debugTracker.warn("unsubscribe","Unsupported event '"+b+"'")}},{key:"onAfterStop",value:function V(){}},{key:"_onAdVideoComplete",value:function W(){}},{key:"_onAdError",value:function X(){}},{key:"_onAdStopped",value:function Y(){}},{key:"_onHijackAttempt",value:function Z(){var a="";"string"==typeof event&&(a=event),l.reportDb("hijackAttempt",{hijackAttempt:a}),this.stopAd()}},{key:"_getMediaUrl",value:function $(){return this.mediaUrl}}]),a}(),c["default"]=p,b.exports=c["default"]},{"../player/utils":28,"./Tracker":44,"./vpaidEvents":60}],34:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function f(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var g,h,i,j,k,l,m;Object.defineProperty(c,"__esModule",{value:!0}),g=Object.assign||function(a){var b,c,d;for(b=1;b<arguments.length;b++){c=arguments[b];for(d in c)Object.prototype.hasOwnProperty.call(c,d)&&(a[d]=c[d])}return a},h=function(){function a(a,b){var c,d;for(c=0;c<b.length;c++)d=b[c],d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),i=a("./Tracker"),j=d(i),k=a("./vpaidEvents"),l=d(k),m=function(){function a(b,c,d){f(this,a),this.vpaidLog=c,this.store=d,this.type="vpaid",this.stopped=!1,this.version="1.1",this.target=b.slot,this.video=b.videoSlot,this.mediaFiles=b.vpaidFiles,this.videoSlotControls=b.videoSlotControls,this.videoSlotCanAutoPlay=b.videoSlotCanAutoPlay,this.debugTracker=new j["default"]("JsVpaid");var e=this.store.get("prtct");this.baseUrl=this.store.get("base_url"),this._VpaidProtection=this.baseUrl+e,this._onReady=b.onReady,this._onError=b.onError,this.vpaidEvents=g({},l["default"]),this.iframe=this._createIframe(),this.VPAID={},this.mediaUrl}return h(a,[{key:"_onIframeWindowError",value:function b(a){this.debugTracker.warn("IframeError",a);var b=this.store.get("debug");return!b}},{key:"_createIframe",value:function c(){var a,b;if(this.debugTracker.info("Loading","Creating iframe"),!this.stopped)return a=document.createElement("iframe"),a.style.display="none",this.target.parentNode?this.target.appendChild(a):(this.debugTracker.warn("wrapper","Target is not connected to DOM,using own body instead"),b=document.getElementsByTagName("body")[0]||document.getElementsByTagName("div")[0],b.appendChild(a)),a.onload=this._onIframeLoaded.bind(this,a),a.contentWindow.document.open(),a.contentWindow.document.write("<html><head>"+(this._VpaidProtection?"<script type='text/javascript' src='"+this._VpaidProtection+"'></script>":"")+"</head><body></body></html>"),a.contentWindow.document.close(),a}},{key:"_onIframeLoaded",value:function d(a,b){var c,d,e;this.stopped||(this.debugTracker.info("Loading","Iframe was loaded!"),c=a.contentWindow,c.ReportHijackAttempt=this._onHijackAttempt,d=this.store.get("dlgverr")||!1,d&&(c.onerror=this._onIframeWindowError.bind(this)),e=c.document.createElement("script"),e.onerror=this._onVpaidLoadError.bind(this),this.mediaUrl=this.mediaFiles[0].url,e.src=this.mediaUrl,e.onload=this._onVpaidLoadSuccess.bind(this,a),c.document.body.appendChild(e))}},{key:"_onVpaidLoadError",value:function i(a){this.debugTracker.error("ErrorLoadingVpaid",a),this.stopped||this._onError(this,a)}},{key:"_onVpaidLoadSuccess",value:function k(a,b){if(!this.stopped){this.debugTracker.info("Loading","Vpaid script was loaded!");try{var c=a.contentWindow;this.VPAID=c.getVPAIDAd(),this._onReady(this)}catch(d){this.vpaidLog.push("initJsError",{err:e.message}),this._onVpaidLoadError(d)}}}},{key:"_safeCall",value:function m(a,b,c){if(!this.stopped){!c&&this.debugTracker&&this.debugTracker.info("Calling-< "+a+" >",b);try{return this.VPAID[a].apply(this.VPAID,b)}catch(d){return this.vpaidLog&&this.vpaidLog.push("jsCallError",{err:d.message}),this._onAdError(d),!1}}}},{key:"restartAd",value:function n(){this.video.currentTime=0,this.video.play()}},{key:"handshakeVersion",value:function o(a){return this._safeCall("handshakeVersion",[a])}},{key:"resizeAd",value:function p(a,b,c){this.target.style.width=a+"px",this.target.style.height=b+"px",this.target.setAttribute("width",a),this.target.setAttribute("height",b),this._safeCall("resizeAd",[a,b,c])}},{key:"initAd",value:function q(a,b,c,d,e,f){this._safeCall("initAd",[a,b,c,d,e,f])}},{key:"stopAd",value:function r(){this._safeCall("stopAd",[]),window.setTimeout(this._stopAd.bind(this),1)}},{key:"_stopAd",value:function s(){this.stopped||(this.iframe&&this.iframe.parentNode.removeChild(this.iframe),this.iframe=this.VPAID=this.mediaFiles=this.video=this.vpaidEvents=this.target=this.debugTracker=void 0,this.vpaidLog=null,this.stopped=!0,this.onAfterStop())}},{key:"pauseAd",value:function t(){this._safeCall("pauseAd",[])}},{key:"resumeAd",value:function u(){this._safeCall("resumeAd",[])}},{key:"skipAd",value:function v(){this._safeCall("skipAd",[])}},{key:"startAd",value:function w(){this._safeCall("startAd",[])}},{key:"expandAd",value:function x(){this._safeCall("expandAd",[])}},{key:"collapseAd",value:function y(){this._safeCall("collapseAd",[])}},{key:"setAdVolume",value:function z(a){this._safeCall("setAdVolume",[a])}},{key:"getAdWidth",value:function A(){return this._safeCall("getAdWidth",[])}},{key:"getAdHeight",value:function B(){return this._safeCall("getAdWidth",[])}},{key:"getAdSkippableRemainingTime",value:function C(){return this._safeCall("getAdSkippableRemainingTime",[])}},{key:"getAdRemainingTime",value:function D(){return this._safeCall("getAdRemainingTime",[])}},{key:"getAdDuration",value:function E(){return this._safeCall("getAdDuration",[])}},{key:"getAdSkippableState",value:function F(){return this._safeCall("getAdSkippableState",[])}},{key:"getAdVolume",value:function G(){return this._safeCall("getAdVolume",[])}},{key:"getAdIcons",value:function H(){return this._safeCall("getAdIcons",[])}},{key:"getAdCompanions",value:function I(){return this._safeCall("getAdCompanions",[])}},{key:"getAdExpanded",value:function J(){return this._safeCall("getAdExpanded",[])}},{key:"getAdLinear",value:function K(){return this._safeCall("getAdLinear",[])}},{key:"subscribe",value:function L(a,b){this.vpaidEvents[b]?(b==this.vpaidEvents.AdError&&(this._onAdError=a),b==this.vpaidEvents.HijackAttempt?this._onHijackAttempt=a:this._safeCall("subscribe",[a,b],!0)):this.debugTracker.warn("subscribe","Unsupported event '"+b+"'")}},{key:"unsubscribe",value:function M(a,b){if(this.vpaidEvents[b]){if(void 0==a)return;this._safeCall("unsubscribe",[a,b],!0)}else this.debugTracker.warn("unsubscribe","Unsupported event '"+b+"'")}},{key:"onAfterStop",value:function N(){}},{key:"_onAdError",value:function O(){}},{key:"_onHijackAttempt",value:function P(){}},{key:"_getMediaUrl",value:function Q(){return this.mediaUrl}}]),a}(),c["default"]=m,b.exports=c["default"]},{"./Tracker":44,"./vpaidEvents":60}],35:[function(a,b,c){"use strict";function d(a){var b,c;if(a&&a.__esModule)return a;if(b={},null!=a)for(c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b["default"]=a,b}function e(a){return a&&a.__esModule?a:{"default":a}}function f(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var g,h,i,j,k,l,m,n,o,p,q,r;Object.defineProperty(c,"__esModule",{value:!0}),g=Object.assign||function(a){var b,c,d;for(b=1;b<arguments.length;b++){c=arguments[b];for(d in c)Object.prototype.hasOwnProperty.call(c,d)&&(a[d]=c[d])}return a},h=function(){function a(a,b){var c,d;for(c=0;c<b.length;c++)d=b[c],d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),i=a("./Tracker"),j=e(i),k=a("./vpaidEvents"),l=e(k),m=a("./Beacon"),n=e(m),o=a("../player/utils"),p=d(o),q=a("../VPAIDHTML5Client/js/VPAIDHTML5Client"),r=function(){function a(b,c,d){var e,h=this;f(this,a),this.vpaidLog=c,this.store=d,this.type="vpaid",this.stopped=!1,this.version="1.1",this.target=b.slot,this.video=b.videoSlot,this.mediaFiles=b.vpaidFiles,this.mediaUrl,this.videoSlotControls=b.videoSlotControls,this.videoSlotCanAutoPlay=b.videoSlotCanAutoPlay,this.debugTracker=new j["default"]("JsVpaid"),e=this.store.get("prtct"),this.baseUrl=this.store.get("base_url"),this._VpaidProtection=this.baseUrl+e,this._onReady=b.onReady,this._onError=b.onError,this.vpaidEvents=g({},l["default"]),this.beacon=new n["default"](this),this.volume=0,this.isMuted=!0,setTimeout(function(){h._onReady()},2)}return h(a,[{key:"_safeCall",value:function b(a,c){if(!this.stopped&&this.adUnit)try{return this.adUnit[a].apply(this.adUnit,c)}catch(d){return this.vpaidLog&&this.vpaidLog.push("initJsError",{err:d.message,funcName:a,stack:d.stack}),this._onAdError(d),!1}}},{key:"restartAd",value:function c(){this.video.currentTime=0,this.video.play()}},{key:"handshakeVersion",value:function d(a){return"2.0"}},{key:"resizeAd",value:function e(a,b,c){this.target.style.width=a+"px",this.target.style.height=b+"px",this.target.setAttribute("width",a),this.target.setAttribute("height",b),this._safeCall("resizeAd",[a,b,c])}},{key:"initAd",value:function i(a,b,c,d,e,f){function g(d,f){function g(d,g){f.initAd(a,b,c,-1,e,{})}return d?void i._onError():(i.adUnit=f,i._bindIframe(f),i._bindAdUnitEvents(f),void f.handshakeVersion("2.0",g))}var h,i;this.mediaUrl=this.mediaFiles[0].url,this.stopped||(this.debugTracker.info("Loading","Iframe was loaded!"),h=new q(this.target,this.video,{}),this.vpaid=h,h.loadAdUnit(this.mediaUrl,g),i=this)}},{key:"_bindIframe",value:function k(a){var b,c,d,e=a._iframe;this._registerAnalytics(e),b=e.contentWindow.document.createElement("script"),b.src=this._VpaidProtection,e.contentWindow.document.body.appendChild(b),e.contentWindow.ReportHijackAttempt=this._onHijackAttempt,c=this.store.get("debug"),c||(e.contentWindow.onerror=function(){return!0},p._suppressConsoleMethods(e.contentWindow.console)),this._soundProtection(this.video),d=this.store.get("blkflshjs")||!1,this._blockDOMObjectInWin(e.contentWindow)}},{key:"_bindAdUnitEvents",value:function m(a){var b,c=this;for(b in this.vpaidEvents)!function(b){a.subscribe(b,function(a){c._allEventsHandler(b,a)})}(b)}},{key:"_registerAnalytics",value:function o(a){var b,c=this.store.get("anltcsUrl"),d=this.store.get("anltcsOptions"),e=this;c&&(b=a.contentWindow.document.createElement("script"),b.src=this.baseUrl+c,b.addEventListener("load",function(){new a.contentWindow.AnalyticsReporter(e,function(a,b){e.vpaidLog.push("analytics"+a,p.flattenObject(b[a]))},d)}),a.contentWindow.document.body.appendChild(b))}},{key:"_blockDOMObjectInWin",value:function r(a){var b=this.store.get("jsnoflshdtct"),c="window.navigator.__defineGetter__('plugins', function () { return []; });",d='\n        \n\n        Object.defineProperty(\n            HTMLObjectElement.prototype,\n            "_data",\n            Object.getOwnPropertyDescriptor(\n                HTMLObjectElement.prototype,\n                "data"\n            )\n        );\n\n        Object.defineProperty(\n            HTMLObjectElement.prototype,\n            "data", {\n                set : function(val){\n                    console.log(\'HTMLObjectElement block\');\n                    return;\n                }\n            }\n        );';b&&(d=c+d);try{a.eval(d)}catch(e){console.log(e)}}},{key:"_soundProtection",value:function s(a){var b=this;a.addEventListener("volumechange",function(){b.isMuted&&0!=a.volume&&b.beacon.dispatchEvent(b.vpaidEvents.SoundViolation,{}),b.volume&&a.volume!==b.volume&&(a.volume=b.volume)})}},{key:"_allEventsHandler",value:function t(a,b){if("AdImpression"===a){var c=this.video.src;c&&this.vpaidLog.push("videoUrl",{url:c})}this.beacon.dispatchEvent(a,b)}},{key:"stopAd",value:function u(){this._safeCall("stopAd",[]),window.setTimeout(this._stopAd.bind(this),1)}},{key:"_stopAd",value:function v(){this.adUnit&&(this.adUnit._iframe&&this.adUnit._iframe.contentWindow&&(this.adUnit._iframe.contentWindow.ReportHijackAttempt=null),this.adUnit._destroy()),this.iframe=this.vpaid=this.adUnit=this.mediaFiles=this.video=this.vpaidEvents=this.target=this.debugTracker=void 0,this.vpaidLog=null,this.store=void 0,this.onAfterStop()}},{key:"pauseAd",value:function w(){this._safeCall("pauseAd",[])}},{key:"resumeAd",value:function x(){this._safeCall("resumeAd",[])}},{key:"skipAd",value:function y(){this._safeCall("skipAd",[])}},{key:"startAd",value:function z(){this._safeCall("startAd",[])}},{key:"expandAd",value:function A(){this._safeCall("expandAd",[])}},{key:"collapseAd",value:function B(){this._safeCall("collapseAd",[])}},{key:"setAdVolume",value:function C(a){this.volume=a,this.isMuted=0===this.volume,this.store.get("frcvlm")&&(this.video.volume=a,this.beacon.dispatchEvent(this.vpaidEvents.AdVolumeChange,{dispatcher:this})),this._safeCall("setAdVolume",[a])}},{key:"getAdWidth",value:function D(){return this._safeCall("getAdWidth",[])}},{key:"getAdHeight",value:function E(){return this._safeCall("getAdWidth",[])}},{key:"getAdSkippableRemainingTime",value:function F(){return this._safeCall("getAdSkippableRemainingTime",[])}},{key:"getAdRemainingTime",value:function G(){return this._safeCall("getAdRemainingTime",[])}},{key:"getAdDuration",value:function H(){return this._safeCall("getAdDuration",[])}},{key:"getAdSkippableState",value:function I(){return this._safeCall("getAdSkippableState",[])}},{key:"getAdVolume",value:function J(){return this._safeCall("getAdVolume",[])}},{key:"getAdIcons",value:function K(){return this._safeCall("getAdIcons",[])}},{key:"getAdCompanions",value:function L(){return this._safeCall("getAdCompanions",[])}},{key:"getAdExpanded",value:function M(){return this._safeCall("getAdExpanded",[])}},{key:"getAdLinear",value:function N(){return this._safeCall("getAdLinear",[])}},{key:"getDOMContainer",value:function O(){return this.target}},{key:"subscribe",value:function P(a,b){this.vpaidEvents[b]&&this.beacon.addEventListener(b,a)}},{key:"unsubscribe",value:function Q(a,b){if(this.vpaidEvents[b]){if(!a)return;this.beacon.removeEventListener(b,a)}}},{key:"onAfterStop",value:function R(){}},{key:"_onAdError",value:function S(){}},{key:"_onHijackAttempt",value:function T(){var a="";"string"==typeof event&&(a=event),p.reportDb("hijackAttempt",{hijackAttempt:a}),this.stopAd()}},{key:"_getMediaUrl",value:function U(){return this.mediaUrl}}]),a}(),c["default"]=r,b.exports=c["default"]},{"../VPAIDHTML5Client/js/VPAIDHTML5Client":8,"../player/utils":28,"./Beacon":29,"./Tracker":44,"./vpaidEvents":60}],36:[function(a,b,c){"use strict";function d(a){var b,c;if(a&&a.__esModule)return a;if(b={},null!=a)for(c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b["default"]=a,b}function e(a){return a&&a.__esModule?a:{"default":a}}function f(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w;Object.defineProperty(c,"__esModule",{value:!0}),g=Object.assign||function(a){var b,c,d;for(b=1;b<arguments.length;b++){c=arguments[b];for(d in c)Object.prototype.hasOwnProperty.call(c,d)&&(a[d]=c[d])}return a},h=function(){function a(a,b){var c,d;for(c=0;c<b.length;c++)d=b[c],d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),i=a("./Tracker"),j=e(i),k=a("./vpaidEvents"),l=e(k),m=a("./Beacon"),n=e(m),o=a("../player/utils"),p=d(o),q=a("./Mpg1Canvas"),r=e(q),s=a("../player/dynamicSettings"),t=d(s),u=a("../VPAIDHTML5Client/js/VPAIDHTML5Client"),v=0,w=function(){function a(b,c,d){var e,h,i,k=this;f(this,a),this.vpaidLog=c,this.store=d,this.type="vpaid",this.tech="javascript",this.stopped=!1,this.version="1.1",this.target=b.slot,this.video=b.videoSlot,this.mediaFiles=b.vpaidFiles,this.mediaUrl,this.videoSlotControls=b.videoSlotControls,this.videoSlotCanAutoPlay=b.videoSlotCanAutoPlay,this.debugTracker=new j["default"]("JsVpaid"),e=this.store.get("prtct"),this.baseUrl=this.store.get("base_url"),this._VpaidProtection=this.baseUrl+e,this._onReady=b.onReady,this._onError=b.onError,this.tag=b.tag,this.vpaidEvents=g({},l["default"]),this.beacon=new n["default"](this),this.volume=0,this.isMuted=!0,this.video.setAttribute("muted",""),this.video.setAttribute("vcounter",v++),this.video.setAttribute("playsinline",""),this.useCanvasMpeg=this.store.get("uscnvsmpg")||!1,this.hasAutoPlay=this.store.get("hasAutoPlay")||!1,this.isMobile=this.store.get("isMobile")||!1,this.isCanvasMpeg=this._decideCanvas(),this.canvasReady=!1,h=this.store.get("sprssviderr"),h&&this._hookeEventListener(b.videoSlot),this.isCanvasMpeg&&(this.canvas=new r["default"](this.video,this,null,null,d),this.canvas.on("ready",function(){}),this.canvas.on("play",function(){k.beacon.dispatchEvent(k.vpaidEvents.AdStarted)}),i=document.getElementsByClassName("vpaid-ad-controls")[0],i&&(i.className+=" hide")),setTimeout(function(){k._onReady()},2),c.push("vpaidInit",{hasAutoPlay:this.hasAutoPlay,isCanvasMpeg:this.isCanvasMpeg,forceCavnas:this.store.get("forcecnvsmpg"),useAutoPlayForContent:this.store.get("useapforcntnt"),isMobile:this.isMobile})}return h(a,[{key:"muteClick",value:function b(){this.stopped||(this.canvas?this.canvas.muteButtonClick():this.volume?this.setAdVolume(0):this.setAdVolume(.7))}},{key:"_hookeEventListener",value:function c(a){var b=a.addEventListener;a.addEventListener=function(c,d){"error"!==c&&b.apply(a,[c,d])}}},{key:"_decideCanvas",value:function d(){var a,b,c,d;return!!this.store.get("uscnvsmpg")&&(a=t.get()||{},b=a.mobAp||[],c=this.tag.advId,b.indexOf(c)>-1?(this.vpaidLog.push("canvasOptOutByAdvId",{advId:c}),!1):(d=this.store.get("forcecnvsmpg")||!1,this.useCanvasMpeg&&!this.hasAutoPlay&&this.isMobile||d))}},{key:"_resizeAd",value:function e(a){this.stopped||this.canvas&&this.canvas.onResize(a[0],a[1])}},{key:"_safeCall",value:function i(a,b){if(!this.stopped&&this.adUnit){"resizeAd"===a&&this._resizeAd(b);try{return this.adUnit[a].apply(this.adUnit,b)}catch(c){return this.vpaidLog&&this.vpaidLog.push("initJsError",{err:c.message,funcName:a,args:b,stack:c.stack}),!1}}}},{key:"restartAd",value:function k(){this.stopped||(this.video.currentTime=0,this.video.play())}},{key:"handshakeVersion",value:function m(a){return"2.0"}},{key:"resizeAd",value:function o(a,b,c){this.stopped||(this.target.style.width=a+"px",this.target.style.height=b+"px",this.target.setAttribute("width",a),this.target.setAttribute("height",b),this._safeCall("resizeAd",[a,b,c]),this.canvas&&this.canvas.onResize(a,b))}},{key:"initAd",value:function q(a,b,c,d,e,f){function g(d,f){try{var g=function j(d,g){d?i.vpaidLog.push("handshakeVPAIDJSScript",{handshake:!1,error:d}):i.vpaidLog.push("handshakeVPAIDJSScript",{handshake:!0}),f.initAd(a,b,c,-1,e,{})};if(i.stopped)return void i.vpaidLog.push("loadVPAIDJSScript",{stopped:!0});if(d)return i.vpaidLog.push("loadVPAIDJSScript",{scriptLoadedError:!0}),void i._onError();i.vpaidLog.push("loadVPAIDJSScript",{scriptLoaded:!0}),i.adUnit=f,
i._bindIframe(f),i._bindAdUnitEvents(f),f.handshakeVersion("2.0",g)}catch(h){i.vpaidLog.push("loadVPAIDJSScriptErr",{err:h.message})}}var h,i;this.stopped||(this.mediaUrl=this.mediaFiles[0].url,this.debugTracker.info("Loading","Iframe was loaded!"),h=new u(this.target,this.video,{}),this.vpaid=h,h.loadAdUnit(this.mediaUrl,g),i=this)}},{key:"_bindIframe",value:function s(a){var b,c,d=a._iframe;this._registerAnalytics(d),b=d.contentWindow.document.createElement("script"),b.src=this._VpaidProtection,d.contentWindow.document.body.appendChild(b),d.contentWindow.ReportHijackAttempt=this._onHijackAttempt,c=this.store.get("debug"),c||(d.contentWindow.onerror=function(){return!0},p._suppressConsoleMethods(d.contentWindow.console)),this._soundProtection(this.video)}},{key:"_bindAdUnitEvents",value:function w(a){var b,c=this;for(b in this.vpaidEvents)!function(b){a.subscribe(b,function(a){c._allEventsHandler(b,a)})}(b)}},{key:"_registerAnalytics",value:function x(a){var b,c=this.store.get("anltcsUrl"),d=this.store.get("anltcsOptions"),e=this;c&&(b=a.contentWindow.document.createElement("script"),b.src=c,b.addEventListener("load",function(){new a.contentWindow.AnalyticsReporter(e,function(a,b){e.vpaidLog.push("analytics"+a,p.flattenObject(b[a]))},d)}),a.contentWindow.document.body.appendChild(b))}},{key:"_blockDOMObjectInWin",value:function y(a){var b=this.store.get("jsnoflshdtct"),c="window.navigator.__defineGetter__('plugins', function () { return []; });",d='\n\n\n        Object.defineProperty(\n            HTMLObjectElement.prototype,\n            "_data",\n            Object.getOwnPropertyDescriptor(\n                HTMLObjectElement.prototype,\n                "data"\n            )\n        );\n\n        Object.defineProperty(\n            HTMLObjectElement.prototype,\n            "data", {\n                set : function(val){\n                    console.log(\'HTMLObjectElement block\');\n                    return;\n                }\n            }\n        );';b&&(d=c+d);try{a.eval(d)}catch(e){console.log(e)}}},{key:"_soundProtection",value:function z(a){var b=this;a.addEventListener("volumechange",function(){b.stopped||(b.isMuted&&0!=a.volume&&b.beacon.dispatchEvent(b.vpaidEvents.SoundViolation,{}),a.volume!==b.volume&&(a.volume=b.volume))})}},{key:"_allEventsHandler",value:function A(a,b){if("AdImpression"===a){var c=this.video.src;c&&this.vpaidLog.push("videoUrl",{url:c})}this.beacon.dispatchEvent(a,b)}},{key:"stopAd",value:function B(){this._safeCall("stopAd",[]),window.setTimeout(this._stopAd.bind(this),1)}},{key:"_stopAd",value:function C(){this.stopped||(this.stopped=!0,this.adUnit&&this.adUnit._iframe&&this.adUnit._iframe.contentWindow&&(this.adUnit._iframe.contentWindow.ReportHijackAttempt=null),this.adUnit&&this.adUnit._destroy(),this.vpaid&&this.vpaid.destroy(),this.canvas&&this.canvas.destroy(),this.iframe=this.vpaid=this.adUnit=this.mediaFiles=this.video=this.vpaidEvents=this.target=this.debugTracker=this.beacon=void 0,this.vpaidLog=null,this.tag=void 0,this.store=void 0,this.onAfterStop())}},{key:"pauseAd",value:function D(){this._safeCall("pauseAd",[])}},{key:"resumeAd",value:function E(){this._safeCall("resumeAd",[])}},{key:"skipAd",value:function F(){this._safeCall("skipAd",[])}},{key:"startAd",value:function G(){this.vpaidLog&&this.vpaidLog.push("jsMobileStartAd",{start:!0}),this.video.setAttribute("muted",""),this.video.setAttribute("playsinline",""),this.canvas&&this.canvas.emitStartAd(),this._safeCall("startAd",[])}},{key:"expandAd",value:function H(){this._safeCall("expandAd",[])}},{key:"collapseAd",value:function I(){this._safeCall("collapseAd",[])}},{key:"setAdVolume",value:function J(a){this.volume=a,a>0&&(this.video.muted=!1),this.isMuted=0===this.volume,this._safeCall("setAdVolume",[a])}},{key:"getAdWidth",value:function K(){return this._safeCall("getAdWidth",[])}},{key:"getAdHeight",value:function L(){return this._safeCall("getAdWidth",[])}},{key:"getAdSkippableRemainingTime",value:function M(){return this._safeCall("getAdSkippableRemainingTime",[])}},{key:"getAdRemainingTime",value:function N(){return this._safeCall("getAdRemainingTime",[])}},{key:"getAdDuration",value:function O(){return this._safeCall("getAdDuration",[])}},{key:"getAdSkippableState",value:function P(){return this._safeCall("getAdSkippableState",[])}},{key:"getAdVolume",value:function Q(){return this._safeCall("getAdVolume",[])}},{key:"getAdIcons",value:function R(){return this._safeCall("getAdIcons",[])}},{key:"getAdCompanions",value:function S(){return this._safeCall("getAdCompanions",[])}},{key:"getAdExpanded",value:function T(){return this._safeCall("getAdExpanded",[])}},{key:"getAdLinear",value:function U(){return this._safeCall("getAdLinear",[])}},{key:"getDOMContainer",value:function V(){return this.target}},{key:"subscribe",value:function W(a,b){this.stopped||this.vpaidEvents[b]&&this.beacon.addEventListener(b,a)}},{key:"unsubscribe",value:function X(a,b){if(!this.stopped&&this.vpaidEvents[b]){if(!a)return;this.beacon.removeEventListener(b,a)}}},{key:"onAfterStop",value:function Y(){}},{key:"_onAdError",value:function Z(){}},{key:"_onHijackAttempt",value:function $(){var a="";"string"==typeof event&&(a=event),p.reportDb("hijackAttempt",{hijackAttempt:a}),this.stopAd()}},{key:"_getMediaUrl",value:function _(){return this.mediaUrl}}]),a}(),c["default"]=w,b.exports=c["default"]},{"../VPAIDHTML5Client/js/VPAIDHTML5Client":8,"../player/dynamicSettings":26,"../player/utils":28,"./Beacon":29,"./Mpg1Canvas":39,"./Tracker":44,"./vpaidEvents":60}],37:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v;Object.defineProperty(c,"__esModule",{value:!0}),f=function(){function a(a,b){var c,d;for(c=0;c<b.length;c++)d=b[c],d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g=a("./VpaidWrapper"),h=d(g),i=a("./FlashPostAgent"),j=d(i),k=a("../player/utils"),l=a("./swfobject"),m=d(l),n=a("./Tracker"),o=d(n),p=a("./queue-sorter"),q=d(p),r=a("./OpportunityType"),s=d(r),t=a("bluebird"),u=d(t),u["default"].config({cancellation:!0}),v=function(){function a(b,c){var d=this;e(this,a),this.mainVpaid=b,this.store=c,this.time=(new Date).getTime(),this.sequenceId=((new Date).getTime()+"").substring(3,11),this.loops=0,this.stopped=!1,this.started=!1,this.schedule=[],this.timedTimeout=0,this.workingVpaidItem=!1,this.waterfall={},this.adSlots=1,this.filledSlots=0,this.adIsPlaying=!1,this.flashSupport=c.get("use_flash_player"),this.debugTracker=new o["default"]("Manager"),this.oppsID=s["default"],this.queueSize=this.store.get("queue_size")||10,this.store.on("stop",this.stop.bind(this)),this.store.get("debug")&&setInterval(function(){d._postMessageSchedule()},1e3),this.dontTrimMp4=this.store.get("novdtrm")}return f(a,[{key:"_postMessageSchedule",value:function b(){var a,b;if(window.cmPlayerDeubg){a=this.schedule,b=this.store;try{window.cmPlayerDeubg({schedule:a,store:b})}catch(c){console.log(c)}}}},{key:"trigger",value:function c(a,b,d){if(this._handleAllEvents({type:a,dispatcher:b}),this.store.emit(a,b),b.working||a===this.mainVpaid.vpaidEvents.AdImpression){var e={type:a,dispatcher:b};a===this.mainVpaid.vpaidEvents.AdImpression&&(e.tag=b.tag),e.vpaidReady=this.getVpaidReadyCount(),e.qsize=this.schedule.length,e.dp=b&&b.tag?b.tag.dp:"na",e.adImpMS=b?b.adImpInMS:0,e.readyInMS=b?b.readyInMS:0,e.loadToImpMS=b?b.adImpInMS-b.readyInMS:0,e.clickThruUrl=d?d.url:"",this.mainVpaid.trigger(a,e)}}},{key:"getVpaidReadyCount",value:function d(){var a=0;return this.schedule.map(function(b){b&&b.vpaidWrapper&&"ready"===b.vpaidWrapper.status&&a++}),a}},{key:"subscribeToVpaid",value:function g(a){this.stopped||(this.debugTracker.info("manager","subscribeToVpaid"),a.subscribe(this._handleError.bind(this),this.mainVpaid.vpaidEvents.AdError))}},{key:"_handleAllEvents",value:function i(a){var b,c=this;a.type!==this.mainVpaid.vpaidEvents.AdVideoStart&&a.type!==this.mainVpaid.vpaidEvents.AdImpression&&a.type!==this.mainVpaid.vpaidEvents.AdPlaying||!a.dispatcher.isPlaying||this.trigger("viewAdPlayer",a.dispatcher.tag),a.type===this.mainVpaid.vpaidEvents.AdLoaded&&this.shouldPlayWhenAvialable&&!this.store.get("evtbsschdl")&&(setTimeout(function(){c.playFromQueue(c.shouldPlayWhenAvialable)},2),b=a.dispatcher?a.dispatcher.tag:{},this.shouldPlayWhenAvialable=!1),a.type===this.mainVpaid.vpaidEvents.AdImpression&&a.dispatcher.getAdContext&&a.dispatcher.getAdContext&&a.dispatcher.getAdContext.getAdCallback(a.dispatcher)}},{key:"_runNextAd",value:function k(){}},{key:"_handleError",value:function l(a){var b=a.dispatcher,c="";this.adIsPlaying&&b.isStarted&&!b.hadImpression&&!this.store.get("evtbsschdl")&&this.playFromQueue()}},{key:"initVpaidInQue",value:function n(){var a,b,c,d,e;if(!this.stopped)for(a=this.schedule,b={},c=this,d=0;d<a.length;d++)b=a[d],b.vpaidWrapper||(b.sequenceId=b.wfIndex,this.store.get("use_flash_player")&&(e=new j["default"](m["default"],this.mainVpaid.config.target,this.flashSupport,{},this.store)),b.vpaidWrapper=new h["default"]({sendManager:e,tag:b,creatives:this.mainVpaid.config.creatives,vpaidEvents:this.mainVpaid.vpaidEvents,config:this.mainVpaid.config,tagid:d+"-"+b.waterfallTagId,flashSupport:this.flashSupport,manager:this,wfStats:b.wfStats},this.mainVpaid,this.store),b.vpaidWrapper.on("vpaidCleaned",function(){c.cleanExpierd(c.queueSize)}),this.subscribeToVpaid(b.vpaidWrapper))}},{key:"unsubscribeFromVpaid",value:function p(a){this.stopped||(this.debugTracker.info("manager","unsubscribeFromVpaid"),a.unsubscribe(null,this.mainVpaid.vpaidEvents.AdError),a.unsubscribe(null,this.mainVpaid.vpaidEvents.AdFound),a.unsubscribe(null,this.mainVpaid.vpaidEvents.AdStopped),a.unsubscribe(null,this.mainVpaid.vpaidEvents.AdSkipped),a.unsubscribe(null,this.mainVpaid.vpaidEvents.AdImpression),a.unsubscribe(null,this.mainVpaid.vpaidEvents.AdSkippableStateChange),a.unsubscribe(null,this.mainVpaid.vpaidEvents.AdSizeChange),a.unsubscribe(null,this.mainVpaid.vpaidEvents.AdLinearChange),a.unsubscribe(null,this.mainVpaid.vpaidEvents.AdDurationChange),a.unsubscribe(null,this.mainVpaid.vpaidEvents.AdExpandedChange),a.unsubscribe(null,this.mainVpaid.vpaidEvents.AdVolumeChange),a.unsubscribe(null,this.mainVpaid.vpaidEvents.AdVideoStart),a.unsubscribe(null,this.mainVpaid.vpaidEvents.AdVideoFirstQuartile),a.unsubscribe(null,this.mainVpaid.vpaidEvents.AdVideoMidpoint),a.unsubscribe(null,this.mainVpaid.vpaidEvents.AdVideoThirdQuartile),a.unsubscribe(null,this.mainVpaid.vpaidEvents.AdVideoComplete),a.unsubscribe(null,this.mainVpaid.vpaidEvents.AdClickThru),a.unsubscribe(null,this.mainVpaid.vpaidEvents.AdInteraction),a.unsubscribe(null,this.mainVpaid.vpaidEvents.AdUserAcceptInvitation),a.unsubscribe(null,this.mainVpaid.vpaidEvents.AdUserMinimize),a.unsubscribe(null,this.mainVpaid.vpaidEvents.AdUserClose),a.unsubscribe(null,this.mainVpaid.vpaidEvents.AdPaused),a.unsubscribe(null,this.mainVpaid.vpaidEvents.AdPlaying),a.unsubscribe(null,this.mainVpaid.vpaidEvents.AdLog))}},{key:"cleanExpierd",value:function r(a){var b,c,d=this;this.schedule.map(function(a,b){var c,e;!a||!a.vpaidWrapper||a.vpaidWrapper.working||"error"!==a.vpaidWrapper.status&&"stopped"!==a.vpaidWrapper.status||(a.vpaidWrapper._status=a.vpaidWrapper.status,d.unsubscribeFromVpaid(d.schedule[b].vpaidWrapper),c="error"===a.vpaidWrapper.status,e=c?d.oppsID.vastError:d.oppsID.adError,d.schedule[b].vpaidWrapper.stop("cleanExpierd",e),d.schedule[b].vpaidWrapper=null,d.schedule[b]=void 0)}),this.schedule=this.schedule.filter(function(a){return a}),this.schedule=q["default"].sort(this.schedule,this.store),this.schedule.length>a&&(b=this.mainVpaid.config.creatives,c=this.mainVpaid.config.creatives.ADTO||6e4,this.schedule.map(function(b,e){var f,g;if(d.schedule[e]&&!b.vpaidWrapper.working&&(f=Date.now()-d.schedule[e].vpaidWrapper.created,b&&(e<d.schedule.length-a||f>c))){if(d.unsubscribeFromVpaid(d.schedule[e].vpaidWrapper),g=f>c?"queueExpired":"queueTrimmed",!d._canTrim(g,b))return;d.schedule[e].vpaidWrapper.stop(g,d.oppsID[g]),d.schedule[e]=void 0}})),this.schedule=this.schedule.filter(function(a){return a})}},{key:"_canTrim",value:function t(a,b){return"queueTrimmed"!==a||!(b.vpaidWrapper&&"mp4"===b.vpaidWrapper.type&&this.dontTrimMp4)}},{key:"fillSchedule",value:function v(a){var b,c,d,e,f,g;for(this.schedule.length>this.queueSize&&this.cleanExpierd(this.queueSize),this.started=!0,this.stopped=!1,b={},c=0,d=this.mainVpaid.config.creatives,d.ADTO=parseInt(d.ADTO)>1?parseInt(d.ADTO):60,d.ADTO=d.ADTO<1e3?1e3*d.ADTO:d.ADTO,this.adSlots=parseInt(d.B2B)&&parseInt(d.B2B)>1?parseInt(d.B2B):1,e=1,f=0,g=d.DEFAULTTAGTIMEOUT<1e3?1e3*d.DEFAULTTAGTIMEOUT:d.DEFAULTTAGTIMEOUT,c=0;c<a.tags.length;c++)b=a.tags[c],b.active=!1,b.adFound=!1,b.offset=f,b.tagStart=f,b.tagTimeout=g,b.queueNumber=0,b.ADTO=d.ADTO,b.vpaidWrapper=!1,b.tagEnd=1*b.tagStart+1*b.tagTimeout,b.wfStats=a.data,this._updateItemFirstLook(b),this.schedule.push(b);this.time=(new Date).getTime(),this.initVpaidInQue(),this.store.set("queueLength",this.schedule.length),this.store.set("vpaidReadyCount",this.getVpaidReadyCount())}},{key:"_updateItemFirstLook",value:function w(a){a.fll?this.store.get("first_look")?(a.fll_delay=a.fll,delete a.fll):this._startFllTimeout(a.fll):a.flad&&(this.store.get("first_look_ad_loaded")?(a.flad_delay=a.flad,delete a.flad):this._startFladTimeout(a.flad))}},{key:"_startFllTimeout",value:function x(a){this.store.set("first_look",a),this.fllTimeout=setTimeout(this._onFllTimeout.bind(this),1e3*a)}},{key:"_onFllTimeout",value:function y(){var a,b=null;for(a=0;a<this.schedule.length;a++)if(b=this.schedule[a],b.fll_delay)return b.fll=b.fll_delay,delete b.fll_delay,b.vpaidWrapper.startParser(),void this._startFllTimeout(b.fll);this.store.set("first_look",!1),this.store.emit("fllInactive")}},{key:"_startFladTimeout",value:function z(a){this.store.set("first_look_ad_loaded",a),this.fladTimeout=setTimeout(this._onFladTimeout.bind(this),1e3*a)}},{key:"_onFladTimeout",value:function A(){var a,b=null;for(a=0;a<this.schedule.length;a++)if(b=this.schedule[a],b.flad_delay)return b.flad=b.flad_delay,delete b.flad_delay,void this._startFladTimeout(b.flad);this.store.set("first_look_ad_loaded",!1),this.store.emit("fladInactive")}},{key:"stop",value:function B(){if(!this.stopped){this.stopped=!0,window.clearTimeout(this.timedTimeout);for(var a=0;a<this.schedule.length;a++)this.schedule[a].vpaidWrapper.stop("playerClosed",this.oppsID.playerClosed)}}},{key:"managerEnd",value:function C(){}},{key:"playFromQueue",value:function D(a){var b,c,d,e,f,g,h,i,j;if(!this.stopped){for(b=Date.now(),this.store.set("playFromQueue",b),c=this.getVpaidReadyCount(),(0===c||a)&&(this.store.get("vForce")||(this.shouldPlayWhenAvialable=!0)),this.store.get("first_look")||this.store.get("first_look_ad_loaded")||(this.schedule=q["default"].sort(this.schedule,this.store)),d=this.mainVpaid.config.creatives.ADTO||6e4,d+=1e4,e=this,f=!1,g=[],h=this.schedule.length-1;h>=0;h--)i=this.schedule[h],i&&(g.push(i.score),this.setItemScores(i,h,g),i.vpaidWrapper&&i.vpaidWrapper.vpaidLog&&(i.vpaidWrapper.vpaidLog.data.itemScore=i.score,i.vpaidWrapper.vpaidLog.push("itemScores",{index:h,scores:g})),"ready"!==i.vpaidWrapper.status||i.vpaidWrapper.working||i.vpaidWrapper.isStarted||f||this.store.get("first_look_ad_loaded")&&!i.flad||(this.store.set("playFromQueueFound",b),i.vpaidWrapper.bringToFront(),this.workingVpaidItem=i,i.vpaidWrapper.working=!0,i.vpaidWrapper.isPlaying=!0,this.adIsPlaying=!0,f=!0,i.vpaidWrapper.startAd(),i.vpaidWrapper.vpaidLog.push("startFromQ",{score:i.score})));j=this.store.get("run_wf_when_empty"),j&&0===c&&this.store.emit("playFromEmptyQueue")}}},{key:"setItemScores",value:function E(a,b,c){a.vpaidWrapper&&a.vpaidWrapper.vpaidLog&&(a.vpaidWrapper.vpaidLog.data.itemScore=a.score,c&&a.vpaidWrapper.vpaidLog.push("itemScores",{index:b,scores:c}))}},{key:"resizeAd",value:function F(a,b,c){if(!this.stopped){this.mainVpaid.config.creatives.PLAYER_WIDTH=this.mainVpaid.config.width=parseInt(a),this.mainVpaid.config.creatives.PLAYER_HEIGHT=this.mainVpaid.config.height=parseInt(b),this.mainVpaid.config.creatives.VIEW_MODE=this.mainVpaid.config.viewMode=c,this.mainVpaid.config.video.style.height=b+"px",this.mainVpaid.config.video.style.width=a+"px";for(var d=0;d<this.schedule.length;d++)this.schedule[d].vpaidWrapper&&!this.schedule[d].vpaidWrapper.stopped&&this.schedule[d].vpaidWrapper.callVpaidMethod("resizeAd",[a,b,c],0)}}},{key:"setAdVolume",value:function G(a,b){if(!this.stopped){if(a=a>1?a/100:a,isNaN(parseFloat(a)))return!1;a=parseFloat(a),b||(this.mainVpaid.config.creatives.VOLUME=a),this.mainVpaid.config.creatives.MUTED=0==a,this.mainVpaid.config.video.volume=a;for(var c=0;c<this.schedule.length;c++)this.schedule[c].vpaidWrapper&&!this.schedule[c].vpaidWrapper.stopped&&"bf"!==this.schedule[c].vpaidWrapper.status&&this.schedule[c].vpaidWrapper.setAdVolume(a)}}},{key:"callWorkingVpaid",value:function H(a,b,c){if(!this.stopped)return this.workingVpaidItem&&this.workingVpaidItem.vpaidWrapper&&!this.workingVpaidItem.vpaidWrapper.stopped?this.workingVpaidItem.vpaidWrapper.callVpaidMethod(a,b,c):c}},{key:"getVpaidLogs",value:function I(){var a,b,c=[];for(a=0;a<this.schedule.length;a++)b=this.schedule[a],b&&b.vpaidWrapper&&b.vpaidWrapper.vpaidLog&&c.push(b.vpaidWrapper.vpaidLog);return c}},{key:"getAd",value:function J(a){this.store.incr("getAdData.count"),this.store.set("getAdData.options",a);var b=this;return clearTimeout(this.nextAdFromQueue),new u["default"](function(c,d,e){a=a||{};var f={getAdCallback:c};a.getAdContext=f,b.getAdTimeout=setTimeout(function(){f=void 0,d({name:"error",message:"couldn't find a suitable ad to play"})},1e3*b.store.get("get_ad_timeout_seconds")),b.getAdFromQueue(a),e(function(){f=void 0,b.cancelGetAd()}.bind(b))})}},{key:"cancelGetAd",value:function K(){this.store.decr("getAdData.count"),clearTimeout(this.getAdTimeout)}},{key:"getAdFromQueue",value:function L(a){var b,c,d,e;if(!this.stopped&&(a=a||{},a&&a.getAdContext)){for(this.store.get("first_look")||this.store.get("first_look_ad_loaded")||(this.schedule=q["default"].sort(this.schedule,this.store)),b=!1,c=this.schedule.length-1;c>=0;c--)if(d=this.schedule[c],this.setItemScores(d,c),this.isViewabilityMatch(d,a)&&"ready"===d.vpaidWrapper.status&&!d.vpaidWrapper.working&&!d.vpaidWrapper.isStarted&&(!this.store.get("first_look_ad_loaded")||d.flad)){d.vpaidWrapper.bringToFront(),this.workingVpaidItem=d,d.vpaidWrapper.working=!0,d.vpaidWrapper.isPlaying=!0,this.adIsPlaying=!0,b=!0,d.vpaidWrapper.startAd(a.getAdContext),d.vpaidWrapper.vpaidLog.push("startFromQ",{score:d.score}),clearTimeout(this.getAdTimeout),this.getAdTimeout=void 0;break}e=this.store.get("run_wf_when_empty"),e&&0==this.getVpaidReadyCount()&&this.store.emit("playFromEmptyQueue"),b||(this.nextAdFromQueue=setTimeout(this.getAdFromQueue.bind(this,a),1e3))}}},{key:"isViewabilityMatch",value:function M(a,b){return!(!a||!a.vpaidWrapper)&&("undefined"==typeof b.requiredViewability||(b.requiredViewability?a.requiredViewability:!a.requiredViewability))}},{key:"onStop",value:function N(){}}]),a}(),c["default"]=v,b.exports=c["default"]},{"../player/utils":28,"./FlashPostAgent":31,"./OpportunityType":42,"./Tracker":44,"./VpaidWrapper":49,"./queue-sorter":57,"./swfobject":58,bluebird:1}],38:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b,c,d,e){var f,g,h=document.createElement("script"),i=[];b={adData:{ids:b,duration:c,url:e},dispatchEvent:function k(a){this.sendEvent?(i&&(i.push(a),a=i,i=!1),this.sendEvent(a)):i.push(a)}},c="_moatApi"+Math.floor(1e8*Math.random());try{f=a.ownerDocument,g=f.defaultView||f.parentWindow}catch(j){f=document,g=window}return g[c]=b,h.type="text/javascript",a&&a.insertBefore(h,a.childNodes[0]||null),h.src="https://z.moatads.com/"+d+"/moatvideo.js#"+c,b}var f,g;Object.defineProperty(c,"__esModule",{value:!0}),f=function(){function a(a,b){var c,d;for(c=0;c<b.length;c++)d=b[c],d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g=function(){function a(b){var c,f;d(this,a),c=b.store.get("ab_test")||"none",f=b.store.get("unit_type")||"",this.moatApiReference=e(b.container||document.body,b.tag?{level1:f,level2:c,level3:b.tag.advId,level4:b.tag.lineItemId,slicer1:b.url,slicer2:b.tag.tagId}:{level1:"",level2:"",level3:"",level4:"",slicer1:"",slicer2:""},b.duration||0,b.moatPartnerCode,b.url)}return f(a,[{key:"dispatch",value:function b(a){this.moatApiReference&&this.moatApiReference.dispatchEvent(a)}},{key:"dispose",value:function c(){this.moatApiReference=void 0}}]),a}(),c["default"]=g,b.exports=c["default"]},{}],39:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var h,i,j,k,l,m,n;Object.defineProperty(c,"__esModule",{value:!0}),h=function(){function a(a,b){var c,d;for(c=0;c<b.length;c++)d=b[c],d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),i=a("./Tracker"),j=d(i),k=a("events"),l=a("./jsmpeg"),m=new j["default"]("Mpg1Canvas").debug,n=function(a){function b(a,c,d,g,h,i,j){e(this,b);var k=f(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));return m("constructor"),k.video=a,k.target=j,k.createCanvas(),k.store=h,k.modifyVideo(a),k.owner=c,k.shouldAutoPlay=d||!1,k.canvasCss=g||{},k.bypass=!1,k.clntRedirRslvWhiteList=k.store.get("mpgclrslv")||[],k.ready=!1,k.loop=i,k.vidAttr={},a.setAttribute("muted",""),k.status="LOADING",k.owner&&k.owner.vpaidLog&&k.owner.vpaidLog.push("canvas",{ctor:!0}),k}return g(b,a),h(b,[{key:"emitStartAd",value:function c(){this.stratAdCalled=!0}},{key:"backToVideoTag",value:function d(){var a,b,c,d,e,f=this;!this.bypass&&this.src&&(this.bypass=!0,a=this.jsmpeg.currentTime,b=this.video.style,c=this.video.parentElement||this.target,d=parseInt(this.canvas.style.zIndex),e=this.jsmpeg.loop,this.jsmpeg.stop(),this.jsmpeg=void 0,this.newVid=c.appendChild(document.createElement("video")),this.newVid.className="mc-loud-video",this.newVid.setAttribute("playsinline",""),this.newVid.setAttribute("autoplay",""),e&&this.newVid.setAttribute("loop",""),this.newVid.style.height=b.height,this.newVid.style.width=b.width,this.newVid.style.top=b.top?b.top:"0",this.newVid.style.left=b.left?b.left:"0",this.newVid.style.zIndex=d,this.newVid.src=this.src,this.newVid.volume=.7,this.newVid.addEventListener("ended",function(a){f.dispatchDOM("ended")},!1),this.newVid.addEventListener("click",function(a){f.dispatchDOM("click",a)}),this.newVid.currentTime=a,this.newVid.play().then(function(){f.newVid.currentTime=a,f.emit("newVidCreated",f.newVid),f.canvas.style.display="none",f.video.style.display="none",f.video.paused&&f._pause()}))}},{key:"mpegFinish",value:function i(){this.dispatchDOM("ended")}},{key:"onLoad",value:function j(){var a,b,c=this;this.loaded||(this.loaded=!0,a=parseInt(this.store.get("width")),b=parseInt(this.store.get("height")),this.onResize(a,b),setTimeout(function(){c.ready=!0,c.emit("ready"),c.dispatchDOM("loadedmetadata")},0))}},{key:"createCanvas",value:function k(){var a,b,c=this,d=document.createElement("canvas");d.className="mc-video",a=this.video.parentElement||this.target,this.canvas=a.appendChild(d),a.className+=" mpegcnv",b=this,this.video&&this.video.addEventListener("resize",function(a){b.onResize(a.target.clientWidth,a.target.clientHeight)}),this.canvas.addEventListener("click",function(a){c.dispatchDOM("click",a)})}},{key:"onResize",value:function n(a,b){this.jsmpeg&&this.canvas&&this.jsmpeg.fitInParent(this.canvas,a,b),this.height=b,this.width=a}},{key:"hookProp",value:function o(a,b,c,d){var e="alt_"+b;a.hasOwnProperty(e)||(a[e]="",Object.defineProperty(a,b,{get:function f(){var a=c?c():this[e];return a},set:function g(c){this[e]=c,d&&d(c)&&a.setAttribute(b,c)}}))}},{key:"hookMethod",value:function p(a,b,c){this.hooks||(this.hooks=[]),this.hooks[b]=a[b];var d=this;a[b]=function(){var a,e;if(m("hookMethod",b),a={},c(arguments,a))return!(!d.hooks.hasOwnProperty(b)||"function"!=typeof d.hooks[b])&&(e=d.hooks[b].apply(this,arguments),a.res?a.res:e)}}},{key:"dispatchDOM",value:function q(a,b){if(m("dispatchDOM",a),this.video){var c=new Event(a);this.video.dispatchEvent(c)}}},{key:"errHndlr",value:function r(a){this.owner&&(this.owner.vpaidLog&&this.owner.vpaidLog.push("jsmpegError",a),this.owner._onPlayerError&&this.owner._onPlayerError())}},{key:"isUrlInRslvWhiteList",value:function s(a){if(!this.clntRedirRslvWhiteList.length)return!0;for(var b=0;b<this.clntRedirRslvWhiteList.length;++b)if(a.indexOf(this.clntRedirRslvWhiteList[b])>-1)return!0;return!1}},{key:"setSrc",value:function t(a){var b,c,d,e,f,g;if(a=a.trim(),a&&!this.hasVidUrl)return this.owner.vpaidLog&&this.owner.vpaidLog.push("canvasUrl",{url:a}),this.hasVidUrl=!0,"javascript"==this.owner.tech&&this.video&&this.video._vidSetAttr("src",a),this.src=a,m("setSrc",a),b=this.store.get("cnvsldrt"),c=parseInt(this.store.get("width")),d=parseInt(this.store.get("height")),e={loadeReadyRate:b,canvas:this.canvas,centerVertically:!0,autoplay:this.shouldAutoPlay,loop:this.loop||!1,pcy:d,pcx:c,onload:this.onLoad.bind(this),errHndlr:this.errHndlr.bind(this),onfinished:this.mpegFinish.bind(this),progressive:!0,canvasCss:this.canvasCss},f=this.store.get("gtvid"),g=f+"="+encodeURIComponent(a),(/\.mpg$/.test(a)||/\.mpeg$/.test(a))&&(g=a),this.jsmpeg=new l(g,e,this),!1}},{key:"_play",value:function u(){var a=this;if(!this.blockActions){if(this._timeUpdateTicker(),!this.ready)return void this.on("ready",function(){a.emit("play"),a._play()});this.newVid?this.newVid.play():this.jsmpeg.play(),this.dispatchDOM("playing"),this.status="PLAYING",this._render()}}},{key:"_timeUpdateTicker",value:function v(){var a=this;clearInterval(this.tuTicker),this.tuTicker=setInterval(function(){a.dispatchDOM("timeupdate")},1e3)}},{key:"_pause",value:function w(){this.stopped||(this.status="PAUSED",this._render(),this.newVid?this.newVid.pause():this.jsmpeg?this.jsmpeg.pause():"")}},{key:"muteButtonClick",value:function x(a){if(!this.stopped){if(this.owner.vpaidLog){var b=!!this.newVid&&!this.newVid.muted;this.owner.vpaidLog.push("canvasMuteToggle",{muted:b})}return this.newVid?void(this.newVid.muted=!this.newVid.muted):void this.backToVideoTag()}}},{key:"playButtonClick",value:function y(a){var b,c;this.stopped||(this.newVid||this.jsmpeg)&&(b="PLAYING"===this.status?"PAUSED":"PLAYING",this.owner.vpaidLog&&this.owner.vpaidLog.push("canvasPlayToggle",{status:b,view:this.newVid?"newVid":"canvas"}),this.status=b,c=this.newVid||this.jsmpeg,"PLAYING"===this.status?c.play():c.pause(),this._render())}},{key:"modifyVideo",value:function z(a){var b,c=this;this.stopped||(b=this,a._vidSetAttr=a.setAttribute,a.getAttribute=function(a,b){return c.vidAttr[a]},a.setAttribute=function(d,e){if(!b.stopped)return c.vidAttr[d]=e,"volume"===d&&(c._volume=e),b._logToBI("hookSetAttribute",{key:d,val:e}),"src"===d?void c.setSrc(e):a._vidSetAttr(d,e)},this.hookMethod(a,"play",function(){if(!b.stopped)return b._logToBI("hookMethodPlay",{hookMethod:!0}),b._play(),b.dispatchDOM("playing"),!1}),this.hookMethod(a,"pause",function(){if(!b.stopped)return b._logToBI("hookMethodPause",{hookMethod:!0}),b._pause(),!0}),this.hookMethod(a,"stop",function(){if(b._logToBI("hookMethodStop",{hookMethod:!0}),!b.stopped)return b.jsmpeg.stop(),!0}),this.hookProp(a,"paused",function(){return"PAUSED"===this.status}.bind(this),null),this.hookProp(a,"src",null,this.setSrc.bind(this)),this.hookProp(this.video,"volume",function(){return c.newVid?c.newVid.volume:c._volume},function(a){return c._volume=a,!0}),this.hookProp(a,"currentTime",function(){var a=b.newVid||b.jsmpeg;return a?a.currentTime:0},null))}},{key:"_render",value:function A(){var a=this.newVid||this.canvas}},{key:"hide",value:function B(){this.stopped||(this.canvas.style.display="none",this._render())}},{key:"show",value:function C(){this.stopped||(this.canvas.style.display="block",this._render())}},{key:"removeDomMember",value:function D(a){var b=a.parentNode;b.removeChild(a)}},{key:"restartAd",value:function E(){var a=this;this.stopped||(this.newVid?(this.newVid.currentTime=0,this.newVid.play()):this.jsmpeg&&(this.blockActions=!0,this.jsmpeg.stop(),setTimeout(function(){a.jsmpeg.play()},20),setTimeout(function(){a.blockActions=!1},2e3)))}},{key:"_logToBI",value:function F(a,b){this.owner.vpaidLog&&this.owner.vpaidLog.push(a,b)}},{key:"destroy",value:function G(){var a,b;m("destroy jsmpeg and canvas"),clearInterval(this.tuTicker),this.jsmpeg=void 0,a=this._events;for(b in a)this.removeAllListeners(b);this.removeDomMember(this.canvas),this.canvas=void 0}}]),b}(k.EventEmitter),c["default"]=n,b.exports=c["default"]},{"./Tracker":44,"./jsmpeg":54,events:2}],40:[function(a,b,c){"use strict";function d(a){var b,c;if(a&&a.__esModule)return a;if(b={},null!=a)for(c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b["default"]=a,b}function e(a){return a&&a.__esModule?a:{"default":a}}function f(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var g,h,i,j,k,l,m,n;Object.defineProperty(c,"__esModule",{value:!0}),g=function(){function a(a,b){var c,d;for(c=0;c<b.length;c++)d=b[c],d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=a("./Tracker"),i=e(h),j=a("../player/utils"),k=d(j),l=a("../player/Post"),m=e(l),n=function(){function a(b,c){var d,e;f(this,a),this.debugTracker=new i["default"]("OpportunityAggregator"),this.debugTracker.debug("",""),this.store=b,this.opps=[],d=this.store.get("opps_base_path")||c.CM_DOMAIN,this.url=k.setUrlPrefix(d)+(/.*\/$/g.test(d)?"":"/")+"OpportunityServlet",this.postHeaders=this.store.get("psthdrs")||"application/json",this.onFail=this._onFail.bind(this),this.onSuccess=this._onSuccess.bind(this),e=this._sendTicker.bind(this),setInterval(e,this.store.get("timbtopps")),this.store.on("sendOpps",e),this.store.on("beforeunload",e)}return g(a,[{key:"send",value:function b(a){this.opps.push(a),this.debugTracker.debug("Aggregate Opportunity",this.opps.length)}},{key:"_sendTicker",value:function c(){this.opps.length>0&&(this.debugTracker.debug("Aggregate Opportunities Ticker","aggregated opps count="+this.opps.length),(0,m["default"])(this.url,JSON.stringify(this.opps),this.onSuccess,this.onFail,void 0,!1,5e3,this.postHeaders,!1)),this.opps=[]}},{key:"_onSuccess",value:function d(a){this.debugTracker.debug("_onSuccess",a)}},{key:"_onFail",value:function e(a){this.debugTracker.warn("Error Firing Opps",a)}}]),a}(),c["default"]=n,b.exports=c["default"]},{"../player/Post":16,"../player/utils":28,"./Tracker":44}],41:[function(a,b,c){"use strict";function d(a){var b,c;if(a&&a.__esModule)return a;if(b={},null!=a)for(c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b["default"]=a,b}function e(a){return a&&a.__esModule?a:{"default":a}}function f(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var g,h,i,j,k,l;
Object.defineProperty(c,"__esModule",{value:!0}),g=function(){function a(a,b){var c,d;for(c=0;c<b.length;c++)d=b[c],d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=a("./Tracker"),i=e(h),j=a("../player/utils"),k=d(j),l=function(){function a(b,c){f(this,a),this.parameters=b,this.debugTracker=new i["default"]("OpportunityManager"),this.store=c,this.oppsAggregator=this.store.get("oppsAggregator")}return g(a,[{key:"send",value:function b(a,c){var d,e,f,g,h,i,j,l,m,n,o;if(a)if(this.debugTracker.info("OpportunityPixel","[tag-"+(1*a.waterfallTagId+1)+"] Sending '"+c),d=a.lineItemStats,e=this.store.get("pstn")||1,f=a.vidDast||a.dast,g=(new Date).getTime()-a.created,h=[{key:"st",value:k.getStreamType(a.rollType)},{key:"rs",value:a.sequenceId},{key:"os",value:1*a.waterfallTagId+1},{key:"tms",value:Math.floor((new Date).getTime()/1e3)},{key:"d",value:g},{key:"rst",value:c},{key:"dast",value:f},{key:"pstn",value:e},{key:"dp",value:k.crc32(a.dp)},{key:"mob",value:k.boolToInt(this.store.get("isMobile"))},{key:"vstt",value:k.boolToInt(this.store.get("isViewable"))},{key:"unv",value:this.store.get("unit_version")},{key:"unt",value:k.crc32(this.store.get("unit_type"))},{key:"abt",value:this.store.get("ab_test")},{key:"frd",value:this.store.get("fdScore")},{key:"agl",value:this.store.get("agressiveLevel")},{key:"rp",value:a.vpaidWrapperData&&a.vpaidWrapperData.vastPrice},{key:"mty",value:a.vpaidWrapperData&&a.vpaidWrapperData.mediatype},{key:"vstp",value:a.vpaidWrapperData&&a.vpaidWrapperData.vastType},{key:"fv_t",value:d&&d.tries},{key:"fv_c",value:d&&d.conversions},{key:"fv_f",value:d&&d.fails},{key:"fv_fr",value:d&&d.failsRow},{key:"awr",value:this.store.get("performance.wfRoundTripAverageDuration")},{key:"pm",value:this.store.get("performance.performanceMeasurment")}],i=this._filterUndefinededParams(h),this.oppsAggregator)j=i.concat(this._delayedParams(a)),l=this._flatenKeys(j),this.oppsAggregator.send(l);else{m=this._getBaseUrl(a),n=this._flatenParams(i),o=m+"&"+n.join("&");try{return(new Image).src=o,!0}catch(p){return this.debugTracker.warn("manager","Error firing pixel!"),!1}}}},{key:"_filterUndefinededParams",value:function c(a){return a.filter(function(a){return void 0!=a.value})}},{key:"_flatenParams",value:function d(a){return a.map(function(a){return a.key+"="+a.value})}},{key:"_flatenKeys",value:function e(a){var b={};return a.forEach(function(a,c,d){b[a.key]=a.value}),b}},{key:"_getBaseUrl",value:function h(a){var b=this.parameters,c=this.store.get("opps_base_path")||b.CM_DOMAIN,d=k.setUrlPrefix(c)+(/.*\/$/g.test(c)?"":"/")+"OpportunityServlet?";return d+="&auc-dast="+b.AUC_DAST,d+="&sts="+b.STS,d+="&wp="+b.WP,d+="&vpd="+(a.pubId||b.VPD),d+="&vptd="+(a.tagId||b.VPTD),d+="&vmt="+((a.isRon?1:0)||b.VMT||0),d+="&pv="+(this.store.get("player_version")||999),d+="&pt="+k.crc32(this.store.get("ab_test")||999),d+="&w="+this.store.get("width"),d+="&h="+this.store.get("height")}},{key:"_delayedParams",value:function j(a){var b=this.parameters,c=[];return c.push({key:"auc-dast",value:b.AUC_DAST}),c.push({key:"sts",value:b.STS}),c.push({key:"wp",value:b.WP}),c.push({key:"vpd",value:a.pubId||b.VPD}),c.push({key:"vptd",value:a.tagId||b.VPTD}),c.push({key:"vmt",value:(a.isRon?1:0)||b.VMT||0}),c.push({key:"pv",value:this.store.get("player_version")||999}),c.push({key:"pt",value:k.crc32(this.store.get("ab_test")||999)}),c.push({key:"w",value:this.store.get("width")}),c.push({key:"h",value:this.store.get("height")}),c}},{key:"destroy",value:function l(){this.debugTracker=void 0,this.store=void 0,this.oppsAggregator=void 0}}]),a}(),c["default"]=l,b.exports=c["default"]},{"../player/utils":28,"./Tracker":44}],42:[function(a,b,c){"use strict";b.exports={tagStarted:0,tagImpression:1,vastFecthError:2,emptyVast:3,mediaFileNotSupported:4,adError:5,filterVastByRegex:6,playerClosed:7,vastError:8,totalTimeout:9,vpaidFlashLoadTimeout:10,networkError:11,adUnitLoadFailed:12,queueExpired:13,queueTrimmed:14,globalTimeout:15,adtoTimeout:16,adSkiped:17,adloadedTimeout:18,requiredViewability:19,firstImpression:99,videoFirstQuartile:21,videoMidpoint:22,videoThirdQuartile:23,videoComplete:24,soundViolation:34,firstWfMeasurment:35,playerClosedMeasurment:36,adLoaded:41,startAd:42}},{}],43:[function(a,b,c){"use strict";function d(a){var b,c;if(a&&a.__esModule)return a;if(b={},null!=a)for(c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b["default"]=a,b}function e(a){return a&&a.__esModule?a:{"default":a}}function f(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var g,h,i,j,k,l,m,n,o,p,q;Object.defineProperty(c,"__esModule",{value:!0}),g=Object.assign||function(a){var b,c,d;for(b=1;b<arguments.length;b++){c=arguments[b];for(d in c)Object.prototype.hasOwnProperty.call(c,d)&&(a[d]=c[d])}return a},h=function(){function a(a,b){var c,d;for(c=0;c<b.length;c++)d=b[c],d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),i=a("./Tracker"),j=e(i),k=a("./trackingPixels"),l=d(k),m=a("./global-logger"),n=d(m),o=a("../player/utils"),p=d(o),q=function(){function a(b){f(this,a),this.trackingPixels=g({},l),this.debugTracker=new j["default"]("PixelManager"),this.pixelDataLoaded=!1,this.events=[],this.done=[],this.store=b}return h(a,[{key:"loadPixelData",value:function b(a){this.pixelDataLoaded,this.pixelDataLoaded=!0,this.trackingPixels=a}},{key:"firePixel",value:function c(a,b){var c,d,e,f,g,h,i,j;if(this.isValid(a)){switch(c=a.toLowerCase().replace(/^advideo|^aduser|^ad/gi,""),d=[],c){case"clickthrough":case"clickthru":for(e="",f=["adclickthrough","clickthrough","adclickthru","clickthru"],g=!1,h=0;h<f.length;h++)g||(i=f[h],this.trackingPixels.hasOwnProperty(i)&&this.trackingPixels[i].length&&(e=this.trackingPixels[i],g=!0));e&&e[0]&&(this.debugTracker.info("Opening Url","Opening url: ",e[0]),window.open(e[0])),d=d.concat(this._checkConcatPixels(this.trackingPixels.adclicktracking)),d=d.concat(this._checkConcatPixels(this.trackingPixels.clicktracking));break;case"start":this.trackingPixels.hasOwnProperty("creativeview")&&this.trackingPixels.creativeview.map(function(a){d.push(a)});default:d=d.concat(this._checkConcatPixels(this.trackingPixels[c])),d=d.concat(this._checkConcatPixels(this.trackingPixels["aduser"+c])),d=d.concat(this._checkConcatPixels(this.trackingPixels["advideo"+c])),d=d.concat(this._checkConcatPixels(this.trackingPixels["ad"+c]))}for(j=0;j<d.length;j++)!this._sendPixel(d[j],a,b);this.events.push(a)}}},{key:"isValid",value:function d(a){return"AdVideoComplete"!==a||this.events.indexOf("AdVideoThirdQuartile")!==-1}},{key:"destroy",value:function e(){this.debugTracker=this.trackingPixels=this.done=this.events=void 0}},{key:"_checkConcatPixels",value:function i(a){return a&&a.length?a:[]}},{key:"_sendPixel",value:function k(a,b,c){var d,e=c?c.data:null;if(n.reportPixel(a,b,e),this.done.indexOf(a)===-1){n.reportCleanPixel(a,b,e),d=c&&c.tag?c.tag.advId:null,this.done.push(a);try{return a=this._replaceMacros(a),d&&(this.store.getByAdvId("pxlnotsmtp",d)||(a+=(a.search(/\?/)>-1?"&":"?")+(new Date).getTime())),(new Image).src=a,!0}catch(f){return!1}}}},{key:"_replaceMacros",value:function m(a){var b=Date.now().toString(),c=b.substring(5);return a=a.replace("[CACHEBUSTING]",c)}}]),a}(),c["default"]=q,b.exports=c["default"]},{"../player/utils":28,"./Tracker":44,"./global-logger":53,"./trackingPixels":59}],44:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var e,f,g;Object.defineProperty(c,"__esModule",{value:!0}),e=function(){function a(a,b){var c,d;for(c=0;c<b.length;c++)d=b[c],d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=function h(){},g=function(){function a(b){d(this,a),this.label="["+b+"]";var c=this;this.debugLevels||(this.debugLevels={}),localStorage&&localStorage.getItem("dev")&&(this.debugLevels={error:1,warn:1,debug:1,event:1}),this.debugLevels.error&&(this.error=function e(a,b){console.error(c.label,"["+a+"]",b)}),this.debugLevels.warn&&(this.warn=function f(a,b){console.warn(c.label,"["+a+"]",b)}),this.debugLevels.info&&(this.info=function g(a,b){console.info(c.label,"["+a+"]",b)}),this.debugLevels.log&&(this.log=function h(a,b){console.log(c.label,"["+a+"]",b)}),this.debugLevels.debug&&(this.debug=function i(a,b,d){console.debug(d?"":"[-DEBUG-]"+c.label,"["+a+"]",b)}),this.debugLevels.event&&(this.event=function j(a,b){console.debug("[-EVENT-]"+c.label,"["+a+"]",b)})}return e(a,[{key:"error",value:function b(){}},{key:"warn",value:function c(){}},{key:"info",value:function f(){}},{key:"log",value:function g(){}},{key:"debug",value:function h(){}},{key:"event",value:function i(){}}]),a}(),c["default"]=g,b.exports=c["default"]},{}],45:[function(a,b,c){"use strict";function d(a){var b,c;if(a&&a.__esModule)return a;if(b={},null!=a)for(c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b["default"]=a,b}function e(a){return a&&a.__esModule?a:{"default":a}}function f(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B;Object.defineProperty(c,"__esModule",{value:!0}),g=function(){function a(a,b){var c,d;for(c=0;c<b.length;c++)d=b[c],d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=a("./Tracker"),i=e(h),j=a("../player/utils"),k=d(j),l=a("./trackingPixels"),m=e(l),n=a("./VpaidLog"),o=e(n),p=a("./global-logger"),q=d(p),r=a("./OpportunityType"),s=e(r),t=a("../player/Post"),u=e(t),v=a("./mediafile-filter"),w=e(v),x=a("../player/dynamicSettings"),y=d(x),z=a("zepto-browserify").$,window.vpaidId=Date.now()+"-"+parseInt(1e4*Math.random()),A=!1,B=function(){function a(b,c){f(this,a),this.vpaidWrapper=b.vpaidWrapper,this.trackingPixels=(0,m["default"])(),this.trackingPixels.adimpression=[b.internalPixel].concat(b.tag.conversionPixels),this.store=c,this.preferdVpaid=this.store.get("pvpd")||"flash",this.tag=b.tag,this.preferdVpaid=this.store.getByAdvId("pvpd",this.tag.advId)||this.preferdVpaid,this.vpaidLog=b.vpaidLog,this.stopped=!1,this.destroyed=!1,this.flashSupport=b.flashSupport,this.sendManager=b.sendManager,this.mode=b.mode?b.mode:"js",this.debugTracker=new i["default"]("VastParser"),this.width=parseInt(b.width),this.height=parseInt(b.height),this.bitrate=parseInt(b.bitrate),this.redirCount=0,this.isMobile=this.store.get("isMobile"),this.vastFetchxhrFirst=this.store.get("vstxhr")||!this.flashSupport,this.fileTypes=["flv","wmv","mp4","webm","ogg"],this.vastUrls=[]}return g(a,[{key:"_fetch",value:function b(a,c,d,e){var f=this,g=cmTag.$||g;g.ajax({url:a,beforeSend:function h(a){d&&(a.withCredentials=!0)},timeout:1e4,complete:function i(a,b,d){a.responseText&&c(null,a.responseText)},error:function j(b,d,g){return e?c(d):void f._fetch(a,c,!1,!0)}})}},{key:"_fetchVastZepto",value:function c(a,b,d){this._fetch(a,function(a,c){return a?d(a):void b(c)},!0)}},{key:"parseVastFromUrl",value:function d(a){var b,c,d,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return a&&(a=k.trim(a)),a=this._replaceMacros(a),this.vpaidLog.push("parseVastFromUrl",{url:a}),(b=(this.store.get("xhrz")||!0)&&this.isMobile)?void this._fetchVastZepto(a,this._onTagResponse.bind(this),this._onTagResponseError.bind(this)):(this.vastUrls.push(a),(c=this.store.get("vstprxy"))?this._fetchVastByProxy(a):(d=this._shouldPreferXhrForDomain(a),this.vastFetchxhrFirst||d||!this.sendManager?void this._fetchVastXhr(a):(this.sendManager.setVpiadLog(this.vpaidLog),void this.sendManager.send(a,this._onTagResponse.bind(this),this._onTagResponseError.bind(this)))))}},{key:"_fetchVastByProxy",value:function e(a){var b=this.store.get("pxyurl"),c=b+a;this._fetchVastXhr(c)}},{key:"_shouldPreferXhrForDomain",value:function h(a){var b=y.get(),c=b?b.xhr||[]:[],d=k.stripDomain(a),e=k.crc32(d),f=!1;return c.map(function(a){var b=k.crc32(a);b===e&&(f=!0)}),f}},{key:"_fetchVastXhr",value:function j(a){var b=this;(0,u["default"])(a,"",this._onTagResponse.bind(this),function(){b.sendManager?b.sendManager.send(a,b._onTagResponse.bind(b),b._onTagResponseError.bind(b)):b._onTagResponseError("vastxhrerror_noflash",a)})}},{key:"parseVastFromString",value:function l(a){this.vpaidLog.push("parseVastFromString",{xml:a}),this._onTagResponse(a)}},{key:"stop",value:function n(){this.debugTracker.info("Vast","VastParser Was Stopped!"),this.stopped=!0,this.vpaidLog=null,this.debugTracker=this.trackingPixels=void 0}},{key:"_extractDuration",value:function o(a){var b=this._extractTag("duration",a),c=30;return b&&b.length&&b[0].textContent&&(c=parseInt(b[0].textContent.replace("00:00:",""))),c}},{key:"_extractMediaFile",value:function p(a,b,c,d){var e,f,g,h,i,j,k;if(!this.stopped){for(this.debugTracker.info("Vast","Extracting MediaFiles"),e=!1,f=!1,g=this._getFilesTemplate(),h={},i=0;i<a.length;i++)if(j=this._getMediaFileType(a[i]),j&&j.url&&(0,w["default"])(j.url))this.vpaidLog.push("badMediaFile",{url:j.url});else switch(j.type){case"vpaid":"javascript"==j.subType?(e&&"javascript"!=e?f=!0:e="javascript",h.javascript=1,g.vpaid.javascript.push(j)):this.flashSupport&&(e&&"flash"!=e?f=!0:(e="flash",h.flash=1),g.vpaid.flash.push(j));break;case"video":e&&"video"!=e?f=!0:e="video",h.video=1,g.videoFiles[j.subType].push(j);break;default:f=!0,g.mixed.push(j)}if(f&&this.preferdVpaid&&h.hasOwnProperty(this.preferdVpaid)&&(e=this.preferdVpaid,this.debugTracker.info("Vast","Changed mode to "+e)),this.debugTracker.info("Vast","Found Mode is "+e),"video"==e)for(this.debugTracker.info("Vast","Runing video selection based on width["+this.width+"],height["+this.height+"] and bitrate["+this.bitrate+"]"),i=0;i<this.fileTypes.length;i++)k=this._chooseBestVideoFile(g.videoFiles[this.fileTypes[i]],this.bitrate,this.width,this.height),k&&k.url&&g.video.push(k);this._publishParseTagResults(e,g,b,c,d)}}},{key:"_publishParseTagResults",value:function q(a,b,c,d,e){if(!this.stopped){this.debugTracker.info("Vast","Publishing results, mode is "+a);var f=!1;switch(a){case"javascript":b.vpaid.javascript.length>0&&(f=!0);break;case"flash":b.vpaid.flash.length>0&&(f=!0);break;case"video":b.video.length>0&&(f=!0)}if(f){switch(this.vpaidLog.push("vpiadWrapperFound",{wrapperMode:a}),this.isMobile&&(a+="Mobile"),a){case"javascript":this.onVpaidJs(b.vpaid.javascript,c,this.trackingPixels,b);break;case"flash":this.onVpaidSwf(b.vpaid.flash,c,this.trackingPixels,b);break;case"video":this.onMp4Video(b.video,c,this.trackingPixels,b);break;case"javascriptMobile":this.onVpaidJsMobile(b.vpaid.javascript,c,this.trackingPixels,b,e);break;case"videoMobile":this.onMp4VideoMobile(b.video,c,this.trackingPixels,b,e)}this.store.set("currentAdDuration",e)}else this._onVastError("NoMediaFileAfterSort",d,s["default"].mediaFileNotSupported),this.vpaidLog&&this.vpaidLog.push("noMediaFileAfterSort",{})}}},{key:"_chooseBestVideoFile",value:function r(a,b,c,d){var e,f,g,h,i;if(this.stopped)return!1;for(e=!1,f=this.store.get("isMobile"),g=d/c,h=99999999,i=0;i<a.length;i++)a[i].ratioFactor=Math.abs(g-a[i].ratio),a[i].sizeFactor=Math.abs(c-a[i].width)+Math.abs(d-a[i].height),a[i].rateFactor=Math.abs(b-a[i].bitrate),a[i].weight=0,f&&(a[i].rateFactor*=-1,this._isRtmp(a[i].url)&&(a[i].weight=1e6)),a[i].score=100*a[i].ratioFactor+1*a[i].sizeFactor+a[i].rateFactor+a[i].weight,h>a[i].score&&(h=a[i].score,e=a[i]);return e}},{key:"_isRtmp",value:function t(a){return 0===a.indexOf("rtmp://")}},{key:"_getFilesTemplate",value:function v(){var a,b={video:[],videoFiles:{},vpaid:{flash:[],javascript:[]},mixed:[]};for(a=0;a<this.fileTypes.length;a++)b.videoFiles[this.fileTypes[a]]=[];return b}},{key:"_getMediaFileType",value:function x(a){var b,c,d,e;if(this.stopped)return{};switch(b={},b.url=a.textContent,b.url&&(b.url=k.trim(b.url)),c=parseInt(a.getAttribute("bitrate")),b.bitrate=c?c:0,d=parseInt(a.getAttribute("width")),b.width=d?d:0,e=parseInt(a.getAttribute("height")),b.height=e?e:0,b.originalType=a.getAttribute("type"),b.originalType){case"video/x-flv":b.type="video",b.subType="flv";break;case"video/x-ms-wmv":b.type="video",b.subType="wmv";break;case"video/mp4":b.type="video",b.subType="mp4";break;case"video/webm":b.type="video",b.subType="webm";break;case"video/ogg":b.type="video",b.subType="ogg";break;case"application/javascript":b.type="vpaid",b.subType="javascript";break;case"application/x-shockwave-flash":b.type="vpaid",b.subType="flash";break;default:b.type="unknown",b.subType="unknown"}return b.width&&b.height?b.ratio=b.height/b.width:b.ratio="1:1",b}},{key:"_extractTrackingEvents",value:function z(a){var b,c,d,e;if(!this.stopped&&(this.debugTracker.info("Vast","Extracting pixels from xml"),this._checkForSpecificEvent("impression",a),this._checkForSpecificEvent("error",a),this._checkForSpecificEvent("clickthru",a),this._checkForSpecificEvent("clickthrough",a),this._checkForSpecificEvent("clicktracking",a),b=this._extractTag("trackingevents",a),b.length>0))for(c=this._extractTag("tracking",b[0]),d=0;d<c.length;d++)e=c[d].getAttribute("event"),e&&this._addEventPixel(e.toLowerCase(),this._extractTagUrl(c[d]))}},{key:"_extractTagUrl",value:function A(a){var b,c;if(!this.stopped)return b=this._extractTag("url",a),c="",c=b.length>0?b[0].textContent:a.textContent}},{key:"_extractTag",value:function B(a,b){var c,d,e;if(!this.stopped){for(c=b.childNodes,d=[],e=0;e<c.length;e++)c[e].tagName&&(c[e].tagName.toLocaleLowerCase()==a?d.push(c[e]):d=d.concat(this._extractTag(a,c[e])));return d}}},{key:"_extractTagArttibute",value:function C(a,b,c){var d,e,f,g;if(!this.stopped){for(d=b.childNodes,e=[],f=0;f<d.length;f++)d[f].tagName&&(d[f].tagName.toLocaleLowerCase()==a?(g=d[f].getAttribute(c),e.push(g)):e=e.concat(this._extractTagArttibute(a,d[f],c)));return e}}},{key:"_filterVastByRegex",value:function D(a){var b,c,d=this.store.getByAdvId("regx",this.tag.advId);return!!d&&(b=new RegExp(d),c=b.exec(a),!(!c||!c.length)&&(this.vpaidLog.push("vastFilterdByRegex",{response:a,regex:d}),!0))}},{key:"_onTagResponse",value:function E(a,b){var c,d,e,f,g;if(!this.stopped){if(this.debugTracker.info("Vast","Vast was loaded"),this.vpaidLog.push("tagResponse",{response:a,xhrErrors:b}),this._filterVastByRegex(a))return this.vpaidLog.push("vastFilterdByRegex",{response:a,xhrErrors:b}),void this._onVastFilterdByRegexError("VastFilterdByRegex",a,s["default"].filterVastByRegex);if(c=this._parseXml(a),null==c)return void this._onVastError("ParsingError",a,s["default"].vastError);this.vastVersion=this._extractTagArttibute("vast",c,"version").shift()||"1.1",this.vpaidWrapper.setVastPrice(this._readTagPrice(c)),this.store.get("vastTypeMap")&&this.vpaidWrapper.setVastType(this._readType(a)),d=this._extractDuration(c),e=this._extractTag("mediafiles",c),e&&1==e.length&&e[0].childNodes.length?(f=this._extractTag("mediafile",e[0]),0==f.length?(this.debugTracker.error("Vast","No media files!"),this._onVastError("NoMediaFiles",a,s["default"].emptyVast)):(this._extractTrackingEvents(c),this._extractMediaFile(f,this._getAdParameters(c),a,d))):(g=this._extractTag("wrapper",c),1==g.length?(this._extractTrackingEvents(c),this._onWrapper(g[0],a)):this._onVastError("NoMediaFiles",a,s["default"].emptyVast))}}},{key:"_readTagPrice",value:function F(a){var b,c,d=this._extractTag("price",a).shift();if(d){b=0,c=d.textContent;try{isNaN(Number(c))&&c.indexOf("DATA")!=-1&&(b=c.replace(/[^0-9.]/g,"")),b=Number(c),b=b.toFixed(3),b=Number(b)}catch(e){b=0}}return b}},{key:"_readType",value:function G(a){var b,c=this.store.get("vastTypeMap"),d=void 0;for(b in c)a.search(new RegExp(b,"i"))!=-1&&(d=c[b]);return d}},{key:"_onWrapper",value:function H(a,b){var c,d;if(!this.stopped){if(this.debugTracker.info("VAST-WRAPPER","Vast Wrapper Was Detected!"),c=this._extractTag("vastadtagurl",a),0==c.length&&(c=this._extractTag("vastadtaguri",a),0==c.length))return this._onVastError("WrapperError",b,s["default"].vastWrapperError);if(d=this._extractTagUrl(c[0]),!d)return this._onVastError("WrapperError",b,s["default"].vastWrapperError);0===this.redirCount&&this._logToBI("VastWrapper",{type:"wrapper"}),this.redirCount++,this.parseVastFromUrl(d)}}},{key:"_getAdParameters",value:function I(a){var b,c;if(!this.stopped)return b="",c=this._extractTag("adparameters",a),c.length>0&&c[0].textContent?(c.length>1&&this.debugTracker.warn("Vast","Found more than 1 <AdParameters> tag!Using [0]"),b=c[0].textContent):this.debugTracker.warn("Vast","Did not find <AdParameters>!"),b}},{key:"_checkForSpecificEvent",value:function J(a,b){var c,d;if(!this.stopped)for(c=this._extractTag(a,b),d=0;d<c.length;d++)this._addEventPixel(a,this._extractTagUrl(c[d]))}},{key:"_addEventPixel",value:function K(a,b){this.stopped||(void 0!=this.trackingPixels[a]?b?this.trackingPixels[a].push(b):this.debugTracker.warn("TrackingEvents","Empty pixel at '"+a+"'"):this.debugTracker.warn("TrackingEvents","Unsupported event '"+a+"'"))}},{key:"_parseXml",value:function L(a){if(this.stopped)return null;var b=null;if(window.DOMParser)try{b=(new DOMParser).parseFromString(a,"text/xml")}catch(c){b=null}else if(window.ActiveXObject)try{b=new ActiveXObject("Microsoft.XMLDOM"),b.async=!1,b.loadXML(a)||(b=null)}catch(c){b=null}return b}},{key:"_onTagResponseError",value:function M(a,b){if(!this.stopped){if(this.vpaidWrapper.vpaidHandler)return void this._logToBI("VastParserOnTagResponseError",{type:"wrapper has handler"});this.debugTracker.error("Vast","Vast url was not loaded!aborting..."),this._reportToServer(a,"VastLoadError="+a+"&URL="+encodeURIComponent(b)),this.vpaidLog.push("tagLoadError",{errorCodes:a,url:b,urls:this.vastUrls}),a&&Array.isArray(a)?this.onNetworkFail(a):this.onFail(a)}}},{key:"_onVastError",value:function N(a,b,c){this.stopped||(this.debugTracker.error("VAST-ERROR",a),this.vpaidLog.push("vastParseError",{errType:a}),this.onFail(a,c))}},{key:"_onVastFilterdByRegexError",value:function O(a,b,c){this.stopped||(this.debugTracker.error("VAST-ERROR",a),this.vpaidLog.push("VastFilterdByRegexError",{errType:a}),this.onFail(a,c))}},{key:"_sampleVastXml",value:function P(a){this.stopped||this.debugTracker.info("Vast","Vast Sample Sent!")}},{key:"_reportToServer",value:function Q(a,b){}},{key:"destroy",value:function R(){this.stopped=!0,this.destroyed=!0,this.vpaidLog=null,this.vastUrls=null,this.tag=null,this.trackingPixels=this.debugTracker=this.fileTypes=void 0,this._onTagResponse=this._onTagResponseError=function(){},this.onFail=this.onNetworkFail=this.onVpaidJs=this.onVpaidSwf=this.onMp4Video=function(){},this.sendManager&&this.sendManager.destroy(),this.sendManager=null}},{key:"_logToBI",value:function S(a,b){this.vpaidLog&&this.vpaidLog.push(a,b)}},{key:"_replaceMacros",value:function T(a){return a=a.replace(/\[CACHEBUSTER\]/,Date.now())}},{key:"onFail",value:function U(a){}},{key:"onNetworkFail",value:function V(a,b){}},{key:"onVpaidJs",value:function W(a,b,c,d){}},{key:"onVpaidSwf",value:function X(a,b,c,d){}},{key:"onMp4Video",value:function Y(a,b,c,d){}}]),a}(),c["default"]=B,b.exports=c["default"]},{"../player/Post":16,"../player/dynamicSettings":26,"../player/utils":28,"./OpportunityType":42,"./Tracker":44,"./VpaidLog":48,"./global-logger":53,"./mediafile-filter":55,"./trackingPixels":59,"zepto-browserify":5}],46:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var f,g,h,i,j,k,l,m,n;Object.defineProperty(c,"__esModule",{value:!0}),f=Object.assign||function(a){var b,c,d;for(b=1;b<arguments.length;b++){c=arguments[b];for(d in c)Object.prototype.hasOwnProperty.call(c,d)&&(a[d]=c[d])}return a},g=function(){function a(a,b){var c,d;for(c=0;c<b.length;c++)d=b[c],d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=a("./Beacon"),i=d(h),j=a("./Tracker"),k=d(j),l=a("./vpaidEvents"),m=d(l),n=function(){function a(b,c,d){e(this,a),this.vpaidLog=c,this.store=d,this.type="video",this.stopped=!1,this.version="1.1",this.target=b.slot,this.video=b.videoSlot,this.mediaFiles=b.vpaidFiles,this.mediaUrl,this.videoSlotControls=b.videoSlotControls,this.videoSlotCanAutoPlay=b.videoSlotCanAutoPlay,this._PlayerWidth=0,this._PlayerHeight=0,this._AdVolume=0,this._AdLinear=!0,this._AdExpanded=!0,this._AdCompanions=[],this._AdIcons=[],this._SkipTime=60,this._AdPlaying=!1,this._AdPaused=!1,this._PlayerReady=!1,this._FirstFired=!1,this._MidFired=!1,this._ThirdFired=!1,this._VideoLength=0,this._relevantSources=0,this._errorsCount=0,this.debugTracker=new k["default"]("VideoVpaid"),this.beacon=new i["default"](this),this.vpaidEvents=f({},m["default"]),this.decodeUrl=this.store.get("dcdvdurl"),window.setTimeout(b.onReady,0)}return g(a,[{key:"_onCanPlay",value:function b(){this.stopped||(this._VideoLength=this.video.duration,this.vpaidLog.push("canplay",{videoCanPlay:!0}),this._PlayerReady||(this._PlayerReady=!0,this.video.pause(),this.beacon.dispatchEvent(this.vpaidEvents.AdLoaded),this._AdPlaying&&this._fireAdImpression()))}},{key:"_onPlay",value:function c(){return!this.startAdFired||(this.video.play(),void(this.stopped||(this._AdPaused=!1,this._AdPlaying?this.beacon.dispatchEvent(this.vpaidEvents.AdPlaying):(this._AdPlaying=!0,this._PlayerReady&&setTimeout(function(){this._fireAdImpression()}.bind(this),200)))))}},{key:"_onPause",value:function d(){this.stopped||(this._AdPaused=!0,parseInt(this.video.currentTime)>0&&parseInt(this.video.currentTime)<parseInt(this.video.duration)&&this.beacon.dispatchEvent(this.vpaidEvents.AdPaused))}},{key:"_onComplete",value:function h(){this.stopped||(this.beacon.dispatchEvent(this.vpaidEvents.AdVideoComplete),this.beacon&&!this.stayAlive&&this.beacon.dispatchEvent(this.vpaidEvents.AdStopped))}},{key:"_onPlayerError",value:function j(a){this.stopped||(this._errorsCount++,this._errorsCount>=this._relevantSources&&this.beacon.dispatchEvent(this.vpaidEvents.AdError))}},{key:"_onVolume",value:function l(){this.stopped||this.beacon.dispatchEvent(this.vpaidEvents.AdVolumeChange,{volume:this.video.volume})}},{key:"_onClickThru",value:function n(){this.stopped||(this._AdPaused?this.video.play():(this.beacon.dispatchEvent(this.vpaidEvents.AdClickThru),this.video.pause()))}},{key:"_onDurationChange",value:function o(){this.stopped||this.beacon.dispatchEvent(this.vpaidEvents.AdDurationChange)}},{key:"_onTimeUpdate",value:function p(){if(!this.stopped&&!this._ThirdFired&&this._VideoLength){var a=this.video.currentTime/this._VideoLength;a>.25&&!this._FirstFired?(this._FirstFired=!0,this.beacon.dispatchEvent(this.vpaidEvents.AdVideoFirstQuartile)):a>.5&&!this._MidFired?(this._MidFired=!0,this.beacon.dispatchEvent(this.vpaidEvents.AdVideoMidpoint)):a>.75&&!this._ThirdFired&&(this._ThirdFired=!0,this.beacon.dispatchEvent(this.vpaidEvents.AdVideoThirdQuartile))}}},{key:"_connectToVideoTag",value:function q(){this.stopped||(this.video.addEventListener("canplay",this._onCanPlay.bind(this),!0),this.video.addEventListener("play",this._onPlay.bind(this),!0),this.video.addEventListener("pause",this._onPause.bind(this),!0),this.video.addEventListener("ended",this._onComplete.bind(this),!0),this.video.addEventListener("error",this._onPlayerError.bind(this),!0),this.video.addEventListener("click",this._onClickThru.bind(this),!0),this.video.addEventListener("volumechange",this._onVolume.bind(this),!0),this.video.addEventListener("timeupdate",this._onTimeUpdate.bind(this),!0),this.video.addEventListener("durationchange",this._onDurationChange.bind(this),!0))}},{key:"_disconnectFromVideoTag",value:function r(){this.video.removeEventListener("canplay",this._onCanPlay),this.video.removeEventListener("play",this._onPlay),this.video.removeEventListener("pause",this._onPause),this.video.removeEventListener("ended",this._onComplete),this.video.removeEventListener("error",this._onPlayerError),this.video.removeEventListener("click",this._onClickThru),this.video.removeEventListener("volumechange",this._onVolume),this.video.removeEventListener("timeupdate",this._onTimeUpdate),this.video.removeEventListener("durationchange",this._onDurationChange)}},{key:"_prepareVideoTag",value:function s(){this.stopped||(this.video.removeAttribute("controls"),this._connectToVideoTag(),this._loadVideoTagSources())}},{key:"_loadVideoTagSources",value:function t(){var a,b,c;if(!this.stopped){for(;this.video.childNodes.length;)this.video.removeChild(this.video.childNodes[0]);for(a=0;a<this.mediaFiles.length;a++)b=document.createElement("source"),c=this.mediaFiles[a],this.video.canPlayType(c.originalType)&&(this._relevantSources++,this.mediaUrl=this.decodeUrl?decodeURI(c.url):c.url,b.src=this.mediaUrl,b.setAttribute("type",c.originalType),this.video.appendChild(b))}}},{key:"_fireAdImpression",value:function u(){this.fireImpression||this._fireAdImprssionEvents()}},{key:"_fireAdImprssionEvents",value:function v(){this.beacon.dispatchEvent(this.vpaidEvents.AdVideoStart),this.beacon.dispatchEvent(this.vpaidEvents.AdImpression),this.fireImpression=!0}},{key:"resizeAd",value:function w(a,b,c){this.stopped||(this._PlayerWidth=parseInt(a),this._PlayerHeight=parseInt(b),this.video.style.width=this._PlayerWidth+"px",this.target.style.width=this._PlayerWidth+"px",this.video.style.height=this._PlayerHeight+"px",this.target.style.height=this._PlayerHeight+"px",this.video.setAttribute("width",this._PlayerWidth),this.target.setAttribute("width",this._PlayerWidth),this.video.setAttribute("height",this._PlayerHeight),this.target.setAttribute("height",this._PlayerHeight))}},{key:"initAd",value:function x(a,b,c,d,e,f){this.stopped||(this.resizeAd(a,b,c),this._prepareVideoTag())}},{key:"stopAd",value:function y(a){if(!this.stopped){for(this.stopped=!0,this.video.pause(),this._disconnectFromVideoTag();this.video.childNodes.length;)this.video.removeChild(this.video.childNodes[0]);this.video.src="",this.debugTracker=void 0,this.vpaidLog=void 0,this.store=void 0,this.mediaFiles=this.target=this.beacon=this.video=this.target=this._onError=void 0,setTimeout(this.onAfterStop,50)}}},{key:"pauseAd",value:function z(){this.stopped||this.video.pause()}},{key:"resumeAd",value:function A(){this.stopped||this.store.get("forcePause")||(this.resumed=!0,this.video.play(),this.beacon.dispatchEvent(this.vpaidEvents.AdPlaying))}},{key:"skipAd",value:function B(){this.stopped||this.getAdSkippableState()&&this.stopAd()}},{key:"setAdVolume",value:function C(a){this.stopped||(this._AdVolume=parseFloat(a)<=1?a:parseInt(a)/100,this.video.volume=this._AdVolume)}},{key:"getAdWidth",value:function D(){return this._PlayerWidth}},{key:"getAdHeight",value:function E(){return this._PlayerHeight}},{key:"getAdSkippableRemainingTime",value:function F(){var a=this.getAdRemainingTime()-this._SkipTime;return a>0?a:0}},{key:"getAdRemainingTime",value:function G(){return this._VideoLength-this.video.currentTime}},{key:"getAdDuration",value:function H(){return this._VideoLength}},{key:"getAdSkippableState",value:function I(){return 0==this.getAdSkippableRemainingTime()}},{key:"getDOMContainer",value:function J(){return this.target}},{key:"startAd",value:function K(){this.videoSlotCanAutoPlay||this.video.play(),this.startAdFired=!0,this._onPlay()}},{key:"restartAd",value:function L(){this.video.currentTime=0,this.video.play(),this.beacon.dispatchEvent(this.vpaidEvents.AdVideoStart)}},{key:"expandAd",value:function M(){}},{key:"collapseAd",value:function N(){}},{key:"getAdVolume",value:function O(){return this._AdVolume}},{key:"getAdIcons",value:function P(){return this._AdIcons}},{key:"getAdCompanions",value:function Q(){
return this._AdCompanions}},{key:"getAdExpanded",value:function R(){return this._AdExpanded}},{key:"getAdLinear",value:function S(){return this._AdLinear}},{key:"handshakeVersion",value:function T(){return this.version}},{key:"subscribe",value:function U(a,b){this.vpaidEvents[b]?this.beacon.addEventListener(b,a):this.debugTracker.warn("subscribe","Unsupported event '"+b+"'")}},{key:"unsubscribe",value:function V(a,b){if(this.vpaidEvents[b]){if(void 0==a)return;this.beacon.removeEventListener(b,a)}else this.debugTracker.warn("unsubscribe","Unsupported event '"+b+"'")}},{key:"onAfterStop",value:function W(){}},{key:"dontDie",value:function X(){this.stayAlive=!0}},{key:"_getMediaUrl",value:function Y(){return this.mediaUrl}}]),a}(),c["default"]=n,b.exports=c["default"]},{"./Beacon":29,"./Tracker":44,"./vpaidEvents":60}],47:[function(a,b,c){"use strict";function d(a){var b,c;if(a&&a.__esModule)return a;if(b={},null!=a)for(c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b["default"]=a,b}function e(a){return a&&a.__esModule?a:{"default":a}}function f(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var g,h,i,j,k,l,m,n,o,p,q,r,s;Object.defineProperty(c,"__esModule",{value:!0}),g=Object.assign||function(a){var b,c,d;for(b=1;b<arguments.length;b++){c=arguments[b];for(d in c)Object.prototype.hasOwnProperty.call(c,d)&&(a[d]=c[d])}return a},h=function(){function a(a,b){var c,d;for(c=0;c<b.length;c++)d=b[c],d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),i=a("./Beacon"),j=e(i),k=a("./Tracker"),l=e(k),m=a("./vpaidEvents"),n=e(m),o=a("./Mpg1Canvas"),p=e(o),q=a("../player/dynamicSettings"),r=d(q),s=function(){function a(b,c,d){var e,h=this;f(this,a),this.vpaidLog=c,this.store=d,this.type="video",this.stopped=!1,this.version="1.1",this.target=b.slot,this.video=b.videoSlot,this.useCanvasMpeg=this.store.get("uscnvsmpg")||!1,this.hasAutoPlay=this.store.get("hasAutoPlay")||!1,this.isMobile=this.store.get("isMobile")||!1,this.tag=b.tag,this.isCanvasMpeg=this._decideCanvas(),this.isCanvasMpeg?(this.canvas=new p["default"](this.video,this,null,null,d),this.canvas.on("ready",function(){h.beacon.dispatchEvent(h.vpaidEvents.AdLoaded)}),e=document.getElementsByClassName("vpaid-ad-controls")[0],e&&(e.className+=" hide")):setTimeout(function(){h.beacon&&h.beacon.dispatchEvent(h.vpaidEvents.AdLoaded)},2e3),c.push("vpaidInit",{hasAutoPlay:this.hasAutoPlay,isCanvasMpeg:this.isCanvasMpeg,forceCavnas:this.store.get("forcecnvsmpg"),useAutoPlayForContent:this.store.get("useapforcntnt"),isMobile:this.isMobile}),this.mediaFiles=b.vpaidFiles,this.mediaUrl,this.videoSlotControls=b.videoSlotControls,this.videoSlotCanAutoPlay=b.videoSlotCanAutoPlay,this._PlayerWidth=0,this._PlayerHeight=0,this.volume=0,this._AdLinear=!0,this._AdExpanded=!0,this._AdCompanions=[],this._AdIcons=[],this._SkipTime=60,this._AdPlaying=!1,this._AdPaused=!1,this._PlayerReady=!1,this._FirstFired=!1,this._MidFired=!1,this._ThirdFired=!1,this._VideoLength=b.extra.duration||30,this._relevantSources=0,this._errorsCount=0,this.debugTracker=new l["default"]("VideoVpaid"),this.beacon=new j["default"](this),this.vpaidEvents=g({},n["default"]),this.decodeUrl=this.store.get("dcdvdurl"),window.setTimeout(b.onReady,0)}return h(a,[{key:"_decideCanvas",value:function b(){var a,b,c,d;return!!this.store.get("uscnvsmpg")&&(a=r.get()||{},b=a.mobAp||[],c=this.tag.advId,b.indexOf(c)>-1?(this.vpaidLog.push("canvasOptOutByAdvId",{advId:c}),!1):(d=this.store.get("forcecnvsmpg")||!1,this.useCanvasMpeg&&!this.hasAutoPlay&&this.isMobile||d))}},{key:"muteClick",value:function c(){this.stopped||(this.canvas?this.canvas.muteButtonClick():this.volume?this.setAdVolume(0):this.setAdVolume(.7))}},{key:"playButtonClick",value:function d(){this.stopped||(this.canvas?this.canvas.playButtonClick():this._AdPaused?this.play():this.pause())}},{key:"_onCanPlay",value:function e(){this.stopped||(this._VideoLength=this.video.duration,this.vpaidLog.push("canplay",{videoCanPlay:!0,hasAutoPlay:this.hasAutoPlay,isCanvasMpeg:this.isCanvasMpeg}),this._PlayerReady||(this._PlayerReady=!0,this.isMobile||this.video.pause(),this.beacon.dispatchEvent(this.vpaidEvents.AdLoaded),this._AdPlaying&&this._fireAdImpression()))}},{key:"_onPlaying",value:function i(){this.stopped||this.vpaidLog&&this.vpaidLog.push("videoPlaying",{vidCurrentTime:this.video.currentTime})}},{key:"_onPlay",value:function k(){var a,b=this;if(!this.stopped){if(!this.startAdFired)return!0;this.video.play(),this.beacon.dispatchEvent(this.vpaidEvents.AdVideoStart),this.stopped||(this._AdPaused=!1,this._AdPlaying?this.beacon.dispatchEvent(this.vpaidEvents.AdPlaying):(this._AdPlaying=!0,setTimeout(function(){b._fireAdImpression()},2e3)),a=this,setTimeout(function(){a.stopped||a.vpaidLog.push("videoTimeAfter5sec",{vidCurrentTime:b.video.currentTime,hasAutoPlay:b.hasAutoPlay,isCanvasMpeg:b.isCanvasMpeg})},5e3),this.isMobile&&(this.timeUpdateInterval=setInterval(function(){a.stopped||a._onTimeUpdate()},2e3)))}}},{key:"_onPause",value:function m(){this.stopped||(this._AdPaused=!0,parseInt(this.video.currentTime)>0&&parseInt(this.video.currentTime)<parseInt(this.video.duration)&&this.beacon.dispatchEvent(this.vpaidEvents.AdPaused))}},{key:"_onComplete",value:function o(){this.stopped||(this.beacon.dispatchEvent(this.vpaidEvents.AdVideoComplete),this.beacon&&this.beacon.dispatchEvent(this.vpaidEvents.AdStopped))}},{key:"_onPlayerError",value:function q(a){this.isCanvasMpeg||(this.vpaidLog&&this.vpaidLog.push("videoError",{value:a,hasAutoPlay:this.hasAutoPlay,isCanvasMpeg:this.isCanvasMpeg}),this.stopped||(this._errorsCount++,this._errorsCount>=this._relevantSources&&this.beacon.dispatchEvent(this.vpaidEvents.AdError)))}},{key:"_onVolume",value:function s(){this.stopped||(this.vpaidLog.push("volumeChange",{value:this.video.volume,hasAutoPlay:this.hasAutoPlay,isCanvasMpeg:this.isCanvasMpeg}),this.beacon.dispatchEvent(this.vpaidEvents.AdVolumeChange,{volume:this.video.volume}))}},{key:"_onClickThru",value:function t(){this.stopped||(this._AdPaused||this.store.get("dataSaverDetected")&&0===this.video.currentTime?this.video.play():(this.beacon.dispatchEvent(this.vpaidEvents.AdClickThru),this.video.pause()))}},{key:"_onDurationChange",value:function u(){this.stopped||this.beacon.dispatchEvent(this.vpaidEvents.AdDurationChange)}},{key:"_onTimeUpdate",value:function v(){if(!this.stopped&&!this._ThirdFired&&this._VideoLength){var a=this.video.currentTime/this._VideoLength;a>.25&&!this._FirstFired?(this._FirstFired=!0,this.beacon.dispatchEvent(this.vpaidEvents.AdVideoFirstQuartile)):a>.5&&!this._MidFired?(this._MidFired=!0,this.beacon.dispatchEvent(this.vpaidEvents.AdVideoMidpoint)):a>.75&&!this._ThirdFired&&(this._ThirdFired=!0,this.beacon.dispatchEvent(this.vpaidEvents.AdVideoThirdQuartile))}}},{key:"_connectToVideoTag",value:function w(){this.stopped||(this.video.addEventListener("canplay",this._onCanPlay.bind(this),!0),this.video.addEventListener("play",this._onPlay.bind(this),!0),this.video.addEventListener("playing",this._onPlaying.bind(this),!0),this.video.addEventListener("pause",this._onPause.bind(this),!0),this.video.addEventListener("ended",this._onComplete.bind(this),!0),this.video.addEventListener("error",this._onPlayerError.bind(this),!0),this.video.addEventListener("click",this._onClickThru.bind(this),!0),this.video.addEventListener("volumechange",this._onVolume.bind(this),!0),this.video.addEventListener("timeupdate",this._onTimeUpdate.bind(this),!0),this.video.addEventListener("durationchange",this._onDurationChange.bind(this),!0))}},{key:"_disconnectFromVideoTag",value:function x(){this.video.removeEventListener("canplay",this._onCanPlay),this.video.removeEventListener("play",this._onPlay),this.video.removeEventListener("pause",this._onPause),this.video.removeEventListener("ended",this._onComplete),this.video.removeEventListener("error",this._onPlayerError),this.video.removeEventListener("click",this._onClickThru),this.video.removeEventListener("volumechange",this._onVolume),this.video.removeEventListener("timeupdate",this._onTimeUpdate),this.video.removeEventListener("durationchange",this._onDurationChange)}},{key:"_prepareVideoTag",value:function y(){this.stopped||(this.video.removeAttribute("controls"),!this.isCanvasMpeg&&this.isMobile&&this.video.classList.remove("vjs-default-skin"),this.video.setAttribute("muted",""),this.video.setAttribute("playsinline",""),this._connectToVideoTag(),this._loadVideoTagSources())}},{key:"_loadVideoTagSources",value:function z(){var a,b;if(!this.stopped){for(;this.video.childNodes.length;)this.video.removeChild(this.video.childNodes[0]);for(this._sortMediaFiles(),a=0;a<this.mediaFiles.length;a++)b=this.mediaFiles[a],this.video.canPlayType(b.originalType)&&(this._relevantSources++,this.mediaUrl=this.decodeUrl?decodeURI(b.url):b.url,this.video.src=this.mediaUrl)}}},{key:"_sortMediaFiles",value:function A(){var a=this._PlayerWidth;this.mediaFiles.sort(function b(c,d){var e=Math.abs(a-c.width),f=Math.abs(a-d.width);return e-f}),this.mediaFiles.sort(function(a,b){return a.bitRate-b.bitRate})}},{key:"_fireAdImpression",value:function B(){this.stopped||this.fireImpression||(this.beacon.dispatchEvent(this.vpaidEvents.AdVideoStart),this.beacon.dispatchEvent(this.vpaidEvents.AdImpression),this.fireImpression=!0)}},{key:"resizeAd",value:function C(a,b,c){this.stopped||(this._PlayerWidth=parseInt(a),this._PlayerHeight=parseInt(b),this.video.style.width=this._PlayerWidth+"px",this.target.style.width=this._PlayerWidth+"px",this.video.style.height=this._PlayerHeight+"px",this.target.style.height=this._PlayerHeight+"px",this.video.setAttribute("width",this._PlayerWidth),this.target.setAttribute("width",this._PlayerWidth),this.video.setAttribute("height",this._PlayerHeight),this.target.setAttribute("height",this._PlayerHeight),this.canvas&&this.canvas.onResize(a,b))}},{key:"initAd",value:function D(a,b,c,d,e,f){this.stopped||(this.resizeAd(a,b,c),this._prepareVideoTag())}},{key:"stopAd",value:function E(a){if(!this.stopped){for(this.stopped=!0,this.video.pause(),this._disconnectFromVideoTag(),this.canvas&&this.canvas.destroy();this.video.childNodes.length;)this.video.removeChild(this.video.childNodes[0]);this.video.src="",this.debugTracker=void 0,this.vpaidLog=void 0,this.store=void 0,this.mediaFiles=this.target=this.beacon=this.video=this.target=this._onError=void 0,clearTimeout(this.timeUpdateInterval),setTimeout(this.onAfterStop,50)}}},{key:"pauseAd",value:function F(){this.stopped||this.video.pause()}},{key:"resumeAd",value:function G(){this.stopped||this.store.get("forcePause")||(this.video.play(),this.beacon.dispatchEvent(this.vpaidEvents.AdPlaying))}},{key:"skipAd",value:function H(){this.stopped||this.getAdSkippableState()&&this.stopAd()}},{key:"setAdVolume",value:function I(a){this.stopped||(this.video.muted=!a,this.video.volume=this.volume=parseFloat(a)<=1?a:parseInt(a)/100)}},{key:"getAdWidth",value:function J(){return this._PlayerWidth}},{key:"getAdHeight",value:function K(){return this._PlayerHeight}},{key:"getAdSkippableRemainingTime",value:function L(){var a=this.getAdRemainingTime()-this._SkipTime;return a>0?a:0}},{key:"getAdRemainingTime",value:function M(){return this._VideoLength-this.video.currentTime}},{key:"getAdDuration",value:function N(){return this._VideoLength}},{key:"getAdSkippableState",value:function O(){return 0==this.getAdSkippableRemainingTime()}},{key:"startAd",value:function P(){this.startAdFired=!0,this._onPlay()}},{key:"restartAd",value:function Q(){if(!this.stopped){if(this.canvas)return void this.canvas.restartAd();this.video.currentTime=0,this.video.play()}}},{key:"expandAd",value:function R(){}},{key:"collapseAd",value:function S(){}},{key:"getAdVolume",value:function T(){return this.volume}},{key:"getAdIcons",value:function U(){return this._AdIcons}},{key:"getAdCompanions",value:function V(){return this._AdCompanions}},{key:"getAdExpanded",value:function W(){return this._AdExpanded}},{key:"getAdLinear",value:function X(){return this._AdLinear}},{key:"getDOMContainer",value:function Y(){return this.target}},{key:"handshakeVersion",value:function Z(){return this.version}},{key:"subscribe",value:function $(a,b){this.stopped||(this.vpaidEvents[b]?this.beacon.addEventListener(b,a):this.debugTracker.warn("subscribe","Unsupported event '"+b+"'"))}},{key:"unsubscribe",value:function _(a,b){if(!this.stopped)if(this.vpaidEvents[b]){if(void 0==a)return;this.beacon.removeEventListener(b,a)}else this.debugTracker.warn("unsubscribe","Unsupported event '"+b+"'")}},{key:"onAfterStop",value:function aa(){}},{key:"_getMediaUrl",value:function ba(){return this.mediaUrl}}]),a}(),c["default"]=s,b.exports=c["default"]},{"../player/dynamicSettings":26,"./Beacon":29,"./Mpg1Canvas":39,"./Tracker":44,"./vpaidEvents":60}],48:[function(a,b,c){"use strict";function d(a){var b,c;if(a&&a.__esModule)return a;if(b={},null!=a)for(c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b["default"]=a,b}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var f,g,h,i,j,k,l;Object.defineProperty(c,"__esModule",{value:!0}),f=function(){function a(a,b){var c,d;for(c=0;c<b.length;c++)d=b[c],d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g=a("../player/utils"),h=d(g),i={event_AdImpression:"conversion",event_SoundViolation:"soundViolation",adStartTimeout:"adStartTimeout",AutoKill:"timeoutAutoKill",AdStopADTO:"tillAdstartTimeout",queueTrimmed:"queueTrimmed",adPlayTimeout:"adPlayTimeout",queExpierd:"queExpierd",queTrimmed:"queTrimmed",tagError:"tagError",tagFlashError:"tagFlashError",tagErrorDetails:"vpaidFlashClientError",vastFilterdByRegex:"vastFilterdByRegex",event_AdLoaded:"adLoaded",fetchVastXhr:"fetchVastXhr",fetchVastFlash:"fetchVastFlash",fetchVastFallToXhr:"fetchVastFallToXhr",vpaidTimeout_AdLoaded:"vpaidTimeout_AdLoaded",creatingVpaidHandler:"creatingVpaidHandler",createdVpaidHandler:"createdVpaidHandler",creatingVpaidHandlerError:"creatingVpaidHandlerError",networkError:"networkError",vpaidFlashLoadTimeout:"vpaidFlashLoadTimeout",adUnitLoadFailed:"adUnitLoadFailed",adloadedTimeout:"adloadedTimeout",adImpressionTimeout:"adImpressionTimeout",playerClosed:"playerClosed"},j=["conversion","soundViolation","timeout","bfRon","adPlayTimeout","vastFilterdByRegex","queExpierd","queTrimmed","tagError","tagFlashError","vpaidFlashClientError","queueTrimmed","tillAdstartTimeout","timeoutAutoKill","vpaidTimeout","creatingVpaidHandlerError","networkError","vpaidFlashLoadTimeout","adUnitLoadFailed","adloadedTimeout","adImpressionTimeout"],k={BfRon:!0},l=function(){function a(b,c){e(this,a),this.tag=b,this.store=c,this.created=Date.now(),this.data={tag:b,isMobile:b.isMobile,created:(new Date).toISOString(),dp:b.dp,status:"new",statuses:["new"],rollType:b.rollType,unitType:b.unitType,unitVersion:b.unitVersion,rpox:b.rpox,alfrox:b.alfrox,frox:b.frox,itemScore:-1,flashSupport:this.store.get("flashSupported"),waterfallIndex:b.waterfallIndex,fullPageUrl:this.store.get("fullPageUrl"),requiredViewability:b.requiredViewability,documentVisible:!document.hidden},this.sessionStarted=this.store.get("session_started")||Date.now()}return f(a,[{key:"push",value:function b(a,c){var d,e,f;return a.indexOf("AdError")>-1||"event_SoundViolation"===a?this._addStatus(this._prettyErrorStatus(a,c)):i.hasOwnProperty(a)&&"conversion"!==this.data.status?this._addStatus(i[a]):k.hasOwnProperty(a)&&(d="is"+a,this.data[d]=!0),e=Date.now()-this.sessionStarted,f=Date.now()-this.created,c.time=f,c.globalTime=e,this.data.hasOwnProperty(a)?(Array.isArray(!this.data[a])||(this.data[a]=[this.data[a]]),this.data[a].push(c),void(this.data[a].length>3&&this.data[a].splice(0,1))):(this.data[a]=c,void(j.indexOf(this.data.status)!==-1&&this._setDpStats()))}},{key:"_prettyErrorStatus",value:function c(a,b){var c="error_";return c+=b.errType?b.errType:a}},{key:"_setDpStats",value:function d(){var a,b,c,d;this.isDPStatusSet||this.store.get("static_schedule")||(a=Date.now(),this.data.timeFromLastPlayFromQueue=a-this.store.get("playFromQueue"),this.data.timeFromLastPlayFromQueueFound=a-this.store.get("playFromQueueFound"),this.isDPStatusSet=!0,this._incrStats(".tries"),"conversion"===this.data.status?(this._incrStats(".conversions"),this.store.set(this.tag.dp+".failsRow",0),this.store.set(this.tag.lineItem+".failsRow",0)):(this._incrStats(".fails"),this.store.get(this.tag.lineItem+".failsRow")<0?this.store.set(this.tag.lineItem+".failsRow",1):this._incrStats(".failsRow")),b=this.store.get(this.tag.dp)||{fails:0,failsRow:0,conversions:0},c=this.store.get(this.tag.lineItem)||{},c.fails||(c.fails=0),c.failsRow||(c.failsRow=0),c.conversions||(c.conversions=0),b.lineItems=b.lineItems||[],b.lineItems.indexOf(this.tag.lineItem)===-1&&b.lineItems.push(this.tag.lineItem),this.data.dpLog=b,this.data.conversionsCount=this.store.get("conversionsCount"),this.data.unit={width:this.store.get("width"),height:this.store.get("height")},d=this.store.get("lineItems")||[],d.indexOf(this.tag.lineItem)===-1&&(d.push(this.tag.lineItem),this.store.set("lineItems",d)),this.store.set(this.tag.lineItem,c))}},{key:"_incrStats",value:function g(a){this.store.incr(this.tag.dp+a),this.store.incr(this.tag.lineItem+a)}},{key:"saveToDb",value:function l(){if(this.data){this._setDpStats();var a;try{a=cmTag.utils.getLoopTime()}catch(b){}a&&(this.data.loopTime=a),h.reportDb("VpaidLog",this.data,this.store),this.tag=null,this.data=null,this.store=null}}},{key:"_addStatus",value:function m(a){this.data.status=a,this.data.statuses.push(a)}}]),a}(),c["default"]=l,b.exports=c["default"]},{"../player/utils":28}],49:[function(a,b,c){"use strict";function d(a){var b,c;if(a&&a.__esModule)return a;if(b={},null!=a)for(c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b["default"]=a,b}function e(a){return a&&a.__esModule?a:{"default":a}}function f(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function g(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function h(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T;Object.defineProperty(c,"__esModule",{value:!0}),i=Object.assign||function(a){var b,c,d;for(b=1;b<arguments.length;b++){c=arguments[b];for(d in c)Object.prototype.hasOwnProperty.call(c,d)&&(a[d]=c[d])}return a},j=function(){function a(a,b){var c,d;for(c=0;c<b.length;c++)d=b[c],d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),k=a("./Beacon"),l=e(k),m=a("./Tracker"),n=e(m),o=a("./VastParser"),p=e(o),q=a("../player/utils"),r=d(q),s=a("./VideoVpaid"),t=e(s),u=a("./JsVpaid"),v=e(u),w=a("./JsVpaid-legacey"),x=e(w),y=a("./FlashVpaid"),z=e(y),A=a("./JsVpaidMobile"),B=e(A),C=a("./VideoVpaidMobile"),D=e(C),E=a("./FlashVpaidDivMode"),F=e(E),G=a("./PixelManager"),H=e(G),I=a("./VpaidLog"),J=e(I),K=a("./OpportunityManager"),L=e(K),M=a("./OpportunityType"),N=e(M),O=a("events"),P=a("./MoatTracker"),Q=e(P),R=1,S=0,T=function(a){function b(a,c,d){var e,h,j,k,m,o,q;if(f(this,b),e=g(this,(b.__proto__||Object.getPrototypeOf(b)).call(this)),e.mainVpaid=c,e.store=d,e.created=Date.now(),e.loadedEvent="",e.manager=a.manager,e.version="VPAID-WRAPPER-1.0.0("+a.tagid+")",e.tagid=a.tagid,e.tag=a.tag,e.tag.vpaidWrapperData={},e.error="",e.readyInMS=0,e.creatives={},e.stayAlive=!1,e.oldStatus="",e.stopReason="",e.config={},e.vast=[],h=e.store.get("isMobile")||!1,j={auctionId:e.tag.auctionId,advId:e.tag.advId,dast:e.tag.dast,price:e.tag.price,queueNumber:e.tag.queueNumber,cpmFloor:e.tag.cpmFloor,dp:e.tag.dp,rollType:e.tag.rollType,lineItem:e.tag.lineItem,unitType:e.store.get("unit_type"),unitVersion:e.store.get("unit_version"),isMobile:h,rpox:e.tag.rpox,alfrox:e.tag.alfrox,frox:e.tag.frox,waterfallIndex:e.tag.wfIndex,itemType:e.tag.itemType,requiredViewability:e.tag.requiredViewability},e.tag.crId&&(k={stId:e.tag.stId,cmpgnId:e.tag.cmpgnId,itemType:e.tag.itemType,brand:e.tag.brand},j=i(j,k)),e.vpaidLog=new J["default"](j,e.store),e._copyFromStoreToBi("connectionType"),e._copyFromStoreToBi("getAdData"),e._wfStats=a.wfStats,e._wfStats.increaseVpaidsCount(),e.oppsID=N["default"],e.opportunityManager=new L["default"]({CM_DOMAIN:c.config.creatives.CM_DOMAIN,AUC_DAST:c.config.creatives.AUC_DAST,sequenceId:e.sequenceId,ST:c.config.creatives.ST,STS:c.config.creatives.STS,SDID:c.config.creatives.SDID,PT:c.config.creatives.PT,PV:c.config.creatives.PV,WP:c.config.creatives.WP,VPD:c.config.creatives.PUBID,VPTD:c.config.creatives.TAGID,VMT:c.config.creatives.VMT},e.store),e.vpaidEventToPixelId={},e.vpaidEventToPixelId[e.mainVpaid.vpaidEvents.AdVideoFirstQuartile]=e.oppsID.videoFirstQuartile,e.vpaidEventToPixelId[e.mainVpaid.vpaidEvents.AdVideoMidpoint]=e.oppsID.videoMidpoint,e.vpaidEventToPixelId[e.mainVpaid.vpaidEvents.AdVideoThirdQuartile]=e.oppsID.videoThirdQuartile,e.vpaidEventToPixelId[e.mainVpaid.vpaidEvents.AdVideoComplete]=e.oppsID.videoComplete,e.opportunityManager.send(e.tag,e.oppsID.tagStarted),e.debugTracker=new n["default"](e.version),e.pixelManager=new H["default"](d),e.isMobile=e.store.get("isMobile"),e.flashSupport=a.flashSupport,a.creatives)for(m in a.creatives)e.creatives[m]=a.creatives[m];if(a.config)for(m in a.config)e.config[m]=a.config[m];return e.adVolume=parseInt(e.config.VOLUME)?parseInt(e.config.VOLUME):0,e.vpaidEvents=a.vpaidEvents,e.localTarget=e._createLocalTarget(e.config.target),e.localVideo=e._createLocalVideo(e.localTarget,e.config.video),e.config.video.style.display="none",e.beacon=new l["default"](e),e.parser=new p["default"]({sendManager:a.sendManager,vpaidLog:e.vpaidLog,width:e.config.width,height:e.config.height,bitrate:e.config.bitrate,internalPixel:e.tag.pixel,flashSupport:e.flashSupport,tag:e.tag,vpaidWrapper:e},e.store),e.parser.onFail=e._onParserError.bind(e),e.parser.onNetworkFail=e._onNetworkError.bind(e),e.parser.onVpaidJs=e._onVpaidJs.bind(e),e.parser.onVpaidSwf=e._onVpaidSwf.bind(e),e.parser.onMp4Video=e._onMp4Video.bind(e),e.parser.onMp4VideoMobile=e._onMp4VideoMobile.bind(e),e.parser.onVpaidJsMobile=e._onVpaidJsMobile.bind(e),e.adFoundDispatched=!1,e.vpaidHandler=!1,e.stopped=!1,e.store.get("fll")&&!e.tag.fll?e.store.on("fllInactive",e._startParser.bind(e)):e._startParser(),o={lastDelayBetweenWfs:e.store.get("dynamicWf.lastDelayBetweenWfs"),currentDelayBetweenWfs:e.store.get("dynamicWf.currentDelayBetweenWfs")},e._logToBI("dynamicWf",o),e.isMobile&&e._createMobileControls(),q=e.store.get("vForce")||!1,e.vpaidLog.push("vForce",{vForceIsActive:q}),e._initTimers(),e}return h(b,a),j(b,[{key:"_startParser",value:function c(){this.parser.stopped||(this.tag.vast?this.parser.parseVastFromString(this.tag.vast):this.parser.parseVastFromUrl(this.tag.url))}},{key:"_createMobileControls",value:function d(){var a,b,c,d=document.createElement("div");d.style.width="100%",d.style.height="100%",d.style.top="0",d.style.left="0",d.style.pointerEvents="none",d.style.position="absolute",a=document.createElement("div"),a.className="mc-play",a.style.pointerEvents="all",a.addEventListener("click",this._mobilePlayPauseClick.bind(this)),b=document.createElement("div"),b.className="speaker",b.style.pointerEvents="all",b.addEventListener("click",this._mobileMuteClick.bind(this)),c=document.createElement("div"),c.className="tbl-text",c.innerText=this.store.get("disctxt"),this.playbtn=d.appendChild(a),this.mutebtn=d.appendChild(b),d.appendChild(c),this.localVideo.parentElement.appendChild(d),this.muted=0===this.store.get("volume")}},{key:"_mobileMuteClick",value:function e(a){a.stopPropagation(),this.mutebtn.className="speaker",this.vpaidHandler&&this.vpaidHandler.muteClick();var b=0;b=this.vpaidHandler.canvas&&this.vpaidHandler.canvas.newVid?this.vpaidHandler.canvas.newVid.muted?0:this.vpaidHandler.canvas.newVid.volume:this.vpaidHandler.volume||0,this.store.set("volume",b),this.muted=0===this.store.get("volume"),this.adVolume=b,this._renderControls()}},{key:"_mobilePlayPauseClick",value:function k(a){a.stopPropagation(),this.vpaidHandler&&(this.isUnPaused?(this.vpaidHandler.pauseAd(),this.isUnPaused=!1):(this.vpaidHandler.resumeAd(),this.isUnPaused=!0)),this.store.emit("UserInteractionPauseState",!this.isUnPaused),this._renderControls()}},{key:"_initTimers",value:function m(){this._waitForEvent(this.vpaidEvents.AdLoaded,this.store.get("altmot")||this.tag.ADTO,this._onAdLoadedEvent.bind(this),this._onAdLoadedTimeout.bind(this)),this._setTimers()}},{key:"_setTimers",value:function o(){var a=this._initTimersStart?Date.now()-this._initTimersStart:0;this._initTimersStart=Date.now(),this._initTillAdstartTimeout(a),this._initAutoKillTimeOut(a)}},{key:"_initTillAdstartTimeout",value:function q(a){var b,c=this;this.tillAdstartTimeout&&clearTimeout(this.tillAdstartTimeout),b=this.type&&this.store.getByTech("adto",this.type)||this.store.getByAdvId("adto",this.tag.advId)||this.tag.ADTO,b-=a,b>0&&(this.tillAdstartTimeout=setTimeout(function(){c.vpaidLog&&c.vpaidLog.push("AdStopADTO",{timeout:b}),c.error="adto",c.stop(c.error,c.oppsID.adtoTimeout)},b))}},{key:"_initAutoKillTimeOut",value:function s(a){var b,c=this;this.autoKill&&clearTimeout(this.autoKill),b=this.type&&this.store.getByTech("vakll",this.type)||this.store.getByAdvId("vakll",this.tag.advId)||9e4,b-=a,b>0&&(this.autoKill=setTimeout(function(){c.vpaidLog&&c.vpaidLog.push("AutoKill",{timeout:b}),c.error="autoKill",c.beacon.dispatchEvent(c.vpaidEvents.AdVideoComplete,c),c.stop(c.error,c.oppsID.globalTimeout)},b))}},{key:"_killTimers",value:function u(){if(clearTimeout(this.autoKill),clearTimeout(this.tillAdstartTimeout),this.pendingEvents)for(var a in this.pendingEvents)a.timeoutId!=-1&&clearTimeout(a.timeoutId);this.pendingEvents={}}},{key:"_createLocalVideo",value:function w(a,b){if(!this.stopped){var c=document.createElement("video");return c.style.cssText=b.style.cssText,c.className=b.className?b.className:"",c.style.display="",c.volume=0,c.setAttribute("width",b.offsetWidth),c.setAttribute("height",b.offsetHeight),this.isMobile&&c.setAttribute("muted",!0),this.config.videoSlotControls&&c.removeAttribute("controls"),a.appendChild(c),c}}},{key:"_createLocalTarget",value:function y(a){if(!this.stopped){var b=document.createElement("div");return b.style.cssText=a.style.cssText,b.style.position="absolute",b.style.overflow="hidden",b.style.top="0",b.style.height="0",b.style.left="0",b.style.zIndex="1",b.style.background="#000000",b.className=(a.className?a.className:"")+" VpaidWrapper"+R,this.index=R++,a.appendChild(b),b}}},{key:"_onHandlerError",value:function A(a,b){this._logToBI("earlyError",{errMsg:a}),this.loadedEvent||(this.status="error",this.stopped||(this.beacon.dispatchEvent(this.vpaidEvents.AdError,a),"FlashLoaderTimedOut"===b&&(this._logToBI("vpaidFlashLoadTimeout",{errMsg:a}),this.stop("vpaidFlashLoadTimeout",N["default"].vpaidFlashLoadTimeout)),"adUnitLoadFailed"===b&&(this._logToBI("adUnitLoadFailed",{errMsg:a}),this.stop("adUnitLoadFailed",N["default"].adUnitLoadFailed)),this._logToBI("handlerError",{errMsg:a})))}},{key:"_onHandlerCreated",value:function C(){this._logToBI("createdVpaidHandler",{}),this.stopped||(this._connectToVpaidHandler(),this.vpaidHandler.handshakeVersion("2.0"),this.vpaidLog.push("initAd",{adInited:!0}),this.vpaidHandler.initAd(this.config.width,this.config.height,this.config.viewMode,this.config.bitrate,{AdParameters:this.creatives.AdParameters},{slot:this.localTarget,videoSlot:this.localVideo,videoSlotControls:!!this.config.videoSlotControls,videoSlotCanAutoPlay:!!this.config.videoSlotCanAutoPlay}))}},{key:"_connectToVpaidHandler",value:function E(){if(!this.stopped)for(var a in this.vpaidEvents)this.vpaidHandler.subscribe(this._handleVpaidEvents.bind(this,this.vpaidEvents[a]),this.vpaidEvents[a])}},{key:"_adLoadedHandler",value:function G(a){var b,c,d=this;this.loadedEvent=this.loadedEvent+" "+a,this.readyInMS=Date.now()-this.created,this.debugTracker.info("Ad loaded now => pause it srcEvent",a),b=this,this.opportunityManager.send(this.tag,N["default"].adLoaded),this.isMobile&&this.vpaidHandler.canvas&&(this.muted=!0,this._renderControls()),this.status="ready",this.isUnPaused=!0,this.store.emit("vpaidReady",this),this.asyncAdimpression=this.store.getByAdvId("asyncAdimpression",this.tag.advId),this.asyncAdimpression&&(c=this.store.getByAdvId("aaViewability",this.tag.advId)?"unit::viewability":"unit::conversion",this.vpaidLog.push("asyncAdimpression",{event:c}),this.on(c,function(){d.vpaidLog.push("asyncAdimpressionEvent",{event:c}),d.onAsyncAdmpression()})),this.vpaidHandler.setAdVolume(this.adVolume),this.adFoundDispatched=!0}},{key:"startAd",value:function I(a){var b=this;this.setAdVolumeInterval||(this.setAdVolumeInterval=setInterval(function(){b.setAdVolume(b.adVolume)},1e3)),this.getAdContext=a,this.isStarted=!0,this.store.incr("ads_started"),this.opportunityManager.send(this.tag,this.oppsID.startAd),this.vpaidLog.push("startAd",{adStarted:!0}),this._waitForEvent(this.vpaidEvents.AdImpression,this.store.get("adimptmot"),this._onAdImpressionEvent.bind(this),this._onAdImpressionTimeout.bind(this)),this.isUnPaused?this.vpaidHandler.startAd():this.vpaidHandler.resumeAd(),clearTimeout(this.tillAdstartTimeout),this._renderControls(),this.working=!0,this.bringToFront()}},{key:"_renderControls",value:function K(){this.isMobile&&(this.playbtn.className=this.isUnPaused?"mc-pause":"mc-play",this.mutebtn.className=this.muted?"speaker mute":"speaker")}},{key:"restartAd",value:function M(){var a=this;return!(!this.vpaidHandler||!this.vpaidHandler.restartAd||"function"!=typeof this.vpaidHandler.restartAd)&&(this.vpaidHandler.restartAd(),setTimeout(function(){a.bringToFront(),a.manager.trigger(a.vpaidEvents.AdVideoStart,a)}),!0)}},{key:"dontDie",value:function O(){this.stayAlive=!0,this.vpaidHandler&&this.vpaidHandler.dontDie&&this.vpaidHandler.dontDie(),this._killTimers(),this.stayAlive=!0}},{key:"_handleStopped",value:function P(a){this.debugTracker.info("manager","["+a.type+"]["+this.tagid+"]handleStopped"),this.moveToBack(),this.stop(a.type,a.oppType),this.working=!1}},{key:"pauseAd",value:function T(){this.vpaidLog.push("pauseAd",{api:!0}),this.working=!1,this.vpaidHandler.pauseAd()}},{key:"resumeAd",value:function U(){this.vpaidLog.push("resumeAd",{api:!0}),this.working=!0,this.vpaidHandler.resumeAd()}},{key:"_handleVpaidEvents",value:function V(a,b){var c,d,e,f,g=this;if(this.vpaidEvents&&(!this.isFirstVpaidEvent&&this.vpaidHandler._getMediaUrl()&&(this.isFirstVpaidEvent=!0,this._logToBI("mediaUrl",{url:this.vpaidHandler._getMediaUrl()})),c=!0,!this.stopped)){switch(this.adLoadedFired=!0,this._firePixel(a),this.debugTracker.info("VpaidHandler-event",a),this.moatTracker&&this.moatTracker.dispatch({type:a,adVolume:this.adVolume}),this._onEvent(a),a){case this.vpaidEvents.AdLoaded:this._adLoadedHandler(a);break;case this.vpaidEvents.AdImpression:this.setAdVolumeInterval=clearInterval(this.setAdVolumeInterval),this.hadImpression?(this._logToBI("doubleImpression",{value:!0}),c=!1):(this.setAdVolume(this.adVolume),this.beacon.dispatchEvent(this.vpaidEvents.AdImpression),this._fireAdImpression(),this.adImpInMS=Date.now()-this.created,this.hadImpression=!0,d=this.store.get("rstmrai"),d&&this._killTimers(),this._wfStats.increaseSuccess(),this.store.incr("conversionsCount"),setTimeout(this._handleDataSaver.bind(this),200));
break;case this.vpaidEvents.AdVideoStart:this.setAdVolume(this.adVolume),this.adFoundDispatched||(this.adFoundDispatched=!0,this.beacon.dispatchEvent(this.vpaidEvents.AdFound)),this.beacon.dispatchEvent(this.vpaidEvents.AdVideoStart);break;case this.vpaidEvents.AdSkipped:this.adStoppedHandler(a),a.oppType=this.oppsID.adSkiped,this._handleStopped(a);break;case this.vpaidEvents.AdStopped:this.adStoppedHandler(a),this._handleStopped(a);break;case this.vpaidEvents.AdLog:this.debugTracker.info("VpaidHandler-Log",arguments);break;case this.vpaidEvents.AdError:"mp4"===this.type?(this._logToBI("Mp4AdError",{}),this.stop("Mp4AdError",this.oppsID.adError)):this.stop("AdError",this.oppsID.adError);break;case this.vpaidEvents.SoundViolation:this.store.get("sndvltopp")&&this.opportunityManager.send(this.tag,this.oppsID.soundViolation);break;case this.vpaidEvents.AdPaused:case this.vpaidEvents.AdClickThru:this.isUnPaused=!1,this._renderControls();break;case this.vpaidEvents.AdPlaying:case this.vpaidEvents.AdStarted:case this.vpaidEvents.AdVideoStart:this.isUnPaused=!0,this._renderControls();break;default:this.beacon.dispatchEvent(a)}if(e=this.store.get("isViewable"),f=this.localVideo.currentTime,this.vpaidLog&&this.vpaidLog.push("event_"+a,{qsize:this.manager.queueSize,vpaidReadyInQue:this.manager.getVpaidReadyCount(),adsPlaying:this.store.get("ads_playing"),tabVis:!document.hidden,isViewable:e,vidCurrentime:f,lastKpi:this.store.get("last_kpi"),kpiDelta:this.store.get("last_kpi")-this.store.get("first_kpi"),lastWF:this.store.get("last_wf_duration")}),this.vpaidEventToPixelId.hasOwnProperty(a)&&this.hadImpression&&this.opportunityManager.send(this.tag,this.vpaidEventToPixelId[a]),this.vpaidEvents&&a==this.vpaidEvents.AdVideoComplete){if(this.stayAlive)return;this.vpaidHandler.stopAd(),setTimeout(function(){g.working=!1,g.stop("AdVideoComplete"),g.status="stopped"},2)}this.manager&&c&&this.manager.trigger(a,this,b?b.eventData:null)}}},{key:"_firePixel",value:function W(a){"AdVideoComplete"!==a||this.hadImpression?a===this.vpaidEvents.AdImpression&&this.hadImpression||this.asyncAdimpression?this.debugTracker.info("Not firing AdImpression pixel",a):this.pixelManager.firePixel(a,this.vpaidLog):this.debugTracker.info("Not firing advideocomplete pixel",a)}},{key:"_fireAdImpression",value:function X(a){this.adimpFired||this.asyncAdimpression&&!a||(this.vpaidLog.push("fireAsyncAdimpression",{end:!0}),this.opportunityManager.send(this.tag,this.oppsID.tagImpression),this.pixelManager.firePixel(this.vpaidEvents.AdImpression,this.vpaidLog),this.adimpFired=!0)}},{key:"onAsyncAdmpression",value:function Y(){this.vpaidLog.push("fireAsyncAdimpression",{start:!0}),this._fireAdImpression(!0)}},{key:"adStoppedHandler",value:function Z(a){var b=this;this.stop(),setTimeout(function(){b._cleanVpaid()},1e4)}},{key:"setAdVolume",value:function $(a){this.adVolume=a,this.store.get("frcmtfrms")&&this._setVolumeInIframes(this.localTarget.getElementsByTagName("iframe"),a),this.vpaidHandler.setAdVolume(a)}},{key:"_setVolumeInIframes",value:function _(a,b){var c=this;r.DOMIterator(a[0],"iframe",function(a){a.forEach(function(a){c._overideVolumeInIframe(a),a.setAttribute("tbvol",b),a.volume=b})},"video")}},{key:"_overideVolumeInIframe",value:function aa(a){if(!a||!a.sv){var b=this;a.sv=!0,a.addEventListener("volumechange",function(){a.volume!==parseFloat(this.getAttribute("tbvol"))?(a.volume=0,b.beacon.dispatchEvent(b.vpaidEvents.SoundViolation,{})):a.volume=b.adVolume})}}},{key:"_onParserError",value:function ba(a,b){this.stopped||(this.status="error",this.error=a||"",this.isPlaying=!1,this.vpaidLog.push("AdError",{readyInMS:this.readyInMS,errType:a,isPraserError:!0}),this.stop(this.error,b))}},{key:"_onNetworkError",value:function ca(a){this.stopped||(this.status="error",this.error=a?"xhrStatuses_"+a:"",this.isPlaying=!1,this.vpaidLog.push("networkError",{readyInMS:this.readyInMS,errType:"networkError",isNetworkError:!0}),this.stop(this.error,N["default"].networkError))}},{key:"_onVpaidJs",value:function da(a,b,c,d){this.tag.vpaidWrapperData.mediatype=2,this.debugTracker.info("ParserResponded[JavaScript]",d),this.pixelManager.loadPixelData(c),this.type="javascript";var e=this.store.get("vjshndlrlgcy")?x["default"]:v["default"];this._createHandler(a,b,e)}},{key:"_onVpaidSwf",value:function ea(a,b,c,d){this.tag.vpaidWrapperData.mediatype=3,this.debugTracker.info("ParserResponded[Flash]",d),this.pixelManager.loadPixelData(c),this.type="flash";var e=this.store.get("vflashhndlrlgcy")?z["default"]:F["default"];this._createHandler(a,b,e)}},{key:"_onMp4Video",value:function fa(a,b,c,d){this.tag.vpaidWrapperData.mediatype=1,this.debugTracker.info("ParserResponded[Video]",d),this.type="mp4",this.pixelManager.loadPixelData(c),this._createHandler(a,b,t["default"],{})}},{key:"_onVpaidJsMobile",value:function ga(a,b,c,d){this.tag.vpaidWrapperData.mediatype=2,this.debugTracker.info("ParserResponded[JsMobile]",d),this.type="javascript",this.pixelManager.loadPixelData(c),this._createHandler(a,b,B["default"])}},{key:"_onMp4VideoMobile",value:function ha(a,b,c,d,e){this.tag.vpaidWrapperData.mediatype=1,this.debugTracker.info("ParserResponded[VideoMobile]",d),this.type="mp4",this.pixelManager.loadPixelData(c),this._createHandler(a,b,D["default"],{duration:e})}},{key:"_createHandler",value:function ia(a,b,c,d){this._logToBI("creatingVpaidHandler",{type:c}),this.stopped||this.vpaidHandler||(this._setTimers(),this.creatives.AdParameters=b,this.vpaidHandler=new c({applyBypass:!!this.creatives.AFBP,slot:this.localTarget,videoSlot:this.localVideo,videoSlotControls:!!this.config.videoSlotControls,videoSlotCanAutoPlay:!!this.config.videoSlotCanAutoPlay,protection:this.config.vpaid_protect_path,adParams:b,vpaidFiles:a,tag:this.tag,onReady:this._onHandlerCreated.bind(this),onError:this._onHandlerError.bind(this),extra:d||{}},this.vpaidLog,this.store),this.vpaidHandler._onHijackAttempt=this.hijackAttempt.bind(this),this.store.get("moat")&&(this.moatTracker?this._logToBI("doubleMoat",{text:"tried to initiate moat more than once"}):this.moatTracker=new Q["default"]({container:this.vpaidHandler.getDOMContainer(),tag:this.tag,moatPartnerCode:this.store.get("moatPartnerCode"),duration:this.vpaidHandler.getAdDuration(),url:this.vpaidHandler.mediaFiles[0].url,store:this.store})))}},{key:"_cleanVpaid",value:function ja(){var a,b;this.clean||this.stayAlive||(this.clean=!0,this.vpaidLog&&this.vpaidLog.saveToDb(),this.pixelManager&&this.pixelManager.destroy(),this.beacon&&(a=this.beacon.listEvents(),this.beacon.destroy()),this.localTarget&&(this.localTarget.removeChild(this.localVideo),b=this.localTarget.querySelectorAll("iframe"),this._clearIframe(b&&b.length?b[0]:null),this.localTarget.parentNode.removeChild(this.localTarget)),this._killTimers(),this.parser.destroy(),this.vpaidHandler&&(this.vpaidHandler._onHijackAttempt=null),this.moatTracker&&this.moatTracker.dispose(),this.status="stopped",this.working=!1,this.creatives=this.vpaidLog=this.parser=this.debugTracker=this.manager=this.tag=this.vast=this.beacon=this.pixelManager=this.config=this.vpaidEvents=this.localTarget=this.vpaidHandler=this.store=this._wfStats=this.localVideo=void 0,this.isPlaying=!1,window.setTimeout(this.onAfterStop,0),this.emit("vpaidCleaned"))}},{key:"_clearIframe",value:function ka(a){r.DOMIterator(a,"iframe",function(a){var b=cmTag.$;a.forEach(function(a){b(a).remove()})},"*"),a&&a.parentNode.removeChild(a)}},{key:"bringToFront",value:function la(){if(this.localTarget){this.localTarget.style.display="block",this.localTarget.style.height=this.store.get("height")+"px",this.localTarget.setAttribute("zndx",S);var a=S++ +99;this.localTarget.style.zIndex=a}}},{key:"moveToBack",value:function ma(){this.localTarget&&(this.localTarget.style.zIndex=0)}},{key:"subscribe",value:function na(a,b){this.stopped||(this.vpaidEvents[b]?this.beacon.addEventListener(b,a):this.debugTracker.warn("subscribe","Unsupported event '"+b+"'"))}},{key:"unsubscribe",value:function oa(a,b){this.vpaidEvents&&(this.vpaidEvents[b]?this.beacon.removeEventListener(b,a):this.debugTracker.warn("unsubscribe","Unsupported event '"+b+"'"))}},{key:"stop",value:function pa(a,b){var c=this;this.stayAlive||this.stopped||(a&&this.vpaidLog&&this.vpaidLog.push(a,{debug:a,status:this.status}),clearInterval(this.setAdVolumeInterval),this._wfStats&&(this.hadImpression||this._wfStats.increaseFailure(),this._logToBI("wfStats",{data:this._wfStats.getData()})),this.isStarted&&this.store.decr("ads_started"),this.stopReason=a,this.oldStatus+=this.status,this.isPlaying=!1,this.stopped=!0,void 0!==b&&this.opportunityManager.send(this.tag,b),this.vpaidHandler&&(this.vpaidHandler.onAfterStop=this._cleanVpaid.bind(this),this.vpaidHandler.stopAd()),this.emit("end"),this.store.emit("vpaidEnded",this),setTimeout(function(){c._cleanVpaid()},2))}},{key:"callVpaidMethod",value:function qa(a,b,c){if(!this.stopped){if(this.vpaidLog&&this.vpaidLog.push("vpaidApi_"+a,{}),"setAdVolume"==a&&(this.adVolume=b[0]),"pauseAd"==a&&(this.isUnPaused=!1),!this.vpaidHandler||!this.vpaidHandler[a])return c;try{return this.vpaidHandler[a].apply(this.vpaidHandler,b)}catch(d){return c}}}},{key:"onAfterStop",value:function ra(){}},{key:"hijackAttempt",value:function sa(a){var b,c;(new Image).src="//convusmp.basebanner.com/st?cijs=0&ttype=5&pix=31542217&dast="+this.tag.dast+"&"+(new Date).getTime(),this.vpaidLog.push("hijackAttempt",{badUrl:a}),b={dp:this.tag.dp,vast:this.vast,vastUrl:this.parser.vastUrls.join(","),badUrl:a,event:"hijackAttempt"},c=this.store.get("hjkstp")!==!1,c&&this.stop("hijackAttempt",N["default"].hijackAttempt)}},{key:"fire99",value:function ta(){this.opportunityManager.send({waterfallTagId:this.tag.waterfallTagId,dast:this.tag.dast},N["default"].firstImpression)}},{key:"_onEvent",value:function ua(a,b){if(this.pendingEvents&&this.pendingEvents.hasOwnProperty(a)){var c=this.pendingEvents[a];c.timeoutId!=-1&&clearTimeout(c.timeoutId),c.cb&&"function"==typeof c.cb&&c.cb(b),delete this.pendingEvents[a]}}},{key:"_waitForEvent",value:function va(a,b,c,d){var e=function h(){},f=-1,g=this;b>0&&d&&"function"==typeof d&&(f=setTimeout(function(){this.vpaidLog&&this.vpaidLog.push("vpaidTimeout_"+a,{}),d(),delete g.pendingEvents[a],f=null,c=e,d=e}.bind(this),b)),this.pendingEvents||(this.pendingEvents={}),this.pendingEvents[a]={cb:c,timeoutId:f}}},{key:"_onAdLoadedTimeout",value:function wa(){this.vpaidLog&&this.vpaidLog.push("adloadedTimeout",{timeout:this.tag.ADTO}),this.error="adloadedTimeout",this.stop(this.error,this.oppsID.adloadedTimeout)}},{key:"_onAdLoadedEvent",value:function xa(){}},{key:"_onAdImpressionTimeout",value:function ya(){this.error="adImpressionTimeout",this.stop(this.error)}},{key:"_onAdImpressionEvent",value:function za(){}},{key:"setVastPrice",value:function Aa(a){this.tag.vpaidWrapperData.vastPrice=a,a>0&&this._logToBI("vastPrice",{value:a})}},{key:"setVastType",value:function Ba(a){this.tag.vpaidWrapperData.vastType=a}},{key:"_logToBI",value:function Ca(a,b){this.vpaidLog&&this.vpaidLog.push(a,b)}},{key:"_copyFromStoreToBi",value:function Da(a){this.store.get(a)&&this._logToBI(a,this.store.get(a))}},{key:"_handleDataSaver",value:function Ea(){this.isMobile&&!this.vpaidHandler.canvas&&this.store.get("dataSaverDetected")&&(this.localVideo.setAttribute("poster","//cloudvid.cachefly.net/assets/poster-play.png"),this.isUnPaused=!1,this._renderControls(),this._logToBI("dataSaverDetected",{value:!0}))}}]),b}(O.EventEmitter),c["default"]=T,b.exports=c["default"]},{"../player/utils":28,"./Beacon":29,"./FlashVpaid":32,"./FlashVpaidDivMode":33,"./JsVpaid":35,"./JsVpaid-legacey":34,"./JsVpaidMobile":36,"./MoatTracker":38,"./OpportunityManager":41,"./OpportunityType":42,"./PixelManager":43,"./Tracker":44,"./VastParser":45,"./VideoVpaid":46,"./VideoVpaidMobile":47,"./VpaidLog":48,events:2}],50:[function(a,b,c){"use strict";function d(a){var b,c;if(a&&a.__esModule)return a;if(b={},null!=a)for(c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b["default"]=a,b}function e(a){return a&&a.__esModule?a:{"default":a}}function f(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A;Object.defineProperty(c,"__esModule",{value:!0}),g=function(){function a(a,b){var c,d;for(c=0;c<b.length;c++)d=b[c],d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=a("./Tracker"),i=e(h),j=a("../player/Post"),k=e(j),l=a("./swfobject"),m=e(l),n=a("../player/utils"),o=d(n),p=a("./VpaidLog"),q=e(p),r=a("./WfLog"),s=e(r),t=a("../player/dynamicSettings"),u=d(t),v=a("./WaterfallStats"),w=e(v),x="11.0.0",y=-1,z=0,A=function(){function a(b){f(this,a),this.store=b,this.store.set("waterfallFailsInARow",0),this.store.set("waterfallSuccessesInARow",0),this.mimeEnum=[{id:5,mime:"application/javascript",video:!1},{id:7,mime:"application/x-shockwave-flash",video:!1},{id:8,mime:"video/x-ms-wmv",video:!0},{id:9,mime:"video/x-flv",video:!0},{id:10,mime:"video/mp4",video:!0},{id:11,mime:"video/ogg",video:!0},{id:12,mime:"video/webm",video:!0}],this.creatives={},this.inHttpsProtocol="https:"===window.location.protocol,this.debugTracker=new i["default"]("WaterfallManager"),this.cachedTags=!1,this.cacheAge=0,this.staticWf=this.store.get("static_schedule"),this.shouldRun=function(){return!0},this._runBindedWaterfallTicker=this._runWaterfallTicker.bind(this),this._roundTripAverageDuration=0,this._roundTripsCount=0,this._initDynamicWfsValues(),this.store.get("wf_manual")||this.startNextWfTimeout(),this.store.on("stop",this._stop.bind(this)),this.store.on("pausePlayer",this._stop.bind(this));var c=this.store.get("wf_dynmc_ps");c&&(this.store.on("contentPaused",this._stop.bind(this)),this.store.on("contentResumed",this.startNextWfTimeout.bind(this))),this.isFirstRun=!0,this.igonreWfWhenHidden=this.store.get("ignrwfhdn"),this.lineitemMaxFails=this.store.get("mxlifls"),this._registerQueueEvent(),this.maxAllowedEmptyWaterfalls=this.store.get("mxemptwf"),this.emptyWaterfallsInARow=0}return g(a,[{key:"startNextWfTimeout",value:function b(){var a=this;this.wfInterval&&clearTimeout(this.wfInterval),this._calcDynamicWfsValues(),this._delayBetweenWfs>0?this.wfInterval=setTimeout(function(){a._runBindedWaterfallTicker()},this._delayBetweenWfs):this.store.emit("closePlayer")}},{key:"_initDynamicWfsValues",value:function c(){this.maxTimeBetweenWaterfalls=this.store.get("mxtmbtwfs"),this.minTimeBetweenWaterfalls=this.store.get("mntmbtwfs"),this.defaultTimeBetweenWaterfalls=this.store.get("time_between_waterfall"),this.timeBetweenWfFunc=this.store.get("tmbtwfs"),"function"!=typeof this.timeBetweenWfFunc&&(this.timeBetweenWfFunc=void 0),this.minTimeBetweenWfFunc=this.store.get("mntmbtwfsf"),"function"!=typeof this.minTimeBetweenWfFunc&&(this.minTimeBetweenWfFunc=void 0),this.defaultMinTimeBetweenWf=this.store.get("mintimwf")||5e3,this.store.set("dynamicWf.lastDelayBetweenWfs",-1),this.store.set("dynamicWf.currentDelayBetweenWfs",-1),this._calcDynamicWfsValues()}},{key:"_calcDynamicWfsValues",value:function d(){this._delayBetweenWfs=1e3*this._calcDelayBetweenWf(),this._delayBetweenWfs>0&&(this._minTimeBetweenWf=this._calcMinDelayBetweenWfs()),this._saveDynamicWfsValues()}},{key:"_calcDelayBetweenWf",value:function e(){var a=y;if(this.timeBetweenWfFunc)try{a=this.timeBetweenWfFunc(this.store.get("waterfallSuccessesInARow"),this.store.get("waterfallFailsInARow"),this.store)}catch(b){a=this.defaultTimeBetweenWaterfalls}return a>this.maxTimeBetweenWaterfalls?a=y:a<this.minTimeBetweenWaterfalls&&(a=this.minTimeBetweenWaterfalls),a}},{key:"_calcMinDelayBetweenWfs",value:function h(){var a=this.defaultMinTimeBetweenWf;if(this.minTimeBetweenWfFunc)try{a=this.minTimeBetweenWfFunc(this.store.get("waterfallSuccessesInARow"),this.store.get("waterfallFailsInARow"),this.store)}catch(b){a=this.defaultMinTimeBetweenWf}return a}},{key:"_saveDynamicWfsValues",value:function j(){this.store.set("dynamicWf.lastDelayBetweenWfs",this.store.get("dynamicWf.currentDelayBetweenWfs")),this.store.set("dynamicWf.currentDelayBetweenWfs",this._delayBetweenWfs)}},{key:"_registerQueueEvent",value:function l(){var a=this.store.get("run_wf_when_empty");a&&this.store.on("playFromEmptyQueue",this._onPlayFromEmptyQueue.bind(this))}},{key:"_onPlayFromEmptyQueue",value:function m(){this.runWaterfall("queueEmpty")}},{key:"_runWaterfallTicker",value:function n(){this.startNextWfTimeout(),this.runWaterfall("interval")}},{key:"init",value:function p(a,b){this.creatives=a,this.adParams=b,this.store.get("run_wf_on_init")&&this.runWaterfall("run_wf_on_init")}},{key:"_serveStaticWf",value:function q(){var a,b;this._getRollType(),a=0,"mid-roll"==this.currentRollType?a=1:"post-roll"==this.currentRollType&&(a=2),b=new Function("try { return "+this.staticWf[a].ad_parameters+";} catch(e){}")(),this._handleWaterfallSuccess(JSON.stringify(b.waterfall))}},{key:"runWaterfall",value:function r(a){var b,c,d,e,f,g,h,i,j,l,m,n,p,q;if(!this.passedMaxEmptyWaterfalls()){if(this.store.get("first_look"))return void this.debugTracker.debug("runWaterfall","First Look disables the waterfall!");if("function"==typeof this.shouldRun&&!this.shouldRun())return void this.debugTracker.debug("runWaterfall","Should Not Run!");if(this.staticWf)return this._serveStaticWf();if(b=this,c=(new Date).getTime(),d=this.lastRun?c-this.lastRun:this._minTimeBetweenWf,d<this._minTimeBetweenWf)return void this.debugTracker.debug("runWaterfall","Should Not Run Min time is "+(c-this._minTimeBetweenWf));this.lastRun=c,0===z&&o.reportDebug("player_waterfall","firstwf",{type:"debug",message:"firstwf",fullPageUrl:this.store.get("fullPageUrl")},this.store),e=this.store.get("pstflrs")===!0,f=this.store.get("psthdrs")||"application/json",g=new s["default"](this.store),this.lastRun=c,g.resuestTime=Date.now(),g.ignoredLineitems=[],g.push("reason",a),g.push("index",z),g.push("sinceLastWf",d),g.push("queueLength",this.store.get("queueLength")),g.push("vpaidReadyCount",this.store.get("vpaidReadyCount")),g.push("vpaidPendingCount",this.store.get("queueLength")-this.store.get("vpaidReadyCount")),g.push("failsInARow",this.store.get("waterfallFailsInARow")),g.push("successesInARow",this.store.get("waterfallSuccessesInARow")),g.push("lastDelayBetweenWfs",this.store.get("dynamicWf.lastDelayBetweenWfs")),g.push("currentDelayBetweenWfs",this.store.get("dynamicWf.currentDelayBetweenWfs")),g.push("emptyWaterfallsInARow",this.emptyWaterfallsInARow),g.push("maxAllowedEmptyWaterfalls",this.maxAllowedEmptyWaterfalls),h=function t(a){b._handleWaterfallError(a,g)},i=function u(a){b._handleWaterfallSuccess(a,g)},j=this._generateWaterfallUrl(this.creatives,this._runMimeTypeCheck(this.store.get("use_flash_player"))),g.push("url",j);try{for(l=j.split("?")[1].split("&"),m={},p=0;p<l.length;p++)n=l[p],m[n.split("=")[0]]=n.split("=")[1];g.push("urlParams",m)}catch(r){}if(g.push("noaop",this.isFirstRun?this.store.get("firstWaterfallNoaop"):this.creatives.NOAOP),!j)return void this.debugTracker.debug("runWaterfall","No MidRoll to run exit.");if(this.adParams&&this.adParams.waterfall)window.setTimeout(this._handleWaterfallSuccess.bind(this,JSON.stringify(this.adParams.waterfall)),0);else{if(!e)return(0,k["default"])(j,"",i,h,!0,!0),z++,void(this.isFirstRun&&(this.isFirstRun=!1));q=this._buildPostData(),g.push("postData",q),(0,k["default"])(j,q,i,h,!0,!0,5e3,f),this.isFirstRun&&(this.isFirstRun=!1)}z++}}},{key:"_buildPostData",value:function t(){var a,b,c,d,e={fv:[]},f=this.store.get("sessionData");if(f&&(e.sd=f),a=this.store.get("lineItems")||[],0===a.length)return"";b=this,a.map(function(a){var c=b.store.get(a);e.fv.push({li:a,f:c.fails,fr:c.failsRow,c:c.conversions,t:c.tries})}),c=u.getWfData(),e.adv=c,d="";try{d=JSON.stringify(e)}catch(g){}return d}},{key:"_runMimeTypeCheck",value:function v(a){var b,c,d=document.createElement("video"),e=[];for(e.push(5),a&&e.push(7),b=0;b<this.mimeEnum.length;b++)c=this.mimeEnum[b],c.video&&d.canPlayType(c.mime)&&e.push(c.id);return d=void 0,e}},{key:"passedMaxEmptyWaterfalls",value:function x(){return!!this.maxAllowedEmptyWaterfalls&&this.emptyWaterfallsInARow>this.maxAllowedEmptyWaterfalls}},{key:"_handleWaterfallSuccess",value:function A(a,b){var c,d,e,f,g;if(this.emptyWaterfallsInARow++,!this.igonreWfWhenHidden){if(this._addRoundTripDuration(),this.debugTracker.event("_handleWaterfallSuccess","WaterfallManager::"),!a)return this.debugTracker.error("runWaterfall","Server responded with nothing!"),this.debugTracker.event("runWaterfall","[AdError]-No content server"),this.store.incr("waterfallFailsInARow"),this.store.set("waterfallSuccessesInARow",0),void this._handleWaterfallError("empty-response",b);if(this.debugTracker.info("runWaterfall","Waterfall loaded!"),c=new Function("try { return "+a+";} catch(e){}")(),!(c&&c.tags&&c.tags.length))return this.debugTracker.error("runWaterfall","Failed to decode server response!"),this.debugTracker.event("runWaterfall","[AdError]-No content server"),this.store.incr("waterfallFailsInARow"),this.store.set("waterfallSuccessesInARow",0),void this._handleWaterfallError("no-tags",b);this.debugTracker.info("runWaterfall","Waterfall Data loaded!"),this.emptyWaterfallsInARow=0,this.store.set("sessionData",c.sd),c&&c.pixel_piggies&&this._firePiggies(c.pixel_piggies),d=[];for(e in c.tags)f=c.tags[e],(f.url||f.vast)&&(f.score=-1,f.waterfallTagId=e,f.created=(new Date).getTime(),f.dp=(f.lp&&f.lp.length>0?f.lp[0]:"").replace(/http:\/\/|.com|https:\/\/|.com/g,"")||"na",f.dpFull=f.lp&&f.lp.length>0?f.lp[0]:"na",f.conversionPixels=f.conversionPixels||[],f.ts=Date.now(),f.wfIndex=z,f.url=f.url?this._replaceMacros(f.url):"",f.vast=f.vast?this._replaceMacros(f.vast):"",f.pixel=f.pixel?this._getPixel(f.pixel):"",f.rollType=this.currentRollType,f.pubId=this.pubid,f.tagId=this.tagid,f.isRon=this.isRon,g=f.pixel.match("cirid=([^&]*)"),g&&g.length&&(f.cirid=g[1]),f.dast=f.pixel?this._getDastFromPixel(f.pixel):"",f.vidDast=f.pixel?this._getVidDastFromPixel(f.pixel):"",f.lineItem=f.lineItemId||this._getDastVal(f.dast,"cicmp"),f.lineItem=f.lineItem.toString(),this.store.get("httpsOverride")&&f.url&&this.inHttpsProtocol&&0===f.url.indexOf("http:")&&(f.url=f.url.replace("http:","https:")),this._decodeItemParams(f),this._ignoreLineitem(f.lineItem)?(b.ignoredLineitems.push(f.lineItem),b.push("ignoreLineitems",b.ignoredLineitems)):d.push(f),this.store.get(f.lineItem)||this.store.set(f.lineItem,{failsRow:-2,tries:0,conversions:0,fails:0}),f.lineItemStats=o.deepClone(this.store.get(f.lineItem)));d.length>0?(c.tags=d,c.data=new w["default"](this.store,z),this.onWaterfallSuccess(c),b&&(b.push("duration",Date.now()-b.resuestTime),b.push("response",a),b.push("tagsCount",d.length),b.push("success",!0),this._sendWfLog(b)),this.store.emit("waterfallData",c)):(this.debugTracker.error("runWaterfall","Failed to get any tags!"),this.debugTracker.event("runWaterfall","[AdError]-No ads found!"),this._handleWaterfallError("no-clean-tags",b))}}},{key:"_sendWfLog",value:function B(a){var b={wfRoundTripAverageDuration:this.store.get("performance.wfRoundTripAverageDuration"),performanceMeasurment:this.store.get("performance.performanceMeasurment")};a.push("performance",b),a.push("conversionsCount",this.store.get("conversionsCount")),a.push("unit",{width:this.store.get("width"),height:this.store.get("height")}),this.store.get("vForce")&&a.push("getAdData",this.store.get("getAdData")),a.complete()}},{key:"_addRoundTripDuration",value:function C(){var a=Date.now()-this.lastRun;this._roundTripAverageDuration=parseInt((this._roundTripAverageDuration*this._roundTripsCount+a)/(this._roundTripsCount+1)),this.store.set("waterfall_data.last_duration",a),this.store.set("waterfall_data.average_duration",this._roundTripAverageDuration),this._roundTripsCount++}},{key:"_ignoreLineitem",value:function D(a){var b,c;return this.lineitemMaxFails>0&&(b=this.store.get(a),c=b?b.failsRow:-1,c>this.lineitemMaxFails)}},{key:"_getVidDastFromPixel",value:function E(a){var b=a.match('vid-dast=([^&|"]*)');return b&&b.length?b[1]:""}},{key:"_decodeItemParams",value:function F(a){a.rpox=this._decodeValue(a.rpox),a.alfrox=this._decodeValue(a.alfrox),a.frox=this._decodeValue(a.frox),a.ex&&(a.crId=a.ex.ecrid,a.stId=a.ex.seatId,a.cmpgnId=a.ex.ecid,a.ex.b&&(a.brand=this._decodeBrand(a.ex.b))),a.itemType=a.t}},{key:"_decodeValue",value:function G(a){return(2530^a)/1e3}},{key:"_decodeBrand",value:function H(a){var b,c,d,e,f;try{b=atob(a)}catch(g){return!1}for(c="",d="PlAyER",f=0;f<b.length;f++)e=f%d.length,c+=String.fromCharCode(b[f].charCodeAt(0).toString(10)^d[e].charCodeAt(0).toString(10));return c}},{key:"_firePiggies",value:function I(a){var b,c,d,e=this.store.get("fire_piggies");if(e&&!(z>5))for(b=0;b<a.length;b++)if(c=a[b],c.url){d=o.setUrlPrefix(c.url);try{(new Image).src=d}catch(f){this.debugTracker.warn("_fireIframePig","Malformed url!")}}}},{key:"_fireIframePig",value:function J(a){var b,c=document.createElement("iframe");c.src=a,c.style.display="none",b=document.getElementsByTagName("body")[0],b||(b=document.getElementsByTagName("html")[0]),b||(b=document.getElementsByTagName("div")[0]),b?b.appendChild(c):this.debugTracker.warn("_fireIframePig","Failed to fire piggies.")}},{key:"_handleWaterfallError",value:function K(a,b){this.emptyWaterfallsInARow++,this._addRoundTripDuration(),b&&(b.push("duration",Date.now()-b.resuestTime),b.push("error",a),b.push("success",!1),this._sendWfLog(b)),this.onWaterfallError(a)}},{key:"_generateWaterfallUrl",value:function L(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,p=this.store.get("wf_base_path")||a.CM_DOMAIN;if(p+=/.*\/$/g.test(p)?"":"/",p=o.setUrlPrefix(p),c=[],localStorage.getItem("dev"))for(d in a)localStorage.getItem(d)&&(a[d]=localStorage.getItem(d));return e=this.store.get("isViewable")||0,e=!!e,(f=this._getRollType())?(g=(new Date).getTimezoneOffset(),g*=-1,h=this.isFirstRun?this.store.get("firstWaterfallNoaop"):a.NOAOP,h=h||a.NOAOP,i=a.SORTORDERTYPE,j=this.store.get("ab_test"),k=this.store.get("mprdct"),c.push("oid="+a.OID),c.push("width="+(a.PLAYER_WIDTH||a["PLAYER-WIDTH"])),c.push("height="+(a.PLAYER_HEIGHT||a["PLAYER-HEIGHT"])),c.push("pubid="+this.pubid||a.PUBID),c.push("tagid="+this.tagid||a.TAGID),c.push("crid="+(this.store.get("creativeId")||"")),c.push("noaop="+h),c.push("sortOrderType="+i),c.push("cb="+(new Date).getTime()),c.push("mimes="+b.join(",")),c.push("isvideo="+a.ISVIDEO),c.push("plmd="+a.PLMD),c.push("mindur="+a.MINDUR),c.push("maxdur="+a.MAXDUR),c.push("minbr="+a.MINBR),c.push("maxbr="+a.MAXBR),c.push("st="+o.getStreamType(f.roll_type)),c.push("seq="+z),c.push("pv="+this.store.get("player_version")||999),c.push("pt="+o.crc32(j||999)),c.push("tz="+g),c.push("viewable="+e),c.push("ddast="+this.store.get("auc_dast")),c.push("proto=2,3,5,6"),this.store.get("dtagid")&&c.push("dtagid="+this.store.get("dtagid")),this.store.get("dpubid")&&c.push("dpubid="+this.store.get("dpubid")),j&&c.push("abtst="+j),k&&c.push("mPre="+k),c.push("encoded=1"),l=this.store.get("pstn")||1,c.push("pstn="+l),a.CIRF&&c.push("cirf="+encodeURIComponent(decodeURIComponent(a.CIRF))),c.push("callback="),m=this.store.get("wf_xrta"),m&&c.push(m),n=this.store.get("wf_path")||a.SERVICE,window.lastWfUrl=p+n+"?"+c.join("&"),p+n+"?"+c.join("&")):""}},{key:"_replaceMacros",value:function M(a){var b=encodeURIComponent(this.creatives.VIDEO_URL&&this.creatives.VIDEO_URL.url?this.creatives.VIDEO_URL.url:this.creatives.VIDEO_URL),c=(new Date).getTime();return a=a.replace(/%%referrer%%/gi,this.creatives.REFERRER),a=a.replace(/%%domain%%/gi,this.creatives.DOMAIN),a=a.replace(/%%video-url%%/gi,b),a=a.replace(/%%page-url%%/gi,this.creatives.PAGE_URL),a=a.replace(/%%player-width%%/gi,this.creatives.PLAYER_WIDTH),a=a.replace(/%%player-height%%/gi,this.creatives.PLAYER_HEIGHT),a=a.replace(/%%timestamp%%/gi,Math.floor(c/1e3)),a=a.replace(/%%vidlength%%/gi,this.creatives.VIDLENGTH),a=a.replace(/%%keywords%%/gi,this.creatives.KEY_WORDS),a=a.replace(/%%description%%/gi,this.creatives.DESCRIPTION),a=a.replace(/%%vertical%%/gi,this.creatives.VERTICAL),a=a.replace(/%%tag%%/gi,this.creatives.TAG?creatives.TAG:""),a=a.replace(/%%title%%/gi,this.creatives.TITLE),a=a.replace(/%%cirf%%/gi,encodeURIComponent(decodeURIComponent(this.creatives.CIRF))),a=a.replace(/%%cb%%/gi,"R0."+c),a=a.replace(/%%country%%/gi,this.store.get("country")),a=a.replace(/%%ip%%/gi,this.store.get("ip")),a=a.replace(/%%ua%%/gi,encodeURIComponent(navigator.userAgent)),a=a.replace(/%%[^%]*%%/gi,"")}},{key:"_getPixel",value:function N(a){var b=a.split(/<script.*?src="(.*?)"/g);if(1==b.length){if(b=a.split(/<script.*?src='(.*?)'/g),b[1])return b[1].replace(/^http(s:|:)/g,"")}else if(b[1])return b[1].replace(/^http(s:|:)/g,"");return a.replace(/^http(s:|:)/g,"")}},{key:"_getDastFromPixel",value:function O(a){var b,c,d,e=a.replace(/\?\?+/g,"?").replace(/&&+/g,"&").split(/\?(.+)?/gi,2);if(2!=e.length)return"";b=e[1].split(/\?|&/gi);for(c in b)if(b[c]&&(d=b[c].split(/=(.+)?/gi,2),2==d.length&&"dast"==d[0]))return d[1];return""}},{key:"onWaterfallError",value:function P(){}},{key:"onWaterfallSuccess",value:function Q(){}},{key:"SetWaterfallError",value:function R(a){this.onWaterfallError=a}},{key:"SetWaterfallSuccess",value:function S(a){this.onWaterfallSuccess=a}},{key:"SetShouldRun",value:function T(a){this.shouldRun=a||function(){}}},{key:"GetCounter",value:function U(){return z}},{key:"_getRollType",value:function V(){var a,b=this.store.get("contentSchedule")||{},c=null,d=Object.keys(b)||[];return 0===z?(this.debugTracker.debug("Waterfall Fetch pre-roll"),a=d[0],c=b[a]):d.length>0&&(this.debugTracker.debug("Waterfall Fetch mid-roll"),a=d[1],c=b[a]),this.currentRollType=c?c.roll_type:"",this.pubid=c?c.pubid:0,this.tagid=c?c.tagid:0,c}},{key:"_getDastVal",value:function W(a,b){var c,d="";try{d=atob(a)}catch(e){return}return c=d.match(b+"=([^&]*)"),c&&c.length>1?c[1]:""}},{key:"_stop",value:function X(){clearTimeout(this.wfInterval)}},{key:"start",value:function Y(){this.startNextWfTimeout()}},{key:"stop",value:function Z(){this._stop()}}]),a}(),c["default"]=A,b.exports=c["default"]},{"../player/Post":16,"../player/dynamicSettings":26,"../player/utils":28,"./Tracker":44,"./VpaidLog":48,"./WaterfallStats":51,"./WfLog":52,"./swfobject":58}],51:[function(a,b,c){"use strict";function d(a){var b,c;if(a&&a.__esModule)return a;if(b={},null!=a)for(c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b["default"]=a,b}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var f,g,h,i;Object.defineProperty(c,"__esModule",{value:!0}),f=function(){function a(a,b){var c,d;for(c=0;c<b.length;c++)d=b[c],d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g=a("../player/utils"),h=d(g),i=function(){function a(b,c){e(this,a),this.id=Date.now()+"_"+h.generateGuid(20),this.index=c,this.store=b,this.vpaidsCount=0,this.reportedVpaidsCount=0,this.success=0,this.fails=0,this.isSuccessed=!1}return f(a,[{key:"increaseVpaidsCount",value:function b(){this.vpaidsCount++}},{key:"increaseSuccess",value:function c(){this.success++,this._update()}},{key:"increaseFailure",value:function d(){this.fails++,this._update()}},{key:"_update",value:function g(){this.reportedVpaidsCount++,this.isSuccessed||(1===this.success?(this.store.incr("waterfallSuccessesInARow"),this.store.set("waterfallFailsInARow",0),this.isSuccessed=!0):this.reportedVpaidsCount===this.vpaidsCount&&(this.store.incr("waterfallFailsInARow"),this.store.set("waterfallSuccessesInARow",0)))}},{key:"getData",value:function i(){return{id:this.id,index:this.index,allVpaidsReported:this.vpaidsCount===this.reportedVpaidsCount,wf_sr:this.store.get("waterfallSuccessesInARow"),wf_fr:this.store.get("waterfallFailsInARow")}}}]),a}(),c["default"]=i,b.exports=c["default"]},{"../player/utils":28
}],52:[function(a,b,c){"use strict";function d(a){var b,c;if(a&&a.__esModule)return a;if(b={},null!=a)for(c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b["default"]=a,b}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var f,g,h,i;Object.defineProperty(c,"__esModule",{value:!0}),f=function(){function a(a,b){var c,d;for(c=0;c<b.length;c++)d=b[c],d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g=a("../player/utils"),h=d(g),i=function(){function a(b){e(this,a),this.store=b,this.created=Date.now(),this.data={isMobile:this.store.get("isMobile"),created:(new Date).toISOString(),unitType:this.store.get("unit_type"),fullPageUrl:this.store.get("fullPageUrl")},this.sessionStarted=this.store.get("session_started")||Date.now()}return f(a,[{key:"push",value:function b(a,c){this.data[a]=c}},{key:"complete",value:function c(){h.reportDebug("player_waterfall","WfLog",this.data,this.store)}}]),a}(),c["default"]=i,b.exports=c["default"]},{"../player/utils":28}],53:[function(a,b,c){"use strict";function d(a){var b,c;if(a&&a.__esModule)return a;if(b={},null!=a)for(c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b["default"]=a,b}function e(a,b,c){j.indexOf(a)>-1||j.push(a)}function f(a,b,c){j.indexOf(a)>-1||j.push(a)}function g(a){var b=i.crc32(a);j.indexOf(b)>-1||k.push(a)}var h=a("../player/utils"),i=d(h),j=[],k=[];b.exports={reportPixel:e,reportVast:g,reportCleanPixel:f}},{"../player/utils":28}],54:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}var e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I=a("./Tracker"),J=d(I),K=a("./progXHR"),L=new J["default"]("jsmpeg").debug,M=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(a){window.setTimeout(a,1e3/60)}}(),N=function O(a,b,c){b=b||{},this.host=c,this.progressive=b.progressive!==!1,this.benchmark=!!b.benchmark,this.canvas=b.canvas||document.createElement("canvas"),this.autoplay=!!b.autoplay,this.wantsToPlay=this.autoplay,this.loop=!!b.loop,this.seekable=!!b.seekable,this.externalLoadCallback=b.onload||null,this.externalDecodeCallback=b.ondecodeframe||null,this.externalFinishedCallback=b.onfinished||null,this.centerVertically=b.centerVertically||null,this.canvasCss=b.canvasCss||{},this.customIntraQuantMatrix=new Uint8Array(64),this.customNonIntraQuantMatrix=new Uint8Array(64),this.blockData=new Int32Array(64),this.zeroBlockData=new Int32Array(64),this.fillArray(this.zeroBlockData,0),this.receiveStarted=!1,this.loadeReadyRate=b.loadeReadyRate,this.url=a,this.errHndlr=b.errHndlr||null;var d=b.useWebGl||!1;d?this.renderFrame=this.renderFrameGL:(this.canvasContext=this.canvas.getContext("2d"),this.renderFrame=this.renderFrame2D),a instanceof WebSocket?(this.client=a,this.client.onopen=this.initSocketClient.bind(this)):this.load(a)};N.prototype.waitForIntraFrame=!0,N.prototype.socketBufferSize=524288,N.prototype.initSocketClient=function(){this.buffer=new H(new ArrayBuffer(this.socketBufferSize)),this.nextPictureBuffer=new H(new ArrayBuffer(this.socketBufferSize)),this.nextPictureBuffer.writePos=0,this.nextPictureBuffer.chunkBegin=0,this.nextPictureBuffer.lastWriteBeforeWrap=0,this.client.binaryType="arraybuffer",this.client.onmessage=this.receiveSocketMessage.bind(this)},N.prototype.decodeSocketHeader=function(a){a[0]===e.charCodeAt(0)&&a[1]===e.charCodeAt(1)&&a[2]===e.charCodeAt(2)&&a[3]===e.charCodeAt(3)&&(this.width=256*a[4]+a[5],this.height=256*a[6]+a[7],this.initBuffers())},N.prototype.receiveSocketMessage=function(a){var b,c,d,e,g,h=new Uint8Array(a.data);for(this.sequenceStarted||this.decodeSocketHeader(h),b=this.buffer,c=this.nextPictureBuffer,c.writePos+h.length>c.length&&(c.lastWriteBeforeWrap=c.writePos,c.writePos=0,c.index=0),c.bytes.set(h,c.writePos),c.writePos+=h.length,d=0;;){if(d=c.findNextMPEGStartCode(),d===H.NOT_FOUND||c.index>>3>c.writePos)return void(c.index=Math.max(c.writePos-3,0)<<3);if(d===A)break}return this.waitForIntraFrame?(c.advance(10),void(c.getBits(3)===u&&(this.waitForIntraFrame=!1,c.chunkBegin=c.index-13>>3))):(this.currentPictureDecoded||this.decodePicture(f),e=c.index>>3,e>c.chunkBegin?(b.bytes.set(c.bytes.subarray(c.chunkBegin,e)),b.writePos=e-c.chunkBegin):(b.bytes.set(c.bytes.subarray(c.chunkBegin,c.lastWriteBeforeWrap)),g=c.lastWriteBeforeWrap-c.chunkBegin,b.bytes.set(c.bytes.subarray(0,e),g),b.writePos=e+g),b.index=0,c.chunkBegin=e,this.currentPictureDecoded=!1,void M(this.scheduleDecoding.bind(this),this.canvas))},N.prototype.scheduleDecoding=function(){this.decodePicture(),this.currentPictureDecoded=!0},N.prototype.isRecording=!1,N.prototype.recorderWaitForIntraFrame=!1,N.prototype.recordedFrames=0,N.prototype.recordedSize=0,N.prototype.didStartRecordingCallback=null,N.prototype.recordBuffers=[],N.prototype.canRecord=function(){return this.client&&this.client.readyState===this.client.OPEN},N.prototype.startRecording=function(a){if(this.canRecord()){this.discardRecordBuffers(),this.isRecording=!0,this.recorderWaitForIntraFrame=!0,this.didStartRecordingCallback=a||null,this.recordedFrames=0,this.recordedSize=0;var b=this.width>>4,c=(15&this.width)<<4|this.height>>8,d=255&this.height;this.recordBuffers.push(new Uint8Array([0,0,1,179,b,c,d,19,255,255,225,88,0,0,1,184,0,8,0,0,0,0,1,0]))}},N.prototype.recordFrameFromCurrentBuffer=function(){if(this.isRecording){if(this.recorderWaitForIntraFrame){if(this.pictureCodingType!==u)return;this.recorderWaitForIntraFrame=!1,this.didStartRecordingCallback&&this.didStartRecordingCallback(this)}this.recordedFrames++,this.recordedSize+=this.buffer.writePos,this.recordBuffers.push(new Uint8Array(this.buffer.bytes.subarray(0,this.buffer.writePos)))}},N.prototype.discardRecordBuffers=function(){this.recordBuffers=[],this.recordedFrames=0},N.prototype.stopRecording=function(){var a=new Blob(this.recordBuffers,{type:"video/mpeg"});return this.discardRecordBuffers(),this.isRecording=!1,a},N.prototype.intraFrames=[],N.prototype.currentFrame=-1,N.prototype.currentTime=0,N.prototype.frameCount=0,N.prototype.duration=0,N.prototype.progressiveMinSize=131072,N.prototype.fetchReaderPump2=function(a){var b=this;a.read(function(c){b.receiveStarted=!0,b.fetchReaderReceive(a,c)})},N.prototype.fetchReaderReceive=function(a,b){var c,d;if(b.done)return this.seekable&&(c=this.buffer.index,this.collectIntraFrames(),this.buffer.index=c),this.duration=this.frameCount/this.pictureRate,void(this.lastFrameIndex=this.buffer.writePos<<3);if(this.buffer.bytes.set(b.value,this.buffer.writePos),this.buffer.writePos+=b.value.byteLength,this.lastFrameIndex=this.findLastPictureStartCode(),!this.sequenceStarted&&this.buffer.writePos>=this.progressiveMinSize){if(this.findStartCode(x),this.firstSequenceHeader=this.buffer.index,d=this.decodeSequenceHeader(),!d)return void(this.errHndlr&&this.errHndlr({type:"decodeFailed",width:this.width,height:this.height,url:this.url}));this.nextFrame(),this.autoplay&&this.play()}this.externalLoadCallback&&(this.loadeReadyRate?this.buffer.writePos>this.buffer.length/this.loadeReadyRate&&(this.externalLoadCallback(this),this.externalLoadCallback=void 0):(this.externalLoadCallback(this),this.externalLoadCallback=void 0)),this.fetchReaderPump2(a)},N.prototype.findLastPictureStartCode=function(){var a,b=this.buffer.bytes;for(a=this.buffer.writePos;a>3;a--)if(b[a]==A&&1==b[a-1]&&0==b[a-2]&&0==b[a-3])return a-3<<3;return 0},N.prototype.load=function(a){this.url=a;var b=this;this.progressive&&K.streamFetch&&(this.progXhr=K.streamFetch(a,function(a,c){return a===-1?void(b.errHndlr&&b.errHndlr({xhrStatus:c})):(b.buffer=new H(new ArrayBuffer(a)),b.buffer.writePos=0,void b.fetchReaderPump2(c))}))},N.prototype.loadCallback=function(a){this.buffer=new H(a),this.seekable&&(this.collectIntraFrames(),this.buffer.index=0),this.findStartCode(x),this.firstSequenceHeader=this.buffer.index,this.decodeSequenceHeader(),this.duration=this.frameCount/this.pictureRate,this.nextFrame(),this.autoplay&&this.play()},N.prototype.collectIntraFrames=function(){var a;for(a=0;this.findStartCode(A)!==H.NOT_FOUND;a++)this.buffer.advance(10),this.buffer.getBits(3)===u&&this.intraFrames.push({frame:a,index:this.buffer.index-13});this.frameCount=a},N.prototype.seekToFrame=function(a,b){var c,d,e;if(a<0||a>=this.frameCount||!this.intraFrames.length)return!1;for(c=null,d=0;d<this.intraFrames.length&&this.intraFrames[d].frame<=a;d++)c=this.intraFrames[d];if(this.buffer.index=c.index,this.currentFrame=c.frame-1,b){for(e=c.frame;e<a;e++)this.decodePicture(f),this.findStartCode(A);this.currentFrame=a-1}return this.decodePicture(),!0},N.prototype.seekToTime=function(a,b){this.seekToFrame(a*this.pictureRate|0,b)},N.prototype.play=function(){this.playing||(this.targetTime=this.now(),this.playing=!0,this.wantsToPlay=!0,this.scheduleNextFrame())},N.prototype.pause=function(){this.playing=!1,this.wantsToPlay=!1},N.prototype.stop=function(){this.currentFrame=-1,this.buffer&&(this.buffer.index=this.firstSequenceHeader),this.playing=!1,this.client&&(this.client.close(),this.client=null),this.wantsToPlay=!1,this.progXhr&&this.progXhr.abort()},N.prototype.readCode=function(a){var b=0;do b=a[b+this.buffer.getBits(1)];while(b>=0&&0!==a[b]);return a[b+2]},N.prototype.findStartCode=function(a){for(var b=0;;)if(b=this.buffer.findNextMPEGStartCode(),b===a||b===H.NOT_FOUND)return b;return H.NOT_FOUND},N.prototype.fillArray=function(a,b){for(var c=0,d=a.length;c<d;c++)a[c]=b},N.prototype.pictureRate=30,N.prototype.lateTime=0,N.prototype.firstSequenceHeader=0,N.prototype.targetTime=0,N.prototype.benchmark=!1,N.prototype.benchFrame=0,N.prototype.benchDecodeTimes=0,N.prototype.benchAvgFrameTime=0,N.prototype.now=function(){return window.performance?window.performance.now():Date.now()},N.prototype.nextFrame=function(){var a,b;if(this.buffer&&this.receiveStarted)for(a=this.now();;)if(b=this.buffer.findNextMPEGStartCode(),b===x)this.decodeSequenceHeader();else{if(b===A){if(this.progressive&&this.buffer.index>=this.lastFrameIndex)return;return this.playing&&this.scheduleNextFrame(),this.decodePicture(),this.benchDecodeTimes+=this.now()-a,this.canvas}if(b===H.NOT_FOUND)return this.stop(),this.externalFinishedCallback&&this.externalFinishedCallback(this),this.loop&&this.sequenceStarted&&this.play(),null}},N.prototype.scheduleNextFrame=function(){this.lateTime=this.now()-this.targetTime;var a=Math.max(0,1e3/this.pictureRate-this.lateTime);this.targetTime=this.now()+a,this.benchmark?(this.benchFrame++,this.benchFrame>=120&&(this.benchAvgFrameTime=this.benchDecodeTimes/this.benchFrame,this.benchFrame=0,this.benchDecodeTimes=0,window.console&&console.log("Average time per frame:",this.benchAvgFrameTime,"ms")),setTimeout(this.nextFrame.bind(this),0)):a<10?this.scheduleAnimation():setTimeout(this.scheduleAnimation.bind(this),a)},N.prototype.scheduleAnimation=function(){M(this.nextFrame.bind(this),this.canvas)},N.prototype.decodeSequenceHeader=function(){if(this.width=this.buffer.getBits(12),this.height=this.buffer.getBits(12),this.width<1||this.height<1)return!1;this.buffer.advance(4),this.pictureRate=g[this.buffer.getBits(4)],this.buffer.advance(30),this.initBuffers();var a;if(this.buffer.getBits(1)){for(a=0;a<64;a++)this.customIntraQuantMatrix[h[a]]=this.buffer.getBits(8);this.intraQuantMatrix=this.customIntraQuantMatrix}if(this.buffer.getBits(1)){for(a=0;a<64;a++)this.customNonIntraQuantMatrix[h[a]]=this.buffer.getBits(8);this.nonIntraQuantMatrix=this.customNonIntraQuantMatrix}return!0},N.prototype.fitInParent=function(a,b,c){var d,e,f,g,h,i,j,k;a.style.position="relative",d=a.parentElement,b=b||d.clientWidth,c=c||d.clientHeight,b===this.pcx&&this.pcy===c||(e=a.style.display,f=a.style.visibility,a.style.visibility="hidden",a.style.display="",g=a.clientWidth||parseInt(a.getAttribute("width")),h=a.clientHeight||parseInt(a.getAttribute("height")),i=Math.min(b/g,c/h),i===1/0&&(i=.724),j=g*i,k=h*i,a.style.display=e,a.style.visibility=f,a.style.width=j+"px",a.style.height=k+"px",this.pcx=b,this.pcy=c,b>j?a.style.left=(b-j)/2+"px":c>k&&(a.style.top=(c-k)/2+"px"))},N.prototype.initBuffers=function(){var a,b;if(this.intraQuantMatrix=i,this.nonIntraQuantMatrix=j,this.mbWidth=this.width+15>>4,this.mbHeight=this.height+15>>4,this.mbSize=this.mbWidth*this.mbHeight,this.codedWidth=this.mbWidth<<4,this.codedHeight=this.mbHeight<<4,this.codedSize=this.codedWidth*this.codedHeight,this.halfWidth=this.mbWidth<<3,this.halfHeight=this.mbHeight<<3,this.quarterSize=this.codedSize>>2,!this.sequenceStarted){if(this.sequenceStarted=!0,a=window.Uint8ClampedArray||window.Uint8Array,window.Uint8ClampedArray||(this.copyBlockToDestination=this.copyBlockToDestinationClamp,this.addBlockToDestination=this.addBlockToDestinationClamp),this.currentY=new a(this.codedSize),this.currentY32=new Uint32Array(this.currentY.buffer),this.currentCr=new a(this.codedSize>>2),this.currentCr32=new Uint32Array(this.currentCr.buffer),this.currentCb=new a(this.codedSize>>2),this.currentCb32=new Uint32Array(this.currentCb.buffer),this.forwardY=new a(this.codedSize),this.forwardY32=new Uint32Array(this.forwardY.buffer),this.forwardCr=new a(this.codedSize>>2),this.forwardCr32=new Uint32Array(this.forwardCr.buffer),this.forwardCb=new a(this.codedSize>>2),this.forwardCb32=new Uint32Array(this.forwardCb.buffer),this.aspect=this.height/this.width,this.canvas.width=this.width,this.canvas.height=this.height,this.canvasCss)for(b in this.canvasCss)this.canvas.style[b]=this.canvasCss[b];this.gl?(this.gl.useProgram(this.program),this.gl.viewport(0,0,this.width,this.height)):(this.currentRGBA=this.canvasContext.getImageData(0,0,this.width,this.height),this.fillArray(this.currentRGBA.data,255))}},N.prototype.currentY=null,N.prototype.currentCr=null,N.prototype.currentCb=null,N.prototype.currentRGBA=null,N.prototype.pictureCodingType=0,N.prototype.forwardY=null,N.prototype.forwardCr=null,N.prototype.forwardCb=null,N.prototype.fullPelForward=!1,N.prototype.forwardFCode=0,N.prototype.forwardRSize=0,N.prototype.forwardF=0,N.prototype.decodePicture=function(a){var b,c,d,e,g,h,i;if(this.currentFrame++,this.currentTime=this.currentFrame/this.pictureRate,this.buffer.advance(10),this.pictureCodingType=this.buffer.getBits(3),this.buffer.advance(16),!(this.pictureCodingType<=0||this.pictureCodingType>=w)){if(this.pictureCodingType===v){if(this.fullPelForward=this.buffer.getBits(1),this.forwardFCode=this.buffer.getBits(3),0===this.forwardFCode)return;this.forwardRSize=this.forwardFCode-1,this.forwardF=1<<this.forwardRSize}b=0;do b=this.buffer.findNextMPEGStartCode();while(b===B||b===C);for(;b>=y&&b<=z;)this.decodeSlice(255&b),b=this.buffer.findNextMPEGStartCode();this.buffer.rewind(32),this.recordFrameFromCurrentBuffer(),a!==f&&(this.renderFrame(),this.externalDecodeCallback&&this.externalDecodeCallback(this,this.canvas)),this.pictureCodingType!==u&&this.pictureCodingType!==v||(c=this.forwardY,d=this.forwardY32,e=this.forwardCr,g=this.forwardCr32,h=this.forwardCb,i=this.forwardCb32,this.forwardY=this.currentY,this.forwardY32=this.currentY32,this.forwardCr=this.currentCr,this.forwardCr32=this.currentCr32,this.forwardCb=this.currentCb,this.forwardCb32=this.currentCb32,this.currentY=c,this.currentY32=d,this.currentCr=e,this.currentCr32=g,this.currentCb=h,this.currentCb32=i)}},N.prototype.YCbCrToRGBA=function(){var a,b,c,d,e,f,g,h,i,j,k,l=this.currentY,m=this.currentCb,n=this.currentCr,o=this.currentRGBA.data,p=0,q=this.codedWidth,r=this.codedWidth+(this.codedWidth-this.width),s=0,t=this.halfWidth-(this.width>>1),u=0,v=4*this.width,w=4*this.width,x=this.width>>1,y=this.height>>1;for(f=0;f<y;f++){for(g=0;g<x;g++)a=m[s],b=n[s],s++,c=b+(103*b>>8)-179,d=(88*a>>8)-44+(183*b>>8)-91,e=a+(198*a>>8)-227,h=l[p++],i=l[p++],o[u]=h+c,o[u+1]=h-d,o[u+2]=h+e,o[u+4]=i+c,o[u+5]=i-d,o[u+6]=i+e,u+=8,j=l[q++],k=l[q++],o[v]=j+c,o[v+1]=j-d,o[v+2]=j+e,o[v+4]=k+c,o[v+5]=k-d,o[v+6]=k+e,v+=8;p+=r,q+=r,u+=w,v+=w,s+=t}},N.prototype.renderFrame2D=function(){this.YCbCrToRGBA(),this.canvasContext.putImageData(this.currentRGBA,0,0)},N.prototype.gl=null,N.prototype.program=null,N.prototype.YTexture=null,N.prototype.CBTexture=null,N.prototype.CRTexture=null,N.prototype.createTexture=function(a,b){var c=this.gl,d=c.createTexture();return c.bindTexture(c.TEXTURE_2D,d),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.LINEAR),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.LINEAR),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE),c.uniform1i(c.getUniformLocation(this.program,b),a),d},N.prototype.compileShader=function(a,b){var c=this.gl,d=c.createShader(a);if(c.shaderSource(d,b),c.compileShader(d),!c.getShaderParameter(d,c.COMPILE_STATUS))throw this.errHndlr({glGetShaderParameter:"error"}),new Error(c.getShaderInfoLog(d));return d},N.prototype.initWebGL=function(){var a,b;try{a=this.gl=this.canvas.getContext("webgl")||this.canvas.getContext("experimental-webgl")}catch(c){return!1}if(!a)return!1;if(this.buffer=a.createBuffer(),a.bindBuffer(a.ARRAY_BUFFER,this.buffer),a.bufferData(a.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,1]),a.STATIC_DRAW),this.program=a.createProgram(),a.attachShader(this.program,this.compileShader(a.VERTEX_SHADER,F)),a.attachShader(this.program,this.compileShader(a.FRAGMENT_SHADER,D)),a.linkProgram(this.program),!a.getProgramParameter(this.program,a.LINK_STATUS))throw this.errHndlr({glGetProgramInfoLog:"error"}),new Error(a.getProgramInfoLog(this.program));return a.useProgram(this.program),this.YTexture=this.createTexture(0,"YTexture"),this.CBTexture=this.createTexture(1,"CBTexture"),this.CRTexture=this.createTexture(2,"CRTexture"),b=a.getAttribLocation(this.program,"vertex"),a.enableVertexAttribArray(b),a.vertexAttribPointer(b,2,a.FLOAT,!1,0,0),this.loadingProgram=a.createProgram(),a.attachShader(this.loadingProgram,this.compileShader(a.VERTEX_SHADER,F)),a.attachShader(this.loadingProgram,this.compileShader(a.FRAGMENT_SHADER,E)),a.linkProgram(this.loadingProgram),a.useProgram(this.loadingProgram),b=a.getAttribLocation(this.loadingProgram,"vertex"),a.enableVertexAttribArray(b),a.vertexAttribPointer(b,2,a.FLOAT,!1,0,0),!0},N.prototype.renderFrameGL=function(){var a=this.gl,b=new Uint8Array(this.currentY.buffer),c=new Uint8Array(this.currentCr.buffer),d=new Uint8Array(this.currentCb.buffer);a.activeTexture(a.TEXTURE0),a.bindTexture(a.TEXTURE_2D,this.YTexture),a.texImage2D(a.TEXTURE_2D,0,a.LUMINANCE,this.codedWidth,this.height,0,a.LUMINANCE,a.UNSIGNED_BYTE,b),a.activeTexture(a.TEXTURE1),a.bindTexture(a.TEXTURE_2D,this.CBTexture),a.texImage2D(a.TEXTURE_2D,0,a.LUMINANCE,this.halfWidth,this.height/2,0,a.LUMINANCE,a.UNSIGNED_BYTE,c),a.activeTexture(a.TEXTURE2),a.bindTexture(a.TEXTURE_2D,this.CRTexture),a.texImage2D(a.TEXTURE_2D,0,a.LUMINANCE,this.halfWidth,this.height/2,0,a.LUMINANCE,a.UNSIGNED_BYTE,d),a.drawArrays(a.TRIANGLE_STRIP,0,4)},N.prototype.quantizerScale=0,N.prototype.sliceBegin=!1,N.prototype.decodeSlice=function(a){for(this.sliceBegin=!0,this.macroblockAddress=(a-1)*this.mbWidth-1,this.motionFwH=this.motionFwHPrev=0,this.motionFwV=this.motionFwVPrev=0,this.dcPredictorY=128,this.dcPredictorCr=128,this.dcPredictorCb=128,this.quantizerScale=this.buffer.getBits(5);this.buffer.getBits(1);)this.buffer.advance(8);do this.decodeMacroblock();while(!this.buffer.nextBytesAreStartCode())},N.prototype.macroblockAddress=0,N.prototype.mbRow=0,N.prototype.mbCol=0,N.prototype.macroblockType=0,N.prototype.macroblockIntra=!1,N.prototype.macroblockMotFw=!1,N.prototype.motionFwH=0,N.prototype.motionFwV=0,N.prototype.motionFwHPrev=0,N.prototype.motionFwVPrev=0,N.prototype.decodeMacroblock=function(){for(var a,b,c,d=0,e=this.readCode(l);34===e;)e=this.readCode(l);for(;35===e;)d+=33,e=this.readCode(l);if(d+=e,this.sliceBegin)this.sliceBegin=!1,this.macroblockAddress+=d;else{if(this.macroblockAddress+d>=this.mbSize)return;for(d>1&&(this.dcPredictorY=128,this.dcPredictorCr=128,this.dcPredictorCb=128,this.pictureCodingType===v&&(this.motionFwH=this.motionFwHPrev=0,this.motionFwV=this.motionFwVPrev=0));d>1;)this.macroblockAddress++,this.mbRow=this.macroblockAddress/this.mbWidth|0,this.mbCol=this.macroblockAddress%this.mbWidth,this.copyMacroblock(this.motionFwH,this.motionFwV,this.forwardY,this.forwardCr,this.forwardCb),d--;this.macroblockAddress++}for(this.mbRow=this.macroblockAddress/this.mbWidth|0,this.mbCol=this.macroblockAddress%this.mbWidth,this.macroblockType=this.readCode(G[this.pictureCodingType]),this.macroblockIntra=1&this.macroblockType,this.macroblockMotFw=8&this.macroblockType,0!==(16&this.macroblockType)&&(this.quantizerScale=this.buffer.getBits(5)),this.macroblockIntra?(this.motionFwH=this.motionFwHPrev=0,this.motionFwV=this.motionFwVPrev=0):(this.dcPredictorY=128,this.dcPredictorCr=128,this.dcPredictorCb=128,this.decodeMotionVectors(),this.copyMacroblock(this.motionFwH,this.motionFwV,this.forwardY,this.forwardCr,this.forwardCb)),a=0!==(2&this.macroblockType)?this.readCode(p):this.macroblockIntra?63:0,b=0,c=32;b<6;b++)0!==(a&c)&&this.decodeBlock(b),c>>=1},N.prototype.decodeMotionVectors=function(){var a,b,c=0;this.macroblockMotFw?(a=this.readCode(q),0!==a&&1!==this.forwardF?(c=this.buffer.getBits(this.forwardRSize),b=(Math.abs(a)-1<<this.forwardRSize)+c+1,a<0&&(b=-b)):b=a,this.motionFwHPrev+=b,this.motionFwHPrev>(this.forwardF<<4)-1?this.motionFwHPrev-=this.forwardF<<5:this.motionFwHPrev<-this.forwardF<<4&&(this.motionFwHPrev+=this.forwardF<<5),this.motionFwH=this.motionFwHPrev,this.fullPelForward&&(this.motionFwH<<=1),a=this.readCode(q),0!==a&&1!==this.forwardF?(c=this.buffer.getBits(this.forwardRSize),b=(Math.abs(a)-1<<this.forwardRSize)+c+1,a<0&&(b=-b)):b=a,this.motionFwVPrev+=b,this.motionFwVPrev>(this.forwardF<<4)-1?this.motionFwVPrev-=this.forwardF<<5:this.motionFwVPrev<-this.forwardF<<4&&(this.motionFwVPrev+=this.forwardF<<5),this.motionFwV=this.motionFwVPrev,this.fullPelForward&&(this.motionFwV<<=1)):this.pictureCodingType===v&&(this.motionFwH=this.motionFwHPrev=0,this.motionFwV=this.motionFwVPrev=0)},N.prototype.copyMacroblock=function(a,b,c,d,e){var f,g,h,i,j,k,l,m,n,o,p=this.currentY32,q=this.currentCb32,r=this.currentCr32,s=this.codedWidth,t=s-16,u=a>>1,v=b>>1,w=1===(1&a),x=1===(1&b),y=((this.mbRow<<4)+v)*s+(this.mbCol<<4)+u,z=this.mbRow*s+this.mbCol<<2,A=z+(s<<2);if(w)if(x)for(;z<A;){for(g=c[y]+c[y+s],y++,f=0;f<4;f++)h=c[y]+c[y+s],y++,i=g+h+2>>2&255,g=c[y]+c[y+s],y++,i|=g+h+2<<6&65280,h=c[y]+c[y+s],y++,i|=g+h+2<<14&16711680,g=c[y]+c[y+s],y++,i|=g+h+2<<22&4278190080,p[z++]=i;z+=t>>2,y+=t-1}else for(;z<A;){for(g=c[y++],f=0;f<4;f++)h=c[y++],i=g+h+1>>1&255,g=c[y++],i|=g+h+1<<7&65280,h=c[y++],i|=g+h+1<<15&16711680,g=c[y++],i|=g+h+1<<23&4278190080,p[z++]=i;z+=t>>2,y+=t-1}else if(x)for(;z<A;){for(f=0;f<4;f++)i=c[y]+c[y+s]+1>>1&255,y++,i|=c[y]+c[y+s]+1<<7&65280,y++,i|=c[y]+c[y+s]+1<<15&16711680,y++,i|=c[y]+c[y+s]+1<<23&4278190080,y++,p[z++]=i;z+=t>>2,y+=t}else for(;z<A;){for(f=0;f<4;f++)i=c[y],y++,i|=c[y]<<8,y++,i|=c[y]<<16,y++,i|=c[y]<<24,y++,p[z++]=i;z+=t>>2,y+=t}if(s=this.halfWidth,t=s-8,u=a/2>>1,v=b/2>>1,w=1===(a/2&1),x=1===(b/2&1),y=((this.mbRow<<3)+v)*s+(this.mbCol<<3)+u,z=this.mbRow*s+this.mbCol<<1,A=z+(s<<1),w)if(x)for(;z<A;){for(j=d[y]+d[y+s],m=e[y]+e[y+s],y++,f=0;f<2;f++)k=d[y]+d[y+s],n=e[y]+e[y+s],y++,l=j+k+2>>2&255,o=m+n+2>>2&255,j=d[y]+d[y+s],m=e[y]+e[y+s],y++,l|=j+k+2<<6&65280,o|=m+n+2<<6&65280,k=d[y]+d[y+s],n=e[y]+e[y+s],y++,l|=j+k+2<<14&16711680,o|=m+n+2<<14&16711680,j=d[y]+d[y+s],m=e[y]+e[y+s],y++,l|=j+k+2<<22&4278190080,o|=m+n+2<<22&4278190080,r[z]=l,q[z]=o,z++;z+=t>>2,y+=t-1}else for(;z<A;){for(j=d[y],m=e[y],y++,f=0;f<2;f++)k=d[y],n=e[y++],l=j+k+1>>1&255,o=m+n+1>>1&255,j=d[y],m=e[y++],l|=j+k+1<<7&65280,o|=m+n+1<<7&65280,k=d[y],n=e[y++],l|=j+k+1<<15&16711680,o|=m+n+1<<15&16711680,j=d[y],m=e[y++],l|=j+k+1<<23&4278190080,o|=m+n+1<<23&4278190080,r[z]=l,q[z]=o,z++;z+=t>>2,y+=t-1}else if(x)for(;z<A;){for(f=0;f<2;f++)l=d[y]+d[y+s]+1>>1&255,o=e[y]+e[y+s]+1>>1&255,y++,l|=d[y]+d[y+s]+1<<7&65280,o|=e[y]+e[y+s]+1<<7&65280,y++,l|=d[y]+d[y+s]+1<<15&16711680,o|=e[y]+e[y+s]+1<<15&16711680,y++,l|=d[y]+d[y+s]+1<<23&4278190080,o|=e[y]+e[y+s]+1<<23&4278190080,y++,r[z]=l,q[z]=o,z++;z+=t>>2,y+=t}else for(;z<A;){for(f=0;f<2;f++)l=d[y],o=e[y],y++,l|=d[y]<<8,o|=e[y]<<8,y++,l|=d[y]<<16,o|=e[y]<<16,y++,l|=d[y]<<24,o|=e[y]<<24,y++,r[z]=l,q[z]=o,z++;z+=t>>2,y+=t}},N.prototype.blockData=null,N.prototype.decodeBlock=function(a){var b,c,d,e,f,g,i,j,l,m,n,o=0;for(this.macroblockIntra?(a<4?(c=this.dcPredictorY,d=this.readCode(r)):(c=4===a?this.dcPredictorCr:this.dcPredictorCb,d=this.readCode(s)),d>0?(e=this.buffer.getBits(d),0!==(e&1<<d-1)?this.blockData[0]=c+e:this.blockData[0]=c+(-1<<d|e+1)):this.blockData[0]=c,a<4?this.dcPredictorY=this.blockData[0]:4===a?this.dcPredictorCr=this.blockData[0]:this.dcPredictorCb=this.blockData[0],this.blockData[0]<<=8,b=this.intraQuantMatrix,o=1):b=this.nonIntraQuantMatrix,f=0;;){if(g=0,i=this.readCode(t),1===i&&o>0&&0===this.buffer.getBits(1))break;65535===i?(g=this.buffer.getBits(6),f=this.buffer.getBits(8),0===f?f=this.buffer.getBits(8):128===f?f=this.buffer.getBits(8)-256:f>128&&(f-=256)):(g=i>>8,f=255&i,this.buffer.getBits(1)&&(f=-f)),o+=g,j=h[o],o++,f<<=1,this.macroblockIntra||(f+=f<0?-1:1),f=f*this.quantizerScale*b[j]>>4,0===(1&f)&&(f-=f>0?1:-1),f>2047?f=2047:f<-2048&&(f=-2048),this.blockData[j]=f*k[j]}a<4?(l=this.currentY,n=this.codedWidth-8,m=this.mbRow*this.codedWidth+this.mbCol<<4,0!==(1&a)&&(m+=8),0!==(2&a)&&(m+=this.codedWidth<<3)):(l=4===a?this.currentCb:this.currentCr,n=(this.codedWidth>>1)-8,m=(this.mbRow*this.codedWidth<<2)+(this.mbCol<<3)),this.macroblockIntra?1===o?(this.copyValueToDestination(this.blockData[0]+128>>8,l,m,n),this.blockData[0]=0):(this.IDCT(),this.copyBlockToDestination(this.blockData,l,m,n),this.blockData.set(this.zeroBlockData)):1===o?(this.addValueToDestination(this.blockData[0]+128>>8,l,m,n),this.blockData[0]=0):(this.IDCT(),this.addBlockToDestination(this.blockData,l,m,n),this.blockData.set(this.zeroBlockData)),o=0},N.prototype.copyBlockToDestination=function(a,b,c,d){for(var e=0;e<64;e+=8,c+=d+8)b[c+0]=a[e+0],b[c+1]=a[e+1],b[c+2]=a[e+2],b[c+3]=a[e+3],b[c+4]=a[e+4],b[c+5]=a[e+5],b[c+6]=a[e+6],b[c+7]=a[e+7]},N.prototype.addBlockToDestination=function(a,b,c,d){for(var e=0;e<64;e+=8,c+=d+8)b[c+0]+=a[e+0],b[c+1]+=a[e+1],b[c+2]+=a[e+2],b[c+3]+=a[e+3],b[c+4]+=a[e+4],b[c+5]+=a[e+5],b[c+6]+=a[e+6],b[c+7]+=a[e+7]},N.prototype.copyValueToDestination=function(a,b,c,d){for(var e=0;e<64;e+=8,c+=d+8)b[c+0]=a,b[c+1]=a,b[c+2]=a,b[c+3]=a,b[c+4]=a,b[c+5]=a,b[c+6]=a,b[c+7]=a},N.prototype.addValueToDestination=function(a,b,c,d){for(var e=0;e<64;e+=8,c+=d+8)b[c+0]+=a,b[c+1]+=a,b[c+2]+=a,b[c+3]+=a,b[c+4]+=a,b[c+5]+=a,b[c+6]+=a,b[c+7]+=a},N.prototype.copyBlockToDestinationClamp=function(a,b,c,d){var e,f,g,h=0;for(e=0;e<8;e++){for(f=0;f<8;f++)g=a[h++],b[c++]=g>255?255:g<0?0:g;c+=d}},N.prototype.addBlockToDestinationClamp=function(a,b,c,d){var e,f,g,h=0;for(e=0;e<8;e++){for(f=0;f<8;f++)g=a[h++]+b[c],b[c++]=g>255?255:g<0?0:g;c+=d}},N.prototype.IDCT=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t=this.blockData;for(s=0;s<8;++s)a=t[32+s],b=t[16+s]+t[48+s],c=t[40+s]-t[24+s],f=t[8+s]+t[56+s],g=t[24+s]+t[40+s],d=t[8+s]-t[56+s],e=f+g,h=t[0+s],m=(473*d-196*c+128>>8)-e,i=m-(362*(f-g)+128>>8),j=h-a,k=(362*(t[16+s]-t[48+s])+128>>8)-b,l=h+a,n=j+k,o=l+b,p=j-k,q=l-b,r=-i-(473*c+196*d+128>>8),t[0+s]=e+o,t[8+s]=m+n,t[16+s]=p-i,t[24+s]=q-r,t[32+s]=q+r,t[40+s]=i+p,t[48+s]=n-m,t[56+s]=o-e;for(s=0;s<64;s+=8)a=t[4+s],b=t[2+s]+t[6+s],c=t[5+s]-t[3+s],f=t[1+s]+t[7+s],g=t[3+s]+t[5+s],d=t[1+s]-t[7+s],e=f+g,h=t[0+s],m=(473*d-196*c+128>>8)-e,i=m-(362*(f-g)+128>>8),j=h-a,k=(362*(t[2+s]-t[6+s])+128>>8)-b,l=h+a,n=j+k,o=l+b,p=j-k,q=l-b,r=-i-(473*c+196*d+128>>8),t[0+s]=e+o+128>>8,t[1+s]=m+n+128>>8,t[2+s]=p-i+128>>8,t[3+s]=q-r+128>>8,t[4+s]=q+r+128>>8,t[5+s]=i+p+128>>8,t[6+s]=n-m+128>>8,t[7+s]=o-e+128>>8},e="jsmp",f=1,g=[0,23.976,24,25,29.97,30,50,59.94,60,0,0,0,0,0,0,0],h=new Uint8Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]),i=new Uint8Array([8,16,19,22,26,27,29,34,16,16,22,24,27,29,34,37,19,22,26,27,29,34,34,38,22,22,26,27,29,34,37,40,22,26,27,29,32,35,40,48,26,27,29,32,35,40,48,58,26,27,29,34,38,46,56,69,27,29,35,38,46,56,69,83]),j=new Uint8Array([16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16]),k=new Uint8Array([32,44,42,38,32,25,17,9,44,62,58,52,44,35,24,12,42,58,55,49,42,33,23,12,38,52,49,44,38,30,20,10,32,44,42,38,32,25,17,9,25,35,33,30,25,20,14,7,17,24,23,20,17,14,9,5,9,12,12,10,9,7,5,2]),l=new Int16Array([3,6,0,9,12,0,0,0,1,15,18,0,21,24,0,27,30,0,33,36,0,0,0,3,0,0,2,39,42,0,45,48,0,0,0,5,0,0,4,51,54,0,57,60,0,0,0,7,0,0,6,63,66,0,69,72,0,75,78,0,81,84,0,-1,87,0,-1,90,0,93,96,0,99,102,0,105,108,0,111,114,0,0,0,9,0,0,8,117,120,0,123,126,0,129,132,0,135,138,0,0,0,15,0,0,14,0,0,13,0,0,12,0,0,11,0,0,10,141,-1,0,-1,144,0,147,150,0,153,156,0,159,162,0,165,168,0,171,174,0,177,180,0,183,-1,0,-1,186,0,189,192,0,195,198,0,201,204,0,207,210,0,213,216,0,219,222,0,0,0,21,0,0,20,0,0,19,0,0,18,0,0,17,0,0,16,0,0,35,0,0,34,0,0,33,0,0,32,0,0,31,0,0,30,0,0,29,0,0,28,0,0,27,0,0,26,0,0,25,0,0,24,0,0,23,0,0,22]),m=new Int8Array([3,6,0,-1,9,0,0,0,1,0,0,17]),n=new Int8Array([3,6,0,9,12,0,0,0,10,15,18,0,0,0,2,21,24,0,0,0,8,27,30,0,33,36,0,-1,39,0,0,0,18,0,0,26,0,0,1,0,0,17]),o=new Int8Array([3,6,0,9,15,0,12,18,0,24,21,0,0,0,12,27,30,0,0,0,14,39,42,0,36,33,0,0,0,4,0,0,6,54,48,0,45,51,0,0,0,8,0,0,10,-1,57,0,0,0,1,60,63,0,0,0,30,0,0,17,0,0,22,0,0,26]),p=new Int16Array([6,3,0,9,18,0,12,15,0,24,33,0,36,39,0,27,21,0,30,42,0,60,57,0,54,48,0,69,51,0,81,75,0,63,84,0,45,66,0,72,78,0,0,0,60,105,120,0,132,144,0,114,108,0,126,141,0,87,93,0,117,96,0,0,0,32,135,138,0,99,123,0,129,102,0,0,0,4,90,111,0,0,0,8,0,0,16,0,0,44,150,168,0,0,0,28,0,0,52,0,0,62,183,177,0,156,180,0,0,0,1,165,162,0,0,0,61,0,0,56,171,174,0,0,0,2,0,0,40,153,186,0,0,0,48,192,189,0,147,159,0,0,0,20,0,0,12,240,249,0,0,0,63,231,225,0,195,219,0,252,198,0,0,0,24,0,0,36,0,0,3,207,261,0,243,237,0,204,213,0,210,234,0,201,228,0,216,222,0,258,255,0,264,246,0,-1,282,0,285,291,0,0,0,33,0,0,9,318,330,0,306,348,0,0,0,5,0,0,10,279,267,0,0,0,6,0,0,18,0,0,17,0,0,34,339,357,0,309,312,0,270,276,0,327,321,0,351,354,0,303,297,0,294,288,0,300,273,0,342,345,0,315,324,0,336,333,0,363,375,0,0,0,41,0,0,14,0,0,21,372,366,0,360,369,0,0,0,11,0,0,19,0,0,7,0,0,35,0,0,13,0,0,50,0,0,49,0,0,58,0,0,37,0,0,25,0,0,45,0,0,57,0,0,26,0,0,29,0,0,38,0,0,53,0,0,23,0,0,43,0,0,46,0,0,42,0,0,22,0,0,54,0,0,51,0,0,15,0,0,30,0,0,39,0,0,47,0,0,55,0,0,27,0,0,59,0,0,31]),q=new Int16Array([3,6,0,12,9,0,0,0,0,18,15,0,24,21,0,0,0,-1,0,0,1,27,30,0,36,33,0,0,0,2,0,0,-2,42,45,0,48,39,0,60,54,0,0,0,3,0,0,-3,51,57,0,-1,69,0,81,75,0,78,63,0,72,66,0,96,84,0,87,93,0,-1,99,0,108,105,0,0,0,-4,90,102,0,0,0,4,0,0,-7,0,0,5,111,123,0,0,0,-5,0,0,7,114,120,0,126,117,0,0,0,-6,0,0,6,153,162,0,150,147,0,135,138,0,156,141,0,129,159,0,132,144,0,0,0,10,0,0,9,0,0,8,0,0,-8,171,198,0,0,0,-9,180,192,0,168,183,0,165,186,0,174,189,0,0,0,-10,177,195,0,0,0,12,0,0,16,0,0,13,0,0,14,0,0,11,0,0,15,0,0,-16,0,0,-12,0,0,-14,0,0,-15,0,0,-11,0,0,-13]),r=new Int8Array([6,3,0,18,15,0,9,12,0,0,0,1,0,0,2,27,24,0,21,30,0,0,0,0,36,33,0,0,0,4,0,0,3,39,42,0,0,0,5,0,0,6,48,45,0,51,-1,0,0,0,7,0,0,8]),s=new Int8Array([6,3,0,12,9,0,18,15,0,24,21,0,0,0,2,0,0,1,0,0,0,30,27,0,0,0,3,36,33,0,0,0,4,42,39,0,0,0,5,48,45,0,0,0,6,51,-1,0,0,0,7,0,0,8]),t=new Int32Array([3,6,0,12,9,0,0,0,1,21,24,0,18,15,0,39,27,0,33,30,0,42,36,0,0,0,257,60,66,0,54,63,0,48,57,0,0,0,513,51,45,0,0,0,2,0,0,3,81,75,0,87,93,0,72,78,0,96,90,0,0,0,1025,69,84,0,0,0,769,0,0,258,0,0,1793,0,0,65535,0,0,1537,111,108,0,0,0,1281,105,102,0,117,114,0,99,126,0,120,123,0,156,150,0,162,159,0,144,147,0,129,135,0,138,132,0,0,0,2049,0,0,4,0,0,514,0,0,2305,153,141,0,165,171,0,180,168,0,177,174,0,183,186,0,0,0,2561,0,0,3329,0,0,6,0,0,259,0,0,5,0,0,770,0,0,2817,0,0,3073,228,225,0,201,210,0,219,213,0,234,222,0,216,231,0,207,192,0,204,189,0,198,195,0,243,261,0,273,240,0,246,237,0,249,258,0,279,276,0,252,255,0,270,282,0,264,267,0,0,0,515,0,0,260,0,0,7,0,0,1026,0,0,1282,0,0,4097,0,0,3841,0,0,3585,315,321,0,333,342,0,312,291,0,375,357,0,288,294,0,-1,369,0,285,303,0,318,363,0,297,306,0,339,309,0,336,348,0,330,300,0,372,345,0,351,366,0,327,354,0,360,324,0,381,408,0,417,420,0,390,378,0,435,438,0,384,387,0,0,0,2050,396,402,0,465,462,0,0,0,8,411,399,0,429,432,0,453,414,0,426,423,0,0,0,10,0,0,9,0,0,11,0,0,5377,0,0,1538,0,0,771,0,0,5121,0,0,1794,0,0,4353,0,0,4609,0,0,4865,444,456,0,0,0,1027,459,450,0,0,0,261,393,405,0,0,0,516,447,441,0,516,519,0,486,474,0,510,483,0,504,498,0,471,537,0,507,501,0,522,513,0,534,531,0,468,477,0,492,495,0,549,546,0,525,528,0,0,0,263,0,0,2562,0,0,2306,0,0,5633,0,0,5889,0,0,6401,0,0,6145,0,0,1283,0,0,772,0,0,13,0,0,12,0,0,14,0,0,15,0,0,517,0,0,6657,0,0,262,540,543,0,480,489,0,588,597,0,0,0,27,609,555,0,606,603,0,0,0,19,0,0,22,591,621,0,0,0,18,573,576,0,564,570,0,0,0,20,552,582,0,0,0,21,558,579,0,0,0,23,612,594,0,0,0,25,0,0,24,600,615,0,0,0,31,0,0,30,0,0,28,0,0,29,0,0,26,0,0,17,0,0,16,567,618,0,561,585,0,654,633,0,0,0,37,645,648,0,0,0,36,630,636,0,0,0,34,639,627,0,663,666,0,657,624,0,651,642,0,669,660,0,0,0,35,0,0,267,0,0,40,0,0,268,0,0,266,0,0,32,0,0,264,0,0,265,0,0,38,0,0,269,0,0,270,0,0,33,0,0,39,0,0,7937,0,0,6913,0,0,7681,0,0,4098,0,0,7425,0,0,7169,0,0,271,0,0,274,0,0,273,0,0,272,0,0,1539,0,0,2818,0,0,3586,0,0,3330,0,0,3074,0,0,3842]),
u=1,v=2,w=3,x=179,y=1,z=175,A=0,B=181,C=178,D=["precision mediump float;","uniform sampler2D YTexture;","uniform sampler2D CBTexture;","uniform sampler2D CRTexture;","varying vec2 texCoord;","void main() {","float y = texture2D(YTexture, texCoord).r;","float cr = texture2D(CBTexture, texCoord).r - 0.5;","float cb = texture2D(CRTexture, texCoord).r - 0.5;","gl_FragColor = vec4(","y + 1.4 * cr,","y + -0.343 * cb - 0.711 * cr,","y + 1.765 * cb,","1.0",");","}"].join("\n"),E=["precision mediump float;","uniform float loaded;","varying vec2 texCoord;","void main() {","float c = ceil(loaded-(1.0-texCoord.y));","gl_FragColor = vec4(c,c,c,1);","}"].join("\n"),F=["attribute vec2 vertex;","varying vec2 texCoord;","void main() {","texCoord = vertex;","gl_Position = vec4((vertex * 2.0 - 1.0) * vec2(1, -1), 0.0, 1.0);","}"].join("\n"),G=[null,m,n,o],H=function P(a){this.bytes=new Uint8Array(a),this.length=this.bytes.length,this.writePos=this.bytes.length,this.index=0},H.NOT_FOUND=-1,H.prototype.findNextMPEGStartCode=function(){for(var a=this.index+7>>3;a<this.writePos;a++)if(0===this.bytes[a]&&0===this.bytes[a+1]&&1===this.bytes[a+2])return this.index=a+4<<3,this.bytes[a+3];return this.index=this.writePos<<3,H.NOT_FOUND},H.prototype.nextBytesAreStartCode=function(){var a=this.index+7>>3;return a>=this.writePos||0===this.bytes[a]&&0===this.bytes[a+1]&&1===this.bytes[a+2]},H.prototype.nextBits=function(a){var b,c,d,e=this.index>>3,f=8-this.index%8;if(f>=a)return this.bytes[e]>>f-a&255>>8-a;for(b=(this.index+a)%8,c=this.index+a-1>>3,d=this.bytes[e]&255>>8-f,e++;e<c;e++)d<<=8,d|=this.bytes[e];return b>0?(d<<=b,d|=this.bytes[e]>>8-b):(d<<=8,d|=this.bytes[e]),d},H.prototype.getBits=function(a){var b=this.nextBits(a);return this.index+=a,b},H.prototype.advance=function(a){return this.index+=a},H.prototype.rewind=function(a){return this.index-=a},b.exports=N},{"./Tracker":44,"./progXHR":56}],55:[function(a,b,c){"use strict";function d(a){var b,c;if(a&&a.__esModule)return a;if(b={},null!=a)for(c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b["default"]=a,b}var e,f,g;Object.defineProperty(c,"__esModule",{value:!0}),c["default"]=function(a){var b=f.get(),c=b.bl||[],d=g.concat(c),e=!1;return d.map(function(b){b.indexOf(a)!==-1&&(e=!0)}),e},e=a("../player/dynamicSettings"),f=d(e),g=[".rtbauction.com","video.leadzu.com"],b.exports=c["default"]},{"../player/dynamicSettings":26}],56:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){var c=new XMLHttpRequest,d=null;return c.overrideMimeType("text/plain; charset=x-user-defined"),c.addEventListener("progress",function(a){if(!d){d=new g(c);var e=c.getResponseHeader("Content-Length");b(e,d)}d.progress()}),c.onreadystatechange=function(a){4===this.readyState&&(200===this.status?d?d.close():b(-1,"NO_PROGRESS"):b(-1,this.status))},c.open("GET",a),c.send(),c}var f,g;Object.defineProperty(c,"__esModule",{value:!0}),f=function(){function a(a,b){var c,d;for(c=0;c<b.length;c++)d=b[c],d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),c.streamFetch=e,g=function(){function a(b){d(this,a),this.req=b,this.result={value:null,done:!1},this.clbk=null,this.index=0}return f(a,[{key:"convertRes2",value:function b(a){var b,c=this.req.responseText,d=new Uint8Array(a);for(b=0;b<a;++b)d[b]=255&c.charCodeAt(this.index+b);return d}},{key:"progress",value:function c(){var a=this.req.responseText.length,b=a-this.index;b&&(this.result.value=this.convertRes2(b),this.index=a,this.clbk&&this.clbk(this.result))}},{key:"close",value:function e(a){this.result.done=!0,this.clbk&&this.clbk(this.result),this.result=void 0,this.clbk=void 0}},{key:"read",value:function g(a){this.clbk=a}}]),a}()},{}],57:[function(a,b,c){"use strict";function d(a,b){function c(a,c){var d=e(a,b),f=e(c,b);return d>f?1:-1}var d=a.sort(c);return d}function e(a,b){var c,d=0,e=g(a.wfIndex),h=g(a.waterfallTagId),i=g(a.cpmFloor),j=g(a.fillrate),k=b.getByAdvId("scoreBoost",a.advId)||0,l=f(a.type)||1,m={wg:e,wi:h,fr:j,cf:i,mt:l,advb:k};if(a.scoreSummary=m,d=1,c=b.get("qsrtscr"),c&&"function"==typeof c)try{d=c(m,a,b)}catch(n){d=999999}return a.score=d,d}function f(a){return"flash"===a?1:"javascript"===a?2:3}function g(a){return a=a||0,parseInt(a)}b.exports={sort:d}},{}],58:[function(a,b,c){"use strict";var d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},e=function(){function a(){var a,b,c,d;if(!W&&document.getElementsByTagName("body")[0]){try{b=t("span"),b.style.display="none",a=P.getElementsByTagName("body")[0].appendChild(b),a.parentNode.removeChild(a),a=null,b=null}catch(e){return}for(W=!0,c=S.length,d=0;d<c;d++)S[d]()}}function b(a){W?a():S[S.length]=a}function c(a){if(d(O.addEventListener)!=H)O.addEventListener("load",a,!1);else if(d(P.addEventListener)!=H)P.addEventListener("load",a,!1);else if(d(O.attachEvent)!=H)v(O,"onload",a);else if("function"==typeof O.onload){var b=O.onload;O.onload=function(){b(),a()}}else O.onload=a}function f(){var a,b,c=P.getElementsByTagName("body")[0],e=t(I);e.setAttribute("style","visibility: hidden;"),e.setAttribute("type",L),a=c.appendChild(e),a?(b=0,function f(){if(d(a.GetVariable)!=H)try{var h=a.GetVariable("$version");h&&(h=h.split(" ")[1].split(","),$.pv=[u(h[0]),u(h[1]),u(h[2])])}catch(i){$.pv=[8,0,0]}else if(b<10)return b++,void setTimeout(f,10);c.removeChild(e),a=null,g()}()):g()}function g(){var a,b,c,e,f,g,l,m,n,o,p,q=T.length;if(q>0)for(a=0;a<q;a++)if(b=T[a].id,c=T[a].callbackFn,e={success:!1,id:b},$.pv[0]>0){if(f=s(b))if(!w(T[a].swfVersion)||$.wk&&$.wk<312)if(T[a].expressInstall&&i()){for(g={},g.data=T[a].expressInstall,g.width=f.getAttribute("width")||"0",g.height=f.getAttribute("height")||"0",f.getAttribute("class")&&(g.styleclass=f.getAttribute("class")),f.getAttribute("align")&&(g.align=f.getAttribute("align")),l={},m=f.getElementsByTagName("param"),n=m.length,o=0;o<n;o++)"movie"!=m[o].getAttribute("name").toLowerCase()&&(l[m[o].getAttribute("name")]=m[o].getAttribute("value"));j(g,l,b,c)}else k(f),c&&c(e);else y(b,!0),c&&(e.success=!0,e.ref=h(b),e.id=b,c(e))}else y(b,!0),c&&(p=h(b),p&&d(p.SetVariable)!=H&&(e.success=!0,e.ref=p,e.id=p.id),c(e))}function h(a){var b=null,c=s(a);return c&&"OBJECT"===c.nodeName.toUpperCase()&&(b=d(c.SetVariable)!==H?c:c.getElementsByTagName(I)[0]||c),b}function i(){return!X&&w("6.0.65")&&($.win||$.mac)&&!($.wk&&$.wk<312)}function j(a,b,c,e){var f,g,h,i=s(c);c=r(c),X=!0,C=e||null,D={success:!1,id:c},i&&("OBJECT"==i.nodeName.toUpperCase()?(A=l(i),B=null):(A=i,B=c),a.id=M,(d(a.width)==H||!/%$/.test(a.width)&&u(a.width)<310)&&(a.width="310"),(d(a.height)==H||!/%$/.test(a.height)&&u(a.height)<137)&&(a.height="137"),f=$.ie?"ActiveX":"PlugIn",g="MMredirectURL="+encodeURIComponent(O.location.toString().replace(/&/g,"%26"))+"&MMplayerType="+f+"&MMdoctitle="+encodeURIComponent(P.title.slice(0,47)+" - Flash Player Installation"),d(b.flashvars)!=H?b.flashvars+="&"+g:b.flashvars=g,$.ie&&4!=i.readyState&&(h=t("div"),c+="SWFObjectNew",h.setAttribute("id",c),i.parentNode.insertBefore(h,i),i.style.display="none",p(i)),n(a,b,c))}function k(a){if($.ie&&4!=a.readyState){a.style.display="none";var b=t("div");a.parentNode.insertBefore(b,a),b.parentNode.replaceChild(l(a),b),p(a)}else a.parentNode.replaceChild(l(a),a)}function l(a){var b,c,d,e,f=t("div");if($.win&&$.ie)f.innerHTML=a.innerHTML;else if(b=a.getElementsByTagName(I)[0],b&&(c=b.childNodes))for(d=c.length,e=0;e<d;e++)1==c[e].nodeType&&"PARAM"==c[e].nodeName||8==c[e].nodeType||f.appendChild(c[e].cloneNode(!0));return f}function m(a,b){var c=t("div");return c.innerHTML="<object classid='clsid:D27CDB6E-AE6D-11cf-96B8-444553540000'><param name='movie' value='"+a+"'>"+b+"</object>",c.firstChild}function n(a,b,c){var e,f,g,h,i,j=s(c);if(c=r(c),$.wk&&$.wk<312)return e;if(j){f=t($.ie?"div":I),d(a.id)==H&&(a.id=c);for(i in b)b.hasOwnProperty(i)&&"movie"!==i.toLowerCase()&&o(f,i,b[i]);$.ie&&(f=m(a.data,f.innerHTML));for(g in a)a.hasOwnProperty(g)&&(h=g.toLowerCase(),"styleclass"===h?f.setAttribute("class",a[g]):"classid"!==h&&"data"!==h&&f.setAttribute(g,a[g]));$.ie?U[U.length]=a.id:(f.setAttribute("type",L),f.setAttribute("data",a.data)),j.parentNode.replaceChild(f,j),e=f}return e}function o(a,b,c){var d=t("param");d.setAttribute("name",b),d.setAttribute("value",c),a.appendChild(d)}function p(a){var b=s(a);b&&"OBJECT"==b.nodeName.toUpperCase()&&($.ie?(b.style.display="none",function c(){if(4==b.readyState){for(var a in b)"function"==typeof b[a]&&(b[a]=null);b.parentNode.removeChild(b)}else setTimeout(c,10)}()):b.parentNode.removeChild(b))}function q(a){return a&&a.nodeType&&1===a.nodeType}function r(a){return q(a)?a.id:a}function s(a){if(q(a))return a;var b=null;try{b=P.getElementById(a)}catch(c){}return b}function t(a){return P.createElement(a)}function u(a){return parseInt(a,10)}function v(a,b,c){a.attachEvent(b,c),V[V.length]=[a,b,c]}function w(a){a+="";var b=$.pv,c=a.split(".");return c[0]=u(c[0]),c[1]=u(c[1])||0,c[2]=u(c[2])||0,b[0]>c[0]||b[0]==c[0]&&b[1]>c[1]||b[0]==c[0]&&b[1]==c[1]&&b[2]>=c[2]}function x(a,b,c,e){var f,g,h=P.getElementsByTagName("head")[0];h&&(f="string"==typeof c?c:"screen",e&&(E=null,F=null),E&&F==f||(g=t("style"),g.setAttribute("type","text/css"),g.setAttribute("media",f),E=h.appendChild(g),$.ie&&d(P.styleSheets)!=H&&P.styleSheets.length>0&&(E=P.styleSheets[P.styleSheets.length-1]),F=f),E&&(d(E.addRule)!=H?E.addRule(a,b):d(P.createTextNode)!=H&&E.appendChild(P.createTextNode(a+" {"+b+"}"))))}function y(a,b){if(Y){var c=b?"visible":"hidden",d=s(a);W&&d?d.style.visibility=c:"string"==typeof a&&x("#"+a,"visibility:"+c)}}function z(a){var b=/[\\\"<>\.;]/,c=null!=b.exec(a);return c&&("undefined"==typeof encodeURIComponent?"undefined":d(encodeURIComponent))!=H?encodeURIComponent(a):a}var A,B,C,D,E,F,G,H="undefined",I="object",J="Shockwave Flash",K="ShockwaveFlash.ShockwaveFlash",L="application/x-shockwave-flash",M="SWFObjectExprInst",N="onreadystatechange",O=window,P=document,Q=navigator,R=!1,S=[],T=[],U=[],V=[],W=!1,X=!1,Y=!0,Z=!1,$=function(){var a,b=d(P.getElementById)!=H&&d(P.getElementsByTagName)!=H&&d(P.createElement)!=H,c=Q.userAgent.toLowerCase(),e=Q.platform.toLowerCase(),f=e?/win/.test(e):/win/.test(c),g=e?/mac/.test(e):/mac/.test(c),h=!!/webkit/.test(c)&&parseFloat(c.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")),i="Microsoft Internet Explorer"===Q.appName,j=[0,0,0],k=null;if(d(Q.plugins)!=H&&d(Q.plugins[J])==I)k=Q.plugins[J].description,k&&d(Q.mimeTypes)!=H&&Q.mimeTypes[L]&&Q.mimeTypes[L].enabledPlugin&&(R=!0,i=!1,k=k.replace(/^.*\s+(\S+\s+\S+$)/,"$1"),j[0]=u(k.replace(/^(.*)\..*$/,"$1")),j[1]=u(k.replace(/^.*\.(.*)\s.*$/,"$1")),j[2]=/[a-zA-Z]/.test(k)?u(k.replace(/^.*[a-zA-Z]+(.*)$/,"$1")):0);else if(d(O.ActiveXObject)!=H)try{a=new ActiveXObject(K),a&&(k=a.GetVariable("$version"),k&&(i=!0,k=k.split(" ")[1].split(","),j=[u(k[0]),u(k[1]),u(k[2])]))}catch(l){}return{w3:b,pv:j,wk:h,ie:i,win:f,mac:g}}(),_=function(){$.w3&&((d(P.readyState)!=H&&("complete"===P.readyState||"interactive"===P.readyState)||d(P.readyState)==H&&(P.getElementsByTagName("body")[0]||P.body))&&a(),W||(d(P.addEventListener)!=H&&P.addEventListener("DOMContentLoaded",a,!1),$.ie&&(P.attachEvent(N,function b(){"complete"==P.readyState&&(P.detachEvent(N,b),a())}),O==top&&!function c(){if(!W){try{P.documentElement.doScroll("left")}catch(b){return void setTimeout(c,0)}a()}}()),$.wk&&!function e(){if(!W)return/loaded|complete/.test(P.readyState)?void a():void setTimeout(e,0)}()))}();return S[0]=function(){R?f():g()},G=function(){$.ie&&window.attachEvent("onunload",function(){var a,b,c,d,f,g=V.length;for(a=0;a<g;a++)V[a][0].detachEvent(V[a][1],V[a][2]);for(b=U.length,c=0;c<b;c++)p(U[c]);for(d in $)$[d]=null;$=null;for(f in e)e[f]=null;e=null})}(),{registerObject:function aa(a,b,c,d){if($.w3&&a&&b){var e={};e.id=a,e.swfVersion=b,e.expressInstall=c,e.callbackFn=d,T[T.length]=e,y(a,!1)}else d&&d({success:!1,id:a})},getObjectById:function ba(a){if($.w3)return h(a)},embedSWF:function ca(a,c,e,f,g,h,k,l,m,o){var p=r(c),q={success:!1,id:p};$.w3&&!($.wk&&$.wk<312)&&a&&c&&e&&f&&g?(y(p,!1),b(function(){var b,r,s,t,u,v,x,z;if(e+="",f+="",b={},m&&("undefined"==typeof m?"undefined":d(m))===I)for(r in m)b[r]=m[r];if(b.data=a,b.width=e,b.height=f,s={},l&&("undefined"==typeof l?"undefined":d(l))===I)for(t in l)s[t]=l[t];if(k&&("undefined"==typeof k?"undefined":d(k))===I)for(u in k)k.hasOwnProperty(u)&&(v=Z?encodeURIComponent(u):u,x=Z?encodeURIComponent(k[u]):k[u],d(s.flashvars)!=H?s.flashvars+="&"+v+"="+x:s.flashvars=v+"="+x);if(w(g))z=n(b,s,c),b.id==p&&y(p,!0),q.success=!0,q.ref=z,q.id=z.id;else{if(h&&i())return b.data=h,void j(b,s,c,o);y(p,!0)}o&&o(q)})):o&&o(q)},switchOffAutoHideShow:function da(){Y=!1},enableUriEncoding:function ea(a){Z=("undefined"==typeof a?"undefined":d(a))===H||a},ua:$,getFlashPlayerVersion:function fa(){return{major:$.pv[0],minor:$.pv[1],release:$.pv[2]}},hasFlashPlayerVersion:w,createSWF:function ga(a,b,c){return $.w3?n(a,b,c):void 0},showExpressInstall:function ha(a,b,c,d){$.w3&&i()&&j(a,b,c,d)},removeSWF:function ia(a){$.w3&&p(a)},createCSS:function ja(a,b,c,d){$.w3&&x(a,b,c,d)},addDomLoadEvent:b,addLoadEvent:c,getQueryParamValue:function ka(a){var b,c,d=P.location.search||P.location.hash;if(d){if(/\?/.test(d)&&(d=d.split("?")[1]),null==a)return z(d);for(b=d.split("&"),c=0;c<b.length;c++)if(b[c].substring(0,b[c].indexOf("="))==a)return z(b[c].substring(b[c].indexOf("=")+1))}return""},expressInstallCallback:function la(){if(X){var a=s(M);a&&A&&(a.parentNode.replaceChild(A,a),B&&(y(B,!0),$.ie&&(A.style.display="block")),C&&C(D)),X=!1}},version:"2.3"}}();b.exports=e},{}],59:[function(a,b,c){"use strict";b.exports=function(){return{adimpression:[],impression:[],aderror:[],error:[],adclickthru:[],clickthru:[],adclickthrough:[],clickthrough:[],adclicktracking:[],clicktracking:[],adoloaded:[],loaded:[],adstarted:[],started:[],adstopped:[],stopped:[],adskipped:[],skipped:[],adskippablestatechange:[],skippablestatechange:[],adsizechange:[],sizechange:[],adlinearchange:[],linearchange:[],addurationchange:[],durationchange:[],adexpandedchange:[],expandedchange:[],advolumechange:[],volumechange:[],advideostart:[],start:[],advideofirstquartile:[],firstquartile:[],advideomidpoint:[],midpoint:[],advideothirdquartile:[],thirdquartile:[],advideocomplete:[],complete:[],adinteraction:[],interaction:[],aduseracceptinvitation:[],acceptinvitation:[],aduserminimize:[],minimize:[],aduserclose:[],close:[],adpaused:[],paused:[],pause:[],adplaying:[],playing:[],resume:[],adlog:[],log:[],adfound:[],admute:[],mute:[],adunmute:[],unmute:[],adfullscreen:[],fullscreen:[],creativeview:[]}}},{}],60:[function(a,b,c){"use strict";b.exports={AdLoaded:"AdLoaded",AdStarted:"AdStarted",AdStopped:"AdStopped",AdSkipped:"AdSkipped",AdSkippableStateChange:"AdSkippableStateChange",AdSizeChange:"AdSizeChange",AdLinearChange:"AdLinearChange",AdDurationChange:"AdDurationChange",AdExpandedChange:"AdExpandedChange",AdVolumeChange:"AdVolumeChange",AdImpression:"AdImpression",AdVideoStart:"AdVideoStart",AdVideoFirstQuartile:"AdVideoFirstQuartile",AdVideoMidpoint:"AdVideoMidpoint",AdVideoThirdQuartile:"AdVideoThirdQuartile",AdVideoComplete:"AdVideoComplete",AdClickThru:"AdClickThru",AdInteraction:"AdInteraction",AdUserAcceptInvitation:"AdUserAcceptInvitation",AdUserMinimize:"AdUserMinimize",AdUserClose:"AdUserClose",AdPaused:"AdPaused",AdPlaying:"AdPlaying",AdLog:"AdLog",AdError:"AdError",SoundViolation:"SoundViolation",HijackAttempt:"HijackAttempt"}},{}]},{},[14]);