if(!window.TNCMS){window.TNCMS={}}window.TNCMS.Tracking=function(){"use strict";var e={},n={},t=null,r=0;function a(e){if(console.warn){console.warn(e)}}function i(e){var t="?";if(n[e]&&window.JSON){t+="d=";t+=encodeURIComponent(JSON.stringify(n[e]));t+="&"}if(document.referrer){var r=document.referrer.match(/:\/\/(.[^/]+)/)[1];t+="rd="+encodeURIComponent(r)+"&"}return t+"i="}function c(e){var n=["app","url","metric","bucket","id"];for(var t=0;t<n.length;t++){if(!e[n[t]]){a("Missing required parameter: "+n[t]);return}}var r=i(e.bucket);var c=e.domain||document.domain;r+=escape(e.id)+"&r="+escape(e.url).replace("%3A",":");return"//"+c+"/tncms/tracking/"+e.app+"/"+e.metric+"/"+r}function u(){var n=null,r=e;e={};t=null;for(var a in r){var c=a.split(":",2);var u=c[0].split("|",2);var o=i(u[1]);var d="//"+u[0]+"/tncms/tracking/"+c[1]+"/"+o;while(r[a].length){var m=r[a].pop();if(d.length+m.length>2e3){(new Image).src=d;d="//"+u[0]+"/tncms/tracking/"+c[1]+"/"+o}d+=m+","}(new Image).src=d}}function o(n){if(!n.app){a("Missing required parameter: app");return}if(!n.metric){a("Missing required parameter: metric");return}if(!n.id){a("Missing required parameter: id");return}var r=n.domain||document.domain;var i=r+"|"+n.bucket+":"+n.app+"/"+n.metric;if(!e[i]){e[i]=[]}e[i]=e[i].concat(n.id);if(t){window.clearTimeout(t)}t=window.setTimeout(u,1e3)}function d(e){if(!n[e.bucket]){n[e.bucket]={}}n[e.bucket][e.name]=e.value}function m(e){if(n[e.bucket]){delete n[e.bucket][e.name]}}return{addEvent:function(e){e.bucket="global";o(e)},getRedirectURL:function(e){e.bucket="global";return c(e)},addData:function(e){e.bucket="global";d(e)},removeData:function(e){e.bucket="global";m(e)},trackDeclarativeEvents:function(e){e=e||{};var n=e.root||document.body;var t=e.domain||document.domain;if(typeof jQuery=="undefined"){throw"Declarative event tracking requires jQuery"}jQuery(n).find("[data-tncms-tracking]").filter(":visible").each(function(){var e=jQuery(this);var n=e.data("tncmsTracking").split("/",3);if(n.length>=3){TNCMS.Tracking.addEvent({domain:t,id:n[2],metric:n[1],app:n[0]})}a("Removing tncms tracking: "+e.data("tncmsTracking"));e.removeData("tncmsTracking")})},createBucket:function(e){var n=e.app||null;var t=e.metric||null;var a=e.domain||document.domain;var i="bucket"+r++;var u=e.data||{};for(var f in u){d({bucket:i,name:f,value:u[f]})}return{addEvent:function(e){o({domain:a,bucket:i,id:e,app:n,metric:t})},addData:function(e){e.bucket=i;d(e)},removeData:function(e){e.bucket=i;m(e)},getRedirectURL:function(e){e.bucket=i;e.domain=a;return c(e)}}}}}();