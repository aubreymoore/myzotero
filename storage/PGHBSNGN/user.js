$(document).ready(function(){function e(e){$.stickr({note:e,className:"opacity",position:{right:0,top:0}})}function t(){setTimeout(function(){$("#loader_news").removeClass("loader_news_gif")},500)}function n(){$(".modal_opt").toggle(function(){$(".more_opt").slideUp(300)},function(){$(".more_opt").slideDown(300)})}function r(e,t){switch(e){case"prssedit":var n={rssid:t};break;case"ptagedit":var n={tagid:t};break}if(n){var r=JSON.stringify(n);return r}}function i(){$(".p_tag, .p_rss,.p_tag2, .p_rss2").hover(function(){$(this).find(".p_tag_control").show()},function(){$(this).find(".p_tag_control").hide()})}function s(){var e=$(".p_tag").size();var t=0;for(var n=0;n<10;n++){var r=$(".p_tag").eq(n);t=t+r.outerHeight(true)}if(e>10){$("#pers_tags").css("height",t+"px");$("#show_more_tags").show();$(".pers_tags_more").html("Развернуть теги +"+(e-10));var i=0;$(".pers_tags_more").click(function(){if(i==0){$("#pers_tags").css("height","auto");$(".pers_tags_more").html("Свернуть теги");i=1}else{$("#pers_tags").css("height",t+"px");$(".pers_tags_more").html("Развернуть теги +"+(e-10));i=0}})}return t}function u(e){var t=0;$(".p_rss a:first-child").each(function(){if($(this).html()==e){t=1}});return t}function a(e){var t=0;$(".p_tag a:first-child").each(function(){if($(this).html()==e){t=1}});return t}function f(e){$("#mi_rss_site,#mi_rss_site2,#rss_search_fld,#rss_search_fld2").autocomplete({url:mi.baseurl+mi.lang_country+"/load/?action=rss_search",sortFunction:function(e,t,n){var r=n.toLowerCase();var i=r.length;var s=e.value.toLowerCase().substring(0,i)==r?"0":"1";var s=s+String(e.data[0]).toLowerCase();var o=t.value.toLowerCase().substring(0,i)==r?"0":"1";var o=o+String(t.data[0]).toLowerCase();if(s>o){return 1}if(s<o){return-1}return 0},showResult:function(e,t){return e},onItemSelect:function(t){if(e=="modal"){$("#mi_rss_site").attr("data-rss",t.data)}else{if($(".rss_search_fld").attr("id")=="rss_search_fld"){$("#rss_search_fld").attr("data-rss",t.data)}else if($(".rss_search_fld").attr("id")=="rss_search_fld2"){$("#rss_search_fld2").attr("data-rss",t.data)}}},mustMatch:true,maxItemsToShow:10,selectFirst:false,autoFill:false,selectOnly:true,remoteDataType:"json"})}function l(){$("#search_fld").autocomplete({url:mi.baseurl+mi.lang_country+"/load/?action=tags_search",sortFunction:function(e,t,n){var r=n.toLowerCase();var i=r.length;var s=e.value.toLowerCase().substring(0,i)==r?"0":"1";var s=s+String(e.data[0]).toLowerCase();var o=t.value.toLowerCase().substring(0,i)==r?"0":"1";var o=o+String(t.data[0]).toLowerCase();if(s>o){return 1}if(s<o){return-1}return 0},showResult:function(e,t){return e},onItemSelect:function(e){},mustMatch:true,maxItemsToShow:15,selectFirst:false,autoFill:false,selectOnly:true,remoteDataType:"json"})}$.cookie.raw=true;if($.cookie("set_tags")==2){$("#show_more_tags").hide();$("#show_more_rss").show()}else{$("#show_more_tags").show();$("#show_more_rss").hide()}$("#tabtags, #tabrss").live("click",function(){var e=$(this).attr("id");if(e=="tabtags"){$("#tabtags").addClass("t_tab_act");$("#tabrss").removeClass("t_tab_act");$("#pers_tags").removeClass("dn");$("#pers_rss").addClass("dn");$.cookie("set_tags",1,{expires:30,path:"/"});$("#show_more_tags").show();$("#show_more_rss").hide();$("#add_tags_blk").show();$("#add_rss_blk").hide();var t=s()}else{$("#add_tags_blk").hide();$("#add_rss_blk").show();$("#show_more_rss").show();$("#show_more_tags").hide();$("#tabtags").removeClass("t_tab_act");$("#tabrss").addClass("t_tab_act");$("#pers_rss").removeClass("dn");$("#pers_tags").addClass("dn");$.cookie("set_tags",2,{expires:30,path:"/"})}});$("#settings, #tag_adv, .ptagedit, .prssedit").live("click",function(){var e="";var t="";var i=$(this).attr("id");if(i=="settings"){t="settings"}if(i=="tag_adv"){t="ptagadd";e=0}if($(this).hasClass("ptagedit")){t="ptagedit";e=$(this).attr("id").replace("ptagedit-","")}if($(this).hasClass("prssedit")){t="prssedit";e=$(this).attr("id").replace("prssedit-","")}var s=r(t,e);if(t!=""){$.arcticmodal({type:"ajax",url:mi.baseurl+mi.lang_country+"/load/",ajax:{type:"POST",cache:false,dataType:"html",data:{action:"forms",form:t,df:s},success:function(r,i,s){var o=$('<div class="box-modal">'+s+"</div>");r.body.html(o);if(t=="ptagedit"){$("#mi_personal_tags_name").val($("#p_tag_"+e+" a:first-child").html());$("#mi_personal_tags_id").val(e);n()}if(t=="prssedit"){f("modal")}}}})}});$(".ptagedit2, .prssedit2").live("click",function(){var e="";var t="";var i=$(this).attr("id");if(i=="tag_adv"){t="ptagadd";e=0}if($(this).hasClass("ptagedit2")){t="ptagedit";e=$(this).attr("id").replace("ptagedit-","")}if($(this).hasClass("prssedit2")){t="prssedit";e=$(this).attr("id").replace("prssedit-","")}var s=r(t,e);if(t!=""){$.arcticmodal({type:"ajax",url:mi.baseurl+mi.lang_country+"/load/",ajax:{type:"POST",cache:false,dataType:"html",data:{action:"forms",form:t,df:s},success:function(r,i,s){var o=$('<div class="box-modal">'+s+"</div>");r.body.html(o);if(t=="ptagedit"){$("#mi_personal_tags_name").val($("#p_tag_"+e+" a:first-child").html());$("#mi_personal_tags_id").val(e);n()}if(t=="prssedit"){f("modal")}}}})}});$("#submit_pt").live("click",function(){var e=$("#mi_settings_lang :selected").val();var e=e.split("-");var t=e[0];var n=e[1];var e=$("#mi_settings_country :selected").val();mi_set_country=e.split("-");mi_settings_country=mi_set_country[0];mi_settings_country_iso=mi_set_country[1];var r=$("#mi_settings_timezone :selected").val();var i=$("#mi_settings_dateformat :selected").val();$(".loading_modal").addClass("loading_modal_bg");$("#submit_pt").animate({opacity:.4},"slow");$.ajax({type:"POST",url:mi.baseurl+mi.lang_country+"/load/",cache:false,dataType:"json",data:{mi_settings_lang:t,mi_settings_country:mi_settings_country,mi_settings_timezone:r,mi_settings_dateformat:i,action:"change_settings"},success:function(e){if(e.error=="no"){$("#submit_pt").animate({opacity:100},"slow");$(".loading_modal").removeClass("loading_modal_bg").addClass("ok_bg");if(n!=mi.langiso||mi.country_id!=mi_settings_country){var t=n+"-"+mi_settings_country_iso+"/";window.location=mi.baseurl+t}}else{$(".loading_modal").html("error")}},error:function(){console.log("error send data")}})});i();var o=s();$(".s_favorite, .infavorite").live("click",function(){if($(this).hasClass("infavorite")){var t="removefavorite"}else{var t="addfavorite"}var n=$(this).attr("id");var r=n.split("-");$.ajax({type:"POST",url:mi.baseurl+mi.lang_country+"/load/",cache:false,dataType:"json",data:{flangid:r[1],fnewsid:r[2],action:t},success:function(r){if(r.error=="no"){if(t=="addfavorite"){$("#"+n).addClass("infavorite");$(".count_favorite").html(parseInt($(".count_favorite").html())+1);e(mi.addtofavorite)}else{$("#"+n).removeClass("infavorite");$(".count_favorite").html($(".count_favorite").html()-1);e(mi.delfromfavorite)}}else{if(r.msg=="notauthorized"){e(mi.logintofavor)}else{$(".loading_modal").html("error")}}},error:function(){console.log("error send data")}})});$("#tags_search_submit, #rss_search_submit, #submit_rssedit").live("click",function(){var n="addtag";var r="";var s=0;if($(this).attr("id")=="tags_search_submit"){var o=$("#tags_search_fld").val();if(a(o)==1){s=1;e(o+mi.existrss)}n="addtag"}else if($(this).attr("id")=="rss_search_submit"){var f=$("#rss_search_fld").attr("data-rss");var l=f.split(":");var c=l[0];var h=l[1];var p=l[2];var d=$("#rss_search_fld").val();if(u(d)==1){s=1;e(d+mi.existrss)}n="addrss"}else if($(this).attr("id")=="submit_rssedit"){var f=$("#mi_rss_site").attr("data-rss");var l=f.split(":");var c=l[0];var h=l[1];var p=l[2];var d=$("#mi_rss_site").val();if(u(d)==1){s=1;e(d+mi.existrss)}var r=$("#mi_personal_tags_id").val();n="editrss"}if(o==""){s=1;$("#tags_search_fld").attr("placeholder",mi.entertag)}if(d==""||c==""){s=1;$("#rss_search_fld").attr("placeholder",mi.enterrss)}if(s==0){$("#loader_news").addClass("loader_news_gif");$(".loading_modal").addClass("loading_modal_bg");$.ajax({type:"POST",url:mi.baseurl+mi.lang_country+"/load/",cache:false,dataType:"json",data:{tag:o,rss:c,action:n,mi_personal_tags_id:r},success:function(e){if(e.error=="no"){if(n=="addtag"){$("#pers_tags").prepend('<div class="p_tag" id="p_tag_'+e.id+'"><a href="'+mi.baseurl+mi.lang_country+"/search/"+o+'/" class="sha">'+o+'</a><div class="p_tag_control"><span><img class="ptagedit" height="18" id="ptagedit-'+e.id+'" src="'+mi.tpl+'images/mi_gear.png" alt="'+mi.edittag+'" title="'+mi.edittag+'"></span><span><img class="ptagdelete" height="17" src="'+mi.tpl+'images/mi_close.png"  id="ptagdelete-'+e.id+'" alt="'+mi.deletetag+'" title="'+mi.deletetag+'"></span></div></div>');i()}else if(n=="addrss"){$("#rss_search_fld").attr("data-rss","");$("#rss_search_fld").val("");$("#pers_rss").prepend('<div class="p_rss" id="p_rss_'+e.id+'"><a href="'+mi.baseurl+mi.lang_country+"/rss/"+c+"-"+h+'/" class="sha">'+d+'</a><div class="n_read"><img src="'+mi.basestat+p+'" width="16" height="16" /></div><div class="p_tag_control"><span><img class="prssedit" height="18" id="prssedit-'+e.id+'" src="'+mi.tpl+'images/mi_gear.png"  alt="'+mi.editrss+'" title="'+mi.editrss+'"></span><span><img class="prssdelete" height="17" src="'+mi.tpl+'images/mi_close.png" id="prssdelete-'+e.id+'" alt="'+mi.deleterss+'" title="'+mi.deleterss+'"></span></div></div>');i()}else if(n=="editrss"){$("#p_rss_"+r+" a:first-child").attr("href",mi.baseurl+mi.lang_country+"/rss/"+c+"-"+h+"/");$("#p_rss_"+r+"").find(".n_read img:first-child").attr("src",mi.basestat+p);$("#p_rss_"+r+" a:first-child").html(d);$("#p_rss_"+r).attr("id",e.id)}$(".loading_modal").removeClass("loading_modal_bg").addClass("ok_bg");t()}else{$(".loading_modal").html("error");t()}},error:function(){console.log("error send data")}})}});$("#tags_search_submit2, #rss_search_submit2, #submit_rssedit2").live("click",function(){var n="addtag";var r="";var s=0;if($(this).attr("id")=="tags_search_submit2"){var o=$("#tags_search_fld2").val();if(a(o)==1){s=1;e(o+mi.existrss)}n="addtag"}else if($(this).attr("id")=="rss_search_submit2"){var f=$("#rss_search_fld2").attr("data-rss");var l=f.split(":");var c=l[0];var h=l[1];var p=l[2];var d=$("#rss_search_fld2").val();if(u(d)==1){s=1;e(d+mi.existrss)}n="addrss"}else if($(this).attr("id")=="submit_rssedit2"){var f=$("#mi_rss_site").attr("data-rss");var l=f.split(":");var c=l[0];var h=l[1];var p=l[2];var d=$("#mi_rss_site").val();if(u(d)==1){s=1;e(d+mi.existrss)}var r=$("#mi_personal_tags_id").val();n="editrss";$.cookie("ur["+r+"]",c,{expires:30,path:"/"});$("#p_rss_"+r+" a:first-child").attr("href",mi.baseurl+mi.lang_country+"/rss/"+c+"-"+h+"/");$("#p_rss_"+r+"").find(".n_read img:first-child").attr("src",mi.basestat+p);$("#p_rss_"+r+" a:first-child").html(d);$("#p_rss_"+r).attr("id",r)}if(o==""){s=1;$("#tags_search_fld").attr("placeholder",mi.entertag)}if(d==""||c==""){s=1;$("#rss_search_fld").attr("placeholder",mi.enterrss)}if(s==0){$("#loader_news").addClass("loader_news_gif");$(".loading_modal").addClass("loading_modal_bg");if(n=="addtag"){var v=0;for(var m=0;m<6;m++){if(!$.cookie("ut["+m+"]")){if(v==0){$.cookie("ut["+m+"]",mi.langiso+"||"+o,{expires:30,path:"/"});$("#pers_tags").prepend('<div class="p_tag" id="p_tag_'+m+'"><a href="'+mi.baseurl+mi.lang_country+"/search/"+o+'/" class="sha">'+o+'</a><div class="p_tag_control"><span><img class="ptagedit" height="18" id="ptagedit-'+m+'" src="'+mi.tpl+'images/mi_gear.png" alt="'+mi.edittag+'" title="'+mi.edittag+'"></span><span><img class="ptagdelete" height="17" src="'+mi.tpl+'images/mi_close.png"  id="ptagdelete-'+m+'" alt="'+mi.deletetag+'" title="'+mi.deletetag+'"></span></div></div>');i();v=1}}}if(v==0){e(mi.only5tags)}}else if(n=="addrss"){$("#rss_search_fld").attr("data-rss","");$("#rss_search_fld").val("");var g=0;for(var m=0;m<6;m++){if(!$.cookie("ur["+m+"]")){if(g==0){$.cookie("ur["+m+"]",c,{expires:30,path:"/"});$("#pers_rss").prepend('<div class="p_rss2" id="p_rss_'+m+'"><a href="'+mi.baseurl+mi.lang_country+"/rss/"+c+"-"+h+'/" class="sha">'+d+'</a><div class="n_read"><img src="'+mi.basestat+p+'" width="16" height="16" /></div><div class="p_tag_control"><span><img class="prssedit2" height="18" id="prssedit-'+m+'" src="'+mi.tpl+'images/mi_gear.png"  alt="'+mi.editrss+'" title="'+mi.editrss+'"></span><span><img class="prssdelete2" height="17" src="'+mi.tpl+'images/mi_close.png" id="prssdelete-'+m+'" alt="'+mi.deleterss+'" title="'+mi.deleterss+'"></span></div></div>');i();g=1}}}if(g==0){e(mi.only5rss)}}$(".loading_modal").removeClass("loading_modal_bg").addClass("ok_bg");t()}});f("nm");l();$(".ptagdelete, .prssdelete").live("click",function(){if($(this).hasClass("ptagdelete")){var e=$(this).attr("id").replace("ptagdelete-","");var t="p_tag_"+e}else{var e=$(this).attr("id").replace("prssdelete-","");var t="p_rss_"+e}$.ajax({type:"POST",url:mi.baseurl+mi.lang_country+"/load/",cache:false,dataType:"json",data:{tagid:e,action:"removetag"},success:function(e){if(e.error=="no"){$("#"+t).css({"background-color":"#fb6c6c"},300);$("#"+t).slideUp("900")}else{$(".loading_modal").html("error")}},error:function(){console.log("error send data")}})});$(".ptagdelete2, .prssdelete2").live("click",function(){if($(this).hasClass("ptagdelete2")){var e=$(this).attr("id").replace("ptagdelete-","");var t="p_tag_"+e;$.removeCookie("ut["+e+"]",{path:"/"})}else{var e=$(this).attr("id").replace("prssdelete-","");var t="p_rss_"+e;$.removeCookie("ur["+e+"]",{path:"/"})}$("#"+t).css({"background-color":"#fb6c6c"},300);$("#"+t).slideUp("900")});$("#submit_tagedit, #submit_tagadd").live("click",function(){var t="";var n=0;if($(this).attr("id")=="submit_tagedit"){t="tag_edit"}if($(this).attr("id")=="submit_tagadd"){t="addtag"}var r=$("#mi_personal_tags_name").val();var i=$("#mi_personal_tags_id").val();var s=$("#mi_personal_tagsadv_lang :selected").val();var o=$("#mi_personal_tagsadv_country :selected").val();var u=$("#mi_personal_tagsadv_type :selected").val();var f=$("#mi_personal_tagsadv_category :selected").val();if(t=="addtag"){if(a(r)==1){n=1;e(r+mi.existrss)}}if(s!=0||o!=0||u!=0||f!=0){var l=s+"-"+o+"-"+u+"-"+f+"/"}else{var l=""}if(n==0){$(".loading_modal").addClass("loading_modal_bg");$("#submit_tagedit").animate({opacity:.4},"slow");$.ajax({type:"POST",url:mi.baseurl+mi.lang_country+"/load/",cache:false,dataType:"json",data:{mi_personal_tagsadv_lang:s,mi_personal_tagsadv_country:o,mi_personal_tagsadv_type:u,mi_personal_tagsadv_category:f,tag:r,mi_personal_tags_id:i,action:t},success:function(e){if(e.error=="no"){$("#submit_tagedit").animate({opacity:100},"slow");$(".loading_modal").removeClass("loading_modal_bg").addClass("ok_bg");if(t=="tag_edit"){$("#p_tag_"+i+" a:first-child").html(r);$("#p_tag_"+i+" a:first-child").attr("href",mi.baseurl+mi.lang_country+"/search/"+r+"/"+l)}if(t=="addtag"){$("#pers_tags").prepend('<div class="p_tag" id="p_tag_'+e.id+'"><a href="'+mi.baseurl+mi.lang_country+"/search/"+r+"/"+l+'" class="sha">'+r+'</a><div class="n_read">+0</div><div class="p_tag_control"><span><img class="ptagedit" height="18" id="ptagedit-'+e.id+'" src="'+mi.tpl+'images/mi_gear.png" alt="'+mi.edittag+'" title="'+mi.edittag+'"></span><span><img class="ptagdelete" height="17" src="'+mi.tpl+'images/mi_close.png"  id="ptagdelete-'+e.id+'" alt="'+mi.deletetag+'" title="'+mi.deletetag+'"></span></div></div>')}}else{$(".loading_modal").html("error")}},error:function(){console.log("error send data")}})}});$("#submit_tagedit2").live("click",function(){var t="";var n=0;if($(this).attr("id")=="submit_tagedit2"){t="tag_edit"}var r=$("#mi_personal_tags_name").val();var i=$("#mi_personal_tags_id").val();if(t=="tag_edit"){if(a(r)==1){n=1;e(r+mi.existrss)}}if(n==0){if(t=="tag_edit"){$.cookie("ut["+i+"]",mi.langiso+"||"+r,{expires:30,path:"/"});$("#p_tag_"+i+" a:first-child").html(r);$("#p_tag_"+i+" a:first-child").attr("href",mi.baseurl+mi.lang_country+"/search/"+r+"/");$("#submit_tagedit2").animate({opacity:100},"slow");$(".loading_modal").removeClass("loading_modal_bg").addClass("ok_bg")}}});$("#mi_settings_lang").live("change",function(){var e=$('select[name="mi_settings_country"]');var t=$("#mi_settings_lang :selected").val();var n=t.split("-");var r=n[0];$.getJSON(mi.baseurl+mi.lang_country+"/load/",{action:"get_country",lang_id:r},function(t){e.html("");$.each(t,function(t){e.append('<option value="'+t+'">'+this+"</option>")})})});$("#mi_personal_tagsadv_lang").live("change",function(){var e=$('select[name="mi_personal_tagsadv_country"]');var t=$("#mi_personal_tagsadv_lang :selected").val();var n=$('select[name="mi_personal_tagsadv_category"]');$.getJSON(mi.baseurl+mi.lang_country+"/load/",{action:"get_country",lang_id:t},function(t){e.html("");$.each(t,function(t){e.append('<option value="'+t+'">'+this+"</option>")})});$.getJSON(mi.baseurl+mi.lang_country+"/load/",{action:"get_cat",lang_id:t},function(e){n.html("");$.each(e,function(e,t){n.append('<option value="'+e+'">'+t+"</option>")})})})})