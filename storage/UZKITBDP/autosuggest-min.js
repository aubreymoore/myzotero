"undefined"==typeof bsn&&(_b=bsn={}),"undefined"==typeof _b.Autosuggest?_b.Autosuggest={}:alert("Autosuggest is already set!");var firstSuggestionCode;_b.AutoSuggest=function(t,e){if(!document.getElementById)return 0;if(this.fld=_b.DOM.gE(t),!this.fld)return 0;this.sInp="",this.nInpC=0,this.aSug=[],this.iHigh=0,this.oP=e?e:{};var s,i={minchars:1,meth:"get",varname:"input",className:"autosuggest",timeout:2500,delay:500,offsety:-5,shownoresults:!0,noresults:"No results!",maxheight:250,cache:!0,maxentries:25};for(s in i)typeof this.oP[s]!=typeof i[s]&&(this.oP[s]=i[s]);var n=this;this.fld.onkeypress=function(t){return n.onKeyPress(t)},this.fld.onkeyup=function(t){return n.onKeyUp(t)},this.fld.setAttribute("autocomplete","off")},_b.AutoSuggest.prototype.onKeyPress=function(t){var e=window.event?window.event.keyCode:t.keyCode,s=13,i=27,n=1;switch(e){case s:this.setHighlightedValue(),n=0;break;case i:this.clearSuggestions()}return n},_b.AutoSuggest.prototype.onKeyUp=function(t){var e=window.event?window.event.keyCode:t.keyCode,s=38,i=40,n=1;switch(e){case s:this.changeHighlight(e),n=0;break;case i:this.changeHighlight(e),n=0;break;default:this.getSuggestions(this.fld.value)}return n},_b.AutoSuggest.prototype.getSuggestions=function(t){if(t==this.sInp)return 0;if(_b.DOM.remE(this.idAs),this.sInp=t,t.length<this.oP.minchars)return this.aSug=[],this.nInpC=t.length,0;var e=this.nInpC;this.nInpC=t.length?t.length:0;var s=this.aSug.length;if(this.nInpC>e&&s&&s<this.oP.maxentries&&this.oP.cache){for(var i=[],n=0;s>n;n++)this.aSug[n].value.substr(0,t.length).toLowerCase()==t.toLowerCase()&&i.push(this.aSug[n]);return this.aSug=i,this.createList(this.aSug),!1}var o=this,r=this.sInp;return clearTimeout(this.ajID),o.doAjaxRequest(r),!1},_b.AutoSuggest.prototype.doAjaxRequest=function(t){if(t!=this.fld.value)return!1;var e=this;if("function"==typeof this.oP.script)var s=this.oP.script(encodeURIComponent(this.sInp));else var s=this.oP.script+this.oP.varname+"="+encodeURIComponent(this.sInp);if(!s)return!1;var i=this.oP.meth,t=this.sInp,n=function(s){e.setSuggestions(s,t)},o=function(t){alert("AJAX error: "+t)},r=new _b.Ajax;r.makeRequest(s,i,n,o)},_b.AutoSuggest.prototype.setSuggestions=function(req,input){if(input!=this.fld.value)return!1;if(this.aSug=[],this.oP.json)for(var jsondata=eval("("+req.responseText+")"),i=0;i<jsondata.results.length;i++)this.aSug.push({id:jsondata.results[i].id,value:jsondata.results[i].value,info:jsondata.results[i].info});else for(var xml=req.responseXML,results=xml.getElementsByTagName("results")[0].childNodes,i=0;i<results.length;i++)0==i&&(firstSuggestionCode=results[i].getAttribute("id")),results[i].hasChildNodes()&&this.aSug.push({id:results[i].getAttribute("id"),value:results[i].childNodes[0].nodeValue,info:results[i].getAttribute("info"),url:results[i].getAttribute("url")});this.idAs="as_"+this.fld.id,this.createList(this.aSug)},_b.AutoSuggest.prototype.createList=function(t){var e=this;if(_b.DOM.remE(this.idAs),this.killTimeout(),0==t.length&&!this.oP.shownoresults)return!1;var s=_b.DOM.cE("div",{id:this.idAs,className:this.oP.className}),i=_b.DOM.cE("div",{className:"as_corner"}),n=_b.DOM.cE("div",{className:"as_bar"}),o=_b.DOM.cE("div",{className:"as_header"});o.appendChild(i),o.appendChild(n),s.appendChild(o);for(var r=_b.DOM.cE("ul",{id:"as_ul"}),h=0;h<t.length;h++){var a=t[h].value,u=a.toLowerCase().indexOf(this.sInp.toLowerCase());if(-1==this.sInp.indexOf(" ")&&u>-1)var l=a.substring(0,u)+"<em>"+a.substring(u,u+this.sInp.length)+"</em>"+a.substring(u+this.sInp.length);else var l=a;var g=_b.DOM.cE("span",{},l,!0);if(""!=t[h].info){var d=_b.DOM.cE("br",{});g.appendChild(d);{_b.DOM.cE("small",{},t[h].info)}}var f=_b.DOM.cE("a",{href:"#"}),c=_b.DOM.cE("span",{className:"tl"}," "),p=_b.DOM.cE("span",{className:"tr"}," ");f.appendChild(c),f.appendChild(p),f.appendChild(g),f.name=h+1,f.onclick=function(){return e.setHighlightedValue(),!1},f.onmouseover=function(){e.setHighlight(this.name)};var b=_b.DOM.cE("li",{},f);r.appendChild(b)}if(0==t.length&&this.oP.shownoresults){var b=_b.DOM.cE("li",{className:"as_warning"},this.oP.noresults);r.appendChild(b)}s.appendChild(r);var v=_b.DOM.cE("div",{className:"as_corner"}),m=_b.DOM.cE("div",{className:"as_bar"}),_=_b.DOM.cE("div",{className:"as_footer"});_.appendChild(v),_.appendChild(m),s.appendChild(_);var y=_b.DOM.getPos(this.fld);s.style.left=y.x+"px",s.style.top=y.y+this.fld.offsetHeight+this.oP.offsety+"px",s.style.width=this.fld.offsetWidth+"px",s.onmouseover=function(){e.killTimeout()},s.onmouseout=function(){e.resetTimeout()},document.getElementsByTagName("body")[0].appendChild(s),this.iHigh=0;var e=this;this.toID=setTimeout(function(){e.clearSuggestions()},this.oP.timeout)},_b.AutoSuggest.prototype.changeHighlight=function(t){var e=_b.DOM.gE("as_ul");if(!e)return!1;var s;40==t?s=this.iHigh+1:38==t&&(s=this.iHigh-1),s>e.childNodes.length&&(s=e.childNodes.length),1>s&&(s=1),this.setHighlight(s)},_b.AutoSuggest.prototype.setHighlight=function(t){var e=_b.DOM.gE("as_ul");return e?(this.iHigh>0&&this.clearHighlight(),this.iHigh=Number(t),e.childNodes[this.iHigh-1].className="as_highlight",void this.killTimeout()):!1},_b.AutoSuggest.prototype.clearHighlight=function(){var t=_b.DOM.gE("as_ul");return t?void(this.iHigh>0&&(t.childNodes[this.iHigh-1].className="",this.iHigh=0)):!1},_b.AutoSuggest.prototype.setHighlightedValue=function(){this.iHigh&&(this.sInp=this.aSug[this.iHigh-1].value,this.fld.focus(),this.fld.selectionStart&&this.fld.setSelectionRange(this.sInp.length,this.sInp.length),this.clearSuggestions(),"function"==typeof this.oP.callback&&this.oP.callback(this.aSug[this.iHigh-1]))},_b.AutoSuggest.prototype.killTimeout=function(){clearTimeout(this.toID)},_b.AutoSuggest.prototype.resetTimeout=function(){clearTimeout(this.toID);var t=this;this.toID=setTimeout(function(){t.clearSuggestions()},1e3)},_b.AutoSuggest.prototype.clearSuggestions=function(){this.killTimeout();var t=_b.DOM.gE(this.idAs),e=this;t&&_b.DOM.remE(e.idAs)},"undefined"==typeof _b.Ajax&&(_b.Ajax={}),_b.Ajax=function(){this.req={},this.isIE=!1},_b.Ajax.prototype.makeRequest=function(t,e,s,i){"POST"!=e&&(e="GET"),this.onComplete=s,this.onError=i;var n=this;window.XMLHttpRequest?(this.req=new XMLHttpRequest,this.req.onreadystatechange=function(){n.processReqChange()},this.req.open("GET",t,!0),this.req.send(null)):window.ActiveXObject&&(this.req=new ActiveXObject("Microsoft.XMLHTTP"),this.req&&(this.req.onreadystatechange=function(){n.processReqChange()},this.req.open(e,t,!0),this.req.send()))},_b.Ajax.prototype.processReqChange=function(){4==this.req.readyState&&(200==this.req.status?this.onComplete(this.req):this.onError(this.req.status))},"undefined"==typeof _b.DOM&&(_b.DOM={}),_b.DOM.cE=function(t,e,s,i){var n=document.createElement(t);if(!n)return 0;for(var o in e)n[o]=e[o];var r=typeof s;return"string"!=r||i?"string"==r&&i?n.innerHTML=s:"object"==r&&n.appendChild(s):n.appendChild(document.createTextNode(s)),n},_b.DOM.gE=function(t){var e=typeof t;if("undefined"==e)return 0;if("string"==e){var s=document.getElementById(t);return s&&"undefined"!=typeof s.appendChild?s:0}return"undefined"!=typeof t.appendChild?t:0},_b.DOM.remE=function(t){var e=this.gE(t);return e&&e.parentNode.removeChild(e)?!0:0},_b.DOM.getPos=function(t){var t=this.gE(t),e=t,s=0;if(e.offsetParent)for(;e.offsetParent;)s+=e.offsetLeft,e=e.offsetParent;else e.x&&(s+=e.x);var e=t,i=0;if(e.offsetParent)for(;e.offsetParent;)i+=e.offsetTop,e=e.offsetParent;else e.y&&(i+=e.y);return{x:s,y:i}};
